// @bun
var cU=Object.create;var{defineProperty:OW,getPrototypeOf:uU,getOwnPropertyNames:oU}=Object;var iU=Object.prototype.hasOwnProperty;var L$=($,W,X)=>{X=$!=null?cU(uU($)):{};const Y=W||!$||!$.__esModule?OW(X,"default",{value:$,enumerable:!0}):X;for(let Z of oU($))if(!iU.call(Y,Z))OW(Y,Z,{get:()=>$[Z],enumerable:!0});return Y};var o6=($,W)=>()=>(W||$((W={exports:{}}).exports,W),W.exports);var n8=($,W)=>{for(var X in W)OW($,X,{get:W[X],enumerable:!0,configurable:!0,set:(Y)=>W[X]=()=>Y})};var q7=o6((QK,NW)=>{var F$=function(){},nU=function($,W,X){this.fn=$,this.context=W,this.once=X||!1},C7=function($,W,X,Y,Z){if(typeof X!=="function")throw new TypeError("The listener must be a function");var J=new nU(X,Y||$,Z),z=Z1?Z1+W:W;if(!$._events[z])$._events[z]=J,$._eventsCount++;else if(!$._events[z].fn)$._events[z].push(J);else $._events[z]=[$._events[z],J];return $},p5=function($,W){if(--$._eventsCount===0)$._events=new F$;else delete $._events[W]},s2=function(){this._events=new F$,this._eventsCount=0},lU=Object.prototype.hasOwnProperty,Z1="~";if(Object.create){if(F$.prototype=Object.create(null),!new F$().__proto__)Z1=!1}s2.prototype.eventNames=function $(){var W=[],X,Y;if(this._eventsCount===0)return W;for(Y in X=this._events)if(lU.call(X,Y))W.push(Z1?Y.slice(1):Y);if(Object.getOwnPropertySymbols)return W.concat(Object.getOwnPropertySymbols(X));return W};s2.prototype.listeners=function $(W){var X=Z1?Z1+W:W,Y=this._events[X];if(!Y)return[];if(Y.fn)return[Y.fn];for(var Z=0,J=Y.length,z=new Array(J);Z<J;Z++)z[Z]=Y[Z].fn;return z};s2.prototype.listenerCount=function $(W){var X=Z1?Z1+W:W,Y=this._events[X];if(!Y)return 0;if(Y.fn)return 1;return Y.length};s2.prototype.emit=function $(W,X,Y,Z,J,z){var Q=Z1?Z1+W:W;if(!this._events[Q])return!1;var G=this._events[Q],A=arguments.length,w,D;if(G.fn){if(G.once)this.removeListener(W,G.fn,void 0,!0);switch(A){case 1:return G.fn.call(G.context),!0;case 2:return G.fn.call(G.context,X),!0;case 3:return G.fn.call(G.context,X,Y),!0;case 4:return G.fn.call(G.context,X,Y,Z),!0;case 5:return G.fn.call(G.context,X,Y,Z,J),!0;case 6:return G.fn.call(G.context,X,Y,Z,J,z),!0}for(D=1,w=new Array(A-1);D<A;D++)w[D-1]=arguments[D];G.fn.apply(G.context,w)}else{var O=G.length,L;for(D=0;D<O;D++){if(G[D].once)this.removeListener(W,G[D].fn,void 0,!0);switch(A){case 1:G[D].fn.call(G[D].context);break;case 2:G[D].fn.call(G[D].context,X);break;case 3:G[D].fn.call(G[D].context,X,Y);break;case 4:G[D].fn.call(G[D].context,X,Y,Z);break;default:if(!w)for(L=1,w=new Array(A-1);L<A;L++)w[L-1]=arguments[L];G[D].fn.apply(G[D].context,w)}}}return!0};s2.prototype.on=function $(W,X,Y){return C7(this,W,X,Y,!1)};s2.prototype.once=function $(W,X,Y){return C7(this,W,X,Y,!0)};s2.prototype.removeListener=function $(W,X,Y,Z){var J=Z1?Z1+W:W;if(!this._events[J])return this;if(!X)return p5(this,J),this;var z=this._events[J];if(z.fn){if(z.fn===X&&(!Z||z.once)&&(!Y||z.context===Y))p5(this,J)}else{for(var Q=0,G=[],A=z.length;Q<A;Q++)if(z[Q].fn!==X||Z&&!z[Q].once||Y&&z[Q].context!==Y)G.push(z[Q]);if(G.length)this._events[J]=G.length===1?G[0]:G;else p5(this,J)}return this};s2.prototype.removeAllListeners=function $(W){var X;if(W){if(X=Z1?Z1+W:W,this._events[X])p5(this,X)}else this._events=new F$,this._eventsCount=0;return this};s2.prototype.off=s2.prototype.removeListener;s2.prototype.addListener=s2.prototype.on;s2.prefixed=Z1;s2.EventEmitter=s2;if(typeof NW!=="undefined")NW.exports=s2});var M4=o6((ov,lZ)=>{var nN=function($){var W=$.indexOf("%");if(W===-1)return $;var X=$.length,Y="",Z=0,J=0,z=W,Q=oZ;while(W>-1&&W<X){var G=iZ($[W+1],4),A=iZ($[W+2],0),w=G|A,D=h9[w];if(Q=h9[256+Q+D],J=J<<6|w&h9[364+D],Q===oZ)Y+=$.slice(Z,z),Y+=J<=65535?String.fromCharCode(J):String.fromCharCode(55232+(J>>10),56320+(J&1023)),J=0,Z=W+3,W=z=$.indexOf("%",Z);else if(Q===lN)return null;else{if(W+=3,W<X&&$.charCodeAt(W)===37)continue;return null}}return Y+$.slice(Z)},iZ=function($,W){var X=tN[$];return X===void 0?255:X<<W},oZ=12,lN=0,h9=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7],tN={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};lZ.exports=nN});var aZ=o6((iv,rZ)=>{var sN=function($){const W=new sZ;if(typeof $!=="string")return W;let X=$.length,Y="",Z="",J=-1,z=-1,Q=!1,G=!1,A=!1,w=!1,D=!1,O=0;for(let L=0;L<X+1;L++)if(O=L!==X?$.charCodeAt(L):38,O===38){if(D=z>J,!D)z=L;if(Y=$.slice(J+1,z),D||Y.length>0){if(A)Y=Y.replace(tZ," ");if(Q)Y=nZ(Y)||Y;if(D){if(Z=$.slice(z+1,L),w)Z=Z.replace(tZ," ");if(G)Z=nZ(Z)||Z}const B=W[Y];if(B===void 0)W[Y]=Z;else if(B.pop)B.push(Z);else W[Y]=[B,Z]}Z="",J=L,z=L,Q=!1,G=!1,A=!1,w=!1}else if(O===61)if(z<=J)z=L;else G=!0;else if(O===43)if(z>J)w=!0;else A=!0;else if(O===37)if(z>J)G=!0;else Q=!0;return W},nZ=M4(),tZ=/\+/g,sZ=function(){};sZ.prototype=Object.create(null);rZ.exports=sN});var $J=o6((lv,eZ)=>{var aN=function($){const W=$.length;if(W===0)return"";let X="",Y=0,Z=0;$:for(;Z<W;Z++){let J=$.charCodeAt(Z);while(J<128){if(rN[J]!==1){if(Y<Z)X+=$.slice(Y,Z);Y=Z+1,X+=P8[J]}if(++Z===W)break $;J=$.charCodeAt(Z)}if(Y<Z)X+=$.slice(Y,Z);if(J<2048){Y=Z+1,X+=P8[192|J>>6]+P8[128|J&63];continue}if(J<55296||J>=57344){Y=Z+1,X+=P8[224|J>>12]+P8[128|J>>6&63]+P8[128|J&63];continue}if(++Z,Z>=W)throw new Error("URI malformed");const z=$.charCodeAt(Z)&1023;Y=Z+1,J=65536+((J&1023)<<10|z),X+=P8[240|J>>18]+P8[128|J>>12&63]+P8[128|J>>6&63]+P8[128|J&63]}if(Y===0)return $;if(Y<W)return X+$.slice(Y);return X},P8=Array.from({length:256},($,W)=>"%"+((W<16?"0":"")+W.toString(16)).toUpperCase()),rN=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]);eZ.exports={encodeString:aN}});var YJ=o6((nv,XJ)=>{var WJ=function($){const W=typeof $;if(W==="string")return p9($);else if(W==="bigint")return $.toString();else if(W==="boolean")return $?"true":"false";else if(W==="number"&&Number.isFinite($))return $<1000000000000000000000?""+$:p9(""+$);return""},eN=function($){let W="";if($===null||typeof $!=="object")return W;const X="&",Y=Object.keys($),Z=Y.length;let J=0;for(let z=0;z<Z;z++){const Q=Y[z],G=$[Q],A=p9(Q)+"=";if(z)W+=X;if(Array.isArray(G)){J=G.length;for(let w=0;w<J;w++){if(w)W+=X;W+=A,W+=WJ(G[w])}}else W+=A,W+=WJ(G)}return W},{encodeString:p9}=$J();XJ.exports=eN});var m9=o6((tv,M5)=>{var ZJ=aZ(),JJ=YJ(),zJ={parse:ZJ,stringify:JJ};M5.exports=zJ;M5.exports.default=zJ;M5.exports.parse=ZJ;M5.exports.stringify=JJ});var V7=L$(q7(),1);var j7=V7.default;function m5($){return c2($)&&Symbol.asyncIterator in $}function c5($){return c2($)&&Symbol.iterator in $}function M2($){return c2($)&&(Object.getPrototypeOf($)===Object.prototype||Object.getPrototypeOf($)===null)}function u5($){return $ instanceof Promise}function R1($){return $ instanceof Date&&Number.isFinite($.getTime())}function f1($){return ArrayBuffer.isView($)}function i6($){return $ instanceof globalThis.Uint8Array}function I0($,W){return W in $}function c2($){return $!==null&&typeof $==="object"}function K0($){return Array.isArray($)&&!ArrayBuffer.isView($)}function N2($){return $===void 0}function x8($){return $===null}function H8($){return typeof $==="boolean"}function D0($){return typeof $==="number"}function o5($){return Number.isInteger($)}function u2($){return typeof $==="bigint"}function C0($){return typeof $==="string"}function i5($){return typeof $==="function"}function w1($){return typeof $==="symbol"}function P1($){return u2($)||H8($)||x8($)||D0($)||C0($)||w1($)||N2($)}var C2;(function($){$.ExactOptionalPropertyTypes=!1,$.AllowArrayObject=!1,$.AllowNaN=!1,$.AllowNullVoid=!1;function W(z,Q){return $.ExactOptionalPropertyTypes?Q in z:z[Q]!==void 0}$.IsExactOptionalProperty=W;function X(z){const Q=c2(z);return $.AllowArrayObject?Q:Q&&!K0(z)}$.IsObjectLike=X;function Y(z){return X(z)&&!(z instanceof Date)&&!(z instanceof Uint8Array)}$.IsRecordLike=Y;function Z(z){return $.AllowNaN?D0(z):Number.isFinite(z)}$.IsNumberLike=Z;function J(z){const Q=N2(z);return $.AllowNullVoid?Q||z===null:Q}$.IsVoidLike=J})(C2||(C2={}));var O2={};n8(O2,{Set:()=>{{return eU}},Has:()=>{{return aU}},Get:()=>{{return $M}},Entries:()=>{{return tU}},Delete:()=>{{return rU}},Clear:()=>{{return sU}}});function tU(){return new Map(l6)}function sU(){return l6.clear()}function rU($){return l6.delete($)}function aU($){return l6.has($)}function eU($,W){l6.set($,W)}function $M($){return l6.get($)}var l6=new Map;var q2={};n8(q2,{Set:()=>{{return JM}},Has:()=>{{return ZM}},Get:()=>{{return zM}},Entries:()=>{{return WM}},Delete:()=>{{return YM}},Clear:()=>{{return XM}}});function WM(){return new Map(n6)}function XM(){return n6.clear()}function YM($){return n6.delete($)}function ZM($){return n6.has($)}function JM($,W){n6.set($,W)}function zM($){return n6.get($)}var n6=new Map;var V2=Symbol.for("TypeBox.Transform"),D8=Symbol.for("TypeBox.Readonly"),r2=Symbol.for("TypeBox.Optional"),E1=Symbol.for("TypeBox.Hint"),h=Symbol.for("TypeBox.Kind");function K$($={}){return{...$,[h]:$[h]??"Unsafe"}}class P0 extends Error{constructor($){super($)}}class LW extends P0{constructor($){super(`Duplicate type kind '${$}' detected`)}}class FW extends P0{constructor($){super(`Duplicate string format '${$}' detected`)}}var B8;(function($){function W(Y,Z){if(q2.Has(Y))throw new LW(Y);return q2.Set(Y,Z),(J={})=>K$({...J,[h]:Y})}$.Type=W;function X(Y,Z){if(O2.Has(Y))throw new FW(Y);return O2.Set(Y,Z),Y}$.Format=X})(B8||(B8={}));function g0($){return{[h]:"MappedResult",properties:$}}var _1={};n8(_1,{IsUndefined:()=>{{return L2}},IsUint8Array:()=>{{return _6}},IsSymbol:()=>{{return CW}},IsString:()=>{{return A2}},IsRegExp:()=>{{return EW}},IsObject:()=>{{return w2}},IsNumber:()=>{{return X8}},IsNull:()=>{{return PW}},IsIterator:()=>{{return RW}},IsFunction:()=>{{return SW}},IsDate:()=>{{return R$}},IsBoolean:()=>{{return t8}},IsBigInt:()=>{{return S$}},IsAsyncIterator:()=>{{return KW}},IsArray:()=>{{return A1}}});function KW($){return w2($)&&!A1($)&&!_6($)&&Symbol.asyncIterator in $}function A1($){return Array.isArray($)}function S$($){return typeof $==="bigint"}function t8($){return typeof $==="boolean"}function R$($){return $ instanceof globalThis.Date}function SW($){return typeof $==="function"}function RW($){return w2($)&&!A1($)&&!_6($)&&Symbol.iterator in $}function PW($){return $===null}function X8($){return typeof $==="number"}function w2($){return typeof $==="object"&&$!==null}function EW($){return $ instanceof globalThis.RegExp}function A2($){return typeof $==="string"}function CW($){return typeof $==="symbol"}function _6($){return $ instanceof globalThis.Uint8Array}function L2($){return $===void 0}var QM=function($){return $.map((W)=>l5(W))},GM=function($){return new Date($.getTime())},UM=function($){return new Uint8Array($)},MM=function($){return new RegExp($.source,$.flags)},wM=function($){const W={};for(let X of Object.getOwnPropertyNames($))W[X]=l5($[X]);for(let X of Object.getOwnPropertySymbols($))W[X]=l5($[X]);return W},l5=function($){return A1($)?QM($):R$($)?GM($):_6($)?UM($):EW($)?MM($):w2($)?wM($):$};function I7($){return l5($)}function R2($){return $.map((W)=>G0(W))}function G0($,W={}){return{...I7($),...W}}var AM=function($,W){const{[W]:X,...Y}=$;return Y};function P2($,W){return W.reduce((X,Y)=>AM(X,Y),$)}function P$($,W={}){return{...W,[h]:"Array",type:"array",items:G0($)}}function E$($,W={}){return{...W,[h]:"AsyncIterator",type:"AsyncIterator",items:G0($)}}function C$($,W,X){return{...X,[h]:"Constructor",type:"Constructor",parameters:R2($),returns:G0(W)}}function k8($,W,X){return{...X,[h]:"Function",type:"Function",parameters:R2($),returns:G0(W)}}function s0($={}){return{...$,[h]:"Never",not:{}}}function b7($){return w2($)&&$[D8]==="Readonly"}function O8($){return w2($)&&$[r2]==="Optional"}function _M($){return f0($,"Any")}function T8($){return f0($,"Array")}function q$($){return f0($,"AsyncIterator")}function qW($){return f0($,"BigInt")}function VW($){return f0($,"Boolean")}function V$($){return f0($,"Constructor")}function HM($){return f0($,"Date")}function j$($){return f0($,"Function")}function H6($){return f0($,"Integer")}function j2($){return f0($,"Intersect")}function I$($){return f0($,"Iterator")}function f0($,W){return w2($)&&h in $&&$[h]===W}function g8($){return f0($,"Literal")}function C1($){return f0($,"MappedKey")}function B2($){return f0($,"MappedResult")}function t6($){return f0($,"Never")}function DM($){return f0($,"Not")}function BM($){return f0($,"Null")}function D6($){return f0($,"Number")}function f2($){return f0($,"Object")}function B6($){return f0($,"Promise")}function jW($){return f0($,"Record")}function IW($){return f0($,"Ref")}function bW($){return f0($,"RegExp")}function b$($){return f0($,"String")}function OM($){return f0($,"Symbol")}function q1($){return f0($,"TemplateLiteral")}function NM($){return f0($,"This")}function s6($){return w2($)&&V2 in $}function Y8($){return f0($,"Tuple")}function LM($){return f0($,"Undefined")}function p0($){return f0($,"Union")}function FM($){return f0($,"Uint8Array")}function KM($){return f0($,"Unknown")}function SM($){return f0($,"Unsafe")}function RM($){return f0($,"Void")}function PM($){return w2($)&&h in $&&A2($[h])}function V1($){return _M($)||T8($)||VW($)||qW($)||q$($)||V$($)||HM($)||j$($)||H6($)||j2($)||I$($)||g8($)||C1($)||B2($)||t6($)||DM($)||BM($)||D6($)||f2($)||B6($)||jW($)||IW($)||bW($)||b$($)||OM($)||q1($)||NM($)||Y8($)||LM($)||p0($)||FM($)||KM($)||SM($)||RM($)||PM($)}var CM=function($){return P2(G0($),[r2])},qM=function($){return{...G0($),[r2]:"Optional"}},VM=function($,W){return W===!1?CM($):qM($)};function J1($,W){const X=W??!0;return B2($)?x7($,X):VM($,X)}var jM=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames($))X[Y]=J1($[Y],W);return X},IM=function($,W){return jM($.properties,W)};function x7($,W){const X=IM($,W);return g0(X)}function x$($,W){const X=$.every((Z)=>f2(Z)),Y=V1(W.unevaluatedProperties)?{unevaluatedProperties:G0(W.unevaluatedProperties)}:{};return W.unevaluatedProperties===!1||V1(W.unevaluatedProperties)||X?{...W,...Y,[h]:"Intersect",type:"object",allOf:R2($)}:{...W,...Y,[h]:"Intersect",allOf:R2($)}}var bM=function($){return $.every((W)=>O8(W))},xM=function($){return P2($,[r2])},k7=function($){return $.map((W)=>O8(W)?xM(W):W)},kM=function($,W){return bM($)?J1(x$(k7($),W)):x$(k7($),W)};function n5($,W={}){if($.length===0)return s0(W);if($.length===1)return G0($[0],W);if($.some((X)=>s6(X)))throw new Error("Cannot intersect transform types");return kM($,W)}function z1($,W={}){if($.length===0)return s0(W);if($.length===1)return G0($[0],W);if($.some((X)=>s6(X)))throw new Error("Cannot intersect transform types");return x$($,W)}function k$($,W){return{...W,[h]:"Union",anyOf:R2($)}}var TM=function($){return $.some((W)=>O8(W))},T7=function($){return $.map((W)=>O8(W)?gM(W):W)},gM=function($){return P2($,[r2])},fM=function($,W){return TM($)?J1(k$(T7($),W)):k$(T7($),W)};function N8($,W={}){return $.length===0?s0(W):$.length===1?G0($[0],W):fM($,W)}function r0($,W={}){return $.length===0?s0(W):$.length===1?G0($[0],W):k$($,W)}var yM=function($){return $.replace(/\\\$/g,"$").replace(/\\\*/g,"*").replace(/\\\^/g,"^").replace(/\\\|/g,"|").replace(/\\\(/g,"(").replace(/\\\)/g,")")},kW=function($,W,X){return $[W]===X&&$.charCodeAt(W-1)!==92},f8=function($,W){return kW($,W,"(")},T$=function($,W){return kW($,W,")")},g7=function($,W){return kW($,W,"|")},dM=function($){if(!(f8($,0)&&T$($,$.length-1)))return!1;let W=0;for(let X=0;X<$.length;X++){if(f8($,X))W+=1;if(T$($,X))W-=1;if(W===0&&X!==$.length-1)return!1}return!0},vM=function($){return $.slice(1,$.length-1)},hM=function($){let W=0;for(let X=0;X<$.length;X++){if(f8($,X))W+=1;if(T$($,X))W-=1;if(g7($,X)&&W===0)return!0}return!1},pM=function($){for(let W=0;W<$.length;W++)if(f8($,W))return!0;return!1},mM=function($){let[W,X]=[0,0];const Y=[];for(let J=0;J<$.length;J++){if(f8($,J))W+=1;if(T$($,J))W-=1;if(g7($,J)&&W===0){const z=$.slice(X,J);if(z.length>0)Y.push(r6(z));X=J+1}}const Z=$.slice(X);if(Z.length>0)Y.push(r6(Z));if(Y.length===0)return{type:"const",const:""};if(Y.length===1)return Y[0];return{type:"or",expr:Y}},cM=function($){function W(Z,J){if(!f8(Z,J))throw new xW("TemplateLiteralParser: Index must point to open parens");let z=0;for(let Q=J;Q<Z.length;Q++){if(f8(Z,Q))z+=1;if(T$(Z,Q))z-=1;if(z===0)return[J,Q]}throw new xW("TemplateLiteralParser: Unclosed group parens in expression")}function X(Z,J){for(let z=J;z<Z.length;z++)if(f8(Z,z))return[J,z];return[J,Z.length]}const Y=[];for(let Z=0;Z<$.length;Z++)if(f8($,Z)){const[J,z]=W($,Z),Q=$.slice(J,z+1);Y.push(r6(Q)),Z=z}else{const[J,z]=X($,Z),Q=$.slice(J,z);if(Q.length>0)Y.push(r6(Q));Z=z-1}return Y.length===0?{type:"const",const:""}:Y.length===1?Y[0]:{type:"and",expr:Y}};function r6($){return dM($)?r6(vM($)):hM($)?mM($):pM($)?cM($):{type:"const",const:yM($)}}function a6($){return r6($.slice(1,$.length-1))}class xW extends P0{}var uM=function($){return $.type==="or"&&$.expr.length===2&&$.expr[0].type==="const"&&$.expr[0].const==="0"&&$.expr[1].type==="const"&&$.expr[1].const==="[1-9][0-9]*"},oM=function($){return $.type==="or"&&$.expr.length===2&&$.expr[0].type==="const"&&$.expr[0].const==="true"&&$.expr[1].type==="const"&&$.expr[1].const==="false"},iM=function($){return $.type==="const"&&$.const===".*"};function O6($){return uM($)||iM($)?!1:oM($)?!0:$.type==="and"?$.expr.every((W)=>O6(W)):$.type==="or"?$.expr.every((W)=>O6(W)):$.type==="const"?!0:(()=>{throw new f7("Unknown expression type")})()}function t5($){const W=a6($.pattern);return O6(W)}class f7 extends P0{}function*d7($){if($.length===1)return yield*$[0];for(let W of $[0])for(let X of d7($.slice(1)))yield`${W}${X}`}function*lM($){return yield*d7($.expr.map((W)=>[...g$(W)]))}function*nM($){for(let W of $.expr)yield*g$(W)}function*tM($){return yield $.const}function*g$($){return $.type==="and"?yield*lM($):$.type==="or"?yield*nM($):$.type==="const"?yield*tM($):(()=>{throw new y7("Unknown expression")})()}function e6($){const W=a6($.pattern);return O6(W)?[...g$(W)]:[]}class y7 extends P0{}function m0($,W={}){return{...W,[h]:"Literal",const:$,type:typeof $}}function f$($={}){return{...$,[h]:"Boolean",type:"boolean"}}function N6($={}){return{...$,[h]:"BigInt",type:"bigint"}}function Z8($={}){return{...$,[h]:"Number",type:"number"}}function j1($={}){return{...$,[h]:"String",type:"string"}}function*sM($){const W=$.trim().replace(/"|'/g,"");return W==="boolean"?yield f$():W==="number"?yield Z8():W==="bigint"?yield N6():W==="string"?yield j1():yield(()=>{const X=W.split("|").map((Y)=>m0(Y.trim()));return X.length===0?s0():X.length===1?X[0]:N8(X)})()}function*rM($){if($[1]!=="{"){const W=m0("$"),X=TW($.slice(1));return yield*[W,...X]}for(let W=2;W<$.length;W++)if($[W]==="}"){const X=sM($.slice(2,W)),Y=TW($.slice(W+1));return yield*[...X,...Y]}yield m0($)}function*TW($){for(let W=0;W<$.length;W++)if($[W]==="$"){const X=m0($.slice(0,W)),Y=rM($.slice(W));return yield*[X,...Y]}yield m0($)}function v7($){return[...TW($)]}var h7="(true|false)",s5="(0|[1-9][0-9]*)",p7="(.*)";var y8="^(0|[1-9][0-9]*)$",s8="^(.*)$";var aM=function($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},c7=function($,W){return q1($)?$.pattern.slice(1,$.pattern.length-1):p0($)?`(${$.anyOf.map((X)=>c7(X,W)).join("|")})`:D6($)?`${W}${s5}`:H6($)?`${W}${s5}`:qW($)?`${W}${s5}`:b$($)?`${W}${p7}`:g8($)?`${W}${aM($.const.toString())}`:VW($)?`${W}${h7}`:(()=>{throw new m7(`Unexpected Kind '${$[h]}'`)})()};function gW($){return`^${$.map((W)=>c7(W,"")).join("")}$`}class m7 extends P0{}function L6($){const X=e6($).map((Y)=>m0(Y));return N8(X)}function y$($,W={}){const X=A2($)?gW(v7($)):gW($);return{...W,[h]:"TemplateLiteral",type:"string",pattern:X}}var eM=function($){return e6($).map((X)=>X.toString())},$w=function($){const W=[];for(let X of $)W.push(...H1(X));return W},Ww=function($){return[$.toString()]};function H1($){return[...new Set(q1($)?eM($):p0($)?$w($.anyOf):g8($)?Ww($.const):D6($)?["[number]"]:H6($)?["[number]"]:[])]}var Xw=function($,W,X){const Y={};for(let Z of Object.getOwnPropertyNames(W))Y[Z]=F6($,H1(W[Z]),X);return Y},Yw=function($,W,X){return Xw($,W.properties,X)};function u7($,W,X){const Y=Yw($,W,X);return g0(Y)}var i7=function($,W){return $.map((X)=>l7(X,W))},Zw=function($){return $.filter((W)=>!t6(W))},Jw=function($,W){return n5(Zw(i7($,W)))},zw=function($){return $.some((W)=>t6(W))?[]:$},Qw=function($,W){return N8(zw(i7($,W)))},Gw=function($,W){return W in $?$[W]:W==="[number]"?N8($):s0()},Uw=function($,W){return W==="[number]"?$:s0()},Mw=function($,W){return W in $?$[W]:s0()};function l7($,W){return j2($)?Jw($.allOf,W):p0($)?Qw($.anyOf,W):Y8($)?Gw($.items??[],W):T8($)?Uw($.items,W):f2($)?Mw($.properties,W):s0()}function d$($,W){return W.map((X)=>l7($,X))}var o7=function($,W){return N8(d$($,W))};function F6($,W,X={}){return B2(W)?G0(u7($,W,X)):C1(W)?G0(n7($,W,X)):V1(W)?G0(o7($,H1(W)),X):G0(o7($,W),X)}var ww=function($,W,X){return{[W]:F6($,[W],X)}},Aw=function($,W,X){return W.reduce((Y,Z)=>{return{...Y,...ww($,Z,X)}},{})},_w=function($,W,X){return Aw($,W.keys,X)};function n7($,W,X){const Y=_w($,W,X);return g0(Y)}function v$($,W={}){return{...W,[h]:"Iterator",type:"Iterator",items:G0($)}}var Hw=function($,W={}){const X=globalThis.Object.getOwnPropertyNames($),Y=X.filter((Q)=>O8($[Q])),Z=X.filter((Q)=>!Y.includes(Q)),J=V1(W.additionalProperties)?{additionalProperties:G0(W.additionalProperties)}:{},z={};for(let Q of X)z[Q]=G0($[Q]);return Z.length>0?{...W,...J,[h]:"Object",type:"object",properties:z,required:Z}:{...W,...J,[h]:"Object",type:"object",properties:z}},e0=Hw;function h$($,W={}){return{...W,[h]:"Promise",type:"Promise",item:G0($)}}var Dw=function($){return P2(G0($),[D8])},Bw=function($){return{...G0($),[D8]:"Readonly"}},Ow=function($,W){return W===!1?Dw($):Bw($)};function I1($,W){const X=W??!0;return B2($)?t7($,X):Ow($,X)}var Nw=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames($))X[Y]=I1($[Y],W);return X},Lw=function($,W){return Nw($.properties,W)};function t7($,W){const X=Lw($,W);return g0(X)}function J8($,W={}){const[X,Y,Z]=[!1,$.length,$.length];return $.length>0?{...W,[h]:"Tuple",type:"array",items:R2($),additionalItems:X,minItems:Y,maxItems:Z}:{...W,[h]:"Tuple",type:"array",minItems:Y,maxItems:Z}}function s7($,W){return $.includes(W)}function r7($){return[...new Set($)]}function Fw($,W){return $.filter((X)=>W.includes(X))}var Kw=function($,W){return $.reduce((X,Y)=>{return Fw(X,Y)},W)};function a7($){return $.length===1?$[0]:$.length>1?Kw($.slice(1),$[0]):[]}function e7($){const W=[];for(let X of $)W.push(...X);return W}var $Y=function($,W){return $ in W?y1($,W[$]):g0(W)},Sw=function($){return{[$]:m0($)}},Rw=function($){const W={};for(let X of $)W[X]=m0(X);return W},Pw=function($,W){return s7(W,$)?Sw($):Rw(W)},Ew=function($,W){const X=Pw($,W);return $Y($,X)},p$=function($,W){return W.map((X)=>y1($,X))},Cw=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames(W))X[Y]=y1($,W[Y]);return X},y1=function($,W){return O8(W)?J1(y1($,P2(W,[r2]))):b7(W)?I1(y1($,P2(W,[D8]))):B2(W)?$Y($,W.properties):C1(W)?Ew($,W.keys):V$(W)?C$(p$($,W.parameters),y1($,W.returns)):j$(W)?k8(p$($,W.parameters),y1($,W.returns)):q$(W)?E$(y1($,W.items)):I$(W)?v$(y1($,W.items)):j2(W)?z1(p$($,W.allOf)):p0(W)?r0(p$($,W.anyOf)):Y8(W)?J8(p$($,W.items??[])):f2(W)?e0(Cw($,W.properties)):T8(W)?P$(y1($,W.items)):B6(W)?h$(y1($,W.item)):W};function qw($,W){const X={};for(let Y of $)X[Y]=y1(Y,W);return X}function fW($,W,X={}){const Y=V1($)?H1($):$,Z=W({[h]:"MappedKey",keys:Y}),J=qw(Y,Z);return G0(e0(J),X)}var WY=function($){const W=[];for(let X of $)W.push(D1(X));return W},Vw=function($){const W=WY($);return e7(W)},jw=function($){const W=WY($);return a7(W)},Iw=function($){return $.map((W,X)=>X.toString())},bw=function($){return["[number]"]},xw=function($){return globalThis.Object.getOwnPropertyNames($)},kw=function($){if(!yW)return[];return globalThis.Object.getOwnPropertyNames($).map((X)=>{return X[0]==="^"&&X[X.length-1]==="$"?X.slice(1,X.length-1):X})};function D1($){return j2($)?Vw($.allOf):p0($)?jw($.anyOf):Y8($)?Iw($.items??[]):T8($)?bw($.items):f2($)?xw($.properties):jW($)?kw($.patternProperties):[]}function d8($){yW=!0;const W=D1($);return yW=!1,`^(${W.map((Y)=>`(${Y})`).join("|")})\$`}var yW=!1;function Tw($){return $.map((W)=>W==="[number]"?Z8():m0(W))}function m$($,W={}){if(B2($))return XY($,W);else{const X=D1($),Y=Tw(X),Z=N8(Y);return G0(Z,W)}}var gw=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames($))X[Y]=m$($[Y],W);return X},fw=function($,W){return gw($.properties,W)};function XY($,W){const X=fw($,W);return g0(X)}function r5($){const W=D1($),X=d$($,W);return W.map((Y,Z)=>[W[Z],X[Z]])}var yw=function($){return $.allOf.every((W)=>v8(W))},dw=function($){return $.anyOf.some((W)=>v8(W))},vw=function($){return!v8($.not)};function v8($){return $[h]==="Intersect"?yw($):$[h]==="Union"?dw($):$[h]==="Not"?vw($):$[h]==="Undefined"?!0:!1}function hw($){switch($.errorType){case m.ArrayContains:return"Expected array to contain at least one matching value";case m.ArrayMaxContains:return`Expected array to contain no more than ${$.schema.maxContains} matching values`;case m.ArrayMinContains:return`Expected array to contain at least ${$.schema.minContains} matching values`;case m.ArrayMaxItems:return`Expected array length to be less or equal to ${$.schema.maxItems}`;case m.ArrayMinItems:return`Expected array length to be greater or equal to ${$.schema.minItems}`;case m.ArrayUniqueItems:return"Expected array elements to be unique";case m.Array:return"Expected array";case m.AsyncIterator:return"Expected AsyncIterator";case m.BigIntExclusiveMaximum:return`Expected bigint to be less than ${$.schema.exclusiveMaximum}`;case m.BigIntExclusiveMinimum:return`Expected bigint to be greater than ${$.schema.exclusiveMinimum}`;case m.BigIntMaximum:return`Expected bigint to be less or equal to ${$.schema.maximum}`;case m.BigIntMinimum:return`Expected bigint to be greater or equal to ${$.schema.minimum}`;case m.BigIntMultipleOf:return`Expected bigint to be a multiple of ${$.schema.multipleOf}`;case m.BigInt:return"Expected bigint";case m.Boolean:return"Expected boolean";case m.DateExclusiveMinimumTimestamp:return`Expected Date timestamp to be greater than ${$.schema.exclusiveMinimumTimestamp}`;case m.DateExclusiveMaximumTimestamp:return`Expected Date timestamp to be less than ${$.schema.exclusiveMaximumTimestamp}`;case m.DateMinimumTimestamp:return`Expected Date timestamp to be greater or equal to ${$.schema.minimumTimestamp}`;case m.DateMaximumTimestamp:return`Expected Date timestamp to be less or equal to ${$.schema.maximumTimestamp}`;case m.DateMultipleOfTimestamp:return`Expected Date timestamp to be a multiple of ${$.schema.multipleOfTimestamp}`;case m.Date:return"Expected Date";case m.Function:return"Expected function";case m.IntegerExclusiveMaximum:return`Expected integer to be less than ${$.schema.exclusiveMaximum}`;case m.IntegerExclusiveMinimum:return`Expected integer to be greater than ${$.schema.exclusiveMinimum}`;case m.IntegerMaximum:return`Expected integer to be less or equal to ${$.schema.maximum}`;case m.IntegerMinimum:return`Expected integer to be greater or equal to ${$.schema.minimum}`;case m.IntegerMultipleOf:return`Expected integer to be a multiple of ${$.schema.multipleOf}`;case m.Integer:return"Expected integer";case m.IntersectUnevaluatedProperties:return"Unexpected property";case m.Intersect:return"Expected all values to match";case m.Iterator:return"Expected Iterator";case m.Literal:return`Expected ${typeof $.schema.const==="string"?`'${$.schema.const}'`:$.schema.const}`;case m.Never:return"Never";case m.Not:return"Value should not match";case m.Null:return"Expected null";case m.NumberExclusiveMaximum:return`Expected number to be less than ${$.schema.exclusiveMaximum}`;case m.NumberExclusiveMinimum:return`Expected number to be greater than ${$.schema.exclusiveMinimum}`;case m.NumberMaximum:return`Expected number to be less or equal to ${$.schema.maximum}`;case m.NumberMinimum:return`Expected number to be greater or equal to ${$.schema.minimum}`;case m.NumberMultipleOf:return`Expected number to be a multiple of ${$.schema.multipleOf}`;case m.Number:return"Expected number";case m.Object:return"Expected object";case m.ObjectAdditionalProperties:return"Unexpected property";case m.ObjectMaxProperties:return`Expected object to have no more than ${$.schema.maxProperties} properties`;case m.ObjectMinProperties:return`Expected object to have at least ${$.schema.minProperties} properties`;case m.ObjectRequiredProperty:return"Required property";case m.Promise:return"Expected Promise";case m.RegExp:return"Expected string to match regular expression";case m.StringFormatUnknown:return`Unknown format '${$.schema.format}'`;case m.StringFormat:return`Expected string to match '${$.schema.format}' format`;case m.StringMaxLength:return`Expected string length less or equal to ${$.schema.maxLength}`;case m.StringMinLength:return`Expected string length greater or equal to ${$.schema.minLength}`;case m.StringPattern:return`Expected string to match '${$.schema.pattern}'`;case m.String:return"Expected string";case m.Symbol:return"Expected symbol";case m.TupleLength:return`Expected tuple to have ${$.schema.maxItems||0} elements`;case m.Tuple:return"Expected tuple";case m.Uint8ArrayMaxByteLength:return`Expected byte length less or equal to ${$.schema.maxByteLength}`;case m.Uint8ArrayMinByteLength:return`Expected byte length greater or equal to ${$.schema.minByteLength}`;case m.Uint8Array:return"Expected Uint8Array";case m.Undefined:return"Expected undefined";case m.Union:return"Expected union value";case m.Void:return"Expected void";case m.Kind:return`Expected kind '${$.schema[h]}'`;default:return"Unknown error type"}}function YY(){return pw}var pw=hw;var mw=function($,W){const X=W.find((Y)=>Y.$id===$.$ref);if(X===void 0)throw new ZY($);return y0(X,W)};function y0($,W){return $[h]==="This"||$[h]==="Ref"?mw($,W):$}class ZY extends P0{constructor($){super(`Unable to dereference schema with \$id '${$.$id}'`);this.schema=$}}function*iw($){const W=$===0?1:Math.ceil(Math.floor(Math.log2($)+1)/8);for(let X=0;X<W;X++)yield $>>8*(W-1-X)&255}var lw=function($){a2(b1.Array);for(let W of $)W$(W)},nw=function($){a2(b1.Boolean),a2($?1:0)},tw=function($){a2(b1.BigInt),QY.setBigInt64(0,$);for(let W of GY)a2(W)},sw=function($){a2(b1.Date),W$($.getTime())},rw=function($){a2(b1.Null)},aw=function($){a2(b1.Number),QY.setFloat64(0,$);for(let W of GY)a2(W)},ew=function($){a2(b1.Object);for(let W of globalThis.Object.getOwnPropertyNames($).sort())W$(W),W$($[W])},$A=function($){a2(b1.String);for(let W=0;W<$.length;W++)for(let X of iw($.charCodeAt(W)))a2(X)},WA=function($){a2(b1.Symbol),W$($.description)},XA=function($){a2(b1.Uint8Array);for(let W=0;W<$.length;W++)a2($[W])},YA=function($){return a2(b1.Undefined)},W$=function($){if(K0($))return lw($);if(H8($))return nw($);if(u2($))return tw($);if(R1($))return sw($);if(x8($))return rw($);if(D0($))return aw($);if(M2($))return ew($);if(C0($))return $A($);if(w1($))return WA($);if(i6($))return XA($);if(N2($))return YA($);throw new JY($)},a2=function($){$$=$$^ow[$],$$=$$*cw%uw};function r8($){return $$=BigInt("14695981039346656037"),W$($),$$}class JY extends P0{constructor($){super("Unable to hash value");this.value=$}}var b1;(function($){$[$.Undefined=0]="Undefined",$[$.Null=1]="Null",$[$.Boolean=2]="Boolean",$[$.Number=3]="Number",$[$.String=4]="String",$[$.Object=5]="Object",$[$.Array=6]="Array",$[$.Date=7]="Date",$[$.Uint8Array=8]="Uint8Array",$[$.Symbol=9]="Symbol",$[$.BigInt=10]="BigInt"})(b1||(b1={}));var $$=BigInt("14695981039346656037"),[cw,uw]=[BigInt("1099511628211"),BigInt("2")**BigInt("64")],ow=Array.from({length:256}).map(($,W)=>BigInt(W)),zY=new Float64Array(1),QY=new DataView(zY.buffer),GY=new Uint8Array(zY.buffer);var h8=function($){return $.replace(/~/g,"~0").replace(/\//g,"~1")},b0=function($){return $!==void 0},U0=function($,W,X,Y){return{type:$,schema:W,path:X,value:Y,message:YY()({errorType:$,path:X,schema:W,value:Y})}};function*ZA($,W,X,Y){}function*JA($,W,X,Y){if(!K0(Y))return yield U0(m.Array,$,X,Y);if(b0($.minItems)&&!(Y.length>=$.minItems))yield U0(m.ArrayMinItems,$,X,Y);if(b0($.maxItems)&&!(Y.length<=$.maxItems))yield U0(m.ArrayMaxItems,$,X,Y);for(let z=0;z<Y.length;z++)yield*o2($.items,W,`${X}/${z}`,Y[z]);if($.uniqueItems===!0&&!function(){const z=new Set;for(let Q of Y){const G=r8(Q);if(z.has(G))return!1;else z.add(G)}return!0}())yield U0(m.ArrayUniqueItems,$,X,Y);if(!(b0($.contains)||b0($.minContains)||b0($.maxContains)))return;const Z=b0($.contains)?$.contains:s0(),J=Y.reduce((z,Q,G)=>o2(Z,W,`${X}${G}`,Q).next().done===!0?z+1:z,0);if(J===0)yield U0(m.ArrayContains,$,X,Y);if(D0($.minContains)&&J<$.minContains)yield U0(m.ArrayMinContains,$,X,Y);if(D0($.maxContains)&&J>$.maxContains)yield U0(m.ArrayMaxContains,$,X,Y)}function*zA($,W,X,Y){if(!m5(Y))yield U0(m.AsyncIterator,$,X,Y)}function*QA($,W,X,Y){if(!u2(Y))return yield U0(m.BigInt,$,X,Y);if(b0($.exclusiveMaximum)&&!(Y<$.exclusiveMaximum))yield U0(m.BigIntExclusiveMaximum,$,X,Y);if(b0($.exclusiveMinimum)&&!(Y>$.exclusiveMinimum))yield U0(m.BigIntExclusiveMinimum,$,X,Y);if(b0($.maximum)&&!(Y<=$.maximum))yield U0(m.BigIntMaximum,$,X,Y);if(b0($.minimum)&&!(Y>=$.minimum))yield U0(m.BigIntMinimum,$,X,Y);if(b0($.multipleOf)&&Y%$.multipleOf!==BigInt(0))yield U0(m.BigIntMultipleOf,$,X,Y)}function*GA($,W,X,Y){if(!H8(Y))yield U0(m.Boolean,$,X,Y)}function*UA($,W,X,Y){yield*o2($.returns,W,X,Y.prototype)}function*MA($,W,X,Y){if(!R1(Y))return yield U0(m.Date,$,X,Y);if(b0($.exclusiveMaximumTimestamp)&&!(Y.getTime()<$.exclusiveMaximumTimestamp))yield U0(m.DateExclusiveMaximumTimestamp,$,X,Y);if(b0($.exclusiveMinimumTimestamp)&&!(Y.getTime()>$.exclusiveMinimumTimestamp))yield U0(m.DateExclusiveMinimumTimestamp,$,X,Y);if(b0($.maximumTimestamp)&&!(Y.getTime()<=$.maximumTimestamp))yield U0(m.DateMaximumTimestamp,$,X,Y);if(b0($.minimumTimestamp)&&!(Y.getTime()>=$.minimumTimestamp))yield U0(m.DateMinimumTimestamp,$,X,Y);if(b0($.multipleOfTimestamp)&&Y.getTime()%$.multipleOfTimestamp!==0)yield U0(m.DateMultipleOfTimestamp,$,X,Y)}function*wA($,W,X,Y){if(!i5(Y))yield U0(m.Function,$,X,Y)}function*AA($,W,X,Y){if(!o5(Y))return yield U0(m.Integer,$,X,Y);if(b0($.exclusiveMaximum)&&!(Y<$.exclusiveMaximum))yield U0(m.IntegerExclusiveMaximum,$,X,Y);if(b0($.exclusiveMinimum)&&!(Y>$.exclusiveMinimum))yield U0(m.IntegerExclusiveMinimum,$,X,Y);if(b0($.maximum)&&!(Y<=$.maximum))yield U0(m.IntegerMaximum,$,X,Y);if(b0($.minimum)&&!(Y>=$.minimum))yield U0(m.IntegerMinimum,$,X,Y);if(b0($.multipleOf)&&Y%$.multipleOf!==0)yield U0(m.IntegerMultipleOf,$,X,Y)}function*_A($,W,X,Y){for(let Z of $.allOf){const J=o2(Z,W,X,Y).next();if(!J.done)yield U0(m.Intersect,$,X,Y),yield J.value}if($.unevaluatedProperties===!1){const Z=new RegExp(d8($));for(let J of Object.getOwnPropertyNames(Y))if(!Z.test(J))yield U0(m.IntersectUnevaluatedProperties,$,`${X}/${J}`,Y)}if(typeof $.unevaluatedProperties==="object"){const Z=new RegExp(d8($));for(let J of Object.getOwnPropertyNames(Y))if(!Z.test(J)){const z=o2($.unevaluatedProperties,W,`${X}/${J}`,Y[J]).next();if(!z.done)yield z.value}}}function*HA($,W,X,Y){if(!c5(Y))yield U0(m.Iterator,$,X,Y)}function*DA($,W,X,Y){if(Y!==$.const)yield U0(m.Literal,$,X,Y)}function*BA($,W,X,Y){yield U0(m.Never,$,X,Y)}function*OA($,W,X,Y){if(o2($.not,W,X,Y).next().done===!0)yield U0(m.Not,$,X,Y)}function*NA($,W,X,Y){if(!x8(Y))yield U0(m.Null,$,X,Y)}function*LA($,W,X,Y){if(!C2.IsNumberLike(Y))return yield U0(m.Number,$,X,Y);if(b0($.exclusiveMaximum)&&!(Y<$.exclusiveMaximum))yield U0(m.NumberExclusiveMaximum,$,X,Y);if(b0($.exclusiveMinimum)&&!(Y>$.exclusiveMinimum))yield U0(m.NumberExclusiveMinimum,$,X,Y);if(b0($.maximum)&&!(Y<=$.maximum))yield U0(m.NumberMaximum,$,X,Y);if(b0($.minimum)&&!(Y>=$.minimum))yield U0(m.NumberMinimum,$,X,Y);if(b0($.multipleOf)&&Y%$.multipleOf!==0)yield U0(m.NumberMultipleOf,$,X,Y)}function*FA($,W,X,Y){if(!C2.IsObjectLike(Y))return yield U0(m.Object,$,X,Y);if(b0($.minProperties)&&!(Object.getOwnPropertyNames(Y).length>=$.minProperties))yield U0(m.ObjectMinProperties,$,X,Y);if(b0($.maxProperties)&&!(Object.getOwnPropertyNames(Y).length<=$.maxProperties))yield U0(m.ObjectMaxProperties,$,X,Y);const Z=Array.isArray($.required)?$.required:[],J=Object.getOwnPropertyNames($.properties),z=Object.getOwnPropertyNames(Y);for(let Q of Z){if(z.includes(Q))continue;yield U0(m.ObjectRequiredProperty,$.properties[Q],`${X}/${h8(Q)}`,void 0)}if($.additionalProperties===!1){for(let Q of z)if(!J.includes(Q))yield U0(m.ObjectAdditionalProperties,$,`${X}/${h8(Q)}`,Y[Q])}if(typeof $.additionalProperties==="object")for(let Q of z){if(J.includes(Q))continue;yield*o2($.additionalProperties,W,`${X}/${h8(Q)}`,Y[Q])}for(let Q of J){const G=$.properties[Q];if($.required&&$.required.includes(Q)){if(yield*o2(G,W,`${X}/${h8(Q)}`,Y[Q]),v8($)&&!(Q in Y))yield U0(m.ObjectRequiredProperty,G,`${X}/${h8(Q)}`,void 0)}else if(C2.IsExactOptionalProperty(Y,Q))yield*o2(G,W,`${X}/${h8(Q)}`,Y[Q])}}function*KA($,W,X,Y){if(!u5(Y))yield U0(m.Promise,$,X,Y)}function*SA($,W,X,Y){if(!C2.IsRecordLike(Y))return yield U0(m.Object,$,X,Y);if(b0($.minProperties)&&!(Object.getOwnPropertyNames(Y).length>=$.minProperties))yield U0(m.ObjectMinProperties,$,X,Y);if(b0($.maxProperties)&&!(Object.getOwnPropertyNames(Y).length<=$.maxProperties))yield U0(m.ObjectMaxProperties,$,X,Y);const[Z,J]=Object.entries($.patternProperties)[0],z=new RegExp(Z);for(let[Q,G]of Object.entries(Y))if(z.test(Q))yield*o2(J,W,`${X}/${h8(Q)}`,G);if(typeof $.additionalProperties==="object"){for(let[Q,G]of Object.entries(Y))if(!z.test(Q))yield*o2($.additionalProperties,W,`${X}/${h8(Q)}`,G)}if($.additionalProperties===!1)for(let[Q,G]of Object.entries(Y)){if(z.test(Q))continue;return yield U0(m.ObjectAdditionalProperties,$,`${X}/${h8(Q)}`,G)}}function*RA($,W,X,Y){yield*o2(y0($,W),W,X,Y)}function*PA($,W,X,Y){if(!C0(Y))return yield U0(m.String,$,X,Y);if(b0($.minLength)&&!(Y.length>=$.minLength))yield U0(m.StringMinLength,$,X,Y);if(b0($.maxLength)&&!(Y.length<=$.maxLength))yield U0(m.StringMaxLength,$,X,Y);if(!new RegExp($.source,$.flags).test(Y))return yield U0(m.RegExp,$,X,Y)}function*EA($,W,X,Y){if(!C0(Y))return yield U0(m.String,$,X,Y);if(b0($.minLength)&&!(Y.length>=$.minLength))yield U0(m.StringMinLength,$,X,Y);if(b0($.maxLength)&&!(Y.length<=$.maxLength))yield U0(m.StringMaxLength,$,X,Y);if(C0($.pattern)){if(!new RegExp($.pattern).test(Y))yield U0(m.StringPattern,$,X,Y)}if(C0($.format)){if(!O2.Has($.format))yield U0(m.StringFormatUnknown,$,X,Y);else if(!O2.Get($.format)(Y))yield U0(m.StringFormat,$,X,Y)}}function*CA($,W,X,Y){if(!w1(Y))yield U0(m.Symbol,$,X,Y)}function*qA($,W,X,Y){if(!C0(Y))return yield U0(m.String,$,X,Y);if(!new RegExp($.pattern).test(Y))yield U0(m.StringPattern,$,X,Y)}function*VA($,W,X,Y){yield*o2(y0($,W),W,X,Y)}function*jA($,W,X,Y){if(!K0(Y))return yield U0(m.Tuple,$,X,Y);if($.items===void 0&&Y.length!==0)return yield U0(m.TupleLength,$,X,Y);if(Y.length!==$.maxItems)return yield U0(m.TupleLength,$,X,Y);if(!$.items)return;for(let Z=0;Z<$.items.length;Z++)yield*o2($.items[Z],W,`${X}/${Z}`,Y[Z])}function*IA($,W,X,Y){if(!N2(Y))yield U0(m.Undefined,$,X,Y)}function*bA($,W,X,Y){let Z=0;for(let J of $.anyOf){const z=[...o2(J,W,X,Y)];if(z.length===0)return;Z+=z.length}if(Z>0)yield U0(m.Union,$,X,Y)}function*xA($,W,X,Y){if(!i6(Y))return yield U0(m.Uint8Array,$,X,Y);if(b0($.maxByteLength)&&!(Y.length<=$.maxByteLength))yield U0(m.Uint8ArrayMaxByteLength,$,X,Y);if(b0($.minByteLength)&&!(Y.length>=$.minByteLength))yield U0(m.Uint8ArrayMinByteLength,$,X,Y)}function*kA($,W,X,Y){}function*TA($,W,X,Y){if(!C2.IsVoidLike(Y))yield U0(m.Void,$,X,Y)}function*gA($,W,X,Y){if(!q2.Get($[h])($,Y))yield U0(m.Kind,$,X,Y)}function*o2($,W,X,Y){const Z=b0($.$id)?[...W,$]:W,J=$;switch(J[h]){case"Any":return yield*ZA(J,Z,X,Y);case"Array":return yield*JA(J,Z,X,Y);case"AsyncIterator":return yield*zA(J,Z,X,Y);case"BigInt":return yield*QA(J,Z,X,Y);case"Boolean":return yield*GA(J,Z,X,Y);case"Constructor":return yield*UA(J,Z,X,Y);case"Date":return yield*MA(J,Z,X,Y);case"Function":return yield*wA(J,Z,X,Y);case"Integer":return yield*AA(J,Z,X,Y);case"Intersect":return yield*_A(J,Z,X,Y);case"Iterator":return yield*HA(J,Z,X,Y);case"Literal":return yield*DA(J,Z,X,Y);case"Never":return yield*BA(J,Z,X,Y);case"Not":return yield*OA(J,Z,X,Y);case"Null":return yield*NA(J,Z,X,Y);case"Number":return yield*LA(J,Z,X,Y);case"Object":return yield*FA(J,Z,X,Y);case"Promise":return yield*KA(J,Z,X,Y);case"Record":return yield*SA(J,Z,X,Y);case"Ref":return yield*RA(J,Z,X,Y);case"RegExp":return yield*PA(J,Z,X,Y);case"String":return yield*EA(J,Z,X,Y);case"Symbol":return yield*CA(J,Z,X,Y);case"TemplateLiteral":return yield*qA(J,Z,X,Y);case"This":return yield*VA(J,Z,X,Y);case"Tuple":return yield*jA(J,Z,X,Y);case"Undefined":return yield*IA(J,Z,X,Y);case"Union":return yield*bA(J,Z,X,Y);case"Uint8Array":return yield*xA(J,Z,X,Y);case"Unknown":return yield*kA(J,Z,X,Y);case"Void":return yield*TA(J,Z,X,Y);default:if(!q2.Has(J[h]))throw new UY($);return yield*gA(J,Z,X,Y)}}function c$(...$){const W=$.length===3?o2($[0],$[1],"",$[2]):o2($[0],[],"",$[1]);return new a5(W)}var m;(function($){$[$.ArrayContains=0]="ArrayContains",$[$.ArrayMaxContains=1]="ArrayMaxContains",$[$.ArrayMaxItems=2]="ArrayMaxItems",$[$.ArrayMinContains=3]="ArrayMinContains",$[$.ArrayMinItems=4]="ArrayMinItems",$[$.ArrayUniqueItems=5]="ArrayUniqueItems",$[$.Array=6]="Array",$[$.AsyncIterator=7]="AsyncIterator",$[$.BigIntExclusiveMaximum=8]="BigIntExclusiveMaximum",$[$.BigIntExclusiveMinimum=9]="BigIntExclusiveMinimum",$[$.BigIntMaximum=10]="BigIntMaximum",$[$.BigIntMinimum=11]="BigIntMinimum",$[$.BigIntMultipleOf=12]="BigIntMultipleOf",$[$.BigInt=13]="BigInt",$[$.Boolean=14]="Boolean",$[$.DateExclusiveMaximumTimestamp=15]="DateExclusiveMaximumTimestamp",$[$.DateExclusiveMinimumTimestamp=16]="DateExclusiveMinimumTimestamp",$[$.DateMaximumTimestamp=17]="DateMaximumTimestamp",$[$.DateMinimumTimestamp=18]="DateMinimumTimestamp",$[$.DateMultipleOfTimestamp=19]="DateMultipleOfTimestamp",$[$.Date=20]="Date",$[$.Function=21]="Function",$[$.IntegerExclusiveMaximum=22]="IntegerExclusiveMaximum",$[$.IntegerExclusiveMinimum=23]="IntegerExclusiveMinimum",$[$.IntegerMaximum=24]="IntegerMaximum",$[$.IntegerMinimum=25]="IntegerMinimum",$[$.IntegerMultipleOf=26]="IntegerMultipleOf",$[$.Integer=27]="Integer",$[$.IntersectUnevaluatedProperties=28]="IntersectUnevaluatedProperties",$[$.Intersect=29]="Intersect",$[$.Iterator=30]="Iterator",$[$.Kind=31]="Kind",$[$.Literal=32]="Literal",$[$.Never=33]="Never",$[$.Not=34]="Not",$[$.Null=35]="Null",$[$.NumberExclusiveMaximum=36]="NumberExclusiveMaximum",$[$.NumberExclusiveMinimum=37]="NumberExclusiveMinimum",$[$.NumberMaximum=38]="NumberMaximum",$[$.NumberMinimum=39]="NumberMinimum",$[$.NumberMultipleOf=40]="NumberMultipleOf",$[$.Number=41]="Number",$[$.ObjectAdditionalProperties=42]="ObjectAdditionalProperties",$[$.ObjectMaxProperties=43]="ObjectMaxProperties",$[$.ObjectMinProperties=44]="ObjectMinProperties",$[$.ObjectRequiredProperty=45]="ObjectRequiredProperty",$[$.Object=46]="Object",$[$.Promise=47]="Promise",$[$.RegExp=48]="RegExp",$[$.StringFormatUnknown=49]="StringFormatUnknown",$[$.StringFormat=50]="StringFormat",$[$.StringMaxLength=51]="StringMaxLength",$[$.StringMinLength=52]="StringMinLength",$[$.StringPattern=53]="StringPattern",$[$.String=54]="String",$[$.Symbol=55]="Symbol",$[$.TupleLength=56]="TupleLength",$[$.Tuple=57]="Tuple",$[$.Uint8ArrayMaxByteLength=58]="Uint8ArrayMaxByteLength",$[$.Uint8ArrayMinByteLength=59]="Uint8ArrayMinByteLength",$[$.Uint8Array=60]="Uint8Array",$[$.Undefined=61]="Undefined",$[$.Union=62]="Union",$[$.Void=63]="Void"})(m||(m={}));class UY extends P0{constructor($){super("Unknown type");this.schema=$}}class a5{constructor($){this.iterator=$}[Symbol.iterator](){return this.iterator}First(){const $=this.iterator.next();return $.done?void 0:$.value}}function p8($={}){return{...$,[h]:"Any"}}function L8($={}){return{...$,[h]:"Unknown"}}var x={};n8(x,{TypeGuardUnknownTypeError:()=>{{return MY}},IsVoid:()=>{{return nY}},IsUnsafe:()=>{{return lY}},IsUnknown:()=>{{return iY}},IsUnionLiteral:()=>{{return cA}},IsUnion:()=>{{return pW}},IsUndefined:()=>{{return uY}},IsUint8Array:()=>{{return oY}},IsTuple:()=>{{return cY}},IsTransform:()=>{{return _2}},IsThis:()=>{{return mY}},IsTemplateLiteral:()=>{{return pY}},IsSymbol:()=>{{return hY}},IsString:()=>{{return vY}},IsSchema:()=>{{return E0}},IsRegExp:()=>{{return dY}},IsRef:()=>{{return yY}},IsRecursive:()=>{{return mA}},IsRecord:()=>{{return fY}},IsReadonly:()=>{{return vA}},IsProperties:()=>{{return hW}},IsPromise:()=>{{return gY}},IsOptional:()=>{{return hA}},IsObject:()=>{{return TY}},IsNumber:()=>{{return kY}},IsNull:()=>{{return xY}},IsNot:()=>{{return bY}},IsNever:()=>{{return IY}},IsMappedResult:()=>{{return jY}},IsMappedKey:()=>{{return VY}},IsLiteralValue:()=>{{return qY}},IsLiteralString:()=>{{return EY}},IsLiteralNumber:()=>{{return CY}},IsLiteralBoolean:()=>{{return pA}},IsLiteral:()=>{{return o$}},IsKindOf:()=>{{return k0}},IsKind:()=>{{return tY}},IsIterator:()=>{{return PY}},IsIntersect:()=>{{return RY}},IsInteger:()=>{{return SY}},IsFunction:()=>{{return KY}},IsDate:()=>{{return FY}},IsConstructor:()=>{{return LY}},IsBoolean:()=>{{return NY}},IsBigInt:()=>{{return OY}},IsAsyncIterator:()=>{{return BY}},IsArray:()=>{{return DY}},IsAny:()=>{{return HY}}});var wY=function($){try{return new RegExp($),!0}catch{return!1}},dW=function($){if(!A2($))return!1;for(let W=0;W<$.length;W++){const X=$.charCodeAt(W);if(X>=7&&X<=13||X===27||X===127)return!1}return!0},AY=function($){return vW($)||E0($)},u$=function($){return L2($)||S$($)},Q2=function($){return L2($)||X8($)},vW=function($){return L2($)||t8($)},$2=function($){return L2($)||A2($)},yA=function($){return L2($)||A2($)&&dW($)&&wY($)},dA=function($){return L2($)||A2($)&&dW($)},_Y=function($){return L2($)||E0($)};function vA($){return w2($)&&$[D8]==="Readonly"}function hA($){return w2($)&&$[r2]==="Optional"}function HY($){return k0($,"Any")&&$2($.$id)}function DY($){return k0($,"Array")&&$.type==="array"&&$2($.$id)&&E0($.items)&&Q2($.minItems)&&Q2($.maxItems)&&vW($.uniqueItems)&&_Y($.contains)&&Q2($.minContains)&&Q2($.maxContains)}function BY($){return k0($,"AsyncIterator")&&$.type==="AsyncIterator"&&$2($.$id)&&E0($.items)}function OY($){return k0($,"BigInt")&&$.type==="bigint"&&$2($.$id)&&u$($.exclusiveMaximum)&&u$($.exclusiveMinimum)&&u$($.maximum)&&u$($.minimum)&&u$($.multipleOf)}function NY($){return k0($,"Boolean")&&$.type==="boolean"&&$2($.$id)}function LY($){return k0($,"Constructor")&&$.type==="Constructor"&&$2($.$id)&&A1($.parameters)&&$.parameters.every((W)=>E0(W))&&E0($.returns)}function FY($){return k0($,"Date")&&$.type==="Date"&&$2($.$id)&&Q2($.exclusiveMaximumTimestamp)&&Q2($.exclusiveMinimumTimestamp)&&Q2($.maximumTimestamp)&&Q2($.minimumTimestamp)&&Q2($.multipleOfTimestamp)}function KY($){return k0($,"Function")&&$.type==="Function"&&$2($.$id)&&A1($.parameters)&&$.parameters.every((W)=>E0(W))&&E0($.returns)}function SY($){return k0($,"Integer")&&$.type==="integer"&&$2($.$id)&&Q2($.exclusiveMaximum)&&Q2($.exclusiveMinimum)&&Q2($.maximum)&&Q2($.minimum)&&Q2($.multipleOf)}function hW($){return w2($)&&Object.entries($).every(([W,X])=>dW(W)&&E0(X))}function RY($){return k0($,"Intersect")&&(A2($.type)&&$.type!=="object"?!1:!0)&&A1($.allOf)&&$.allOf.every((W)=>E0(W)&&!_2(W))&&$2($.type)&&(vW($.unevaluatedProperties)||_Y($.unevaluatedProperties))&&$2($.$id)}function PY($){return k0($,"Iterator")&&$.type==="Iterator"&&$2($.$id)&&E0($.items)}function k0($,W){return w2($)&&h in $&&$[h]===W}function EY($){return o$($)&&A2($.const)}function CY($){return o$($)&&X8($.const)}function pA($){return o$($)&&t8($.const)}function o$($){return k0($,"Literal")&&$2($.$id)&&qY($.const)}function qY($){return t8($)||X8($)||A2($)}function VY($){return k0($,"MappedKey")&&A1($.keys)&&$.keys.every((W)=>X8(W)||A2(W))}function jY($){return k0($,"MappedResult")&&hW($.properties)}function IY($){return k0($,"Never")&&w2($.not)&&Object.getOwnPropertyNames($.not).length===0}function bY($){return k0($,"Not")&&E0($.not)}function xY($){return k0($,"Null")&&$.type==="null"&&$2($.$id)}function kY($){return k0($,"Number")&&$.type==="number"&&$2($.$id)&&Q2($.exclusiveMaximum)&&Q2($.exclusiveMinimum)&&Q2($.maximum)&&Q2($.minimum)&&Q2($.multipleOf)}function TY($){return k0($,"Object")&&$.type==="object"&&$2($.$id)&&hW($.properties)&&AY($.additionalProperties)&&Q2($.minProperties)&&Q2($.maxProperties)}function gY($){return k0($,"Promise")&&$.type==="Promise"&&$2($.$id)&&E0($.item)}function fY($){return k0($,"Record")&&$.type==="object"&&$2($.$id)&&AY($.additionalProperties)&&w2($.patternProperties)&&((W)=>{const X=Object.getOwnPropertyNames(W.patternProperties);return X.length===1&&wY(X[0])&&w2(W.patternProperties)&&E0(W.patternProperties[X[0]])})($)}function mA($){return w2($)&&E1 in $&&$[E1]==="Recursive"}function yY($){return k0($,"Ref")&&$2($.$id)&&A2($.$ref)}function dY($){return k0($,"RegExp")&&$2($.$id)&&A2($.source)&&A2($.flags)&&Q2($.maxLength)&&Q2($.minLength)}function vY($){return k0($,"String")&&$.type==="string"&&$2($.$id)&&Q2($.minLength)&&Q2($.maxLength)&&yA($.pattern)&&dA($.format)}function hY($){return k0($,"Symbol")&&$.type==="symbol"&&$2($.$id)}function pY($){return k0($,"TemplateLiteral")&&$.type==="string"&&A2($.pattern)&&$.pattern[0]==="^"&&$.pattern[$.pattern.length-1]==="$"}function mY($){return k0($,"This")&&$2($.$id)&&A2($.$ref)}function _2($){return w2($)&&V2 in $}function cY($){return k0($,"Tuple")&&$.type==="array"&&$2($.$id)&&X8($.minItems)&&X8($.maxItems)&&$.minItems===$.maxItems&&(L2($.items)&&L2($.additionalItems)&&$.minItems===0||A1($.items)&&$.items.every((W)=>E0(W)))}function uY($){return k0($,"Undefined")&&$.type==="undefined"&&$2($.$id)}function cA($){return pW($)&&$.anyOf.every((W)=>EY(W)||CY(W))}function pW($){return k0($,"Union")&&$2($.$id)&&w2($)&&A1($.anyOf)&&$.anyOf.every((W)=>E0(W))}function oY($){return k0($,"Uint8Array")&&$.type==="Uint8Array"&&$2($.$id)&&Q2($.minByteLength)&&Q2($.maxByteLength)}function iY($){return k0($,"Unknown")&&$2($.$id)}function lY($){return k0($,"Unsafe")}function nY($){return k0($,"Void")&&$.type==="void"&&$2($.$id)}function tY($){return w2($)&&h in $&&A2($[h])&&!fA.includes($[h])}function E0($){return w2($)&&(HY($)||DY($)||NY($)||OY($)||BY($)||LY($)||FY($)||KY($)||SY($)||RY($)||PY($)||o$($)||VY($)||jY($)||IY($)||bY($)||xY($)||kY($)||TY($)||gY($)||fY($)||yY($)||dY($)||vY($)||hY($)||pY($)||mY($)||cY($)||uY($)||pW($)||oY($)||iY($)||lY($)||nY($)||tY($))}class MY extends P0{}var fA=["Any","Array","AsyncIterator","BigInt","Boolean","Constructor","Date","Enum","Function","Integer","Intersect","Iterator","Literal","MappedKey","MappedResult","Not","Null","Number","Object","Promise","Record","Ref","RegExp","String","Symbol","TemplateLiteral","This","Tuple","Undefined","Union","Uint8Array","Unknown","Void"];var d1=function($){return $===u.False?$:u.True},X$=function($){throw new $Z($)},x2=function($){return x.IsNever($)||x.IsIntersect($)||x.IsUnion($)||x.IsUnknown($)||x.IsAny($)},k2=function($,W){return x.IsNever(W)?YZ($,W):x.IsIntersect(W)?e5($,W):x.IsUnion(W)?iW($,W):x.IsUnknown(W)?QZ($,W):x.IsAny(W)?oW($,W):X$("StructuralRight")},oW=function($,W){return u.True},uA=function($,W){return x.IsIntersect(W)?e5($,W):x.IsUnion(W)&&W.anyOf.some((X)=>x.IsAny(X)||x.IsUnknown(X))?u.True:x.IsUnion(W)?u.Union:x.IsUnknown(W)?u.True:x.IsAny(W)?u.True:u.Union},oA=function($,W){return x.IsUnknown($)?u.False:x.IsAny($)?u.Union:x.IsNever($)?u.True:u.False},iA=function($,W){return x.IsObject(W)&&$4(W)?u.True:x2(W)?k2($,W):!x.IsArray(W)?u.False:d1(W2($.items,W.items))},lA=function($,W){return x2(W)?k2($,W):!x.IsAsyncIterator(W)?u.False:d1(W2($.items,W.items))},nA=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsBigInt(W)?u.True:u.False},WZ=function($,W){return x.IsLiteralBoolean($)?u.True:x.IsBoolean($)?u.True:u.False},tA=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsBoolean(W)?u.True:u.False},sA=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):!x.IsConstructor(W)?u.False:$.parameters.length>W.parameters.length?u.False:!$.parameters.every((X,Y)=>d1(W2(W.parameters[Y],X))===u.True)?u.False:d1(W2($.returns,W.returns))},rA=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsDate(W)?u.True:u.False},aA=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):!x.IsFunction(W)?u.False:$.parameters.length>W.parameters.length?u.False:!$.parameters.every((X,Y)=>d1(W2(W.parameters[Y],X))===u.True)?u.False:d1(W2($.returns,W.returns))},XZ=function($,W){return x.IsLiteral($)&&_1.IsNumber($.const)?u.True:x.IsNumber($)||x.IsInteger($)?u.True:u.False},eA=function($,W){return x.IsInteger(W)||x.IsNumber(W)?u.True:x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):u.False},e5=function($,W){return W.allOf.every((X)=>W2($,X)===u.True)?u.True:u.False},$_=function($,W){return $.allOf.some((X)=>W2(X,W)===u.True)?u.True:u.False},W_=function($,W){return x2(W)?k2($,W):!x.IsIterator(W)?u.False:d1(W2($.items,W.items))},X_=function($,W){return x.IsLiteral(W)&&W.const===$.const?u.True:x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsString(W)?zZ($,W):x.IsNumber(W)?ZZ($,W):x.IsInteger(W)?XZ($,W):x.IsBoolean(W)?WZ($,W):u.False},YZ=function($,W){return u.False},Y_=function($,W){return u.True},sY=function($){let[W,X]=[$,0];while(!0){if(!x.IsNot(W))break;W=W.not,X+=1}return X%2===0?W:L8()},Z_=function($,W){return x.IsNot($)?W2(sY($),W):x.IsNot(W)?W2($,sY(W)):X$("Invalid fallthrough for Not")},J_=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsNull(W)?u.True:u.False},ZZ=function($,W){return x.IsLiteralNumber($)?u.True:x.IsNumber($)||x.IsInteger($)?u.True:u.False},z_=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsInteger(W)||x.IsNumber(W)?u.True:u.False},B1=function($,W){return Object.getOwnPropertyNames($.properties).length===W},rY=function($){return $4($)},aY=function($){return B1($,0)||B1($,1)&&"description"in $.properties&&x.IsUnion($.properties.description)&&$.properties.description.anyOf.length===2&&(x.IsString($.properties.description.anyOf[0])&&x.IsUndefined($.properties.description.anyOf[1])||x.IsString($.properties.description.anyOf[1])&&x.IsUndefined($.properties.description.anyOf[0]))},mW=function($){return B1($,0)},eY=function($){return B1($,0)},Q_=function($){return B1($,0)},G_=function($){return B1($,0)},U_=function($){return $4($)},M_=function($){const W=Z8();return B1($,0)||B1($,1)&&"length"in $.properties&&d1(W2($.properties.length,W))===u.True},w_=function($){return B1($,0)},$4=function($){const W=Z8();return B1($,0)||B1($,1)&&"length"in $.properties&&d1(W2($.properties.length,W))===u.True},A_=function($){const W=k8([p8()],p8());return B1($,0)||B1($,1)&&"then"in $.properties&&d1(W2($.properties.then,W))===u.True},JZ=function($,W){return W2($,W)===u.False?u.False:x.IsOptional($)&&!x.IsOptional(W)?u.False:u.True},e2=function($,W){return x.IsUnknown($)?u.False:x.IsAny($)?u.Union:x.IsNever($)||x.IsLiteralString($)&&rY(W)||x.IsLiteralNumber($)&&mW(W)||x.IsLiteralBoolean($)&&eY(W)||x.IsSymbol($)&&aY(W)||x.IsBigInt($)&&Q_(W)||x.IsString($)&&rY(W)||x.IsSymbol($)&&aY(W)||x.IsNumber($)&&mW(W)||x.IsInteger($)&&mW(W)||x.IsBoolean($)&&eY(W)||x.IsUint8Array($)&&U_(W)||x.IsDate($)&&G_(W)||x.IsConstructor($)&&w_(W)||x.IsFunction($)&&M_(W)?u.True:x.IsRecord($)&&x.IsString(cW($))?(()=>{return W[E1]==="Record"?u.True:u.False})():x.IsRecord($)&&x.IsNumber(cW($))?(()=>{return B1(W,0)?u.True:u.False})():u.False},__=function($,W){return x2(W)?k2($,W):x.IsRecord(W)?v1($,W):!x.IsObject(W)?u.False:(()=>{for(let X of Object.getOwnPropertyNames(W.properties)){if(!(X in $.properties)&&!x.IsOptional(W.properties[X]))return u.False;if(x.IsOptional(W.properties[X]))return u.True;if(JZ($.properties[X],W.properties[X])===u.False)return u.False}return u.True})()},H_=function($,W){return x2(W)?k2($,W):x.IsObject(W)&&A_(W)?u.True:!x.IsPromise(W)?u.False:d1(W2($.item,W.item))},cW=function($){return y8 in $.patternProperties?Z8():(s8 in $.patternProperties)?j1():X$("Unknown record key pattern")},uW=function($){return y8 in $.patternProperties?$.patternProperties[y8]:(s8 in $.patternProperties)?$.patternProperties[s8]:X$("Unable to get record value schema")},v1=function($,W){const[X,Y]=[cW(W),uW(W)];return x.IsLiteralString($)&&x.IsNumber(X)&&d1(W2($,Y))===u.True?u.True:x.IsUint8Array($)&&x.IsNumber(X)?W2($,Y):x.IsString($)&&x.IsNumber(X)?W2($,Y):x.IsArray($)&&x.IsNumber(X)?W2($,Y):x.IsObject($)?(()=>{for(let Z of Object.getOwnPropertyNames($.properties))if(JZ(Y,$.properties[Z])===u.False)return u.False;return u.True})():u.False},D_=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):!x.IsRecord(W)?u.False:W2(uW($),uW(W))},B_=function($,W){const X=x.IsRegExp($)?j1():$,Y=x.IsRegExp(W)?j1():W;return W2(X,Y)},zZ=function($,W){return x.IsLiteral($)&&_1.IsString($.const)?u.True:x.IsString($)?u.True:u.False},O_=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsString(W)?u.True:u.False},N_=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsSymbol(W)?u.True:u.False},L_=function($,W){return x.IsTemplateLiteral($)?W2(L6($),W):x.IsTemplateLiteral(W)?W2($,L6(W)):X$("Invalid fallthrough for TemplateLiteral")},F_=function($,W){return x.IsArray(W)&&$.items!==void 0&&$.items.every((X)=>W2(X,W.items)===u.True)},K_=function($,W){return x.IsNever($)?u.True:x.IsUnknown($)?u.False:x.IsAny($)?u.Union:u.False},S_=function($,W){return x2(W)?k2($,W):x.IsObject(W)&&$4(W)?u.True:x.IsArray(W)&&F_($,W)?u.True:!x.IsTuple(W)?u.False:_1.IsUndefined($.items)&&!_1.IsUndefined(W.items)||!_1.IsUndefined($.items)&&_1.IsUndefined(W.items)?u.False:_1.IsUndefined($.items)&&!_1.IsUndefined(W.items)?u.True:$.items.every((X,Y)=>W2(X,W.items[Y])===u.True)?u.True:u.False},R_=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsUint8Array(W)?u.True:u.False},P_=function($,W){return x2(W)?k2($,W):x.IsObject(W)?e2($,W):x.IsRecord(W)?v1($,W):x.IsVoid(W)?q_($,W):x.IsUndefined(W)?u.True:u.False},iW=function($,W){return W.anyOf.some((X)=>W2($,X)===u.True)?u.True:u.False},E_=function($,W){return $.anyOf.every((X)=>W2(X,W)===u.True)?u.True:u.False},QZ=function($,W){return u.True},C_=function($,W){return x.IsNever(W)?YZ($,W):x.IsIntersect(W)?e5($,W):x.IsUnion(W)?iW($,W):x.IsAny(W)?oW($,W):x.IsString(W)?zZ($,W):x.IsNumber(W)?ZZ($,W):x.IsInteger(W)?XZ($,W):x.IsBoolean(W)?WZ($,W):x.IsArray(W)?oA($,W):x.IsTuple(W)?K_($,W):x.IsObject(W)?e2($,W):x.IsUnknown(W)?u.True:u.False},q_=function($,W){return x.IsUndefined($)?u.True:x.IsUndefined($)?u.True:u.False},V_=function($,W){return x.IsIntersect(W)?e5($,W):x.IsUnion(W)?iW($,W):x.IsUnknown(W)?QZ($,W):x.IsAny(W)?oW($,W):x.IsObject(W)?e2($,W):x.IsVoid(W)?u.True:u.False},W2=function($,W){return x.IsTemplateLiteral($)||x.IsTemplateLiteral(W)?L_($,W):x.IsRegExp($)||x.IsRegExp(W)?B_($,W):x.IsNot($)||x.IsNot(W)?Z_($,W):x.IsAny($)?uA($,W):x.IsArray($)?iA($,W):x.IsBigInt($)?nA($,W):x.IsBoolean($)?tA($,W):x.IsAsyncIterator($)?lA($,W):x.IsConstructor($)?sA($,W):x.IsDate($)?rA($,W):x.IsFunction($)?aA($,W):x.IsInteger($)?eA($,W):x.IsIntersect($)?$_($,W):x.IsIterator($)?W_($,W):x.IsLiteral($)?X_($,W):x.IsNever($)?Y_($,W):x.IsNull($)?J_($,W):x.IsNumber($)?z_($,W):x.IsObject($)?__($,W):x.IsRecord($)?D_($,W):x.IsString($)?O_($,W):x.IsSymbol($)?N_($,W):x.IsTuple($)?S_($,W):x.IsPromise($)?H_($,W):x.IsUint8Array($)?R_($,W):x.IsUndefined($)?P_($,W):x.IsUnion($)?E_($,W):x.IsUnknown($)?C_($,W):x.IsVoid($)?V_($,W):X$(`Unknown left type operand '${$[h]}'`)};function a8($,W){return W2($,W)}class $Z extends P0{}var u;(function($){$[$.Union=0]="Union",$[$.True=1]="True",$[$.False=2]="False"})(u||(u={}));var j_=function($,W,X,Y,Z){const J={};for(let z of globalThis.Object.getOwnPropertyNames($))J[z]=K6($[z],W,X,Y,Z);return J},I_=function($,W,X,Y,Z){return j_($.properties,W,X,Y,Z)};function GZ($,W,X,Y,Z){const J=I_($,W,X,Y,Z);return g0(J)}var b_=function($,W,X,Y){const Z=a8($,W);return Z===u.Union?r0([X,Y]):Z===u.True?X:Y};function K6($,W,X,Y,Z={}){return B2($)?GZ($,W,X,Y,Z):C1($)?G0(UZ($,W,X,Y,Z)):G0(b_($,W,X,Y),Z)}var x_=function($,W,X,Y,Z){return{[$]:K6(m0($),W,X,Y,Z)}},k_=function($,W,X,Y,Z){return $.reduce((J,z)=>{return{...J,...x_(z,W,X,Y,Z)}},{})},T_=function($,W,X,Y,Z){return k_($.keys,W,X,Y,Z)};function UZ($,W,X,Y,Z){const J=T_($,W,X,Y,Z);return g0(J)}var g_=function($){return $[h]==="Any"||$[h]==="Unknown"},x0=function($){return $!==void 0},f_=function($,W,X){return!0},y_=function($,W,X){if(!K0(X))return!1;if(x0($.minItems)&&!(X.length>=$.minItems))return!1;if(x0($.maxItems)&&!(X.length<=$.maxItems))return!1;if(!X.every((J)=>i2($.items,W,J)))return!1;if($.uniqueItems===!0&&!function(){const J=new Set;for(let z of X){const Q=r8(z);if(J.has(Q))return!1;else J.add(Q)}return!0}())return!1;if(!(x0($.contains)||D0($.minContains)||D0($.maxContains)))return!0;const Y=x0($.contains)?$.contains:s0(),Z=X.reduce((J,z)=>i2(Y,W,z)?J+1:J,0);if(Z===0)return!1;if(D0($.minContains)&&Z<$.minContains)return!1;if(D0($.maxContains)&&Z>$.maxContains)return!1;return!0},d_=function($,W,X){return m5(X)},v_=function($,W,X){if(!u2(X))return!1;if(x0($.exclusiveMaximum)&&!(X<$.exclusiveMaximum))return!1;if(x0($.exclusiveMinimum)&&!(X>$.exclusiveMinimum))return!1;if(x0($.maximum)&&!(X<=$.maximum))return!1;if(x0($.minimum)&&!(X>=$.minimum))return!1;if(x0($.multipleOf)&&X%$.multipleOf!==BigInt(0))return!1;return!0},h_=function($,W,X){return H8(X)},p_=function($,W,X){return i2($.returns,W,X.prototype)},m_=function($,W,X){if(!R1(X))return!1;if(x0($.exclusiveMaximumTimestamp)&&!(X.getTime()<$.exclusiveMaximumTimestamp))return!1;if(x0($.exclusiveMinimumTimestamp)&&!(X.getTime()>$.exclusiveMinimumTimestamp))return!1;if(x0($.maximumTimestamp)&&!(X.getTime()<=$.maximumTimestamp))return!1;if(x0($.minimumTimestamp)&&!(X.getTime()>=$.minimumTimestamp))return!1;if(x0($.multipleOfTimestamp)&&X.getTime()%$.multipleOfTimestamp!==0)return!1;return!0},c_=function($,W,X){return i5(X)},u_=function($,W,X){if(!o5(X))return!1;if(x0($.exclusiveMaximum)&&!(X<$.exclusiveMaximum))return!1;if(x0($.exclusiveMinimum)&&!(X>$.exclusiveMinimum))return!1;if(x0($.maximum)&&!(X<=$.maximum))return!1;if(x0($.minimum)&&!(X>=$.minimum))return!1;if(x0($.multipleOf)&&X%$.multipleOf!==0)return!1;return!0},o_=function($,W,X){const Y=$.allOf.every((Z)=>i2(Z,W,X));if($.unevaluatedProperties===!1){const Z=new RegExp(d8($)),J=Object.getOwnPropertyNames(X).every((z)=>Z.test(z));return Y&&J}else if(E0($.unevaluatedProperties)){const Z=new RegExp(d8($)),J=Object.getOwnPropertyNames(X).every((z)=>Z.test(z)||i2($.unevaluatedProperties,W,X[z]));return Y&&J}else return Y},i_=function($,W,X){return c5(X)},l_=function($,W,X){return X===$.const},n_=function($,W,X){return!1},t_=function($,W,X){return!i2($.not,W,X)},s_=function($,W,X){return x8(X)},r_=function($,W,X){if(!C2.IsNumberLike(X))return!1;if(x0($.exclusiveMaximum)&&!(X<$.exclusiveMaximum))return!1;if(x0($.exclusiveMinimum)&&!(X>$.exclusiveMinimum))return!1;if(x0($.minimum)&&!(X>=$.minimum))return!1;if(x0($.maximum)&&!(X<=$.maximum))return!1;if(x0($.multipleOf)&&X%$.multipleOf!==0)return!1;return!0},a_=function($,W,X){if(!C2.IsObjectLike(X))return!1;if(x0($.minProperties)&&!(Object.getOwnPropertyNames(X).length>=$.minProperties))return!1;if(x0($.maxProperties)&&!(Object.getOwnPropertyNames(X).length<=$.maxProperties))return!1;const Y=Object.getOwnPropertyNames($.properties);for(let Z of Y){const J=$.properties[Z];if($.required&&$.required.includes(Z)){if(!i2(J,W,X[Z]))return!1;if((v8(J)||g_(J))&&!(Z in X))return!1}else if(C2.IsExactOptionalProperty(X,Z)&&!i2(J,W,X[Z]))return!1}if($.additionalProperties===!1){const Z=Object.getOwnPropertyNames(X);if($.required&&$.required.length===Y.length&&Z.length===Y.length)return!0;else return Z.every((J)=>Y.includes(J))}else if(typeof $.additionalProperties==="object")return Object.getOwnPropertyNames(X).every((J)=>Y.includes(J)||i2($.additionalProperties,W,X[J]));else return!0},e_=function($,W,X){return u5(X)},$H=function($,W,X){if(!C2.IsRecordLike(X))return!1;if(x0($.minProperties)&&!(Object.getOwnPropertyNames(X).length>=$.minProperties))return!1;if(x0($.maxProperties)&&!(Object.getOwnPropertyNames(X).length<=$.maxProperties))return!1;const[Y,Z]=Object.entries($.patternProperties)[0],J=new RegExp(Y),z=Object.entries(X).every(([A,w])=>{return J.test(A)?i2(Z,W,w):!0}),Q=typeof $.additionalProperties==="object"?Object.entries(X).every(([A,w])=>{return!J.test(A)?i2($.additionalProperties,W,w):!0}):!0,G=$.additionalProperties===!1?Object.getOwnPropertyNames(X).every((A)=>{return J.test(A)}):!0;return z&&Q&&G},WH=function($,W,X){return i2(y0($,W),W,X)},XH=function($,W,X){const Y=new RegExp($.source,$.flags);if(x0($.minLength)){if(!(X.length>=$.minLength))return!1}if(x0($.maxLength)){if(!(X.length<=$.maxLength))return!1}return Y.test(X)},YH=function($,W,X){if(!C0(X))return!1;if(x0($.minLength)){if(!(X.length>=$.minLength))return!1}if(x0($.maxLength)){if(!(X.length<=$.maxLength))return!1}if(x0($.pattern)){if(!new RegExp($.pattern).test(X))return!1}if(x0($.format)){if(!O2.Has($.format))return!1;return O2.Get($.format)(X)}return!0},ZH=function($,W,X){return w1(X)},JH=function($,W,X){return C0(X)&&new RegExp($.pattern).test(X)},zH=function($,W,X){return i2(y0($,W),W,X)},QH=function($,W,X){if(!K0(X))return!1;if($.items===void 0&&X.length!==0)return!1;if(X.length!==$.maxItems)return!1;if(!$.items)return!0;for(let Y=0;Y<$.items.length;Y++)if(!i2($.items[Y],W,X[Y]))return!1;return!0},GH=function($,W,X){return N2(X)},UH=function($,W,X){return $.anyOf.some((Y)=>i2(Y,W,X))},MH=function($,W,X){if(!i6(X))return!1;if(x0($.maxByteLength)&&!(X.length<=$.maxByteLength))return!1;if(x0($.minByteLength)&&!(X.length>=$.minByteLength))return!1;return!0},wH=function($,W,X){return!0},AH=function($,W,X){return C2.IsVoidLike(X)},_H=function($,W,X){if(!q2.Has($[h]))return!1;return q2.Get($[h])($,X)},i2=function($,W,X){const Y=x0($.$id)?[...W,$]:W,Z=$;switch(Z[h]){case"Any":return f_(Z,Y,X);case"Array":return y_(Z,Y,X);case"AsyncIterator":return d_(Z,Y,X);case"BigInt":return v_(Z,Y,X);case"Boolean":return h_(Z,Y,X);case"Constructor":return p_(Z,Y,X);case"Date":return m_(Z,Y,X);case"Function":return c_(Z,Y,X);case"Integer":return u_(Z,Y,X);case"Intersect":return o_(Z,Y,X);case"Iterator":return i_(Z,Y,X);case"Literal":return l_(Z,Y,X);case"Never":return n_(Z,Y,X);case"Not":return t_(Z,Y,X);case"Null":return s_(Z,Y,X);case"Number":return r_(Z,Y,X);case"Object":return a_(Z,Y,X);case"Promise":return e_(Z,Y,X);case"Record":return $H(Z,Y,X);case"Ref":return WH(Z,Y,X);case"RegExp":return XH(Z,Y,X);case"String":return YH(Z,Y,X);case"Symbol":return ZH(Z,Y,X);case"TemplateLiteral":return JH(Z,Y,X);case"This":return zH(Z,Y,X);case"Tuple":return QH(Z,Y,X);case"Undefined":return GH(Z,Y,X);case"Union":return UH(Z,Y,X);case"Uint8Array":return MH(Z,Y,X);case"Unknown":return wH(Z,Y,X);case"Void":return AH(Z,Y,X);default:if(!q2.Has(Z[h]))throw new MZ(Z);return _H(Z,Y,X)}};function c0(...$){return $.length===3?i2($[0],$[1],$[2]):i2($[0],[],$[1])}class MZ extends P0{constructor($){super("Unknown type");this.schema=$}}var HH=function($){const W={};for(let X of Object.getOwnPropertyNames($))W[X]=X2($[X]);for(let X of Object.getOwnPropertySymbols($))W[X]=X2($[X]);return W},DH=function($){return $.map((W)=>X2(W))},BH=function($){return $.slice()},OH=function($){return new Date($.toISOString())},NH=function($){return $};function X2($){if(K0($))return DH($);if(R1($))return OH($);if(M2($))return HH($);if(f1($))return BH($);if(P1($))return NH($);throw new Error("ValueClone: Unable to clone value")}var d0=function($){return typeof $==="function"?$:X2($)},LH=function($,W){if(I0($,"default"))return d0($.default);else return{}},FH=function($,W){if($.uniqueItems===!0&&!I0($,"default"))throw new h1($,"Array with the uniqueItems constraint requires a default value");else if("contains"in $&&!I0($,"default"))throw new h1($,"Array with the contains constraint requires a default value");else if("default"in $)return d0($.default);else if($.minItems!==void 0)return Array.from({length:$.minItems}).map((X)=>{return x1($.items,W)});else return[]},KH=function($,W){if(I0($,"default"))return d0($.default);else return async function*(){}()},SH=function($,W){if(I0($,"default"))return d0($.default);else return BigInt(0)},RH=function($,W){if(I0($,"default"))return d0($.default);else return!1},PH=function($,W){if(I0($,"default"))return d0($.default);else{const X=x1($.returns,W);if(typeof X==="object"&&!Array.isArray(X))return class{constructor(){for(let[Y,Z]of Object.entries(X)){const J=this;J[Y]=Z}}};else return class{}}},EH=function($,W){if(I0($,"default"))return d0($.default);else if($.minimumTimestamp!==void 0)return new Date($.minimumTimestamp);else return new Date},CH=function($,W){if(I0($,"default"))return d0($.default);else return()=>x1($.returns,W)},qH=function($,W){if(I0($,"default"))return d0($.default);else if($.minimum!==void 0)return $.minimum;else return 0},VH=function($,W){if(I0($,"default"))return d0($.default);else{const X=$.allOf.reduce((Y,Z)=>{const J=x1(Z,W);return typeof J==="object"?{...Y,...J}:J},{});if(!c0($,W,X))throw new h1($,"Intersect produced invalid value. Consider using a default value.");return X}},jH=function($,W){if(I0($,"default"))return d0($.default);else return function*(){}()},IH=function($,W){if(I0($,"default"))return d0($.default);else return $.const},bH=function($,W){if(I0($,"default"))return d0($.default);else throw new h1($,"Never types cannot be created. Consider using a default value.")},xH=function($,W){if(I0($,"default"))return d0($.default);else throw new h1($,"Not types must have a default value")},kH=function($,W){if(I0($,"default"))return d0($.default);else return null},TH=function($,W){if(I0($,"default"))return d0($.default);else if($.minimum!==void 0)return $.minimum;else return 0},gH=function($,W){if(I0($,"default"))return d0($.default);else{const X=new Set($.required),Y={};for(let[Z,J]of Object.entries($.properties)){if(!X.has(Z))continue;Y[Z]=x1(J,W)}return Y}},fH=function($,W){if(I0($,"default"))return d0($.default);else return Promise.resolve(x1($.item,W))},yH=function($,W){const[X,Y]=Object.entries($.patternProperties)[0];if(I0($,"default"))return d0($.default);else if(!(X===s8||X===y8)){const Z=X.slice(1,X.length-1).split("|"),J={};for(let z of Z)J[z]=x1(Y,W);return J}else return{}},dH=function($,W){if(I0($,"default"))return d0($.default);else return x1(y0($,W),W)},vH=function($,W){if(I0($,"default"))return d0($.default);else throw new h1($,"RegExp types cannot be created. Consider using a default value.")},hH=function($,W){if($.pattern!==void 0)if(!I0($,"default"))throw new h1($,"String types with patterns must specify a default value");else return d0($.default);else if($.format!==void 0)if(!I0($,"default"))throw new h1($,"String types with formats must specify a default value");else return d0($.default);else if(I0($,"default"))return d0($.default);else if($.minLength!==void 0)return Array.from({length:$.minLength}).map(()=>" ").join("");else return""},pH=function($,W){if(I0($,"default"))return d0($.default);else if("value"in $)return Symbol.for($.value);else return Symbol()},mH=function($,W){if(I0($,"default"))return d0($.default);if(!t5($))throw new h1($,"Can only create template literals that produce a finite variants. Consider using a default value.");return e6($)[0]},cH=function($,W){if(wZ++>rH)throw new h1($,"Cannot create recursive type as it appears possibly infinite. Consider using a default.");if(I0($,"default"))return d0($.default);else return x1(y0($,W),W)},uH=function($,W){if(I0($,"default"))return d0($.default);if($.items===void 0)return[];else return Array.from({length:$.minItems}).map((X,Y)=>x1($.items[Y],W))},oH=function($,W){if(I0($,"default"))return d0($.default);else return},iH=function($,W){if(I0($,"default"))return d0($.default);else if($.anyOf.length===0)throw new Error("ValueCreate.Union: Cannot create Union with zero variants");else return x1($.anyOf[0],W)},lH=function($,W){if(I0($,"default"))return d0($.default);else if($.minByteLength!==void 0)return new Uint8Array($.minByteLength);else return new Uint8Array(0)},nH=function($,W){if(I0($,"default"))return d0($.default);else return{}},tH=function($,W){if(I0($,"default"))return d0($.default);else return},sH=function($,W){if(I0($,"default"))return d0($.default);else throw new Error("User defined types must specify a default value")},x1=function($,W){const X=C0($.$id)?[...W,$]:W,Y=$;switch(Y[h]){case"Any":return LH(Y,X);case"Array":return FH(Y,X);case"AsyncIterator":return KH(Y,X);case"BigInt":return SH(Y,X);case"Boolean":return RH(Y,X);case"Constructor":return PH(Y,X);case"Date":return EH(Y,X);case"Function":return CH(Y,X);case"Integer":return qH(Y,X);case"Intersect":return VH(Y,X);case"Iterator":return jH(Y,X);case"Literal":return IH(Y,X);case"Never":return bH(Y,X);case"Not":return xH(Y,X);case"Null":return kH(Y,X);case"Number":return TH(Y,X);case"Object":return gH(Y,X);case"Promise":return fH(Y,X);case"Record":return yH(Y,X);case"Ref":return dH(Y,X);case"RegExp":return vH(Y,X);case"String":return hH(Y,X);case"Symbol":return pH(Y,X);case"TemplateLiteral":return mH(Y,X);case"This":return cH(Y,X);case"Tuple":return uH(Y,X);case"Undefined":return oH(Y,X);case"Union":return iH(Y,X);case"Uint8Array":return lH(Y,X);case"Unknown":return nH(Y,X);case"Void":return tH(Y,X);default:if(!q2.Has(Y[h]))throw new h1(Y,"Unknown type");return sH(Y,X)}};function k1(...$){return wZ=0,$.length===2?x1($[0],$[1]):x1($[0],[])}class h1 extends P0{constructor($,W){super(W);this.schema=$}}var rH=512,wZ=0;var aH=function($,W,X){if($[h]==="Object"&&typeof X==="object"&&!x8(X)){const Y=$,Z=Object.getOwnPropertyNames(X),J=Object.entries(Y.properties),[z,Q]=[1/J.length,J.length];return J.reduce((G,[A,w])=>{const D=w[h]==="Literal"&&w.const===X[A]?Q:0,O=c0(w,W,X[A])?z:0,L=Z.includes(A)?z:0;return G+(D+O+L)},0)}else return c0($,W,X)?1:0},eH=function($,W,X){const Y=$.anyOf.map((z)=>y0(z,W));let[Z,J]=[Y[0],0];for(let z of Y){const Q=aH(z,W,X);if(Q>J)Z=z,J=Q}return Z},$D=function($,W,X){if("default"in $)return typeof X==="function"?$.default:X2($.default);else{const Y=eH($,W,X);return W4(Y,W,X)}},WD=function($,W,X){return c0($,W,X)?X2(X):k1($,W)},XD=function($,W,X){return c0($,W,X)?X:k1($,W)},YD=function($,W,X){if(c0($,W,X))return X2(X);const Y=K0(X)?X2(X):k1($,W),Z=D0($.minItems)&&Y.length<$.minItems?[...Y,...Array.from({length:$.minItems-Y.length},()=>null)]:Y,z=(D0($.maxItems)&&Z.length>$.maxItems?Z.slice(0,$.maxItems):Z).map((G)=>F8($.items,W,G));if($.uniqueItems!==!0)return z;const Q=[...new Set(z)];if(!c0($,W,Q))throw new lW($,"Array cast produced invalid data due to uniqueItems constraint");return Q},ZD=function($,W,X){if(c0($,W,X))return k1($,W);const Y=new Set($.returns.required||[]),Z=function(){};for(let[J,z]of Object.entries($.returns.properties)){if(!Y.has(J)&&X.prototype[J]===void 0)continue;Z.prototype[J]=F8(z,W,X.prototype[J])}return Z},JD=function($,W,X){const Y=k1($,W),Z=M2(Y)&&M2(X)?{...Y,...X}:X;return c0($,W,Z)?Z:k1($,W)},zD=function($,W,X){throw new lW($,"Never types cannot be cast")},QD=function($,W,X){if(c0($,W,X))return X;if(X===null||typeof X!=="object")return k1($,W);const Y=new Set($.required||[]),Z={};for(let[J,z]of Object.entries($.properties)){if(!Y.has(J)&&X[J]===void 0)continue;Z[J]=F8(z,W,X[J])}if(typeof $.additionalProperties==="object"){const J=Object.getOwnPropertyNames($.properties);for(let z of Object.getOwnPropertyNames(X)){if(J.includes(z))continue;Z[z]=F8($.additionalProperties,W,X[z])}}return Z},GD=function($,W,X){if(c0($,W,X))return X2(X);if(X===null||typeof X!=="object"||Array.isArray(X)||X instanceof Date)return k1($,W);const Y=Object.getOwnPropertyNames($.patternProperties)[0],Z=$.patternProperties[Y],J={};for(let[z,Q]of Object.entries(X))J[z]=F8(Z,W,Q);return J},UD=function($,W,X){return F8(y0($,W),W,X)},MD=function($,W,X){return F8(y0($,W),W,X)},wD=function($,W,X){if(c0($,W,X))return X2(X);if(!K0(X))return k1($,W);if($.items===void 0)return[];return $.items.map((Y,Z)=>F8(Y,W,X[Z]))},AD=function($,W,X){return c0($,W,X)?X2(X):$D($,W,X)},F8=function($,W,X){const Y=C0($.$id)?[...W,$]:W,Z=$;switch($[h]){case"Array":return YD(Z,Y,X);case"Constructor":return ZD(Z,Y,X);case"Intersect":return JD(Z,Y,X);case"Never":return zD(Z,Y,X);case"Object":return QD(Z,Y,X);case"Record":return GD(Z,Y,X);case"Ref":return UD(Z,Y,X);case"This":return MD(Z,Y,X);case"Tuple":return wD(Z,Y,X);case"Union":return AD(Z,Y,X);case"Date":case"Symbol":case"Uint8Array":return WD($,W,X);default:return XD(Z,Y,X)}};function W4(...$){return $.length===3?F8($[0],$[1],$[2]):F8($[0],[],$[1])}class lW extends P0{constructor($,W){super(W);this.schema=$}}var _D=function($){return E0($)&&$[h]!=="Unsafe"},HD=function($,W,X){if(!K0(X))return X;return X.map((Y)=>T1($.items,W,Y))},DD=function($,W,X){const Y=$.unevaluatedProperties,J=$.allOf.map((Q)=>T1(Q,W,X2(X))).reduce((Q,G)=>c2(G)?{...Q,...G}:G,{});if(!c2(X)||!c2(J)||!E0(Y))return J;const z=D1($);for(let Q of Object.getOwnPropertyNames(X)){if(z.includes(Q))continue;if(c0(Y,W,X[Q]))J[Q]=T1(Y,W,X[Q])}return J},BD=function($,W,X){if(!c2(X)||K0(X))return X;const Y=$.additionalProperties;for(let Z of Object.getOwnPropertyNames(X)){if(Z in $.properties){X[Z]=T1($.properties[Z],W,X[Z]);continue}if(E0(Y)&&c0(Y,W,X[Z])){X[Z]=T1(Y,W,X[Z]);continue}delete X[Z]}return X},OD=function($,W,X){if(!c2(X))return X;const Y=$.additionalProperties,Z=Object.getOwnPropertyNames(X),[J,z]=Object.entries($.patternProperties)[0],Q=new RegExp(J);for(let G of Z){if(Q.test(G)){X[G]=T1(z,W,X[G]);continue}if(E0(Y)&&c0(Y,W,X[G])){X[G]=T1(Y,W,X[G]);continue}delete X[G]}return X},ND=function($,W,X){return T1(y0($,W),W,X)},LD=function($,W,X){return T1(y0($,W),W,X)},FD=function($,W,X){if(!K0(X))return X;if(N2($.items))return[];const Y=Math.min(X.length,$.items.length);for(let Z=0;Z<Y;Z++)X[Z]=T1($.items[Z],W,X[Z]);return X.length>Y?X.slice(0,Y):X},KD=function($,W,X){for(let Y of $.anyOf)if(_D(Y)&&c0(Y,W,X))return T1(Y,W,X);return X},T1=function($,W,X){const Y=C0($.$id)?[...W,$]:W,Z=$;switch(Z[h]){case"Array":return HD(Z,Y,X);case"Intersect":return DD(Z,Y,X);case"Object":return BD(Z,Y,X);case"Record":return OD(Z,Y,X);case"Ref":return ND(Z,Y,X);case"This":return LD(Z,Y,X);case"Tuple":return FD(Z,Y,X);case"Union":return KD(Z,Y,X);default:return X}};function nW(...$){return $.length===3?T1($[0],$[1],$[2]):T1($[0],[],$[1])}var X4=function($){return C0($)&&!isNaN($)&&!isNaN(parseFloat($))},SD=function($){return u2($)||H8($)||D0($)},i$=function($){return $===!0||D0($)&&$===1||u2($)&&$===BigInt("1")||C0($)&&($.toLowerCase()==="true"||$==="1")},l$=function($){return $===!1||D0($)&&($===0||Object.is($,-0))||u2($)&&$===BigInt("0")||C0($)&&($.toLowerCase()==="false"||$==="0"||$==="-0")},RD=function($){return C0($)&&/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i.test($)},PD=function($){return C0($)&&/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)?$/i.test($)},ED=function($){return C0($)&&/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i.test($)},CD=function($){return C0($)&&/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)?$/i.test($)},qD=function($){return C0($)&&/^\d\d\d\d-[0-1]\d-[0-3]\d$/i.test($)},VD=function($,W){const X=_Z($);return X===W?X:$},jD=function($,W){const X=HZ($);return X===W?X:$},ID=function($,W){const X=AZ($);return X===W?X:$},bD=function($,W){return C0($.const)?VD(W,$.const):D0($.const)?jD(W,$.const):H8($.const)?ID(W,$.const):X2(W)},AZ=function($){return i$($)?!0:l$($)?!1:$},xD=function($){return X4($)?BigInt(parseInt($)):D0($)?BigInt($|0):l$($)?BigInt(0):i$($)?BigInt(1):$},_Z=function($){return SD($)?$.toString():w1($)&&$.description!==void 0?$.description.toString():$},HZ=function($){return X4($)?parseFloat($):i$($)?1:l$($)?0:$},kD=function($){return X4($)?parseInt($):D0($)?$|0:i$($)?1:l$($)?0:$},TD=function($){return C0($)&&$.toLowerCase()==="null"?null:$},gD=function($){return C0($)&&$==="undefined"?void 0:$},fD=function($){return R1($)?$:D0($)?new Date($):i$($)?new Date(1):l$($)?new Date(0):X4($)?new Date(parseInt($)):PD($)?new Date(`1970-01-01T${$}.000Z`):RD($)?new Date(`1970-01-01T${$}`):CD($)?new Date(`${$}.000Z`):ED($)?new Date($):qD($)?new Date(`${$}T00:00:00.000Z`):$},yD=function($){return $},dD=function($,W,X){return(K0(X)?X:[X]).map((Z)=>K8($.items,W,Z))},vD=function($,W,X){return xD(X)},hD=function($,W,X){return AZ(X)},pD=function($,W,X){return fD(X)},mD=function($,W,X){return kD(X)},cD=function($,W,X){return $.allOf.reduce((Y,Z)=>K8(Z,W,Y),X)},uD=function($,W,X){return bD($,X)},oD=function($,W,X){return TD(X)},iD=function($,W,X){return HZ(X)},lD=function($,W,X){if(!c2(X))return X;const Z={};for(let J of Object.keys(X))Z[J]=I0($.properties,J)?K8($.properties[J],W,X[J]):X[J];return Z},nD=function($,W,X){const Y=Object.getOwnPropertyNames($.patternProperties)[0],Z=$.patternProperties[Y],J={};for(let[z,Q]of Object.entries(X))J[z]=K8(Z,W,Q);return J},tD=function($,W,X){return K8(y0($,W),W,X)},sD=function($,W,X){return _Z(X)},rD=function($,W,X){return C0(X)||D0(X)?Symbol(X):X},aD=function($,W,X){return K8(y0($,W),W,X)},eD=function($,W,X){if(!(K0(X)&&!N2($.items)))return X;return X.map((Z,J)=>{return J<$.items.length?K8($.items[J],W,Z):Z})},$B=function($,W,X){return gD(X)},WB=function($,W,X){for(let Y of $.anyOf){const Z=K8(Y,W,X);if(!c0(Y,W,Z))continue;return Z}return X},K8=function($,W,X){const Y=C0($.$id)?[...W,$]:W,Z=$;switch($[h]){case"Array":return dD(Z,Y,X);case"BigInt":return vD(Z,Y,X);case"Boolean":return hD(Z,Y,X);case"Date":return pD(Z,Y,X);case"Integer":return mD(Z,Y,X);case"Intersect":return cD(Z,Y,X);case"Literal":return uD(Z,Y,X);case"Null":return oD(Z,Y,X);case"Number":return iD(Z,Y,X);case"Object":return lD(Z,Y,X);case"Record":return nD(Z,Y,X);case"Ref":return tD(Z,Y,X);case"String":return sD(Z,Y,X);case"Symbol":return rD(Z,Y,X);case"This":return aD(Z,Y,X);case"Tuple":return eD(Z,Y,X);case"Undefined":return $B(Z,Y,X);case"Union":return WB(Z,Y,X);default:return yD(X)}};function tW(...$){return $.length===3?K8($[0],$[1],$[2]):K8($[0],[],$[1])}var e8=function($,W){return W===void 0&&"default"in $?X2($.default):W},XB=function($){return E0($)&&$[h]!=="Unsafe"},Y4=function($){return E0($)&&"default"in $},YB=function($,W,X){const Y=e8($,X);if(!K0(Y))return Y;for(let Z=0;Z<Y.length;Z++)Y[Z]=p1($.items,W,Y[Z]);return Y},ZB=function($,W,X){const Y=e8($,X);return $.allOf.reduce((Z,J)=>{const z=p1(J,W,Y);return c2(z)?{...Z,...z}:z},{})},JB=function($,W,X){const Y=e8($,X);if(!c2(Y))return Y;const Z=$.additionalProperties,J=Object.getOwnPropertyNames($.properties);for(let z of J){if(!Y4($.properties[z]))continue;Y[z]=p1($.properties[z],W,Y[z])}if(!Y4(Z))return Y;for(let z of Object.getOwnPropertyNames(Y)){if(J.includes(z))continue;Y[z]=p1(Z,W,Y[z])}return Y},zB=function($,W,X){const Y=e8($,X);if(!c2(Y))return Y;const Z=$.additionalProperties,[J,z]=Object.entries($.patternProperties)[0],Q=new RegExp(J);for(let G of Object.getOwnPropertyNames(Y)){if(!(Q.test(G)&&Y4(z)))continue;Y[G]=p1(z,W,Y[G])}if(!Y4(Z))return Y;for(let G of Object.getOwnPropertyNames(Y)){if(Q.test(G))continue;Y[G]=p1(Z,W,Y[G])}return Y},QB=function($,W,X){return p1(y0($,W),W,e8($,X))},GB=function($,W,X){return p1(y0($,W),W,X)},UB=function($,W,X){const Y=e8($,X);if(!K0(Y)||N2($.items))return Y;const[Z,J]=[$.items,Math.max($.items.length,Y.length)];for(let z=0;z<J;z++)if(z<Z.length)Y[z]=p1(Z[z],W,Y[z]);return Y},MB=function($,W,X){const Y=e8($,X);for(let Z of $.anyOf){const J=p1(Z,W,Y);if(XB(Z)&&c0(Z,J))return J}return Y},p1=function($,W,X){const Y=C0($.$id)?[...W,$]:W,Z=$;switch(Z[h]){case"Array":return YB(Z,Y,X);case"Intersect":return ZB(Z,Y,X);case"Object":return JB(Z,Y,X);case"Record":return zB(Z,Y,X);case"Ref":return QB(Z,Y,X);case"This":return GB(Z,Y,X);case"Tuple":return UB(Z,Y,X);case"Union":return MB(Z,Y,X);default:return e8(Z,X)}};function sW(...$){return $.length===3?p1($[0],$[1],$[2]):p1($[0],[],$[1])}var z8={};n8(z8,{ValuePointerRootSetError:()=>{{return rW}},ValuePointerRootDeleteError:()=>{{return aW}},Set:()=>{{return wB}},Has:()=>{{return _B}},Get:()=>{{return HB}},Format:()=>{{return n$}},Delete:()=>{{return AB}}});var DZ=function($){return $.indexOf("~")===-1?$:$.replace(/~1/g,"/").replace(/~0/g,"~")};function*n$($){if($==="")return;let[W,X]=[0,0];for(let Y=0;Y<$.length;Y++)if($.charAt(Y)==="/")if(Y===0)W=Y+1;else X=Y,yield DZ($.slice(W,X)),W=Y+1;else X=Y;yield DZ($.slice(W))}function wB($,W,X){if(W==="")throw new rW($,W,X);let[Y,Z,J]=[null,$,""];for(let z of n$(W)){if(Z[z]===void 0)Z[z]={};Y=Z,Z=Z[z],J=z}Y[J]=X}function AB($,W){if(W==="")throw new aW($,W);let[X,Y,Z]=[null,$,""];for(let J of n$(W)){if(Y[J]===void 0||Y[J]===null)return;X=Y,Y=Y[J],Z=J}if(Array.isArray(X)){const J=parseInt(Z);X.splice(J,1)}else delete X[Z]}function _B($,W){if(W==="")return!0;let[X,Y,Z]=[null,$,""];for(let J of n$(W)){if(Y[J]===void 0)return!1;X=Y,Y=Y[J],Z=J}return Object.getOwnPropertyNames(X).includes(Z)}function HB($,W){if(W==="")return $;let X=$;for(let Y of n$(W)){if(X[Y]===void 0)return;X=X[Y]}return X}class rW extends P0{constructor($,W,X){super("Cannot set root value");this.value=$,this.path=W,this.update=X}}class aW extends P0{constructor($,W){super("Cannot delete root value");this.value=$,this.path=W}}var s$=function($,W){return{type:"update",path:$,value:W}},BZ=function($,W){return{type:"insert",path:$,value:W}},OZ=function($){return{type:"delete",path:$}};function*NB($,W,X){if(!M2(X))return yield s$($,X);const Y=[...globalThis.Object.keys(W),...globalThis.Object.getOwnPropertySymbols(W)],Z=[...globalThis.Object.keys(X),...globalThis.Object.getOwnPropertySymbols(X)];for(let J of Y){if(w1(J))throw new t$(J);if(N2(X[J])&&Z.includes(J))yield s$(`${$}/${globalThis.String(J)}`,void 0)}for(let J of Z){if(N2(W[J])||N2(X[J]))continue;if(w1(J))throw new t$(J);yield*Z4(`${$}/${globalThis.String(J)}`,W[J],X[J])}for(let J of Z){if(w1(J))throw new t$(J);if(N2(W[J]))yield BZ(`${$}/${globalThis.String(J)}`,X[J])}for(let J of Y.reverse()){if(w1(J))throw new t$(J);if(N2(X[J])&&!Z.includes(J))yield OZ(`${$}/${globalThis.String(J)}`)}}function*LB($,W,X){if(!K0(X))return yield s$($,X);for(let Y=0;Y<Math.min(W.length,X.length);Y++)yield*Z4(`${$}/${Y}`,W[Y],X[Y]);for(let Y=0;Y<X.length;Y++){if(Y<W.length)continue;yield BZ(`${$}/${Y}`,X[Y])}for(let Y=W.length-1;Y>=0;Y--){if(Y<X.length)continue;yield OZ(`${$}/${Y}`)}}function*FB($,W,X){if(!f1(X)||W.length!==X.length||globalThis.Object.getPrototypeOf(W).constructor.name!==globalThis.Object.getPrototypeOf(X).constructor.name)return yield s$($,X);for(let Y=0;Y<Math.min(W.length,X.length);Y++)yield*Z4(`${$}/${Y}`,W[Y],X[Y])}function*KB($,W,X){if(W===X)return;yield s$($,X)}function*Z4($,W,X){if(M2(W))return yield*NB($,W,X);if(K0(W))return yield*LB($,W,X);if(f1(W))return yield*FB($,W,X);if(P1(W))return yield*KB($,W,X);throw new eW(W,"Unable to create diff edits for unknown value")}function NZ($,W){return[...Z4("",$,W)]}var SB=function($){return $.length>0&&$[0].path===""&&$[0].type==="update"},RB=function($){return $.length===0};function LZ($,W){if(SB(W))return X2(W[0].value);if(RB(W))return X2($);const X=X2($);for(let Y of W)switch(Y.type){case"insert":{z8.Set(X,Y.path,Y.value);break}case"update":{z8.Set(X,Y.path,Y.value);break}case"delete":{z8.Delete(X,Y.path);break}}return X}var DB=e0({type:m0("insert"),path:j1(),value:L8()}),BB=e0({type:m0("update"),path:j1(),value:L8()}),OB=e0({type:m0("delete"),path:j1()}),wj=r0([DB,BB,OB]);class eW extends P0{constructor($,W){super(W);this.value=$}}class t$ extends eW{constructor($){super($,"Cannot diff objects with symbol keys");this.value=$}}var PB=function($,W){if(!M2(W))return!1;const X=[...Object.keys($),...Object.getOwnPropertySymbols($)],Y=[...Object.keys(W),...Object.getOwnPropertySymbols(W)];if(X.length!==Y.length)return!1;return X.every((Z)=>r$($[Z],W[Z]))},EB=function($,W){return R1(W)&&$.getTime()===W.getTime()},CB=function($,W){if(!K0(W)||$.length!==W.length)return!1;return $.every((X,Y)=>r$(X,W[Y]))},qB=function($,W){if(!f1(W)||$.length!==W.length||Object.getPrototypeOf($).constructor.name!==Object.getPrototypeOf(W).constructor.name)return!1;return $.every((X,Y)=>r$(X,W[Y]))},VB=function($,W){return $===W};function r$($,W){if(M2($))return PB($,W);if(R1($))return EB($,W);if(f1($))return qB($,W);if(K0($))return CB($,W);if(P1($))return VB($,W);throw new Error("ValueEquals: Unable to compare value")}var jB=function($,W,X,Y){if(!M2(X))z8.Set($,W,X2(Y));else{const Z=Object.getOwnPropertyNames(X),J=Object.getOwnPropertyNames(Y);for(let z of Z)if(!J.includes(z))delete X[z];for(let z of J)if(!Z.includes(z))X[z]=null;for(let z of J)W9($,`${W}/${z}`,X[z],Y[z])}},IB=function($,W,X,Y){if(!K0(X))z8.Set($,W,X2(Y));else{for(let Z=0;Z<Y.length;Z++)W9($,`${W}/${Z}`,X[Z],Y[Z]);X.splice(Y.length)}},bB=function($,W,X,Y){if(f1(X)&&X.length===Y.length)for(let Z=0;Z<X.length;Z++)X[Z]=Y[Z];else z8.Set($,W,X2(Y))},xB=function($,W,X,Y){if(X===Y)return;z8.Set($,W,Y)},W9=function($,W,X,Y){if(K0(Y))return IB($,W,X,Y);if(f1(Y))return bB($,W,X,Y);if(M2(Y))return jB($,W,X,Y);if(P1(Y))return xB($,W,X,Y)},FZ=function($){return f1($)||P1($)},kB=function($,W){return M2($)&&K0(W)||K0($)&&M2(W)};function KZ($,W){if(FZ($)||FZ(W))throw new $9("Only object and array types can be mutated at the root level");if(kB($,W))throw new $9("Cannot assign due type mismatch of assignable values");W9($,"",$,W)}class $9 extends P0{constructor($){super($)}}var F2=function($,W,X){try{return _2($)?$[V2].Decode(X):X}catch(Y){throw new SZ($,W,X,Y)}},TB=function($,W,X,Y){return K0(Y)?F2($,X,Y.map((Z,J)=>S8($.items,W,`${X}/${J}`,Z))):F2($,X,Y)},gB=function($,W,X,Y){if(!M2(Y)||P1(Y))return F2($,X,Y);const Z=r5($),J=Z.map((w)=>w[0]),z={...Y};for(let[w,D]of Z)if(w in z)z[w]=S8(D,W,`${X}/${w}`,z[w]);if(!_2($.unevaluatedProperties))return F2($,X,z);const Q=Object.getOwnPropertyNames(z),G=$.unevaluatedProperties,A={...z};for(let w of Q)if(!J.includes(w))A[w]=F2(G,`${X}/${w}`,A[w]);return F2($,X,A)},fB=function($,W,X,Y){return F2($,X,S8($.not,W,X,Y))},yB=function($,W,X,Y){if(!M2(Y))return F2($,X,Y);const Z=D1($),J={...Y};for(let A of Z)if(A in J)J[A]=S8($.properties[A],W,`${X}/${A}`,J[A]);if(!E0($.additionalProperties))return F2($,X,J);const z=Object.getOwnPropertyNames(J),Q=$.additionalProperties,G={...J};for(let A of z)if(!Z.includes(A))G[A]=F2(Q,`${X}/${A}`,G[A]);return F2($,X,G)},dB=function($,W,X,Y){if(!M2(Y))return F2($,X,Y);const Z=Object.getOwnPropertyNames($.patternProperties)[0],J=new RegExp(Z),z={...Y};for(let w of Object.getOwnPropertyNames(Y))if(J.test(w))z[w]=S8($.patternProperties[Z],W,`${X}/${w}`,z[w]);if(!E0($.additionalProperties))return F2($,X,z);const Q=Object.getOwnPropertyNames(z),G=$.additionalProperties,A={...z};for(let w of Q)if(!J.test(w))A[w]=F2(G,`${X}/${w}`,A[w]);return F2($,X,A)},vB=function($,W,X,Y){const Z=y0($,W);return F2($,X,S8(Z,W,X,Y))},hB=function($,W,X,Y){const Z=y0($,W);return F2($,X,S8(Z,W,X,Y))},pB=function($,W,X,Y){return K0(Y)&&K0($.items)?F2($,X,$.items.map((Z,J)=>S8(Z,W,`${X}/${J}`,Y[J]))):F2($,X,Y)},mB=function($,W,X,Y){for(let Z of $.anyOf){if(!c0(Z,W,Y))continue;const J=S8(Z,W,X,Y);return F2($,X,J)}return F2($,X,Y)},S8=function($,W,X,Y){const Z=typeof $.$id==="string"?[...W,$]:W,J=$;switch($[h]){case"Array":return TB(J,Z,X,Y);case"Intersect":return gB(J,Z,X,Y);case"Not":return fB(J,Z,X,Y);case"Object":return yB(J,Z,X,Y);case"Record":return dB(J,Z,X,Y);case"Ref":return vB(J,Z,X,Y);case"Symbol":return F2(J,X,Y);case"This":return hB(J,Z,X,Y);case"Tuple":return pB(J,Z,X,Y);case"Union":return mB(J,Z,X,Y);default:return F2(J,X,Y)}};function J4($,W,X){return S8($,W,"",X)}class a$ extends P0{constructor($,W,X){super("Unable to decode value as it does not match the expected schema");this.schema=$,this.value=W,this.error=X}}class SZ extends P0{constructor($,W,X,Y){super(Y instanceof Error?Y.message:"Unknown error");this.schema=$,this.path=W,this.value=X,this.error=Y}}var d2=function($,W,X){try{return _2($)?$[V2].Encode(X):X}catch(Y){throw new RZ($,W,X,Y)}},cB=function($,W,X,Y){const Z=d2($,X,Y);return K0(Z)?Z.map((J,z)=>R8($.items,W,`${X}/${z}`,J)):Z},uB=function($,W,X,Y){const Z=d2($,X,Y);if(!M2(Y)||P1(Y))return Z;const J=r5($),z=J.map((D)=>D[0]),Q={...Z};for(let[D,O]of J)if(D in Q)Q[D]=R8(O,W,`${X}/${D}`,Q[D]);if(!_2($.unevaluatedProperties))return d2($,X,Q);const G=Object.getOwnPropertyNames(Q),A=$.unevaluatedProperties,w={...Q};for(let D of G)if(!z.includes(D))w[D]=d2(A,`${X}/${D}`,w[D]);return w},oB=function($,W,X,Y){return d2($.not,X,d2($,X,Y))},iB=function($,W,X,Y){const Z=d2($,X,Y);if(!M2(Z))return Z;const J=D1($),z={...Z};for(let w of J)if(w in z)z[w]=R8($.properties[w],W,`${X}/${w}`,z[w]);if(!E0($.additionalProperties))return z;const Q=Object.getOwnPropertyNames(z),G=$.additionalProperties,A={...z};for(let w of Q)if(!J.includes(w))A[w]=d2(G,`${X}/${w}`,A[w]);return A},lB=function($,W,X,Y){const Z=d2($,X,Y);if(!M2(Y))return Z;const J=Object.getOwnPropertyNames($.patternProperties)[0],z=new RegExp(J),Q={...Z};for(let D of Object.getOwnPropertyNames(Y))if(z.test(D))Q[D]=R8($.patternProperties[J],W,`${X}/${D}`,Q[D]);if(!E0($.additionalProperties))return d2($,X,Q);const G=Object.getOwnPropertyNames(Q),A=$.additionalProperties,w={...Q};for(let D of G)if(!z.test(D))w[D]=d2(A,`${X}/${D}`,w[D]);return w},nB=function($,W,X,Y){const Z=y0($,W),J=R8(Z,W,X,Y);return d2($,X,J)},tB=function($,W,X,Y){const Z=y0($,W),J=R8(Z,W,X,Y);return d2($,X,J)},sB=function($,W,X,Y){const Z=d2($,X,Y);return K0($.items)?$.items.map((J,z)=>R8(J,W,`${X}/${z}`,Z[z])):[]},rB=function($,W,X,Y){for(let Z of $.anyOf){if(!c0(Z,W,Y))continue;const J=R8(Z,W,X,Y);return d2($,X,J)}for(let Z of $.anyOf){const J=R8(Z,W,X,Y);if(!c0($,W,J))continue;return d2($,X,J)}return d2($,X,Y)},R8=function($,W,X,Y){const Z=typeof $.$id==="string"?[...W,$]:W,J=$;switch($[h]){case"Array":return cB(J,Z,X,Y);case"Intersect":return uB(J,Z,X,Y);case"Not":return oB(J,Z,X,Y);case"Object":return iB(J,Z,X,Y);case"Record":return lB(J,Z,X,Y);case"Ref":return nB(J,Z,X,Y);case"This":return tB(J,Z,X,Y);case"Tuple":return sB(J,Z,X,Y);case"Union":return rB(J,Z,X,Y);default:return d2(J,X,Y)}};function z4($,W,X){return R8($,W,"",X)}class e$ extends P0{constructor($,W,X){super("The encoded value does not match the expected schema");this.schema=$,this.value=W,this.error=X}}class RZ extends P0{constructor($,W,X,Y){super(`${Y instanceof Error?Y.message:"Unknown error"}`);this.schema=$,this.path=W,this.value=X,this.error=Y}}var aB=function($,W){return _2($)||v2($.items,W)},eB=function($,W){return _2($)||v2($.items,W)},$O=function($,W){return _2($)||v2($.returns,W)||$.parameters.some((X)=>v2(X,W))},WO=function($,W){return _2($)||v2($.returns,W)||$.parameters.some((X)=>v2(X,W))},XO=function($,W){return _2($)||_2($.unevaluatedProperties)||$.allOf.some((X)=>v2(X,W))},YO=function($,W){return _2($)||v2($.items,W)},ZO=function($,W){return _2($)||v2($.not,W)},JO=function($,W){return _2($)||Object.values($.properties).some((X)=>v2(X,W))||E0($.additionalProperties)&&v2($.additionalProperties,W)},zO=function($,W){return _2($)||v2($.item,W)},QO=function($,W){const X=Object.getOwnPropertyNames($.patternProperties)[0],Y=$.patternProperties[X];return _2($)||v2(Y,W)||E0($.additionalProperties)&&_2($.additionalProperties)},GO=function($,W){if(_2($))return!0;return v2(y0($,W),W)},UO=function($,W){if(_2($))return!0;return v2(y0($,W),W)},MO=function($,W){return _2($)||!N2($.items)&&$.items.some((X)=>v2(X,W))},wO=function($,W){return _2($)||$.anyOf.some((X)=>v2(X,W))},v2=function($,W){const X=C0($.$id)?[...W,$]:W,Y=$;if($.$id&&X9.has($.$id))return!1;if($.$id)X9.add($.$id);switch($[h]){case"Array":return aB(Y,X);case"AsyncIterator":return eB(Y,X);case"Constructor":return $O(Y,X);case"Function":return WO(Y,X);case"Intersect":return XO(Y,X);case"Iterator":return YO(Y,X);case"Not":return ZO(Y,X);case"Object":return JO(Y,X);case"Promise":return zO(Y,X);case"Record":return QO(Y,X);case"Ref":return GO(Y,X);case"This":return UO(Y,X);case"Tuple":return MO(Y,X);case"Union":return wO(Y,X);default:return _2($)}};function $5($,W){return X9.clear(),v2($,W)}var X9=new Set;var Y2={};n8(Y2,{Patch:()=>{{return RO}},Mutate:()=>{{return PO}},Hash:()=>{{return SO}},Errors:()=>{{return Z9}},Equal:()=>{{return FO}},Encode:()=>{{return LO}},Diff:()=>{{return KO}},Default:()=>{{return NO}},Decode:()=>{{return OO}},Create:()=>{{return _O}},Convert:()=>{{return DO}},Clone:()=>{{return BO}},Clean:()=>{{return HO}},Check:()=>{{return Y9}},Cast:()=>{{return AO}}});function AO(...$){return W4.apply(W4,$)}function _O(...$){return k1.apply(k1,$)}function Y9(...$){return c0.apply(c0,$)}function HO(...$){return nW.apply(nW,$)}function DO(...$){return tW.apply(tW,$)}function BO($){return X2($)}function OO(...$){const[W,X,Y]=$.length===3?[$[0],$[1],$[2]]:[$[0],[],$[1]];if(!Y9(W,X,Y))throw new a$(W,Y,Z9(W,X,Y).First());return $5(W,X)?J4(W,X,Y):Y}function NO(...$){return sW.apply(sW,$)}function LO(...$){const[W,X,Y]=$.length===3?[$[0],$[1],$[2]]:[$[0],[],$[1]],Z=$5(W,X)?z4(W,X,Y):Y;if(!Y9(W,X,Z))throw new e$(W,Z,Z9(W,X,Z).First());return Z}function Z9(...$){return c$.apply(c$,$)}function FO($,W){return r$($,W)}function KO($,W){return NZ($,W)}function SO($){return r8($)}function RO($,W){return LZ($,W)}function PO($,W){KZ($,W)}var PZ=function($){return $.map((W)=>J9(W))},EO=function($){return z1(PZ($))},CO=function($){return r0(PZ($))},qO=function($){return J9($)},J9=function($){return j2($)?EO($.allOf):p0($)?CO($.anyOf):B6($)?qO($.item):$};function z9($,W={}){return G0(J9($),W)}var VO=function($){const W=[];for(let X of $)W.push(...D1(X));return r7(W)},jO=function($){return $.filter((W)=>!t6(W))},IO=function($,W){const X=[];for(let Y of $)X.push(...d$(Y,[W]));return jO(X)},bO=function($,W){const X={};for(let Y of W)X[Y]=n5(IO($,Y));return X};function Q9($,W={}){const X=VO($),Y=bO($,X);return e0(Y,W)}function W5($={}){return{...$,[h]:"Date",type:"Date"}}function X5($={}){return{...$,[h]:"Null",type:"null"}}function Y5($){return{...$,[h]:"Symbol",type:"symbol"}}function Z5($={}){return{...$,[h]:"Undefined",type:"undefined"}}function J5($={}){return{...$,[h]:"Uint8Array",type:"Uint8Array"}}var xO=function($){return $.map((W)=>G9(W,!1))},kO=function($){const W={};for(let X of globalThis.Object.getOwnPropertyNames($))W[X]=I1(G9($[X],!1));return W},Q4=function($,W){return W===!0?$:I1($)},G9=function($,W){return KW($)?Q4(p8(),W):RW($)?Q4(p8(),W):A1($)?I1(J8(xO($))):_6($)?J5():R$($)?W5():w2($)?Q4(e0(kO($)),W):SW($)?Q4(k8([],L8()),W):L2($)?Z5():PW($)?X5():CW($)?Y5():S$($)?N6():X8($)?m0($):t8($)?m0($):A2($)?m0($):e0({})};function U9($,W={}){return G0(G9($,!0),W)}function M9($,W={}){return J8(R2($.parameters),{...W})}var z5=function($,W){return $.map((X)=>m1(X,W))},TO=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames($))X[Y]=m1($[Y],W);return X},gO=function($,W){return $.parameters=z5($.parameters,W),$.returns=m1($.returns,W),$},fO=function($,W){return $.parameters=z5($.parameters,W),$.returns=m1($.returns,W),$},yO=function($,W){return $.allOf=z5($.allOf,W),$},dO=function($,W){return $.anyOf=z5($.anyOf,W),$},vO=function($,W){if(L2($.items))return $;return $.items=z5($.items,W),$},hO=function($,W){return $.items=m1($.items,W),$},pO=function($,W){return $.properties=TO($.properties,W),$},mO=function($,W){return $.item=m1($.item,W),$},cO=function($,W){return $.items=m1($.items,W),$},uO=function($,W){return $.items=m1($.items,W),$},oO=function($,W){const X=W.find((Z)=>Z.$id===$.$ref);if(X===void 0)throw Error(`Unable to dereference schema with \$id ${$.$ref}`);const Y=P2(X,["$id"]);return m1(Y,W)},iO=function($,W){return V$($)?gO($,W):j$($)?fO($,W):j2($)?yO($,W):p0($)?dO($,W):Y8($)?vO($,W):T8($)?hO($,W):f2($)?pO($,W):B6($)?mO($,W):q$($)?cO($,W):I$($)?uO($,W):IW($)?oO($,W):$};function m1($,W){return iO(G0($),R2(W))}function w9($,W={}){if(L2($))throw new Error("Enum undefined or empty");const X=globalThis.Object.getOwnPropertyNames($).filter((J)=>isNaN(J)).map((J)=>$[J]),Z=[...new Set(X)].map((J)=>m0(J));return r0(Z,{...W,[E1]:"Enum"})}function EZ($,W){return S6(L6($),W)}var lO=function($,W){const X=$.filter((Y)=>a8(Y,W)===u.False);return X.length===1?X[0]:r0(X)};function S6($,W,X={}){if(q1($))return G0(EZ($,W),X);if(B2($))return G0(CZ($,W),X);return G0(p0($)?lO($.anyOf,W):a8($,W)!==u.False?s0():$,X)}var nO=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames($))X[Y]=S6($[Y],W);return X},tO=function($,W){return nO($.properties,W)};function CZ($,W){const X=tO($,W);return g0(X)}function qZ($,W){return R6(L6($),W)}var sO=function($,W){const X=$.filter((Y)=>a8(Y,W)!==u.False);return X.length===1?X[0]:r0(X)};function R6($,W,X={}){if(q1($))return G0(qZ($,W),X);if(B2($))return G0(VZ($,W),X);return G0(p0($)?sO($.anyOf,W):a8($,W)!==u.False?$:s0(),X)}var rO=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames($))X[Y]=R6($[Y],W);return X},aO=function($,W){return rO($.properties,W)};function VZ($,W){const X=aO($,W);return g0(X)}function A9($,W={}){return G0($.returns,W)}function _9($={}){return{...$,[h]:"Integer",type:"integer"}}var eO=function($,W,X){return{[$]:Q8(m0($),W,X)}},$N=function($,W,X){return $.reduce((Y,Z)=>{return{...Y,...eO(Z,W,X)}},{})},WN=function($,W,X){return $N($.keys,W,X)};function jZ($,W,X){const Y=WN($,W,X);return g0(Y)}var XN=function($){const[W,X]=[$.slice(0,1),$.slice(1)];return[W.toLowerCase(),X].join("")},YN=function($){const[W,X]=[$.slice(0,1),$.slice(1)];return[W.toUpperCase(),X].join("")},ZN=function($){return $.toUpperCase()},JN=function($){return $.toLowerCase()},zN=function($,W,X){const Y=a6($.pattern);if(!O6(Y))return{...$,pattern:IZ($.pattern,W)};const z=[...g$(Y)].map((A)=>m0(A)),Q=bZ(z,W),G=r0(Q);return y$([G],X)},IZ=function($,W){return typeof $==="string"?W==="Uncapitalize"?XN($):W==="Capitalize"?YN($):W==="Uppercase"?ZN($):W==="Lowercase"?JN($):$:$.toString()},bZ=function($,W){return $.map((X)=>Q8(X,W))};function Q8($,W,X={}){return C1($)?jZ($,W,X):q1($)?zN($,W,$):p0($)?r0(bZ($.anyOf,W),X):g8($)?m0(IZ($.const,W),X):$}function H9($,W={}){return Q8($,"Capitalize",W)}function D9($,W={}){return Q8($,"Lowercase",W)}function B9($,W={}){return Q8($,"Uncapitalize",W)}function O9($,W={}){return Q8($,"Uppercase",W)}function N9($,W){return{...W,[h]:"Not",not:G0($)}}var QN=function($,W,X){const Y={};for(let Z of globalThis.Object.getOwnPropertyNames($))Y[Z]=P6($[Z],W,X);return Y},GN=function($,W,X){return QN($.properties,W,X)};function xZ($,W,X){const Y=GN($,W,X);return g0(Y)}var UN=function($,W){return $.map((X)=>L9(X,W))},MN=function($,W){return $.map((X)=>L9(X,W))},wN=function($,W){const{[W]:X,...Y}=$;return Y},AN=function($,W){return W.reduce((X,Y)=>wN(X,Y),$)},L9=function($,W){return j2($)?z1(UN($.allOf,W)):p0($)?r0(MN($.anyOf,W)):f2($)?e0(AN($.properties,W)):e0({})};function P6($,W,X={}){if(C1(W))return kZ($,W,X);if(B2($))return xZ($,W,X);const Y=V1(W)?H1(W):W,Z=P2($,[V2,"$id","required"]),J=G0(L9($,Y),X);return{...Z,...J}}var _N=function($,W,X){return{[W]:P6($,[W],X)}},HN=function($,W,X){return W.reduce((Y,Z)=>{return{...Y,..._N($,Z,X)}},{})},DN=function($,W,X){return HN($,W.keys,X)};function kZ($,W,X){const Y=DN($,W,X);return g0(Y)}function F9($,W={}){return J8(R2($.parameters),{...W})}var TZ=function($){return $.map((W)=>gZ(W))},BN=function($){const W={};for(let X of globalThis.Object.getOwnPropertyNames($))W[X]=J1($[X]);return W},gZ=function($){return j2($)?z1(TZ($.allOf)):p0($)?r0(TZ($.anyOf)):f2($)?e0(BN($.properties)):e0({})};function Q5($,W={}){if(B2($))return fZ($,W);const X=P2($,[V2,"$id","required"]),Y=G0(gZ($),W);return{...X,...Y}}var ON=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames($))X[Y]=Q5($[Y],W);return X},NN=function($,W){return ON($.properties,W)};function fZ($,W){const X=NN($,W);return g0(X)}var LN=function($,W,X){const Y={};for(let Z of globalThis.Object.getOwnPropertyNames($))Y[Z]=E6($[Z],W,X);return Y},FN=function($,W,X){return LN($.properties,W,X)};function yZ($,W,X){const Y=FN($,W,X);return g0(Y)}var KN=function($,W){return $.map((X)=>K9(X,W))},SN=function($,W){return $.map((X)=>K9(X,W))},RN=function($,W){const X={};for(let Y of W)if(Y in $)X[Y]=$[Y];return X},K9=function($,W){return j2($)?z1(KN($.allOf,W)):p0($)?r0(SN($.anyOf,W)):f2($)?e0(RN($.properties,W)):e0({})};function E6($,W,X={}){if(C1(W))return dZ($,W,X);if(B2($))return yZ($,W,X);const Y=V1(W)?H1(W):W,Z=P2($,[V2,"$id","required"]),J=G0(K9($,Y),X);return{...Z,...J}}var PN=function($,W,X){return{[W]:E6($,[W],X)}},EN=function($,W,X){return W.reduce((Y,Z)=>{return{...Y,...PN($,Z,X)}},{})},CN=function($,W,X){return EN($,W.keys,X)};function dZ($,W,X){const Y=CN($,W,X);return g0(Y)}function S9($){return I1(J1($))}var G5=function($,W,X){return{...X,[h]:"Record",type:"object",patternProperties:{[$]:G0(W)}}},R9=function($,W,X){const Y={};for(let Z of $)Y[Z]=G0(W);return e0(Y,{...X,[E1]:"Record"})},qN=function($,W,X){return t5($)?R9(H1($),W,X):G5($.pattern,W,X)},VN=function($,W,X){return R9(H1(r0($)),W,X)},jN=function($,W,X){return R9([$.toString()],W,X)},IN=function($,W,X){return G5($.source,W,X)},bN=function($,W,X){const Y=L2($.pattern)?s8:$.pattern;return G5(Y,W,X)},xN=function($,W,X){return G5(y8,W,X)},kN=function($,W,X){return G5(y8,W,X)};function P9($,W,X={}){return p0($)?VN($.anyOf,W,X):q1($)?qN($,W,X):g8($)?jN($.const,W,X):H6($)?xN($,W,X):D6($)?kN($,W,X):bW($)?IN($,W,X):b$($)?bN($,W,X):s0(X)}function E9($,W={}){if(L2(W.$id))W.$id=`T${TN++}`;const X=$({[h]:"This",$ref:`${W.$id}`});return X.$id=W.$id,G0({...W,[E1]:"Recursive",...X})}var TN=0;function C9($,W={}){if(A2($))return{...W,[h]:"Ref",$ref:$};if(L2($.$id))throw new Error("Reference target type must specify an $id");return{...W,[h]:"Ref",$ref:$.$id}}function q9($,W={}){const X=A2($)?new globalThis.RegExp($):$;return{...W,[h]:"RegExp",type:"RegExp",source:X.source,flags:X.flags}}var vZ=function($){return $.map((W)=>hZ(W))},gN=function($){const W={};for(let X of globalThis.Object.getOwnPropertyNames($))W[X]=P2($[X],[r2]);return W},hZ=function($){return j2($)?z1(vZ($.allOf)):p0($)?r0(vZ($.anyOf)):f2($)?e0(gN($.properties)):e0({})};function U5($,W={}){if(B2($))return pZ($,W);else{const X=P2($,[V2,"$id","required"]),Y=G0(hZ($),W);return{...X,...Y}}}var fN=function($,W){const X={};for(let Y of globalThis.Object.getOwnPropertyNames($))X[Y]=U5($[Y],W);return X},yN=function($,W){return fN($.properties,W)};function pZ($,W){const X=yN($,W);return g0(X)}var dN=function($){return j2($)?R2($.allOf):p0($)?R2($.anyOf):Y8($)?R2($.items??[]):[]};function V9($){return R2(dN($))}function j9($,W={}){return G0($.returns,W)}function I9($){return JSON.parse(JSON.stringify($))}function b9($){return new mZ($)}class mZ{constructor($){this.schema=$}Decode($){return new cZ(this.schema,$)}}class cZ{constructor($,W){this.schema=$,this.decode=W}EncodeTransform($,W){const Z={Encode:(J)=>W[V2].Encode($(J)),Decode:(J)=>this.decode(W[V2].Decode(J))};return{...W,[V2]:Z}}EncodeSchema($,W){const X={Decode:this.decode,Encode:$};return{...W,[V2]:X}}Encode($){const W=G0(this.schema);return s6(W)?this.EncodeTransform($,W):this.EncodeSchema($,W)}}function x9($={}){return{...$,[h]:"Void",type:"void"}}var k9={};n8(k9,{Void:()=>{{return x9}},Uppercase:()=>{{return O9}},Unsafe:()=>{{return K$}},Unknown:()=>{{return L8}},Union:()=>{{return r0}},Undefined:()=>{{return Z5}},Uncapitalize:()=>{{return B9}},Uint8Array:()=>{{return J5}},Tuple:()=>{{return J8}},Transform:()=>{{return b9}},TemplateLiteral:()=>{{return y$}},Symbol:()=>{{return Y5}},String:()=>{{return j1}},Strict:()=>{{return I9}},ReturnType:()=>{{return j9}},Rest:()=>{{return V9}},Required:()=>{{return U5}},RegExp:()=>{{return q9}},Ref:()=>{{return C9}},Recursive:()=>{{return E9}},Record:()=>{{return P9}},ReadonlyOptional:()=>{{return S9}},Readonly:()=>{{return I1}},Promise:()=>{{return h$}},Pick:()=>{{return E6}},Partial:()=>{{return Q5}},Parameters:()=>{{return F9}},Optional:()=>{{return J1}},Omit:()=>{{return P6}},Object:()=>{{return e0}},Number:()=>{{return Z8}},Null:()=>{{return X5}},Not:()=>{{return N9}},Never:()=>{{return s0}},Mapped:()=>{{return fW}},Lowercase:()=>{{return D9}},Literal:()=>{{return m0}},KeyOf:()=>{{return m$}},Iterator:()=>{{return v$}},Intersect:()=>{{return z1}},Integer:()=>{{return _9}},InstanceType:()=>{{return A9}},Index:()=>{{return F6}},Function:()=>{{return k8}},Extract:()=>{{return R6}},Extends:()=>{{return K6}},Exclude:()=>{{return S6}},Enum:()=>{{return w9}},Deref:()=>{{return m1}},Date:()=>{{return W5}},ConstructorParameters:()=>{{return M9}},Constructor:()=>{{return C$}},Const:()=>{{return U9}},Composite:()=>{{return Q9}},Capitalize:()=>{{return H9}},Boolean:()=>{{return f$}},BigInt:()=>{{return N6}},Awaited:()=>{{return z9}},AsyncIterator:()=>{{return E$}},Array:()=>{{return P$}},Any:()=>{{return p8}}});var Y$=k9;class y9{constructor($,W,X,Y){this.schema=$,this.references=W,this.checkFunc=X,this.code=Y,this.hasTransform=$5($,W)}Code(){return this.code}Errors($){return c$(this.schema,this.references,$)}Check($){return this.checkFunc($)}Decode($){if(!this.checkFunc($))throw new a$(this.schema,$,this.Errors($).First());return this.hasTransform?J4(this.schema,this.references,$):$}Encode($){const W=this.hasTransform?z4(this.schema,this.references,$):$;if(!this.checkFunc(W))throw new e$(this.schema,$,this.Errors($).First());return W}}var m8;(function($){function W(J){return J===36}$.DollarSign=W;function X(J){return J===95}$.IsUnderscore=X;function Y(J){return J>=65&&J<=90||J>=97&&J<=122}$.IsAlpha=Y;function Z(J){return J>=48&&J<=57}$.IsNumeric=Z})(m8||(m8={}));var G4;(function($){function W(J){if(J.length===0)return!1;return m8.IsNumeric(J.charCodeAt(0))}function X(J){if(W(J))return!1;for(let z=0;z<J.length;z++){const Q=J.charCodeAt(z);if(!(m8.IsAlpha(Q)||m8.IsNumeric(Q)||m8.DollarSign(Q)||m8.IsUnderscore(Q)))return!1}return!0}function Y(J){return J.replace(/'/g,"\\'")}function Z(J,z){return X(z)?`${J}.${z}`:`${J}['${Y(z)}']`}$.Encode=Z})(G4||(G4={}));var T9;(function($){function W(X){const Y=[];for(let Z=0;Z<X.length;Z++){const J=X.charCodeAt(Z);if(m8.IsNumeric(J)||m8.IsAlpha(J))Y.push(X.charAt(Z));else Y.push(`_${J}_`)}return Y.join("").replace(/__/g,"_")}$.Encode=W})(T9||(T9={}));var g9;(function($){function W(X){return X.replace(/'/g,"\\'")}$.Escape=W})(g9||(g9={}));class uZ extends P0{constructor($){super("Unknown type");this.schema=$}}class f9 extends P0{constructor($){super("Preflight validation check failed to guard for the given schema");this.schema=$}}var C6;(function($){function W(z,Q,G){return C2.ExactOptionalPropertyTypes?`('${Q}' in ${z} ? ${G} : true)`:`(${G4.Encode(z,Q)} !== undefined ? ${G} : true)`}$.IsExactOptionalProperty=W;function X(z){return!C2.AllowArrayObject?`(typeof ${z} === 'object' && ${z} !== null && !Array.isArray(${z}))`:`(typeof ${z} === 'object' && ${z} !== null)`}$.IsObjectLike=X;function Y(z){return!C2.AllowArrayObject?`(typeof ${z} === 'object' && ${z} !== null && !Array.isArray(${z}) && !(${z} instanceof Date) && !(${z} instanceof Uint8Array))`:`(typeof ${z} === 'object' && ${z} !== null && !(${z} instanceof Date) && !(${z} instanceof Uint8Array))`}$.IsRecordLike=Y;function Z(z){return C2.AllowNaN?`typeof ${z} === 'number'`:`Number.isFinite(${z})`}$.IsNumberLike=Z;function J(z){return C2.AllowNullVoid?`(${z} === undefined || ${z} === null)`:`${z} === undefined`}$.IsVoidLike=J})(C6||(C6={}));var Z$;(function($){function W(C){return C[h]==="Any"||C[h]==="Unknown"}function*X(C,J0,T){yield"true"}function*Y(C,J0,T){yield`Array.isArray(${T})`;const[H0,Y0]=[A0("value","any"),A0("acc","number")];if(D0(C.maxItems))yield`${T}.length <= ${C.maxItems}`;if(D0(C.minItems))yield`${T}.length >= ${C.minItems}`;const X0=_0(C.items,J0,"value");if(yield`${T}.every((${H0}) => ${X0})`,E0(C.contains)||D0(C.minContains)||D0(C.maxContains)){const j0=E0(C.contains)?C.contains:s0(),Z2=_0(j0,J0,"value"),Z0=D0(C.minContains)?[`(count >= ${C.minContains})`]:[],b2=D0(C.maxContains)?[`(count <= ${C.maxContains})`]:[],t0=`const count = value.reduce((${Y0}, ${H0}) => ${Z2} ? acc + 1 : acc, 0)`,_8=["(count > 0)",...Z0,...b2].join(" && ");yield`((${H0}) => { ${t0}; return ${_8}})(${T})`}if(C.uniqueItems===!0)yield`((${H0}) => { const set = new Set(); for(const element of value) { const hashed = hash(element); if(set.has(hashed)) { return false } else { set.add(hashed) } } return true } )(${T})`}function*Z(C,J0,T){yield`(typeof value === 'object' && Symbol.asyncIterator in ${T})`}function*J(C,J0,T){if(yield`(typeof ${T} === 'bigint')`,u2(C.exclusiveMaximum))yield`${T} < BigInt(${C.exclusiveMaximum})`;if(u2(C.exclusiveMinimum))yield`${T} > BigInt(${C.exclusiveMinimum})`;if(u2(C.maximum))yield`${T} <= BigInt(${C.maximum})`;if(u2(C.minimum))yield`${T} >= BigInt(${C.minimum})`;if(u2(C.multipleOf))yield`(${T} % BigInt(${C.multipleOf})) === 0`}function*z(C,J0,T){yield`(typeof ${T} === 'boolean')`}function*Q(C,J0,T){yield*c(C.returns,J0,`${T}.prototype`)}function*G(C,J0,T){if(yield`(${T} instanceof Date) && Number.isFinite(${T}.getTime())`,D0(C.exclusiveMaximumTimestamp))yield`${T}.getTime() < ${C.exclusiveMaximumTimestamp}`;if(D0(C.exclusiveMinimumTimestamp))yield`${T}.getTime() > ${C.exclusiveMinimumTimestamp}`;if(D0(C.maximumTimestamp))yield`${T}.getTime() <= ${C.maximumTimestamp}`;if(D0(C.minimumTimestamp))yield`${T}.getTime() >= ${C.minimumTimestamp}`;if(D0(C.multipleOfTimestamp))yield`(${T}.getTime() % ${C.multipleOfTimestamp}) === 0`}function*A(C,J0,T){yield`(typeof ${T} === 'function')`}function*w(C,J0,T){if(yield`Number.isInteger(${T})`,D0(C.exclusiveMaximum))yield`${T} < ${C.exclusiveMaximum}`;if(D0(C.exclusiveMinimum))yield`${T} > ${C.exclusiveMinimum}`;if(D0(C.maximum))yield`${T} <= ${C.maximum}`;if(D0(C.minimum))yield`${T} >= ${C.minimum}`;if(D0(C.multipleOf))yield`(${T} % ${C.multipleOf}) === 0`}function*D(C,J0,T){const H0=C.allOf.map((Y0)=>_0(Y0,J0,T)).join(" && ");if(C.unevaluatedProperties===!1){const Y0=i(`${new RegExp(d8(C))};`),X0=`Object.getOwnPropertyNames(${T}).every(key => ${Y0}.test(key))`;yield`(${H0} && ${X0})`}else if(E0(C.unevaluatedProperties)){const Y0=i(`${new RegExp(d8(C))};`),X0=`Object.getOwnPropertyNames(${T}).every(key => ${Y0}.test(key) || ${_0(C.unevaluatedProperties,J0,`${T}[key]`)})`;yield`(${H0} && ${X0})`}else yield`(${H0})`}function*O(C,J0,T){yield`(typeof value === 'object' && Symbol.iterator in ${T})`}function*L(C,J0,T){if(typeof C.const==="number"||typeof C.const==="boolean")yield`(${T} === ${C.const})`;else yield`(${T} === '${g9.Escape(C.const)}')`}function*B(C,J0,T){yield"false"}function*M(C,J0,T){yield`(!${_0(C.not,J0,T)})`}function*H(C,J0,T){yield`(${T} === null)`}function*K(C,J0,T){if(yield C6.IsNumberLike(T),D0(C.exclusiveMaximum))yield`${T} < ${C.exclusiveMaximum}`;if(D0(C.exclusiveMinimum))yield`${T} > ${C.exclusiveMinimum}`;if(D0(C.maximum))yield`${T} <= ${C.maximum}`;if(D0(C.minimum))yield`${T} >= ${C.minimum}`;if(D0(C.multipleOf))yield`(${T} % ${C.multipleOf}) === 0`}function*S(C,J0,T){if(yield C6.IsObjectLike(T),D0(C.minProperties))yield`Object.getOwnPropertyNames(${T}).length >= ${C.minProperties}`;if(D0(C.maxProperties))yield`Object.getOwnPropertyNames(${T}).length <= ${C.maxProperties}`;const H0=Object.getOwnPropertyNames(C.properties);for(let Y0 of H0){const X0=G4.Encode(T,Y0),j0=C.properties[Y0];if(C.required&&C.required.includes(Y0)){if(yield*c(j0,J0,X0),v8(j0)||W(j0))yield`('${Y0}' in ${T})`}else{const Z2=_0(j0,J0,X0);yield C6.IsExactOptionalProperty(T,Y0,Z2)}}if(C.additionalProperties===!1)if(C.required&&C.required.length===H0.length)yield`Object.getOwnPropertyNames(${T}).length === ${H0.length}`;else{const Y0=`[${H0.map((X0)=>`'${X0}'`).join(", ")}]`;yield`Object.getOwnPropertyNames(${T}).every(key => ${Y0}.includes(key))`}if(typeof C.additionalProperties==="object"){const Y0=_0(C.additionalProperties,J0,`${T}[key]`),X0=`[${H0.map((j0)=>`'${j0}'`).join(", ")}]`;yield`(Object.getOwnPropertyNames(${T}).every(key => ${X0}.includes(key) || ${Y0}))`}}function*R(C,J0,T){yield`(typeof value === 'object' && typeof ${T}.then === 'function')`}function*b(C,J0,T){if(yield C6.IsRecordLike(T),D0(C.minProperties))yield`Object.getOwnPropertyNames(${T}).length >= ${C.minProperties}`;if(D0(C.maxProperties))yield`Object.getOwnPropertyNames(${T}).length <= ${C.maxProperties}`;const[H0,Y0]=Object.entries(C.patternProperties)[0],X0=i(`${new RegExp(H0)}`),j0=_0(Y0,J0,"value"),Z2=E0(C.additionalProperties)?_0(C.additionalProperties,J0,T):C.additionalProperties===!1?"false":"true",Z0=`(${X0}.test(key) ? ${j0} : ${Z2})`;yield`(Object.entries(${T}).every(([key, value]) => ${Z0}))`}function*f(C,J0,T){const H0=y0(C,J0);if(e.functions.has(C.$ref))return yield`${n(C.$ref)}(${T})`;yield*c(H0,J0,T)}function*P(C,J0,T){const H0=i(`${new RegExp(C.source,C.flags)};`);if(yield`(typeof ${T} === 'string')`,D0(C.maxLength))yield`${T}.length <= ${C.maxLength}`;if(D0(C.minLength))yield`${T}.length >= ${C.minLength}`;yield`${H0}.test(${T})`}function*I(C,J0,T){if(yield`(typeof ${T} === 'string')`,D0(C.maxLength))yield`${T}.length <= ${C.maxLength}`;if(D0(C.minLength))yield`${T}.length >= ${C.minLength}`;if(C.pattern!==void 0)yield`${i(`${new RegExp(C.pattern)};`)}.test(${T})`;if(C.format!==void 0)yield`format('${C.format}', ${T})`}function*g(C,J0,T){yield`(typeof ${T} === 'symbol')`}function*E(C,J0,T){yield`(typeof ${T} === 'string')`,yield`${i(`${new RegExp(C.pattern)};`)}.test(${T})`}function*V(C,J0,T){yield`${n(C.$ref)}(${T})`}function*k(C,J0,T){if(yield`Array.isArray(${T})`,C.items===void 0)return yield`${T}.length === 0`;yield`(${T}.length === ${C.maxItems})`;for(let H0=0;H0<C.items.length;H0++)yield`${_0(C.items[H0],J0,`${T}[${H0}]`)}`}function*s(C,J0,T){yield`${T} === undefined`}function*a(C,J0,T){yield`(${C.anyOf.map((Y0)=>_0(Y0,J0,T)).join(" || ")})`}function*v(C,J0,T){if(yield`${T} instanceof Uint8Array`,D0(C.maxByteLength))yield`(${T}.length <= ${C.maxByteLength})`;if(D0(C.minByteLength))yield`(${T}.length >= ${C.minByteLength})`}function*r(C,J0,T){yield"true"}function*$0(C,J0,T){yield C6.IsVoidLike(T)}function*M0(C,J0,T){const H0=e.instances.size;e.instances.set(H0,C),yield`kind('${C[h]}', ${H0}, ${T})`}function*c(C,J0,T,H0=!0){const Y0=C0(C.$id)?[...J0,C]:J0,X0=C;if(H0&&C0(C.$id)){const j0=n(C.$id);if(e.functions.has(j0))return yield`${j0}(${T})`;else{const Z2=t(j0,C,J0,"value",!1);return e.functions.set(j0,Z2),yield`${j0}(${T})`}}switch(X0[h]){case"Any":return yield*X(X0,Y0,T);case"Array":return yield*Y(X0,Y0,T);case"AsyncIterator":return yield*Z(X0,Y0,T);case"BigInt":return yield*J(X0,Y0,T);case"Boolean":return yield*z(X0,Y0,T);case"Constructor":return yield*Q(X0,Y0,T);case"Date":return yield*G(X0,Y0,T);case"Function":return yield*A(X0,Y0,T);case"Integer":return yield*w(X0,Y0,T);case"Intersect":return yield*D(X0,Y0,T);case"Iterator":return yield*O(X0,Y0,T);case"Literal":return yield*L(X0,Y0,T);case"Never":return yield*B(X0,Y0,T);case"Not":return yield*M(X0,Y0,T);case"Null":return yield*H(X0,Y0,T);case"Number":return yield*K(X0,Y0,T);case"Object":return yield*S(X0,Y0,T);case"Promise":return yield*R(X0,Y0,T);case"Record":return yield*b(X0,Y0,T);case"Ref":return yield*f(X0,Y0,T);case"RegExp":return yield*P(X0,Y0,T);case"String":return yield*I(X0,Y0,T);case"Symbol":return yield*g(X0,Y0,T);case"TemplateLiteral":return yield*E(X0,Y0,T);case"This":return yield*V(X0,Y0,T);case"Tuple":return yield*k(X0,Y0,T);case"Undefined":return yield*s(X0,Y0,T);case"Union":return yield*a(X0,Y0,T);case"Uint8Array":return yield*v(X0,Y0,T);case"Unknown":return yield*r(X0,Y0,T);case"Void":return yield*$0(X0,Y0,T);default:if(!q2.Has(X0[h]))throw new uZ(C);return yield*M0(X0,Y0,T)}}const e={language:"javascript",functions:new Map,variables:new Map,instances:new Map};function _0(C,J0,T,H0=!0){return`(${[...c(C,J0,T,H0)].join(" && ")})`}function n(C){return`check_${T9.Encode(C)}`}function i(C){const J0=`local_${e.variables.size}`;return e.variables.set(J0,`const ${J0} = ${C}`),J0}function t(C,J0,T,H0,Y0=!0){const[X0,j0]=["\n",(t0)=>"".padStart(t0," ")],Z2=A0("value","any"),Z0=F0("boolean"),b2=[...c(J0,T,H0,Y0)].map((t0)=>`${j0(4)}${t0}`).join(` &&${X0}`);return`function ${C}(${Z2})${Z0} {${X0}${j0(2)}return (${X0}${b2}${X0}${j0(2)})\n}`}function A0(C,J0){const T=e.language==="typescript"?`: ${J0}`:"";return`${C}${T}`}function F0(C){return e.language==="typescript"?`: ${C}`:""}function T0(C,J0,T){const H0=t("check",C,J0,"value"),Y0=A0("value","any"),X0=F0("boolean"),j0=[...e.functions.values()],Z2=[...e.variables.values()],Z0=C0(C.$id)?`return function check(${Y0})${X0} {\n  return ${n(C.$id)}(value)\n}`:`return ${H0}`;return[...Z2,...j0,Z0].join("\n")}function v0(...C){const J0={language:"javascript"},[T,H0,Y0]=C.length===2&&K0(C[1])?[C[0],C[1],J0]:C.length===2&&!K0(C[1])?[C[0],[],C[1]]:C.length===3?[C[0],C[1],C[2]]:C.length===1?[C[0],[],J0]:[null,[],J0];if(e.language=Y0.language,e.variables.clear(),e.functions.clear(),e.instances.clear(),!E0(T))throw new f9(T);for(let X0 of H0)if(!E0(X0))throw new f9(X0);return T0(T,H0,Y0)}$.Code=v0;function u0(C,J0=[]){const T=v0(C,J0,{language:"javascript"}),H0=globalThis.Function("kind","format","hash",T),Y0=new Map(e.instances);function X0(b2,t0,_8){if(!q2.Has(b2)||!Y0.has(t0))return!1;const b8=q2.Get(b2),g2=Y0.get(t0);return b8(g2,_8)}function j0(b2,t0){if(!O2.Has(b2))return!1;return O2.Get(b2)(t0)}function Z2(b2){return r8(b2)}const Z0=H0(X0,j0,Z2);return new y9(C,J0,Z0,T)}$.Compile=u0})(Z$||(Z$={}));var pN=function($,W){if(typeof $!=="string")throw new TypeError("argument str must be a string");var X={},Y=W||{},Z=Y.decode||cN,J=0;while(J<$.length){var z=$.indexOf("=",J);if(z===-1)break;var Q=$.indexOf(";",J);if(Q===-1)Q=$.length;else if(Q<z){J=$.lastIndexOf(";",z-1)+1;continue}var G=$.slice(J,z).trim();if(X[G]===void 0){var A=$.slice(z+1,Q).trim();if(A.charCodeAt(0)===34)A=A.slice(1,-1);X[G]=iN(A,Z)}J=Q+1}return X},mN=function($,W,X){var Y=X||{},Z=Y.encode||uN;if(typeof Z!=="function")throw new TypeError("option encode is invalid");if(!U4.test($))throw new TypeError("argument name is invalid");var J=Z(W);if(J&&!U4.test(J))throw new TypeError("argument val is invalid");var z=$+"="+J;if(Y.maxAge!=null){var Q=Y.maxAge-0;if(isNaN(Q)||!isFinite(Q))throw new TypeError("option maxAge is invalid");z+="; Max-Age="+Math.floor(Q)}if(Y.domain){if(!U4.test(Y.domain))throw new TypeError("option domain is invalid");z+="; Domain="+Y.domain}if(Y.path){if(!U4.test(Y.path))throw new TypeError("option path is invalid");z+="; Path="+Y.path}if(Y.expires){var G=Y.expires;if(!oN(G)||isNaN(G.valueOf()))throw new TypeError("option expires is invalid");z+="; Expires="+G.toUTCString()}if(Y.httpOnly)z+="; HttpOnly";if(Y.secure)z+="; Secure";if(Y.partitioned)z+="; Partitioned";if(Y.priority){var A=typeof Y.priority==="string"?Y.priority.toLowerCase():Y.priority;switch(A){case"low":z+="; Priority=Low";break;case"medium":z+="; Priority=Medium";break;case"high":z+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(Y.sameSite){var w=typeof Y.sameSite==="string"?Y.sameSite.toLowerCase():Y.sameSite;switch(w){case!0:z+="; SameSite=Strict";break;case"lax":z+="; SameSite=Lax";break;case"strict":z+="; SameSite=Strict";break;case"none":z+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return z},cN=function($){return $.indexOf("%")!==-1?decodeURIComponent($):$},uN=function($){return encodeURIComponent($)},oN=function($){return hN.call($)==="[object Date]"||$ instanceof Date},iN=function($,W){try{return W($)}catch(X){return $}};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var d9=pN,v9=mN;var hN=Object.prototype.toString,U4=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;var bJ=L$(M4(),1),B3=function($){let W=$;while(W.endsWith("="))W=W.slice(0,-1);return W};var vJ=L$(m9(),1),hJ=L$(M4(),1),D4=L$(m9(),1);var V3=function($){return $%4===0&&($%100!==0||$%400===0)},uJ=function($){const W=j3.exec($);if(!W)return!1;const X=+W[1],Y=+W[2],Z=+W[3];return Y>=1&&Y<=12&&Z>=1&&Z<=(Y===2&&V3(X)?29:I3[Y])},s9=function($){return function W(X){const Y=b3.exec(X);if(!Y)return!1;const Z=+Y[1],J=+Y[2],z=+Y[3],Q=Y[4],G=Y[5]==="-"?-1:1,A=+(Y[6]||0),w=+(Y[7]||0);if(A>23||w>59||$&&!Q)return!1;if(Z<=23&&J<=59&&z<60)return!0;const D=J-w*G,O=Z-A*G-(D<0?1:0);return(O===23||O===-1)&&(D===59||D===-1)&&z<61}},SJ=function($){const W=s9($);return function X(Y){const Z=Y.split(x3);return Z.length===2&&uJ(Z[0])&&W(Z[1])}},g3=function($){return k3.test($)&&T3.test($)},f3=function($){return RJ.lastIndex=0,RJ.test($)},v3=function($){return Number.isInteger($)&&$<=d3&&$>=y3},h3=function($){return Number.isInteger($)},PJ=function(){return!0},m3=function($){if(p3.test($))return!1;try{return new RegExp($),!0}catch(W){return!1}};var J$=($,W)=>({part:$,store:null,inert:W!==void 0?new Map(W.map((X)=>[X.part.charCodeAt(0),X])):null,params:null,wildcardStore:null}),QJ=($,W)=>({...$,part:W}),GJ=($)=>({paramName:$,store:null,inert:null}),c9=class ${root={};history=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g};add(W,X,Y){let Z;if(typeof X!="string")throw TypeError("Route path must be a string");X===""?X="/":X[0]!=="/"&&(X=`/${X}`),this.history.push([W,X,Y]);let J=X[X.length-1]==="*";J&&(X=X.slice(0,-1));let z=X.split($.regex.static),Q=X.match($.regex.params)||[];z[z.length-1]===""&&z.pop(),Z=this.root[W]?this.root[W]:this.root[W]=J$("/");let G=0;for(let A=0;A<z.length;++A){let w=z[A];if(A>0){let D=Q[G++].slice(1);if(Z.params===null)Z.params=GJ(D);else if(Z.params.paramName!==D)throw Error(`Cannot create route "${X}" with parameter "${D}" because a route already exists with a different parameter name ("${Z.params.paramName}") in the same location`);let O=Z.params;if(O.inert===null){Z=O.inert=J$(w);continue}Z=O.inert}for(let D=0;;){if(D===w.length){if(D<Z.part.length){let O=QJ(Z,Z.part.slice(D));Object.assign(Z,J$(w,[O]))}break}if(D===Z.part.length){if(Z.inert===null)Z.inert=new Map;else if(Z.inert.has(w.charCodeAt(D))){Z=Z.inert.get(w.charCodeAt(D)),w=w.slice(D),D=0;continue}let O=J$(w.slice(D));Z.inert.set(w.charCodeAt(D),O),Z=O;break}if(w[D]!==Z.part[D]){let O=QJ(Z,Z.part.slice(D)),L=J$(w.slice(D));Object.assign(Z,J$(Z.part.slice(0,D),[O,L])),Z=L;break}++D}}if(G<Q.length){let A=Q[G],w=A.slice(1);if(Z.params===null)Z.params=GJ(w);else if(Z.params.paramName!==w)throw Error(`Cannot create route "${X}" with parameter "${w}" because a route already exists with a different parameter name ("${Z.params.paramName}") in the same location`);return Z.params.store===null&&(Z.params.store=Y),Z.params.store}return J?(Z.wildcardStore===null&&(Z.wildcardStore=Y),Z.wildcardStore):(Z.store===null&&(Z.store=Y),Z.store)}find(W,X){let Y=this.root[W];return Y?t9(X,X.length,Y,0):null}},t9=($,W,X,Y)=>{let Z=X?.part,J=Y+Z.length;if(Z.length>1){if(J>W)return null;if(Z.length<15){for(let z=1,Q=Y+1;z<Z.length;++z,++Q)if(Z.charCodeAt(z)!==$.charCodeAt(Q))return null}else if($.substring(Y,J)!==Z)return null}if(J===W)return X.store!==null?{store:X.store,params:{}}:X.wildcardStore!==null?{store:X.wildcardStore,params:{"*":""}}:null;if(X.inert!==null){let z=X.inert.get($.charCodeAt(J));if(z!==void 0){let Q=t9($,W,z,J);if(Q!==null)return Q}}if(X.params!==null){let z=X.params,Q=$.indexOf("/",J);if(Q!==J){if(Q===-1||Q>=W){if(z.store!==null){let G={};return G[z.paramName]=$.substring(J,W),{store:z.store,params:G}}}else if(z.inert!==null){let G=t9($,W,z.inert,Q);if(G!==null)return G.params[z.paramName]=$.substring(J,Q),G}}}return X.wildcardStore!==null?{store:X.wildcardStore,params:{"*":$.substring(J,W)}}:null},w4=()=>{let $;return[new Promise((X)=>{$=X}),$]},$6=()=>{const[$,W]=w4(),[X,Y]=w4(),Z=[],J=[];return{signal:$,consume:(z)=>{switch(z.type){case"begin":if(z.unit&&Z.length===0)for(let Q=0;Q<z.unit;Q++){const[G,A]=w4(),[w,D]=w4();Z.push(G),J.push([(O)=>{A({children:[],end:w,name:O.name??"",skip:!1,time:O.time})},(O)=>{D(O)}])}W({children:Z,end:X,name:z.name??"",skip:!1,time:z.time});break;case"end":Y(z.time);break}},consumeChild(z){switch(z.type){case"begin":if(!J[0])return;const[Q]=J[0];Q({children:[],end:X,name:z.name??"",skip:!1,time:z.time});break;case"end":const G=J.shift();if(!G)return;G[1](z.time)}},resolve(){W({children:[],end:new Promise((z)=>z(0)),name:"",skip:!0,time:0});for(let[z,Q]of J)z({children:[],end:new Promise((G)=>G(0)),name:"",skip:!0,time:0}),Q(0);Y(0)}}},$3=($,W,X)=>{if(typeof X==="object")X=X.fn;return async function Y(Y){if(Y.event!=="request"||Y.type!=="begin")return;const Z=Y.id,J=$(),z=$6(),Q=$6(),G=$6(),A=$6(),w=$6(),D=$6(),O=$6(),L=$6();z.consume(Y);const B=(M)=>{if(M.id===Z)switch(M.event){case"request":z.consume(M);break;case"request.unit":z.consumeChild(M);break;case"parse":Q.consume(M);break;case"parse.unit":Q.consumeChild(M);break;case"transform":G.consume(M);break;case"transform.unit":G.consumeChild(M);break;case"beforeHandle":A.consume(M);break;case"beforeHandle.unit":A.consumeChild(M);break;case"handle":w.consume(M);break;case"afterHandle":D.consume(M);break;case"afterHandle.unit":D.consumeChild(M);break;case"error":O.consume(M);break;case"error.unit":O.consumeChild(M);break;case"response":if(M.type==="begin")z.resolve(),Q.resolve(),G.resolve(),A.resolve(),w.resolve(),D.resolve(),O.resolve();else J.off("event",B);L.consume(M);break;case"response.unit":L.consumeChild(M);break;case"exit":z.resolve(),Q.resolve(),G.resolve(),A.resolve(),w.resolve(),D.resolve(),O.resolve();break}};J.on("event",B),await X({id:Z,context:Y.ctx,set:Y.ctx?.set,store:Y.ctx?.store,time:Y.time,request:z.signal,parse:Q.signal,transform:G.signal,beforeHandle:A.signal,handle:w.signal,afterHandle:D.signal,error:O.signal,response:L.signal}),J.emit(`res${Z}.${W}`,void 0)}},CJ=($)=>{if($.startsWith("async"))$=$.slice(6);let W=-1;if($.charCodeAt(0)===40){if(W=$.indexOf(") => {\n"),W!==-1)return[$.slice(1,W),$.slice(W+5),{isArrowReturn:!1}];if(W=$.indexOf(") => "),W!==-1)return[$.slice(1,W),$.slice(W+5),{isArrowReturn:!0}]}if($.startsWith("function")){W=$.indexOf("(");const Z=$.indexOf(")");return[$.slice(W+1,Z),$.slice(Z+2),{isArrowReturn:!1}]}const X=$.indexOf("(");if(X!==-1){const Z=$.indexOf("\n",2),J=$.slice(0,Z),z=J.lastIndexOf(")")+1,Q=$.slice(Z+1);return[J.slice(X,z),"{"+Q,{isArrowReturn:!1}]}const Y=$.split("\n",2);return[Y[0],Y[1],{isArrowReturn:!1}]},qJ=($)=>{const W=$.indexOf("{");if(W===-1)return[-1,0];let X=W+1,Y=1;for(;X<$.length;X++){const Z=$.charCodeAt(X);if(Z===123)Y++;else if(Z===125)Y--;if(Y===0)break}if(Y!==0)return[0,$.length];return[W,X+1]},W3=($)=>{const W=$.lastIndexOf("}");if(W===-1)return[-1,0];let X=W-1,Y=1;for(;X>=0;X--){const Z=$.charCodeAt(X);if(Z===125)Y++;else if(Z===123)Y--;if(Y===0)break}if(Y!==0)return[-1,0];return[X,W+1]},F4=($)=>{if($.charCodeAt(0)===40)$=$.slice(1,-1);if($.charCodeAt(0)===123)$=$.slice(2,-2);while(!0){const[W,X]=qJ($);if(W===-1)break;$=$.slice(0,W-2)+$.slice(X+1)}return $.replace(/:/g,"").trim()},X3=($,W)=>{const X=F4($);if(!W.query&&X.includes("query"))W.query=!0;if(!W.headers&&X.includes("headers"))W.headers=!0;if(!W.body&&X.includes("body"))W.body=!0;if(!W.cookie&&X.includes("cookie"))W.cookie=!0;if(!W.set&&X.includes("set"))W.set=!0;return X},Y3=($,W)=>{const X=F4($);if(!W.request&&X.includes("request"))W.request=!0;if(!W.parse&&X.includes("parse"))W.parse=!0;if(!W.transform&&X.includes("transform"))W.transform=!0;if(!W.handle&&X.includes("handle"))W.handle=!0;if(!W.beforeHandle&&X.includes("beforeHandle"))W.beforeHandle=!0;if(!W.afterHandle&&X.includes("afterHandle"))W.afterHandle=!0;if(!W.error&&X.includes("error"))W.error=!0;if(!W.context&&X.includes("context"))W.context=!0;if(!W.store&&X.includes("store"))W.store=!0;if(!W.set&&X.includes("set"))W.set=!0;return X},VJ=($,W,X)=>{const Y=W.indexOf($+"\n",X),Z=W.indexOf($+"	",X),J=W.indexOf($+",",X),z=W.indexOf($+";",X),Q=W.indexOf($+" ",X);return[Y,Z,J,z,Q].filter((G)=>G>0).sort((G,A)=>G-A)[0]||-1},a9=($,W,X=0)=>{if(X>5)return[];const Y=[];let Z=W;while(!0){let J=VJ(" = "+$,Z);if(J===-1){const G=Z.indexOf(" = "+$);if(G+3+$.length!==Z.length)break;J=G}const z=Z.slice(0,J);let Q=z.slice(z.lastIndexOf(" ")+1);if(Q==="}"){const[G,A]=W3(z);Y.push(Z.slice(G,A)),Z=Z.slice(J+3+$.length);continue}while(Q.charCodeAt(0)===44)Q=Q.slice(1);while(Q.charCodeAt(0)===9)Q=Q.slice(1);Y.push(Q),Z=Z.slice(J+3+$.length)}for(let J of Y){if(J.charCodeAt(0)===123)continue;const z=a9(J,W);if(z.length>0)Y.push(...z)}return Y},jJ=($)=>{if(!$)return;if(!$.includes(",")){if($.includes("..."))return $.slice($.indexOf("...")+3);return $}const X=$.indexOf("...");if(X===-1)return;return $.slice(X+3).trimEnd()},UJ=($,W,X)=>{const Y=(Z,J)=>$.includes(J+"."+Z)||$.includes(J+'["'+Z+'"]')||$.includes(J+"['"+Z+"']");for(let Z of W){if(!Z)continue;if(Z.charCodeAt(0)===123){if(Z=F4(Z),!X.query&&Z.includes("query"))X.query=!0;if(!X.headers&&Z.includes("headers"))X.headers=!0;if(!X.body&&Z.includes("body"))X.body=!0;if(!X.cookie&&Z.includes("cookie"))X.cookie=!0;if(!X.set&&Z.includes("set"))X.set=!0;continue}if($.includes("("+Z+")")){X.query=!0,X.headers=!0,X.body=!0,X.cookie=!0,X.set=!0,X.queries=[],X.unknownQueries=!0;break}if(!X.query&&Y("query",Z))X.query=!0;if($.includes("return "+Z)||$.includes("return "+Z+".query"))X.query=!0,X.unknownQueries=!0,X.queries=[];if(!X.unknownQueries&&X.query){let J=Z+".";if($.includes(J+"query"))J=Z+".query";while(!0){let z=$.indexOf(J);if(z===-1&&$.indexOf(Z+"[")!==-1){X.queries=[],X.unknownQueries=!0;break}if(z!==-1){let Q=VJ("",$,z+J.length+1);if(Q===-1)Q=void 0;const G=z+Z.length+1;$=$.slice(z+Z.length+1);let A=$.slice(0,Q?Q-G:Q).trimEnd();while(z!==-1)if(z=A.indexOf("."),z!==-1)A=A.slice(z+1);if(A.charCodeAt(A.length-1)===59)A=A.slice(0,-1);if(A.charCodeAt(A.length-1)===44)A=A.slice(0,-1);if(A.charCodeAt(A.length-1)===93)A=A.slice(0,-1);if(A.charCodeAt(A.length-1)===41)A=A.slice(0,-1);if(A&&!X.queries.includes(A)){X.queries.push(A);continue}}break}}if(!X.headers&&Y("headers",Z))X.headers=!0;if(!X.body&&Y("body",Z))X.body=!0;if(!X.cookie&&Y("cookie",Z))X.cookie=!0;if(!X.set&&Y("set",Z))X.set=!0;if(X.query&&X.headers&&X.body&&X.cookie&&X.set)break}return W},Z3=($)=>{while(!0){const W=$.indexOf("=");if(W===-1)break;const X=$.indexOf(",",W),Y=$.indexOf("}",W),Z=[X,Y].filter((J)=>J>0).sort((J,z)=>J-z)[0]||-1;if(Z===-1){$=$.slice(0,W);break}$=$.slice(0,W)+$.slice(Z)}return $.split(",").map((W)=>W.trim()).join(", ")},J3=($)=>{for(let W of $){if(W.charCodeAt(0)===123)return!1;if(W.indexOf("'")!==-1)return!1;if(W.indexOf('"')!==-1)return!1;if(W.indexOf("\n")!==-1)return!1;if(W.indexOf("	")!==-1)return!1;if(W.indexOf("(")!==-1)return!1}return!0},z3=($,W,X)=>{const Y=(Z,J)=>$.includes(Z+"."+J)||$.includes(Z+'["'+J+'"]')||$.includes(Z+"['"+J+"']");for(let Z of W){if(Z.charCodeAt(0)===123){if(Z=F4(Z),!X.request&&Z.includes("request"))X.request=!0;if(!X.parse&&Z.includes("parse"))X.parse=!0;if(!X.transform&&Z.includes("transform"))X.transform=!0;if(!X.handle&&Z.includes("handle"))X.handle=!0;if(!X.beforeHandle&&Z.includes("beforeHandle"))X.beforeHandle=!0;if(!X.afterHandle&&Z.includes("afterHandle"))X.afterHandle=!0;if(!X.error&&Z.includes("error"))X.error=!0;if(!X.context&&Z.includes("context"))X.context=!0;if(!X.store&&Z.includes("store"))X.store=!0;if(!X.set&&Z.includes("set"))X.set=!0;continue}if($.includes("("+Z+")")){X.request=!0,X.parse=!0,X.transform=!0,X.handle=!0,X.beforeHandle=!0,X.afterHandle=!0,X.error=!0,X.context=!0,X.store=!0,X.set=!0;break}if(!X.request&&Y("request",Z))X.request=!0;if(!X.parse&&Y("parse",Z))X.parse=!0;if(!X.transform&&Y("transform",Z))X.transform=!0;if(!X.handle&&Y("handle",Z))X.handle=!0;if(!X.beforeHandle&&Y("beforeHandle",Z))X.beforeHandle=!0;if(!X.afterHandle&&Y("afterHandle",Z))X.afterHandle=!0;if(!X.error&&Y("error",Z))X.error=!0;if(!X.context&&Y("context",Z))X.context=!0;if(!X.store&&Y("store",Z))X.store=!0;if(!X.set&&Y("set",Z))X.set=!0;if(X.request&&X.parse&&X.transform&&X.handle&&X.beforeHandle&&X.afterHandle&&X.error&&X.context&&X.store&&X.set)break}return W},IJ=($,W={queries:[],query:!1,headers:!1,body:!1,cookie:!1,set:!1,unknownQueries:!1})=>{const X=[];if($.handler&&typeof $.handler==="function")X.push($.handler);if($.beforeHandle?.length)X.push(...$.beforeHandle);if($.parse?.length)X.push(...$.parse);if($.error?.length)X.push(...$.error);if($.transform?.length)X.push(...$.transform);if($.afterHandle?.length)X.push(...$.afterHandle);if($.mapResponse?.length)X.push(...$.mapResponse);if($.request?.length)X.push(...$.request);if($.onResponse?.length)X.push(...$.onResponse);for(let Y of X){if(!Y)continue;const Z="fn"in Y?Y.fn:Y,[J,z,{isArrowReturn:Q}]=CJ(Z.toString()),G=X3(J,W),A=jJ(G);if(Q&&(z==="query"||G&&z.startsWith(G+".query")))W.query=!0,W.unknownQueries=!0,W.queries=[];if(A){const D=a9(A,z);D.splice(0,-1,A),UJ(z,D,W)}const w=G||A;if(w&&z.includes("return "+w+".query"))W.query=!0,W.unknownQueries=!0,W.queries=[];if(W.query){UJ(z,["query"],W);const D=J.indexOf("query: {");if(D!==-1){const O=J.slice(D+7),[L,B]=qJ(O),M=Z3(O.slice(L,B));for(let H of M.slice(1,-1).split(",")){const K=H.indexOf(":");if(K!==-1)H=H.slice(0,K);if(H=H.trim(),H&&!W.queries.includes(H))W.queries.push(H.trim())}}}if(W.query&&W.headers&&W.body&&W.cookie&&W.set)break}if(!J3(W.queries))W.unknownQueries=!0,W.queries=[];return W},Q3=($,W={request:!1,parse:!1,transform:!1,handle:!1,beforeHandle:!1,afterHandle:!1,error:!1,context:!1,store:!1,set:!1})=>{for(let X of $){const[Y,Z]=CJ(X.toString()),J=Y3(Y,W),z=jJ(J);if(z){const Q=a9(z,Z);Q.splice(0,-1,z),z3(Z,Q,W);continue}if(W.request&&W.parse&&W.transform&&W.handle&&W.beforeHandle&&W.afterHandle&&W.error&&W.context&&W.store&&W.set)break}return W},Q$=class{constructor($,W,X={}){this.name=$,this.jar=W,this.initial=X}get cookie(){if(!(this.name in this.jar))return this.initial;return this.jar[this.name]}set cookie($){if(!(this.name in this.jar))this.jar[this.name]=this.initial;this.jar[this.name]=$}get value(){return this.cookie.value}set value($){if(!(this.name in this.jar))this.jar[this.name]=this.initial;this.jar[this.name].value=$}get expires(){return this.cookie.expires}set expires($){this.cookie.expires=$}get maxAge(){return this.cookie.maxAge}set maxAge($){this.cookie.maxAge=$}get domain(){return this.cookie.domain}set domain($){this.cookie.domain=$}get path(){return this.cookie.path}set path($){this.cookie.path=$}get secure(){return this.cookie.secure}set secure($){this.cookie.secure=$}get httpOnly(){return this.cookie.httpOnly}set httpOnly($){this.cookie.httpOnly=$}get sameSite(){return this.cookie.sameSite}set sameSite($){this.cookie.sameSite=$}get priority(){return this.cookie.priority}set priority($){this.cookie.priority=$}get partitioned(){return this.cookie.partitioned}set partitioned($){this.cookie.partitioned=$}get secrets(){return this.cookie.secrets}set secrets($){this.cookie.secrets=$}update($){return this.cookie=Object.assign(this.cookie,typeof $==="function"?$(this.cookie):$),this}set($){return this.cookie=Object.assign({...this.initial,value:this.value},typeof $==="function"?$(this.cookie):$),this}remove(){if(this.value===void 0)return;return this.set({expires:new Date(0),maxAge:0,value:""}),this}toString(){return typeof this.value==="object"?JSON.stringify(this.value):this.value?.toString()??""}},MJ=($,W,X)=>{if(!$.cookie)$.cookie={};return new Proxy(W,{get(Y,Z){if(Z in W)return new Q$(Z,$.cookie,Object.assign({},X??{},W[Z]));return new Q$(Z,$.cookie,Object.assign({},X))}})},xJ=async($,W,{secrets:X,sign:Y,...Z}={})=>{if(!W)return MJ($,{},Z);const J=typeof X==="string";if(Y&&Y!==!0&&!Array.isArray(Y))Y=[Y];const z={},Q=d9(W);for(let[G,A]of Object.entries(Q)){let w=bJ.default(A);if(Y===!0||Y?.includes(G)){if(!X)throw new Error("No secret is provided to cookie plugin");if(J){const O=await BJ(w,X);if(O===!1)throw new NJ(G);w=O}else{let O=!0;for(let L=0;L<X.length;L++){const B=await BJ(w,X[L]);if(B!==!1){O=!0,w=B;break}}if(!O)throw new NJ(G)}}if(w==null){z[G]={value:A};continue}const D=w.charCodeAt(0);if(D===123||D===91)try{z[G]={value:JSON.parse(w)};continue}catch{}if(O4(w)){z[G]={value:parseInt(w)};continue}if(w==="true"){z[G]={value:!0};continue}if(w==="false"){z[G]={value:!1};continue}z[G]={value:w}}return MJ($,z,Z)},kJ="toJSON"in new Headers,C8=($)=>{if(!$)return!1;for(let W in $)return!0;return!1},A5=($,W)=>{const X=$.size;if(!W&&X||X&&W&&W.status!==206&&W.status!==304&&W.status!==412&&W.status!==416){if(W){if(W.headers instanceof Headers){if(kJ)W.headers=W.headers.toJSON();else for(let[Y,Z]of W.headers.entries())if(Y in W.headers)W.headers[Y]=Z}return new Response($,{status:W.status,headers:Object.assign({"accept-ranges":"bytes","content-range":`bytes 0-${X-1}/${X}`},W.headers)})}return new Response($,{headers:{"accept-ranges":"bytes","content-range":`bytes 0-${X-1}/${X}`}})}return new Response($)},TJ=($,W)=>{if(!$)return $;$.delete("Set-Cookie");for(let X=0;X<W.length;X++){const Y=W[X].indexOf("=");$.append("Set-Cookie",`${W[X].slice(0,Y)}=${W[X].slice(Y+1)||""}`)}return $},gJ=($)=>{if(!$||!C8($))return;const W=[];for(let[X,Y]of Object.entries($)){if(!X||!Y)continue;const Z=Y.value;if(Z===void 0||Z===null)continue;W.push(v9(X,typeof Z==="object"?JSON.stringify(Z):Z+"",Y))}if(W.length===0)return;if(W.length===1)return W[0];return W},n1=($,W,X)=>{if($?.$passthrough)$=$?.[$.$passthrough];if($?.[q8])W.status=$[q8],$=$.response;if(C8(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=K4[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&C8(W.cookie))W.headers["Set-Cookie"]=gJ(W.cookie);if(W.headers["Set-Cookie"]&&Array.isArray(W.headers["Set-Cookie"]))W.headers=TJ(new Headers(W.headers),W.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return A5($,W);case"Array":return Response.json($,W);case"Object":for(let Z in Object.values($))switch(Z?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(_5($));default:break}return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return X?.signal.addEventListener("abort",{handleEvent(){if(!X?.signal.aborted)$.cancel(X)}},{once:!0}),new Response($,W);case void 0:if(!$)return new Response("",W);return Response.json($,W);case"Response":let Y=!1;if(W.headers instanceof Headers)for(let Z of W.headers.keys())if(Z==="set-cookie"){if(Y)continue;Y=!0;for(let J of W.headers.getSetCookie())$.headers.append("set-cookie",J)}else $.headers.append(Z,W.headers?.get(Z)??"");else for(let Z in W.headers)$.headers.append(Z,W.headers[Z]);if($.status!==W.status)W.status=$.status;return $;case"Error":return E8($,W);case"Promise":return $.then((Z)=>n1(Z,W));case"Function":return n1($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"Cookie":if($ instanceof Q$)return new Response($.value,W);return new Response($?.toString(),W);case"FormData":return new Response($,W);default:if($ instanceof Response){let Z=!1;if(W.headers instanceof Headers)for(let J of W.headers.keys())if(J==="set-cookie"){if(Z)continue;Z=!0;for(let z of W.headers.getSetCookie())$.headers.append("set-cookie",z)}else $.headers.append(J,W.headers?.get(J)??"");else for(let J in W.headers)$.headers.append(J,W.headers[J]);if(kJ)W.headers=$.headers.toJSON();else for(let[J,z]of $.headers.entries())if(J in W.headers)W.headers[J]=z;return $}if($ instanceof Promise)return $.then((Z)=>n1(Z,W));if($ instanceof Error)return E8($,W);if("toResponse"in $)return n1($.toResponse(),W);if("charCodeAt"in $){const Z=$.charCodeAt(0);if(Z===123||Z===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return A5($,W);case"Array":return Response.json($);case"Object":for(let Y in Object.values($))switch(Y?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(_5($),W);default:break}return Response.json($,W);case"ReadableStream":return X?.signal.addEventListener("abort",{handleEvent(){if(!X?.signal.aborted)$.cancel(X)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return E8($,W);case"Promise":return $.then((Y)=>{const Z=W6(Y);if(Z!==void 0)return Z;return new Response("")});case"Function":return W6($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof Q$)return new Response($.value,W);return new Response($?.toString(),W);case"FormData":return new Response($,W);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((Y)=>n1(Y,W));if($ instanceof Error)return E8($,W);if("toResponse"in $)return n1($.toResponse(),W);if("charCodeAt"in $){const Y=$.charCodeAt(0);if(Y===123||Y===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($)}},l1=($,W,X)=>{if($===void 0||$===null)return;if($?.$passthrough)$=$?.[$.$passthrough];if($?.[q8])W.status=$[q8],$=$.response;if(C8(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=K4[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&C8(W.cookie))W.headers["Set-Cookie"]=gJ(W.cookie);if(W.headers["Set-Cookie"]&&Array.isArray(W.headers["Set-Cookie"]))W.headers=TJ(new Headers(W.headers),W.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return A5($,W);case"Array":return Response.json($,W);case"Object":for(let Z in Object.values($))switch(Z?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(_5($),W);default:break}return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return X?.signal.addEventListener("abort",{handleEvent(){if(!X?.signal.aborted)$.cancel(X)}},{once:!0}),new Response($,W);case void 0:if(!$)return;return Response.json($,W);case"Response":let Y=!1;if(W.headers instanceof Headers)for(let Z of W.headers.keys())if(Z==="set-cookie"){if(Y)continue;Y=!0;for(let J of W.headers.getSetCookie())$.headers.append("set-cookie",J)}else $.headers.append(Z,W.headers?.get(Z)??"");else for(let Z in W.headers)$.headers.append(Z,W.headers[Z]);if($.status!==W.status)W.status=$.status;return $;case"Promise":return $.then((Z)=>{const J=l1(Z,W);if(J!==void 0)return J});case"Error":return E8($,W);case"Function":return l1($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"FormData":return new Response($);case"Cookie":if($ instanceof Q$)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response){let Z=!1;if(W.headers instanceof Headers)for(let J of W.headers.keys())if(J==="set-cookie"){if(Z)continue;Z=!0;for(let z of W.headers.getSetCookie())$.headers.append("set-cookie",z)}else $.headers.append(J,W.headers?.get(J)??"");else for(let J in W.headers)$.headers.append(J,W.headers[J]);if($.status!==W.status)W.status=$.status;return $}if($ instanceof Promise)return $.then((Z)=>l1(Z,W));if($ instanceof Error)return E8($,W);if("toResponse"in $)return l1($.toResponse(),W);if("charCodeAt"in $){const Z=$.charCodeAt(0);if(Z===123||Z===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return A5($,W);case"Array":return Response.json($);case"Object":for(let Y in Object.values($))switch(Y?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(_5($),W);default:break}return Response.json($,W);case"ReadableStream":return X?.signal.addEventListener("abort",{handleEvent(){if(!X?.signal.aborted)$.cancel(X)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Promise":return $.then((Y)=>{const Z=l1(Y,W);if(Z!==void 0)return Z});case"Error":return E8($,W);case"Function":return W6($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof Q$)return new Response($.value,W);return new Response($?.toString(),W);case"FormData":return new Response($);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((Y)=>l1(Y,W));if($ instanceof Error)return E8($,W);if("toResponse"in $)return l1($.toResponse(),W);if("charCodeAt"in $){const Y=$.charCodeAt(0);if(Y===123||Y===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($)}},W6=($,W)=>{if($?.$passthrough)$=$?.[$.$passthrough];if($?.[q8])return n1($.response,{status:$[q8],headers:{}});switch($?.constructor?.name){case"String":return new Response($);case"Blob":return A5($);case"Array":return Response.json($);case"Object":$:for(let X of Object.values($))switch(X?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(_5($));case"Object":break $;default:break}return Response.json($);case"ReadableStream":return W?.signal.addEventListener("abort",{handleEvent(){if(!W?.signal.aborted)$.cancel(W)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return E8($);case"Promise":return $.then(W6);case"Function":return W6($());case"Number":case"Boolean":return new Response($.toString());case"FormData":return new Response($);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then(W6);if($ instanceof Error)return E8($);if("toResponse"in $)return W6($.toResponse());if("charCodeAt"in $){const X=$.charCodeAt(0);if(X===123||X===91)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}})}return new Response($)}},E8=($,W)=>new Response(JSON.stringify({name:$?.name,message:$?.message,cause:$?.cause}),{status:W?.status!==200?W?.status??500:500,headers:W?.headers}),wJ=($,W)=>{const X=new URL($);return X.pathname=W,X.toString()},G3=($)=>typeof $==="function"&&/^\s*class\s+/.test($.toString())||$.toString().startsWith("[object ")||C8(Object.getPrototypeOf($)),u9=($)=>$&&typeof $==="object"&&!Array.isArray($),i1=($,W,{skipKeys:X}={})=>{if(u9($)&&u9(W))for(let[Y,Z]of Object.entries(W)){if(X?.includes(Y))continue;if(!u9(Z)||!(Y in $)||G3(Z)){$[Y]=Z;continue}$[Y]=i1($[Y],Z)}return $},U3=($,W)=>{const{properties:X,...Y}=$??{},{properties:Z,...J}=W??{};return i1(Y,J)},h2=($=[],W=[])=>{if(!$)return[];if(!W)return $;const X=[],Y=[];if(!Array.isArray($))$=[$];if(!Array.isArray(W))W=[W];for(let Z of $)if(X.push(Z),Z.checksum)Y.push(Z.checksum);for(let Z of W)if(!Y.includes(Z.checksum))X.push(Z);return X},M3=["start","request","parse","transform","resolve","beforeHandle","afterHandle","onResponse","mapResponse","trace","error","stop","body","headers","params","query","response","type","detail"],w3=M3.reduce(($,W)=>($[W]=!0,$),{}),A3=($,W)=>{const X=(Y)=>typeof Y==="object"&&Object.keys(Y).every(O4);if(X($)&&X(W))return{...$,...W};return W??$},c1=($,W,{allowMacro:X=!1}={})=>{return{...X?{...$,...W}:void 0,body:W?.body??$?.body,headers:W?.headers??$?.headers,params:W?.params??$?.params,query:W?.query??$?.query,response:A3($?.response,W?.response),type:$?.type||W?.type,detail:i1(W?.detail??{},$?.detail??{}),parse:h2($?.parse,W?.parse),transform:h2($?.transform,W?.transform),beforeHandle:h2($?.beforeHandle,W?.beforeHandle),afterHandle:h2($?.afterHandle,W?.afterHandle),onResponse:h2($?.onResponse,W?.onResponse),mapResponse:h2($?.mapResponse,W?.mapResponse),trace:h2($?.trace,W?.trace),error:h2($?.error,W?.error)}},o1=($,{models:W={},dynamic:X=!1,normalize:Y=!1,additionalProperties:Z=!1}={})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const J=typeof $==="string"?W[$]:$;if(J.type==="object"&&"additionalProperties"in J===!1)J.additionalProperties=Z;const z=(G)=>Y2.Clean(J,G);if(X){const G={schema:J,references:"",checkFunc:()=>{},code:"",Check:(A)=>Y2.Check(J,A),Errors:(A)=>Y2.Errors(J,A),Code:()=>""};if(Y&&J.additionalProperties===!1)G.Clean=z;if(J.config){if(G.config=J.config,G?.schema?.config)delete G.schema.config}return G}const Q=Z$.Compile(J,Object.values(W));if(Q.Clean=z,J.config){if(Q.config=J.config,Q?.schema?.config)delete Q.schema.config}return Q},AJ=($,{models:W={},dynamic:X=!1,normalize:Y=!1,additionalProperties:Z=!1})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const J=typeof $==="string"?W[$]:$,z=(G,A)=>{const w=(O)=>Y2.Clean(G,O);if(X)return{schema:G,references:"",checkFunc:()=>{},code:"",Check:(O)=>Y2.Check(G,O),Errors:(O)=>Y2.Errors(G,O),Code:()=>""};const D=Z$.Compile(G,A);if(Y&&G.additionalProperties===!1)D.Clean=w;return D};if(h in J){if("additionalProperties"in J===!1)J.additionalProperties=Z;return{200:z(J,Object.values(W))}}const Q={};return Object.keys(J).forEach((G)=>{const A=J[+G];if(typeof A==="string"){if(A in W){const w=W[A];w.type==="object"&&"additionalProperties"in w,Q[+G]=h in w?z(w,Object.values(W)):w}return}if(A.type==="object"&&"additionalProperties"in A===!1)A.additionalProperties=Z;Q[+G]=h in A?z(A,Object.values(W)):A}),Q},_3=typeof Bun!=="undefined",H3=_3&&typeof Bun.hash==="function",A4=($)=>{if(H3)return Bun.hash($);let W=9;for(let X=0;X<$.length;)W=Math.imul(W^$.charCodeAt(X++),387420489);return W=W^W>>>9},fJ=({validator:$,defaultConfig:W={},config:X,dynamic:Y,models:Z})=>{let J=o1($,{dynamic:Y,models:Z,additionalProperties:!0});if(C8(W))if(J)J.config=U3(J.config,X);else J=o1(Q0.Cookie({}),{dynamic:Y,models:Z,additionalProperties:!0}),J.config=W;return J},o9=($,W,X)=>{const Y=(Z)=>{if(!Z)return;if(!Array.isArray(Z)){const z=Z;if(X&&!z.checksum)z.checksum=X;if(z.scope==="scoped")z.scope="local";return z}const J=[...Z];for(let z of J){if(X&&!z.checksum)z.checksum=X;if(z.scope==="scoped")z.scope="local"}return J};return{start:h2($.start,Y(W?.start)),request:h2($.request,Y(W?.request)),parse:h2($.parse,Y(W?.parse)),transform:h2($.transform,Y(W?.transform)),beforeHandle:h2($.beforeHandle,Y(W?.beforeHandle)),afterHandle:h2($.afterHandle,Y(W?.afterHandle)),mapResponse:h2($.mapResponse,Y(W?.mapResponse)),onResponse:h2($.onResponse,Y(W?.onResponse)),trace:$.trace,error:h2($.error,Y(W?.error)),stop:h2($.stop,Y(W?.stop))}},D3=($,W,{skipIfHasType:X=!1}={})=>{if(!$)return $;if(!Array.isArray($)){if(X)$.scope??=W;else $.scope=W;return $}for(let Y of $)if(X)Y.scope??=W;else Y.scope=W;return $},q6=($)=>{if(!$)return $;if(!Array.isArray($))switch($.scope){case"global":case"scoped":return{...$};default:return{fn:$}}const W=[];for(let X of $)switch(X.scope){case"global":case"scoped":W.push({...X});break}return W},_J=($)=>{return{...$,type:$?.type,detail:$?.detail,parse:q6($?.parse),transform:q6($?.transform),beforeHandle:q6($?.beforeHandle),afterHandle:q6($?.afterHandle),onResponse:q6($?.onResponse),error:q6($?.error),mapResponse:q6($?.mapResponse)}},K4={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},HJ=Object.fromEntries(Object.entries(K4).map(([$,W])=>[W,$])),DJ=new TextEncoder,B4=async($,W)=>{if(typeof $!=="string")throw new TypeError("Cookie value must be provided as a string.");if(W===null)throw new TypeError("Secret key must be provided.");const X=await crypto.subtle.importKey("raw",DJ.encode(W),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),Y=await crypto.subtle.sign("HMAC",X,DJ.encode($));return $+"."+B3(Buffer.from(Y).toString("base64"))},BJ=async($,W)=>{if(typeof $!=="string")throw new TypeError("Signed cookie string must be provided.");if(W===null)throw new TypeError("Secret key must be provided.");const X=$.slice(0,$.lastIndexOf("."));return await B4(X,W)===$?X:!1},yJ=($,W,X=W)=>{if(!$||typeof $!=="object"||!W)return;for(let[Y,Z]of Object.entries(W)){if(Y in w3||!(Y in $))continue;const J=$[Y];if(typeof J==="function")J(Z);else if(typeof J==="object")yJ(J,Z,X)}},O3=({globalHook:$,localHook:W})=>(X)=>(Y,Z)=>{if(typeof Y==="function")Y={fn:Y};if("fn"in Y||Array.isArray(Y)){if(!W[X])W[X]=[];if(typeof W[X]==="function")W[X]=[W[X]];if(Array.isArray(Y))W[X]=W[X].concat(Y);else W[X].push(Y);return}const{insert:J="after",stack:z="local"}=Y;if(typeof Z==="function")Z={fn:Z};if(z==="global")if(!Array.isArray(Z))if(J==="before")$[X].unshift(Z);else $[X].push(Z);else if(J==="before")$[X]=Z.concat($[X]);else $[X]=$[X].concat(Z);else{if(!W[X])W[X]=[];if(typeof W[X]==="function")W[X]=[W[X]];if(!Array.isArray(Z))if(J==="before")W[X].unshift(Z);else W[X].push(Z);else if(J==="before")W[X]=Z.concat(W[X]);else W[X]=W[X].concat(Z)}},O4=($)=>{if($.length<16)return $.trim().length!==0&&!Number.isNaN(Number($));if($.length===16){const W=Number($);if(W.toString()===$)return $.trim().length!==0&&!Number.isNaN(W)}return!1},N3=class{constructor($=console.error){this.onError=$,this.root=null,this.promises=[]}get size(){return this.promises.length}add($){return this.promises.push($),this.root||=this.drain(),$}async drain(){while(this.promises.length>0){try{await this.promises[0]}catch($){this.onError($)}this.promises.shift()}this.root=null}then($,W){return(this.root??Promise.resolve()).then($,W)}},u1=($)=>{if(!$)return $;if(!Array.isArray($)){if(typeof $==="function")return{fn:$};else if("fn"in $)return $}const W=[];for(let X of $)if(typeof X==="function")W.push({fn:X});else if("fn"in X)W.push(X);return W},L3=($)=>{return{...$,start:u1($?.start),request:u1($?.request),parse:u1($?.parse),transform:u1($?.transform),beforeHandle:u1($?.beforeHandle),afterHandle:u1($?.afterHandle),onResponse:u1($?.onResponse),mapResponse:u1($?.mapResponse),trace:u1($?.trace),error:u1($?.error),stop:u1($?.stop)}},F3=($)=>{return{...$,start:$.start?.map((W)=>W.fn),request:$.request?.map((W)=>W.fn),parse:$.parse?.map((W)=>W.fn),transform:$.transform?.map((W)=>W.fn),beforeHandle:$.beforeHandle?.map((W)=>W.fn),afterHandle:$.afterHandle?.map((W)=>W.fn),onResponse:$.onResponse?.map((W)=>W.fn),mapResponse:$.mapResponse?.map((W)=>W.fn),trace:$.trace?.map((W)=>W.fn),error:$.error?.map((W)=>W.fn),stop:$.stop?.map((W)=>W.fn)}},i9=($)=>({event:{body:$.event.body,cookie:$.event.cookie,headers:$.event.headers,queries:[...$.event.queries],query:$.event.query,set:$.event.set,unknownQueries:$.event.unknownQueries},trace:{request:$.trace.request,parse:$.trace.parse,transform:$.trace.transform,handle:$.trace.handle,beforeHandle:$.trace.beforeHandle,afterHandle:$.trace.afterHandle,error:$.trace.error,context:$.trace.context,store:$.trace.store,set:$.trace.set}}),dJ=($,W=301)=>Response.redirect($,W),Yh=Symbol("ElysiaFormData"),_5=($)=>{const W=new FormData;for(let[X,Y]of Object.entries($)){if(Array.isArray(Y)){for(let Z of Y){if(Y instanceof File)W.append(X,Y,Y.name);W.append(X,Z)}continue}if(Y instanceof File)W.append(X,Y,Y.name);W.append(X,Y)}return W},OJ=typeof Bun!=="undefined"?Bun.env:typeof process!=="undefined"?process?.env:void 0,N4=Symbol("ElysiaErrorCode"),q8=Symbol("ElysiaResponse"),L4=(OJ?.NODE_ENV??OJ?.ENV)==="production",K3=($,W)=>({[q8]:K4[$]??$,response:W??($ in HJ?HJ[$]:$),_type:void 0}),S3=class extends Error{constructor($){super($??"INTERNAL_SERVER_ERROR");this.code="INTERNAL_SERVER_ERROR",this.status=500}},e9=class extends Error{constructor($){super($??"NOT_FOUND");this.code="NOT_FOUND",this.status=404}},R3=class extends Error{constructor($,W){super($??"PARSE");this.body=W,this.code="PARSE",this.status=400}},NJ=class extends Error{constructor($,W){super(W??`"${$}" has invalid cookie signature`);this.key=$,this.code="INVALID_COOKIE_SIGNATURE",this.status=400}},p2=class $ extends Error{constructor(W,X,Y){if(typeof Y==="object"&&q8 in Y)Y=Y.response;const Z=L4?void 0:("Errors"in X)?X.Errors(Y).First():Y2.Errors(X,Y).First(),J=Z?.schema.error!==void 0?typeof Z.schema.error==="function"?Z.schema.error({type:W,validator:X,value:Y,get errors(){return[...X.Errors(Y)]}}):Z.schema.error:void 0,z=Z?.path||"root";let Q="";if(J!==void 0)Q=typeof J==="object"?JSON.stringify(J):J+"";else if(L4)Q=JSON.stringify({type:"validation",on:W,message:Z?.message,found:Y});else{const G=X?.schema??X,A="Errors"in X?[...X.Errors(Y)]:[...Y2.Errors(X,Y)];let w;try{w=Y2.Create(G)}catch(D){w={type:"Could not create expected value",message:D?.message,error:D}}Q=JSON.stringify({type:"validation",on:W,property:z,message:Z?.message,expected:w,found:Y,errors:A},null,2)}super(Q);this.type=W,this.validator=X,this.value=Y,this.code="VALIDATION",this.status=422,Object.setPrototypeOf(this,$.prototype)}get all(){return[...this.validator.Errors(this.value)]}static simplifyModel(W){const X="schema"in W?W.schema:W;try{return Y2.Create(X)}catch{return X}}get model(){return $.simplifyModel(this.validator)}toResponse(W){return new Response(this.message,{status:400,headers:{...W,"content-type":"application/json"}})}},LJ={open($){$.data.open?.($)},message($,W){$.data.message?.($,W)},drain($){$.data.drain?.($)},close($,W,X){$.data.close?.($,W,X)}},_4=class{constructor($,W){if(this.raw=$,this.data=W,this.validator=$.data.validator,$.data.id)this.id=$.data.id;else{const X=new Uint32Array(1);crypto.getRandomValues(X),this.id=X[0].toString()}}get id(){return this.raw.data.id}set id($){this.raw.data.id=$}get publish(){return($,W=void 0,X)=>{if(this.validator?.Check(W)===!1)throw new p2("message",this.validator,W);if(typeof W==="object")W=JSON.stringify(W);return this.raw.publish($,W,X),this}}get send(){return($)=>{if(this.validator?.Check($)===!1)throw new p2("message",this.validator,$);if(Buffer.isBuffer($))return this.raw.send($),this;if(typeof $==="object")$=JSON.stringify($);return this.raw.send($),this}}get subscribe(){return($)=>{return this.raw.subscribe($),this}}get unsubscribe(){return($)=>{return this.raw.unsubscribe($),this}}get cork(){return($)=>{return this.raw.cork($),this}}get close(){return()=>{return this.raw.close(),this}}get terminate(){return this.raw.terminate.bind(this.raw)}get isSubscribed(){return this.raw.isSubscribed.bind(this.raw)}get remoteAddress(){return this.raw.remoteAddress}},P3=(new Headers()).toJSON,pJ={value:0},mJ=({hasTrace:$,hasTraceSet:W=!1,addFn:X,condition:Y={}})=>{if($)return X(`
const reporter = getReporter()
`),(Z,{name:J,attribute:z="",unit:Q=0}={})=>{const G=Z.indexOf("."),A=G===-1;if(Z!=="request"&&Z!=="response"&&!Y[A?Z:Z.slice(0,G)])return()=>{if(W&&Z==="afterHandle")X(`
await traceDone
`)};if(A)J||=Z;else J||="anonymous";return X("\n"+`reporter.emit('event', {
					id,
					event: '${Z}',
					type: 'begin',
					name: '${J}',
					time: performance.now(),
					${A?`unit: ${Q},`:""}
					${z}
				})`.replace(/(\t| |\n)/g,"")+"\n"),()=>{if(X("\n"+`reporter.emit('event', {
							id,
							event: '${Z}',
							type: 'end',
							time: performance.now()
						})`.replace(/(\t| |\n)/g,"")+"\n"),W&&Z==="afterHandle")X(`
await traceDone
`)}};else return()=>()=>{}},w5=($)=>{const W=$.indexOf(")");if($.charCodeAt(W+2)===61&&$.charCodeAt(W+5)!==123)return!0;return $.includes("return")},E3=($,{injectResponse:W="",normalize:X=!1}={})=>({composeValidation:(Y,Z=`c.${Y}`)=>$?`c.set.status = 422; throw new ValidationError('${Y}', ${Y}, ${Z})`:`c.set.status = 422; return new ValidationError('${Y}', ${Y}, ${Z}).toResponse(c.set.headers)`,composeResponseValidation:(Y="r")=>{const Z=$?`throw new ValidationError('response', response[c.set.status], ${Y})`:`return new ValidationError('response', response[c.set.status], ${Y}).toResponse(c.set.headers)`;let J="\n"+W+"\n";if(J+=`let er

		if(${Y} && typeof ${Y} === "object" && ELYSIA_RESPONSE in ${Y})
			er = ${Y}[ELYSIA_RESPONSE]
`,X)J+=`
			if(!er && response[c.set.status]?.Clean)
				${Y} = response[c.set.status]?.Clean(${Y})
			else if(response[er]?.Clean)
				${Y}.response = response[er]?.Clean(${Y}.response)`;return J+=`
			if(er) {
				if(!(${Y} instanceof Response) && response[er]?.Check(${Y}.response) === false) {
					if(!(response instanceof Error)) {
						c.set.status = ${Y}[ELYSIA_RESPONSE]

						${Z}
					}
				}
			} else if(!(${Y} instanceof Response) && response[c.set.status]?.Check(${Y}) === false) {
				if(!(response instanceof Error))
					${Z}
			}
`,J}}),Jh=Symbol.for("TypeBox.Kind"),V6=($,W)=>{if(!W)return;if(W.type==="object"){const X=W.properties;if(!X)return!1;for(let Y of Object.keys(X)){const Z=X[Y];if($ in Z)return!0;if(Z.type==="object"){if(V6($,Z))return!0}else if(Z.anyOf){for(let J=0;J<Z.anyOf.length;J++)if(V6($,Z.anyOf[J]))return!0}}return!1}return $ in W},l9=Symbol.for("TypeBox.Transform"),z$=($)=>{if(!$)return;if($.type==="object"&&$.properties){const W=$.properties;for(let X of Object.keys(W)){const Y=W[X];if(Y.type==="object"){if(z$(Y))return!0}else if(Y.anyOf){for(let J=0;J<Y.anyOf.length;J++)if(z$(Y.anyOf[J]))return!0}if(l9 in Y)return!0}return!1}return l9 in $||$.properties&&l9 in $.properties},C3=/(?:return|=>) \S+\(/g,l2=($)=>{const W="fn"in $?$.fn:$;if(W.constructor.name==="AsyncFunction")return!0;const X=W.toString();if(X.includes("=> response.clone("))return!1;if(X.includes("await"))return!0;if(X.includes("async"))return!0;return!!X.match(C3)},n9=({app:$,path:W,method:X,localHook:Y,hooks:Z,validator:J,handler:z,allowMeta:Q=!1,appInference:{event:G,trace:A}})=>{const w=typeof z==="function";if(!w)z=n1(z,{headers:$.setHeaders??{}});const D=$.config.forceErrorEncapsulation&&(w||Z.afterHandle.length>0||Z.beforeHandle.length>0||Z.transform.length>0)||Z.error.length>0||$.event.error.length>0||typeof Bun==="undefined"||Z.onResponse.length>0||!!Z.trace.length,O=w?"handler(c)":"handler",L=Z.onResponse.length?`
;(async () => {${Z.onResponse.map((n,i)=>`await res${i}(c)`).join(";")}})();
`:"",B=A,M=Z.trace.length>0;let H="";const K=IJ(Object.assign(Y,{handler:z}),G),S=K.query||!!J.query,R=X!=="$INTERNALWS"&&X!=="GET"&&X!=="HEAD"&&Z.type!=="none"&&(K.body||!!J.body),b=$.setHeaders,f=b&&!!Object.keys(b).length,P=K.headers||J.headers,I=K.cookie||!!J.cookie,g=I?fJ({validator:J.cookie,defaultConfig:$.config.cookie,dynamic:!!$.config.aot,config:J.cookie?.config??{},models:$.definitions.type}):void 0,E=g?.config;let V="";if(E?.sign){if(!E.secrets)throw new Error(`t.Cookie required secret which is not set in (${X}) ${W}.`);const n=!E.secrets?void 0:typeof E.secrets==="string"?E.secrets:E.secrets[0];if(V+=`const _setCookie = c.set.cookie
		if(_setCookie) {`,E.sign===!0)V+=`for(const [key, cookie] of Object.entries(_setCookie)) {
				c.set.cookie[key].value = await signCookie(cookie.value, '${n}')
			}`;else for(let i of E.sign)V+=`if(_setCookie['${i}']?.value) { c.set.cookie['${i}'].value = await signCookie(_setCookie['${i}'].value, '${n}') }
`;V+="}\n"}const k=$.config.normalize,{composeValidation:s,composeResponseValidation:a}=E3(D,{normalize:k});if(P)H+=P3?`c.headers = c.request.headers.toJSON()
`:`c.headers = {}
                for (const [key, value] of c.request.headers.entries())
					c.headers[key] = value
				`;if(I){const n=(t,A0)=>{const F0=E?.[t]??A0;if(!F0)return typeof A0==="string"?`${t}: "${A0}",`:`${t}: ${A0},`;if(typeof F0==="string")return`${t}: '${F0}',`;if(F0 instanceof Date)return`${t}: new Date(${F0.getTime()}),`;return`${t}: ${F0},`},i=E?`{
			secrets: ${E.secrets!==void 0?typeof E.secrets==="string"?`'${E.secrets}'`:"["+E.secrets.reduce((t,A0)=>t+`'${A0}',`,"")+"]":"undefined"},
			sign: ${E.sign===!0?!0:E.sign!==void 0?"["+E.sign.reduce((t,A0)=>t+`'${A0}',`,"")+"]":"undefined"},
			${n("domain")}
			${n("expires")}
			${n("httpOnly")}
			${n("maxAge")}
			${n("path","/")}
			${n("priority")}
			${n("sameSite")}
			${n("secure")}
		}`:"undefined";if(P)H+=`
c.cookie = await parseCookie(c.set, c.headers.cookie, ${i})
`;else H+=`
c.cookie = await parseCookie(c.set, c.request.headers.get('cookie'), ${i})
`}if(S){let n=[];if(J.query&&J.query.schema.type==="object")n=Object.keys(J.query.schema.properties);else for(let i of K.queries)if(n.indexOf(i)===-1)n.push(i);if($.config.forceDynamicQuery===!0||K.unknownQueries===!0||!n.length)H+=`if(c.qi !== -1) {
				c.query = parseQuery(c.url.slice(c.qi + 1).replace(/\\+/g, ' '))

				// decodeURIComponent is already done in parseQuery function
				// for(const key of Object.keys(c.query))
				//  	c.query[key] = decodeURIComponentc.query[key])
			} else c.query = {}`;else H+=`if(c.qi !== -1) {
				let url = '&' + c.url.slice(c.qi + 1).replace(/\\+/g, ' ')

				${n.map((i,t)=>`
						${t===0?"let":""} memory = url.indexOf('&${i}=')
						let a${t}

						if (memory !== -1) {
							const start = memory + ${i.length+2}
							memory = url.indexOf('&', start)

							if(memory === -1) a${t} = decodeURIComponent(url.slice(start))
							else a${t} = decodeURIComponent(url.slice(start, memory))
						}`).join("\n")}

				c.query = {
					${n.map((i,t)=>`'${i}': a${t}`).join(", ")}
				}
			} else {
				c.query = {}
			}`}const v=A.set,r=K.cookie||K.set||v||P||w&&f;if(M)H+="\nconst id = c.$$requestId\n";const $0=mJ({hasTrace:M,hasTraceSet:v,condition:B,addFn:(n)=>{H+=n}});if(H+=D?"\n try {\n":"",v){H+=`
const traceDone = Promise.all([`;for(let n=0;n<Z.trace.length;n++)H+=`new Promise(r => { reporter.once(\`res\${id}.${n}\`, r) }),`;H+=`])
`}const M0=typeof z==="function"&&l2(z),c=I||R||v||M0||!!Z.mapResponse.length||Z.parse.length>0||Z.afterHandle.some(l2)||Z.beforeHandle.some(l2)||Z.transform.some(l2),e=$0("parse",{unit:Z.parse.length});if(R){const n=Z.parse.length||K.body||J.body;if(Z.type&&!Z.parse.length)switch(Z.type){case"json":case"application/json":if(D)H+=`const tempBody = await c.request.text()

							try {
								c.body = JSON.parse(tempBody)
							} catch {
								throw new ParseError('Failed to parse body as found: ' + (typeof body === "string" ? "'" + body + "'" : body), body)
							}`;else H+="c.body = await c.request.json()";break;case"text":case"text/plain":H+=`c.body = await c.request.text()
`;break;case"urlencoded":case"application/x-www-form-urlencoded":H+=`c.body = parseQuery(await c.request.text())
`;break;case"arrayBuffer":case"application/octet-stream":H+=`c.body = await c.request.arrayBuffer()
`;break;case"formdata":case"multipart/form-data":H+=`c.body = {}

						const form = await c.request.formData()
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						}
`;break}else if(n){if(H+="\n",H+=P?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",H+=`
				if (contentType) {
					const index = contentType.indexOf(';')
					if (index !== -1) contentType = contentType.substring(0, index)

					c.contentType = contentType
`,Z.parse.length){H+=`let used = false
`;const i=$0("parse",{unit:Z.parse.length});for(let t=0;t<Z.parse.length;t++){const A0=$0("parse.unit",{name:Z.parse[t].fn.name}),F0=`bo${t}`;if(t!==0)H+=`if(!used) {
`;if(H+=`let ${F0} = parse[${t}](c, contentType)
`,H+=`if(${F0} instanceof Promise) ${F0} = await ${F0}
`,H+=`if(${F0} !== undefined) { c.body = ${F0}; used = true }
`,A0(),t!==0)H+="}"}i()}if(H+="\ndelete c.contentType\n",Z.parse.length)H+="if (!used) {";if(Z.type&&!Array.isArray(Z.type))switch(Z.type){case"json":case"application/json":if(D)H+=`const tempBody = await c.request.text()

								try {
									c.body = JSON.parse(tempBody)
								} catch {
									throw new ParseError('Failed to parse body as found: ' + (typeof body === "string" ? "'" + body + "'" : body), body)
								}`;else H+="c.body = await c.request.json()";break;case"text":case"text/plain":H+=`c.body = await c.request.text()
`;break;case"urlencoded":case"application/x-www-form-urlencoded":H+=`c.body = parseQuery(await c.request.text())
`;break;case"arrayBuffer":case"application/octet-stream":H+=`c.body = await c.request.arrayBuffer()
`;break;case"formdata":case"multipart/form-data":H+=`c.body = {}

							const form = await c.request.formData()
							for (const key of form.keys()) {
								if (c.body[key])
									continue

								const value = form.getAll(key)
								if (value.length === 1)
									c.body[key] = value[0]
								else c.body[key] = value
							}
`;break}else H+=`
					switch (contentType) {
						case 'application/json':
							${D?`
							const tempBody = await c.request.text()

							try {
								c.body = JSON.parse(tempBody)
							} catch {
								throw new ParseError('Failed to parse body as found: ' + (typeof body === "string" ? "'" + body + "'" : body), body)
							}
							`:`c.body = await c.request.json()
`}
							break

						case 'text/plain':
							c.body = await c.request.text()
							break

						case 'application/x-www-form-urlencoded':
							c.body = parseQuery(await c.request.text())
							break

						case 'application/octet-stream':
							c.body = await c.request.arrayBuffer();
							break

						case 'multipart/form-data':
							c.body = {}

							const form = await c.request.formData()
							for (const key of form.keys()) {
								if (c.body[key])
									continue

								const value = form.getAll(key)
								if (value.length === 1)
									c.body[key] = value[0]
								else c.body[key] = value
							}

							break
					}`;if(Z.parse.length)H+="}";H+="}\n"}H+="\n"}if(e(),Z?.transform){const n=$0("transform",{unit:Z.transform.length});if(Z.transform.length)H+="\nlet transformed\n";for(let i=0;i<Z.transform.length;i++){const t=Z.transform[i],A0=$0("transform.unit",{name:t.fn.name});H+=l2(t)?`transformed = await transform[${i}](c)
`:`transformed = transform[${i}](c)
`,H+=`if(transformed?.[ELYSIA_RESPONSE])
				throw transformed
			else
				Object.assign(c, transformed)
`,A0()}n()}if(J){if(H+="\n",J.headers){if(V6("default",J.headers.schema))for(let[n,i]of Object.entries(Y2.Default(J.headers.schema,{}))){const t=typeof i==="object"?JSON.stringify(i):typeof i==="string"?`'${i}'`:i;if(t)H+=`c.headers['${n}'] ??= ${t}
`}if(H+=`if(headers.Check(c.headers) === false) {
				${s("headers")}
			}`,z$(J.headers.schema))H+=`
c.headers = headers.Decode(c.headers)
`}if(J.params){if(V6("default",J.params.schema))for(let[n,i]of Object.entries(Y2.Default(J.params.schema,{}))){const t=typeof i==="object"?JSON.stringify(i):typeof i==="string"?`'${i}'`:i;if(t)H+=`c.params['${n}'] ??= ${t}
`}if(H+=`if(params.Check(c.params) === false) {
				${s("params")}
			}`,z$(J.params.schema))H+=`
c.params = params.Decode(c.params)
`}if(J.query){if(k)H+="c.query = query.Clean(c.query);\n";if(V6("default",J.query.schema))for(let[n,i]of Object.entries(Y2.Default(J.query.schema,{}))){const t=typeof i==="object"?JSON.stringify(i):typeof i==="string"?`'${i}'`:i;if(t)H+=`c.query['${n}'] ??= ${t}
`}for(let[n,i]of Object.entries(J.query.schema?.properties)){const{type:t,anyOf:A0}=i;if(t==="object"||t==="array"){H+=`
if(typeof c.query['${n}'] === "string")
						try {
							c.query['${n}'] = JSON.parse(c.query['${n}'])
						} catch {}
`;continue}if(A0)H+=`if(typeof c.query['${n}'] === "object") c.query['${n}'] = JSON.parse(c.query['${n}'])
`}if(H+=`if(query.Check(c.query) === false) {
				${s("query")}
			}`,z$(J.query.schema))H+=`
c.query = query.Decode(Object.assign({}, c.query))
`}if(J.body){if(k)H+="c.body = body.Clean(c.body);\n";if(V6("default",J.body.schema)){H+=`if(body.Check(c.body) === false) {
					if (typeof c.body === 'object') {
						c.body = Object.assign(${JSON.stringify(Y2.Default(J.body.schema,{})??{})}, c.body)
					} else {`;const n=Y2.Default(J.body.schema,void 0);if(typeof n==="string")H+=`c.body = '${n}'`;else H+=`c.body = ${n}`;H+=`}
    				if(body.Check(c.body) === false) {
        				${s("body")}
     			}
            }`}else H+=`if(body.Check(c.body) === false) {
			${s("body")}
		}`;if(z$(J.body.schema))H+=`
c.body = body.Decode(c.body)
`}if(C8(g?.schema?.properties??g?.schema?.schema??{})){if(H+=`const cookieValue = {}
    			for(const [key, value] of Object.entries(c.cookie))
    				cookieValue[key] = value.value
`,V6("default",g.schema))for(let[n,i]of Object.entries(Y2.Default(g.schema,{})))H+=`cookieValue['${n}'] = ${typeof i==="object"?JSON.stringify(i):i}
`;H+=`if(cookie.Check(cookieValue) === false) {
				${s("cookie","cookieValue")}
			}`}}if(Z?.beforeHandle){const n=$0("beforeHandle",{unit:Z.beforeHandle.length});let i=!1;for(let t=0;t<Z.beforeHandle.length;t++){const A0=Z.beforeHandle[t],F0=$0("beforeHandle.unit",{name:A0.fn.name}),T0=w5(A0.fn.toString());if(A0.subType==="resolve"){if(!i)i=!0,H+="\nlet resolved\n";H+=l2(A0)?`resolved = await beforeHandle[${t}](c);
`:`resolved = beforeHandle[${t}](c);
`,H+=`if(resolved[ELYSIA_RESPONSE])
						throw resolved
					else
						Object.assign(c, resolved)
`}else if(!T0)H+=l2(A0)?`await beforeHandle[${t}](c);
`:`beforeHandle[${t}](c);
`,F0();else{if(H+="Object.assign(c, be);",H+=l2(A0)?`be = await beforeHandle[${t}](c);
`:`be = beforeHandle[${t}](c);
`,F0(),H+=`if(be !== undefined) {
`,n(),Z.afterHandle?.length){const u0=$0("afterHandle",{unit:Z.transform.length});$0("handle",{name:w?z.name:void 0})();for(let C=0;C<Z.afterHandle.length;C++){const J0=Z.afterHandle[C],T=w5(J0.fn.toString()),H0=$0("afterHandle.unit",{name:J0.fn.name});if(H+=`c.response = be
`,!T)H+=l2(J0.fn)?`await afterHandle[${C}](c, be)
`:`afterHandle[${C}](c, be)
`;else H+=l2(J0.fn)?`af = await afterHandle[${C}](c)
`:`af = afterHandle[${C}](c)
`,H+=`if(af !== undefined) { c.response = be = af }
`;H0()}u0()}if(J.response)H+=a("be");if(Z.mapResponse.length){H+="c.response = be";for(let u0=0;u0<Z.mapResponse.length;u0++)H+=`
if(mr === undefined) {
							mr = onMapResponse[${u0}](c)
							if(mr instanceof Promise) mr = await mr
							if(mr !== undefined) c.response = mr
						}
`}H+=V,H+=`return mapEarlyResponse(be, c.set)}
`}}n()}if(Z?.afterHandle.length){const n=$0("handle",{name:w?z.name:void 0});if(Z.afterHandle.length)H+=M0?`let r = c.response = await ${O};
`:`let r = c.response = ${O};
`;else H+=M0?`let r = await ${O};
`:`let r = ${O};
`;n();const i=$0("afterHandle",{unit:Z.afterHandle.length});for(let t=0;t<Z.afterHandle.length;t++){const A0=Z.afterHandle[t],F0=w5(A0.fn.toString()),T0=$0("afterHandle.unit",{name:A0.fn.name});if(!F0)H+=l2(A0.fn)?`await afterHandle[${t}](c)
`:`afterHandle[${t}](c)
`,T0();else if(H+=l2(A0.fn)?`af = await afterHandle[${t}](c)
`:`af = afterHandle[${t}](c)
`,T0(),J.response)H+="if(af !== undefined) {",i(),H+=a("af"),H+="c.response = af }";else H+="if(af !== undefined) {",i(),H+=`c.response = af}
`}if(i(),H+=`r = c.response
`,J.response)H+=a();if(H+=V,Z.mapResponse.length)for(let t=0;t<Z.mapResponse.length;t++)H+=`
mr = onMapResponse[${t}](c)
				if(mr instanceof Promise) mr = await mr
				if(mr !== undefined) c.response = mr
`;if(r)H+=`return mapResponse(r, c.set)
`;else H+=`return mapCompactResponse(r)
`}else{const n=$0("handle",{name:w?z.name:void 0});if(J.response||Z.mapResponse.length){if(H+=M0?`let r = await ${O};
`:`let r = ${O};
`,n(),J.response)H+=a();if($0("afterHandle")(),Z.mapResponse.length){H+="c.response = r";for(let i=0;i<Z.mapResponse.length;i++)H+=`
if(mr === undefined) {
						mr = onMapResponse[${i}](c)
						if(mr instanceof Promise) mr = await mr
    					if(mr !== undefined) r = c.response = mr
					}
`}if(H+=V,z instanceof Response)H+=K.set?`if(
					isNotEmpty(c.set.headers) ||
					c.set.status !== 200 ||
					c.set.redirect ||
					c.set.cookie
				)
					return mapResponse(${O}.clone(), c.set)
				else
					return ${O}.clone()`:`return ${O}.clone()`,H+="\n";else if(r)H+=`return mapResponse(r, c.set)
`;else H+=`return mapCompactResponse(r)
`}else if(B.handle||I){if(H+=M0?`let r = await ${O};
`:`let r = ${O};
`,n(),$0("afterHandle")(),Z.mapResponse.length){H+="c.response = r";for(let i=0;i<Z.mapResponse.length;i++)H+=`
if(mr === undefined) {
							mr = onMapResponse[${i}](c)
							if(mr instanceof Promise) mr = await mr
    						if(mr !== undefined) r = c.response = mr
						}
`}if(H+=V,r)H+=`return mapResponse(r, c.set)
`;else H+=`return mapCompactResponse(r)
`}else{n();const i=M0?`await ${O}`:O;if($0("afterHandle")(),z instanceof Response)H+=K.set?`if(
					isNotEmpty(c.set.headers) ||
					c.set.status !== 200 ||
					c.set.redirect ||
					c.set.cookie
				)
					return mapResponse(${O}.clone(), c.set)
				else
					return ${O}.clone()`:`return ${O}.clone()`,H+="\n";else if(r)H+=`return mapResponse(${i}, c.set)
`;else H+=`return mapCompactResponse(${i})
`}}if(D||L){if(H+=`
} catch(error) {`,!c)H+="return (async () => {";H+=`const set = c.set
if (!set.status || set.status < 300) set.status = error?.status || 500
`;const n=$0("error",{unit:Z.error.length});if(Z.error.length){H+=`
				c.error = error
				c.code = error.code ?? error[ERROR_CODE] ?? "UNKNOWN"
			`;for(let i=0;i<Z.error.length;i++){const t=`er${i}`,A0=$0("error.unit",{name:Z.error[i].fn.name});if(H+=`
let ${t} = handleErrors[${i}](c)
`,l2(Z.error[i]))H+=`if (${t} instanceof Promise) ${t} = await ${t}
`;A0(),H+=`${t} = mapEarlyResponse(${t}, set)
`,H+=`if (${t}) {`,H+=`return ${t} }
`}}if(n(),H+=`return handleError(c, error, true)

`,!c)H+="})()";if(H+="}",L||M){H+=" finally { ";const i=$0("response",{unit:Z.onResponse.length});H+=L,i(),H+="}"}}return H=`const {
		handler,
		handleError,
		hooks: {
			transform,
			resolve,
			beforeHandle,
			afterHandle,
			mapResponse: onMapResponse,
			parse,
			error: handleErrors,
			onResponse
		},
		validator: {
			body,
			headers,
			params,
			query,
			response,
			cookie
		},
		utils: {
			mapResponse,
			mapCompactResponse,
			mapEarlyResponse,
			parseQuery,
			isNotEmpty
		},
		error: {
			NotFoundError,
			ValidationError,
			InternalServerError,
			ParseError
		},
		schema,
		definitions,
		ERROR_CODE,
		getReporter,
		requestId,
		parseCookie,
		signCookie,
		decodeURIComponent,
		ELYSIA_RESPONSE
	} = hooks

	${Z.onResponse.length?`const ${Z.onResponse.map((n,i)=>`res${i} = onResponse[${i}]`).join(",")}`:""}

	return ${c?"async":""} function handle(c) {
		${Z.beforeHandle.length?"let be":""}
		${Z.afterHandle.length?"let af":""}
		${Z.mapResponse.length?"let mr":""}

		${Q?"c.schema = schema; c.defs = definitions":""}
		${H}
	}`,Function("hooks",H)({handler:z,hooks:F3(Z),validator:J,handleError:$.handleError,utils:{mapResponse:n1,mapCompactResponse:W6,mapEarlyResponse:l1,parseQuery:vJ.parse,isNotEmpty:C8},error:{NotFoundError:e9,ValidationError:p2,InternalServerError:S3,ParseError:R3},schema:$.router.history,definitions:$.definitions.type,ERROR_CODE:N4,getReporter:()=>$.reporter,requestId:pJ,parseCookie:xJ,signCookie:B4,decodeURIComponent:hJ.default,ELYSIA_RESPONSE:q8})},FJ=($)=>{const W={event:{...$.inference.event,queries:[...$.inference.event.queries]},trace:{...$.inference.trace}};let X="",Y="";const Z=$.setHeaders;for(let H of Object.keys($.singleton.decorator))X+=`,${H}: app.singleton.decorator.${H}`;const J=$.router,z=$.event.trace.length>0;let Q=`
	const route = router.find(request.method, path) ${J.http.root.ALL?'?? router.find("ALL", path)':""}

	if (route === null)
		return ${$.event.error.length?"app.handleError(ctx, notFound)":$.event.request.length?`new Response(error404Message, {
					status: ctx.set.status === 200 ? 404 : ctx.set.status,
					headers: ctx.set.headers
				})`:"error404.clone()"}

	ctx.params = route.params
`;if(!($.config.precompile===!0||typeof $.config.precompile==="object"&&$.config.precompile.compose===!0))Q+=`
			if(route.store.composed)
				return route.store.composed(ctx)

			if(route.store.compose)
				return (route.store.compose())(ctx)`;else Q+="return route.store(ctx)";Q+="\n";let A="";for(let[H,{code:K,all:S}]of Object.entries(J.static.http.map))A+=`case '${H}':
switch(request.method) {
${K}
${S??"default: break map"}}

`;const w=$.event.request.some(l2),D=`

	const url = request.url
	const s = url.indexOf('/', 11)
	const qi = url.indexOf('?', s + 1)
	let path
	if(qi === -1)
		path = url.substring(s)
	else
		path = url.substring(s, qi)
`;if(Y+=`const {
		app,
		mapEarlyResponse,
		NotFoundError,
		requestId,
		getReporter,
		handleError,
		error,
		redirect
	} = data

	const store = app.singleton.store
	const staticRouter = app.router.static.http
	const wsRouter = app.router.ws
	const router = app.router.http

	const notFound = new NotFoundError()

	${$.event.request.length?"const onRequest = app.event.request.map(x => x.fn)":""}
	${J.static.http.variables}
	${$.event.error.length?"":`
	const error404Message = notFound.message.toString()
	const error404 = new Response(error404Message, { status: 404 });
	`}

	return ${w?"async":""} function map(request) {
`,$.event.request.length)Y+="let re";const O=mJ({hasTrace:z,hasTraceSet:W.trace.set,condition:{request:W.trace.request},addFn:(H)=>{Y+=H}});if($.event.request.length){Y+=`
			${z?"const id = +requestId.value++":""}

			const ctx = {
				request,
				store,
				redirect,
				set: {
					headers: ${Object.keys(Z??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
					status: 200
				},
				error
				${z?",$$requestId: +id":""}
				${X}
			}
		`;const H=O("request",{attribute:"ctx",unit:$.event.request.length});Y+=`
 try {
`;for(let K=0;K<$.event.request.length;K++){const S=$.event.request[K],R=w5(S.fn.toString()),b=l2(S),f=O("request.unit",{name:$.event.request[K].fn.name});if(R)Y+=`re = mapEarlyResponse(
					${b?"await":""} onRequest[${K}](ctx),
					ctx.set,
					request
				)
`,f(),Y+=`if(re !== undefined) return re
`;else Y+=`${b?"await":""} onRequest[${K}](ctx)
`,f()}Y+=`} catch (error) {
			return app.handleError(ctx, error)
		}`,H(),Y+=D,Y+=`
ctx.qi = qi
 ctx.path = path
ctx.url=url`}else Y+=D,Y+=`${z?"const id = +requestId.value++":""}
		const ctx = {
			request,
			store,
			qi,
			path,
			url,
			redirect,
			set: {
				headers: ${Object.keys(Z??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
				status: 200
			},
			error
			${z?",$$requestId: id":""}
			${X}
		}`,O("request",{unit:$.event.request.length,attribute:W.trace.context||W.trace.store||W.trace.set?"ctx":""})();const L=$.router.static.ws,B=$.router.ws;if(Object.keys(L).length||B.history.length){Y+=`
			if(request.method === 'GET') {
				switch(path) {`;for(let[H,K]of Object.entries(L))Y+=`
					case '${H}':
						if(request.headers.get('upgrade') === 'websocket')
							return st${K}(ctx)

						break`;Y+=`
				default:
					if(request.headers.get('upgrade') === 'websocket') {
						const route = wsRouter.find('ws', path)

						if(route) {
							ctx.params = route.params

							return route.store(ctx)
						}
					}

					break
			}
		}
`}Y+=`
		map: switch(path) {
			${A}

			default:
				break
		}

		${Q}
	}`;const M=cJ($);return $.handleError=M,Function("data",Y)({app:$,mapEarlyResponse:l1,NotFoundError:e9,getReporter:()=>$.reporter,requestId:pJ,handleError:M,error:K3,redirect:dJ})},cJ=($)=>{let W=`const {
		app: { event: { error: onErrorContainer, onResponse: resContainer } },
		mapResponse,
		ERROR_CODE,
		ELYSIA_RESPONSE
	} = inject

	const onError = onErrorContainer.map(x => x.fn)
	const res = resContainer.map(x => x.fn)

	return ${$.event.error.find(l2)?"async":""} function(context, error, skipGlobal) {
		let r

		const { set } = context

		context.code = error.code
		context.error = error

		if(typeof error === "object" && ELYSIA_RESPONSE in error) {
			error.status = error[ELYSIA_RESPONSE]
			error.message = error.response
		}
`;for(let X=0;X<$.event.error.length;X++){const Y=$.event.error[X],Z=`${l2(Y)?"await ":""}onError[${X}](context)`;if(W+="\nif(skipGlobal !== true) {\n",w5(Y.fn.toString()))W+=`r = ${Z}; if(r !== undefined) {
				if(r instanceof Response) return r

				if(r[ELYSIA_RESPONSE]) {
					error.status = error[ELYSIA_RESPONSE]
					error.message = error.response
				}

				if(set.status === 200) set.status = error.status
				return mapResponse(r, set, context.request)
			}
`;else W+=Z+"\n";W+="\n}\n"}return W+=`if(error.constructor.name === "ValidationError" || error.constructor.name === "TransformDecodeError") {
		set.status = error.status ?? 422
		return new Response(
			error.message,
			{
				headers: Object.assign(
					{ 'content-type': 'application/json'},
					set.headers
				),
				status: set.status
			}
		)
	} else {
		if(error.code && typeof error.status === "number")
			return new Response(
				error.message,
				{ headers: set.headers, status: error.status }
			)

		return mapResponse(error, set, context.request)
	}
}`,Function("inject",W)({app:$,mapResponse:n1,ERROR_CODE:N4,ELYSIA_RESPONSE:q8})},H4=($)=>`if(stc${$}) return stc${$}(ctx)
if(st${$}.compose) return (stc${$} = st${$}.compose())(ctx)

return st${$}(ctx)`,KJ=($)=>async(W)=>{const X=W.url,Y=X.indexOf("/",11),Z=X.indexOf("?",Y+1),J=Z===-1?X.substring(Y):X.substring(Y,Z),z={cookie:{},status:200,headers:{}},Q=Object.assign({},$.singleton.decorator,{set:z,store:$.singleton.store,request:W,path:J,qi:Z,redirect:dJ});try{for(let K=0;K<$.event.request.length;K++){const S=$.event.request[K].fn;let R=S(Q);if(R instanceof Promise)R=await R;if(R=l1(R,z),R)return R}const G=$.router.dynamic.find(W.method,J)??$.router.dynamic.find("ALL",J);if(!G)throw new e9;const{handle:A,hooks:w,validator:D,content:O}=G.store;let L;if(W.method!=="GET"&&W.method!=="HEAD")if(O)switch(O){case"application/json":L=await W.json();break;case"text/plain":L=await W.text();break;case"application/x-www-form-urlencoded":L=D4.parse(await W.text());break;case"application/octet-stream":L=await W.arrayBuffer();break;case"multipart/form-data":L={};const K=await W.formData();for(let S of K.keys()){if(L[S])continue;const R=K.getAll(S);if(R.length===1)L[S]=R[0];else L[S]=R}break}else{let K=W.headers.get("content-type");if(K){const S=K.indexOf(";");if(S!==-1)K=K.slice(0,S);Q.contentType=K;for(let R=0;R<w.parse.length;R++){const b=w.parse[R].fn;let f=b(Q,K);if(f instanceof Promise)f=await f;if(f){L=f;break}}if(delete Q.contentType,L===void 0)switch(K){case"application/json":L=await W.json();break;case"text/plain":L=await W.text();break;case"application/x-www-form-urlencoded":L=D4.parse(await W.text());break;case"application/octet-stream":L=await W.arrayBuffer();break;case"multipart/form-data":L={};const R=await W.formData();for(let b of R.keys()){if(L[b])continue;const f=R.getAll(b);if(f.length===1)L[b]=f[0];else L[b]=f}break}}}Q.body=L,Q.params=G?.params||void 0,Q.query=Z===-1?{}:D4.parse(X.substring(Z+1)),Q.headers={};for(let[K,S]of W.headers.entries())Q.headers[K]=S;const B=Object.assign({},$.config?.cookie,D?.cookie?.config),M=W.headers.get("cookie");Q.cookie=await xJ(Q.set,M,B?{secrets:B.secrets!==void 0?typeof B.secrets==="string"?B.secrets:B.secrets.join(","):void 0,sign:B.sign===!0?!0:B.sign!==void 0?typeof B.sign==="string"?B.sign:B.sign.join(","):void 0}:void 0);for(let K=0;K<w.transform.length;K++){const S=w.transform[K],R=S.fn(Q);if(S.subType==="derive")if(R instanceof Promise)Object.assign(Q,await R);else Object.assign(Q,R);else if(R instanceof Promise)await R}if(D){if(D.headers){const K={};for(let S in W.headers)K[S]=W.headers.get(S);if(D.headers.Check(K)===!1)throw new p2("header",D.headers,K)}if(D.params?.Check(Q.params)===!1)throw new p2("params",D.params,Q.params);if(D.query?.Check(Q.query)===!1)throw new p2("query",D.query,Q.query);if(D.cookie){const K={};for(let[S,R]of Object.entries(Q.cookie))K[S]=R.value;if(D.cookie?.Check(K)===!1)throw new p2("cookie",D.cookie,K)}if(D.body?.Check(L)===!1)throw new p2("body",D.body,L)}for(let K=0;K<w.beforeHandle.length;K++){let S=w.beforeHandle[K].fn(Q);if(S instanceof Promise)S=await S;if(S!==void 0){Q.response=S;for(let b=0;b<w.afterHandle.length;b++){let f=w.afterHandle[b].fn(Q);if(f instanceof Promise)f=await f;if(f)S=f}const R=l1(S,Q.set);if(R)return R}}let H=A(Q);if(H instanceof Promise)H=await H;if(!w.afterHandle.length){const K=D?.response?.[H.status];if(K?.Check(H)===!1)throw new p2("response",K,H)}else{Q.response=H;for(let K=0;K<w.afterHandle.length;K++){let S=w.afterHandle[K].fn(Q);if(S instanceof Promise)S=await S;const R=l1(S,Q.set);if(R!==void 0){const b=D?.response?.[H.status];if(b?.Check(R)===!1)throw new p2("response",b,R);return R}}}if(Q.set.cookie&&B?.sign){const K=!B.secrets?void 0:typeof B.secrets==="string"?B.secrets:B.secrets[0];if(B.sign===!0)for(let[S,R]of Object.entries(Q.set.cookie))Q.set.cookie[S].value=await B4(R.value,"${secret}");else{const S=D?.cookie?.schema?.properties;for(let R of B.sign){if(!(R in S))continue;if(Q.set.cookie[R]?.value)Q.set.cookie[R].value=await B4(Q.set.cookie[R].value,K)}}}return n1(H,Q.set)}catch(G){if(G.status)z.status=G.status;return $.handleError(Q,G)}finally{for(let G of $.event.onResponse)await G.fn(Q)}},q3=($)=>async(W,X)=>{const Y=Object.assign(W,{error:X,code:X.code});Y.set=W.set;for(let Z=0;Z<$.event.error.length;Z++){let z=$.event.error[Z].fn(Y);if(z instanceof Promise)z=await z;if(z!==void 0&&z!==null)return n1(z,W.set)}return new Response(typeof X.cause==="string"?X.cause:X.message,{headers:W.set.headers,status:X.status??500})},$X={date:uJ,time:s9(!0),"date-time":SJ(!0),"iso-time":s9(!1),"iso-date-time":SJ(!1),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:g3,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:m3,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:f3,int32:{type:"number",validate:v3},int64:{type:"number",validate:h3},float:{type:"number",validate:PJ},double:{type:"number",validate:PJ},password:!0,binary:!0},j3=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,I3=[0,31,28,31,30,31,30,31,31,30,31,30,31],b3=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i,x3=/t|\s/i,k3=/\/|:/,T3=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,RJ=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm,y3=-2147483648,d3=2147483647,p3=/[^\\]\\Z/,oJ=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,iJ=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,lJ=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,c3=$X.date,u3=$X["date-time"];if(!O2.Has("date"))B8.Format("date",($)=>{const W=$.replace(/"/g,"");if(oJ.test(W)||iJ.test(W)||lJ.test(W)||c3(W)){const X=new Date(W);if(!Number.isNaN(X.getTime()))return!0}return!1});if(!O2.Has("date-time"))B8.Format("date-time",($)=>{const W=$.replace(/"/g,"");if(oJ.test(W)||iJ.test(W)||lJ.test(W)||u3(W)){const X=new Date(W);if(!Number.isNaN(X.getTime()))return!0}return!1});Object.entries($X).forEach(($)=>{const[W,X]=$;if(!O2.Has(W)){if(X instanceof RegExp)B8.Format(W,(Y)=>X.test(Y));else if(typeof X==="function")B8.Format(W,X)}});var Q0=Object.assign({},Y$),EJ=($)=>{if(typeof $==="string")switch($.slice(-1)){case"k":return+$.slice(0,$.length-1)*1024;case"m":return+$.slice(0,$.length-1)*1048576;default:return+$}return $},r9=($,W)=>{if(!(W instanceof Blob))return!1;if($.minSize&&W.size<EJ($.minSize))return!1;if($.maxSize&&W.size>EJ($.maxSize))return!1;if($.extension)if(typeof $.extension==="string"){if(!W.type.startsWith($.extension))return!1}else{for(let X=0;X<$.extension.length;X++)if(W.type.startsWith($.extension[X]))return!0;return!1}return!0},o3=q2.Get("Files")??B8.Type("File",r9),i3=q2.Get("Files")??B8.Type("Files",($,W)=>{if(!Array.isArray(W))return r9($,W);if($.minItems&&W.length<$.minItems)return!1;if($.maxItems&&W.length>$.maxItems)return!1;for(let X=0;X<W.length;X++)if(!r9($,W[X]))return!1;return!0});if(!O2.Has("numeric"))O2.Set("numeric",($)=>!!$&&!isNaN(+$));if(!O2.Has("boolean"))O2.Set("boolean",($)=>$==="true"||$==="false");if(!O2.Has("ObjectString"))O2.Set("ObjectString",($)=>{let W=$.charCodeAt(0);if(W===9||W===10||W===32)W=$.trimStart().charCodeAt(0);if(W!==123&&W!==91)return!1;try{return JSON.parse($),!0}catch{return!1}});var c8={Numeric:($)=>{const W=Y$.Number($);return Q0.Transform(Q0.Union([Q0.String({format:"numeric",default:0}),Q0.Number($)],$)).Decode((X)=>{const Y=+X;if(isNaN(Y))return X;if($&&!Y2.Check(W,Y))throw new p2("property",W,Y);return Y}).Encode((X)=>X)},Date:($)=>{const W=Y$.Date($);return Q0.Transform(Q0.Union([Y$.Date($),Q0.String({format:"date",default:(new Date()).toISOString()}),Q0.String({format:"date-time",default:(new Date()).toISOString()})],$)).Decode((X)=>{if(X instanceof Date)return X;const Y=new Date(X);if(!Y2.Check(W,Y))throw new p2("property",W,Y);return Y}).Encode((X)=>{if(typeof X==="string")return new Date(X);return X})},BooleanString:($)=>{const W=Y$.Boolean($);return Q0.Transform(Q0.Union([Q0.String({format:"boolean",default:!1}),Q0.Boolean($)],$)).Decode((X)=>{if(typeof X==="string")return X==="true";if($&&!Y2.Check(W,X))throw new p2("property",W,X);return X}).Encode((X)=>X)},ObjectString:($={},W)=>{const X=Q0.Object($,W),Y=JSON.stringify(Y2.Create(X));return Q0.Transform(Q0.Union([Q0.String({format:"ObjectString",default:Y}),X])).Decode((Z)=>{if(typeof Z==="string"){try{Z=JSON.parse(Z)}catch{throw new p2("property",X,Z)}if(!Y2.Check(X,Z))throw new p2("property",X,Z);return Z}return Z}).Encode((Z)=>{if(typeof Z==="string")try{Z=JSON.parse(Z)}catch{throw new p2("property",X,Z)}if(!Y2.Check(X,Z))throw new p2("property",X,Z);return JSON.stringify(Z)})},File:o3,Files:($={})=>Q0.Transform(i3($)).Decode((W)=>{if(Array.isArray(W))return W;return[W]}).Encode((W)=>W),Nullable:($)=>Q0.Union([Q0.Null(),$]),MaybeEmpty:($)=>Q0.Union([Q0.Null(),Q0.Undefined(),$]),Cookie:($,{domain:W,expires:X,httpOnly:Y,maxAge:Z,path:J,priority:z,sameSite:Q,secure:G,secrets:A,sign:w,...D}={})=>{const O=Q0.Object($,D);return O.config={domain:W,expires:X,httpOnly:Y,maxAge:Z,path:J,priority:z,sameSite:Q,secure:G,secrets:A,sign:w},O}};Q0.BooleanString=c8.BooleanString;Q0.ObjectString=c8.ObjectString;Q0.Numeric=c8.Numeric;Q0.File=($={})=>c8.File({default:"File",...$,extension:$?.type,type:"string",format:"binary"});Q0.Files=($={})=>c8.Files({...$,elysiaMeta:"Files",default:"Files",extension:$?.type,type:"array",items:{...$,default:"Files",type:"string",format:"binary"}});Q0.Nullable=($)=>c8.Nullable($);Q0.MaybeEmpty=c8.MaybeEmpty;Q0.Cookie=c8.Cookie;Q0.Date=c8.Date;var n0=class ${constructor(W){if(this.server=null,this.dependencies={},this.reporter=new j7,this._routes={},this._types={Prefix:"",Scoped:!1,Singleton:{},Definitions:{},Metadata:{}},this._ephemeral={},this._volatile={},this.singleton={decorator:{},store:{},derive:{},resolve:{}},this.definitions={type:{},error:{}},this.extender={macros:[]},this.validator=null,this.event={start:[],request:[],parse:[],transform:[],beforeHandle:[],afterHandle:[],mapResponse:[],onResponse:[],trace:[],error:[],stop:[]},this.telemetry={stack:void 0},this.router={http:new c9,ws:new c9,dynamic:new c9,static:{http:{handlers:[],variables:"",map:{},all:""},ws:{}},history:[]},this.inference={event:{body:!1,cookie:!1,headers:!1,queries:[],query:!1,set:!1,unknownQueries:!1},trace:{request:!1,parse:!1,transform:!1,handle:!1,beforeHandle:!1,afterHandle:!1,error:!1,context:!1,store:!1,set:!1}},this.promisedModules=new N3,this.routeTree=new Map,this.handle=async(X)=>this.fetch(X),this.fetch=(X)=>{return(this.fetch=this.config.aot?FJ(this):KJ(this))(X)},this.handleError=async(X,Y)=>(this.handleError=this.config.aot?cJ(this):q3(this))(X,Y),this.outerErrorHandler=(X)=>new Response(X.message||X.name||"Error",{status:X?.status??500}),this.listen=(X,Y)=>{if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch");if(this.compile(),typeof X==="string"){if(!O4(X))throw new Error("Port must be a numeric value");X=parseInt(X)}const Z=this.fetch,J=typeof X==="object"?{development:!L4,reusePort:!0,...this.config.serve||{},...X||{},websocket:{...this.config.websocket||{},...LJ||{}},fetch:Z,error:this.outerErrorHandler}:{development:!L4,reusePort:!0,...this.config.serve||{},websocket:{...this.config.websocket||{},...LJ||{}},port:X,fetch:Z,error:this.outerErrorHandler};this.server=Bun?.serve(J);for(let z=0;z<this.event.start.length;z++)this.event.start[z].fn(this);if(Y)Y(this.server);return process.on("beforeExit",()=>{if(this.server){this.server.stop(),this.server=null;for(let z=0;z<this.event.stop.length;z++)this.event.stop[z].fn(this)}}),this.promisedModules.then(()=>{Bun?.gc(!1)}),this},this.stop=async()=>{if(!this.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(this.server){if(this.server.stop(),this.server=null,this.event.stop.length)for(let X=0;X<this.event.stop.length;X++)this.event.stop[X].fn(this)}},W?.tags)if(!W.detail)W.detail={tags:W.tags};else W.detail.tags=W.tags;if(this.config={forceErrorEncapsulation:!0,prefix:"",aot:!0,strictPath:!1,global:!1,cookie:{path:"/"},analytic:!1,forceDynamicQuery:!0,...W,experimental:W?.experimental??{},seed:W?.seed===void 0?"":W?.seed},W?.analytic&&(W?.name||W?.seed!==void 0))this.telemetry.stack=new Error().stack}get store(){return this.singleton.store}get decorator(){return this.singleton.decorator}get _scoped(){return this.config.scoped}getServer(){return this.server}get routes(){return this.router.history}applyMacro(W){if(this.extender.macros.length){const X=O3({globalHook:this.event,localHook:W}),Y={events:{global:this.event,local:W},onParse:X("parse"),onTransform:X("transform"),onBeforeHandle:X("beforeHandle"),onAfterHandle:X("afterHandle"),onResponse:X("onResponse"),mapResponse:X("mapResponse"),onError:X("error")};for(let Z of this.extender.macros)yJ(Z.fn(Y),W)}}add(W,X,Y,Z,{allowMeta:J=!1,skipPrefix:z=!1}={allowMeta:!1,skipPrefix:!1}){if(Z=L3(Z),X!==""&&X.charCodeAt(0)!==47)X="/"+X;if(this.config.prefix&&!z&&!this.config.scoped)X=this.config.prefix+X;if(Z?.type)switch(Z.type){case"text":Z.type="text/plain";break;case"json":Z.type="application/json";break;case"formdata":Z.type="multipart/form-data";break;case"urlencoded":Z.type="application/x-www-form-urlencoded";break;case"arrayBuffer":Z.type="application/octet-stream";break;default:break}const Q=this.definitions.type;let G,A,w,D,O,L;const B=!this.config.aot,M={body:Z?.body??this.validator?.body,headers:Z?.headers??this.validator?.headers,params:Z?.params??this.validator?.params,query:Z?.query??this.validator?.query,cookie:Z?.cookie??this.validator?.cookie,response:Z?.response??this.validator?.response},H=()=>M.cookie?fJ({validator:M.cookie,defaultConfig:this.config.cookie,config:M.cookie?.config??{},dynamic:B,models:Q}):void 0,K=this.config.normalize,S=this.config.precompile===!0||typeof this.config.precompile==="object"&&this.config.precompile.schema===!0?{body:o1(M.body,{dynamic:B,models:Q,normalize:K}),headers:o1(M.headers,{dynamic:B,models:Q,additionalProperties:!0}),params:o1(M.params,{dynamic:B,models:Q}),query:o1(M.query,{dynamic:B,models:Q,normalize:K}),cookie:H(),response:AJ(M.response,{dynamic:B,models:Q,normalize:K})}:{get body(){if(G)return G;return G=o1(M.body,{dynamic:B,models:Q,normalize:K})},get headers(){if(A)return A;return o1(M.headers,{dynamic:B,models:Q,additionalProperties:!0})},get params(){if(w)return w;return w=o1(M.params,{dynamic:B,models:Q})},get query(){if(D)return D;return D=o1(M.query,{dynamic:B,models:Q})},get cookie(){if(O)return O;return O=H()},get response(){if(L)return L;return L=AJ(M.response,{dynamic:B,models:Q,normalize:K})}},R=X.endsWith("/")?X.slice(0,X.length-1):X+"/";if(Z=c1(Z,{},{allowMacro:!0}),Z.tags)if(!Z.detail)Z.detail={tags:Z.tags};else Z.detail.tags=Z.tags;if(C8(this.config.detail))Z.detail=i1(Object.assign({},this.config.detail),Z.detail);this.applyMacro(Z);const b=c1(this.event,Z);if(this.config.aot===!1){if(this.router.dynamic.add(W,X,{validator:S,hooks:b,content:Z?.type,handle:Y}),this.config.strictPath===!1)this.router.dynamic.add(W,R,{validator:S,hooks:b,content:Z?.type,handle:Y});this.router.history.push({method:W,path:X,composed:null,handler:Y,hooks:b});return}let f=void 0;const P=this.config.precompile===!0||typeof this.config.precompile==="object"&&this.config.precompile.compose===!0,I=i9(this.inference),g=P?n9({app:this,path:X,method:W,localHook:c1(Z),hooks:b,validator:S,handler:Y,allowMeta:J,appInference:I}):(k)=>{if(f)return f(k);return(f=n9({app:this,path:X,method:W,localHook:c1(Z),hooks:b,validator:S,handler:Y,allowMeta:J,appInference:I}))(k)};if(!P)g.compose=()=>{return g.composed=n9({app:this,path:X,method:W,localHook:c1(Z),hooks:b,validator:S,handler:Y,allowMeta:J,appInference:I})};let E=this.router.history.length;if(this.routeTree.has(W+X)){if(E=this.router.history.findIndex((k)=>k.path===X&&k.method===W),E!==-1){const k=this.router.history.splice(E,1)[0];if(k&&this.routeTree.has(k?.method+k?.path))this.routeTree.delete(k.method+k.path)}}this.routeTree.set(W+X,E),this.router.history.push({method:W,path:X,composed:g,handler:Y,hooks:b});const V=this.router.static.http;if(W==="$INTERNALWS"){const k=this.config.strictPath?void 0:X.endsWith("/")?X.slice(0,X.length-1):X+"/";if(X.indexOf(":")===-1&&X.indexOf("*")===-1){const s=V.handlers.length;if(V.handlers.push(g),V.variables+=`const st${s} = staticRouter.handlers[${s}]
`,this.router.static.ws[X]=s,k)this.router.static.ws[k]=s}else if(this.router.ws.add("ws",X,g),k)this.router.ws.add("ws",k,g);return}if(X.indexOf(":")===-1&&X.indexOf("*")===-1){const k=V.handlers.length;if(V.handlers.push(g),V.variables+=P?`const st${k} = staticRouter.handlers[${k}]
`:`let st${k} = staticRouter.handlers[${k}]
let stc${k}
`,!V.map[X])V.map[X]={code:""};if(W==="ALL")V.map[X].all=P?`default: return st${k}(ctx)
`:`default: ${H4(k)}
`;else V.map[X].code=P?`case '${W}': return st${k}(ctx)
${V.map[X].code}`:`case '${W}': ${H4(k)}
${V.map[X].code}`;if(!this.config.strictPath){if(!V.map[R])V.map[R]={code:""};if(W==="ALL")V.map[R].all=P?`default: return st${k}(ctx)
`:`default: ${H4(k)}
`;else V.map[R].code=P?`case '${W}': return st${k}(ctx)
${V.map[R].code}`:`case '${W}': ${H4(k)}
${V.map[R].code}`}}else if(this.router.http.add(W,X,g),!this.config.strictPath)this.router.http.add(W,X.endsWith("/")?X.slice(0,X.length-1):X+"/",g)}headers(W){if(!W)return this;if(!this.setHeaders)this.setHeaders={};return this.setHeaders=i1(this.setHeaders,W),this}onStart(W){return this.on("start",W),this}onRequest(W){return this.on("request",W),this}onParse(W,X){if(!X)return this.on("parse",W);return this.on(W,"parse",X)}onTransform(W,X){if(!X)return this.on("transform",W);return this.on(W,"transform",X)}resolve(W,X){if(!X)X=W,W={as:"local"};const Y={subType:"resolve",fn:X};return this.onBeforeHandle(W,Y)}mapResolve(W,X){if(!X)X=W,W={as:"local"};const Y={subType:"resolve",fn:X};return this.onBeforeHandle(W,Y)}onBeforeHandle(W,X){if(!X)return this.on("beforeHandle",W);return this.on(W,"beforeHandle",X)}onAfterHandle(W,X){if(!X)return this.on("afterHandle",W);return this.on(W,"afterHandle",X)}mapResponse(W,X){if(!X)return this.on("mapResponse",W);return this.on(W,"mapResponse",X)}onResponse(W,X){if(!X)return this.on("response",W);return this.on(W,"response",X)}trace(W,X){if(!X)X=W,W={as:"local"};if(!Array.isArray(X))X=[X];for(let Y of X)this.reporter.on("event",$3(()=>this.reporter,this.event.trace.length,Y));return this.on(W,"trace",X),this}error(W,X){switch(typeof W){case"string":return X.prototype[N4]=W,this.definitions.error[W]=X,this;case"function":return this.definitions.error=W(this.definitions.error),this}for(let[Y,Z]of Object.entries(W))Z.prototype[N4]=Y,this.definitions.error[Y]=Z;return this}onError(W,X){if(!X)return this.on("error",W);return this.on(W,"error",X)}onStop(W){return this.on("stop",W),this}on(W,X,Y){let Z;switch(typeof W){case"string":Z=W,Y=X;break;case"object":Z=X;break}if(Z==="response")Z="onResponse";if(Array.isArray(Y))Y=u1(Y);else if(typeof Y==="function")Y=[{fn:Y}];else Y=[Y];const J=Y;for(let z of J)z.scope=typeof W==="string"?"local":W?.as??"local";if(Z==="trace")Q3(J.map((z)=>z.fn),this.inference.trace);else IJ({[Z]:J.map((z)=>z.fn)},this.inference.event);for(let z of J){const Q=D3(z,"global",{skipIfHasType:!0});switch(Z){case"start":this.event.start.push(Q);break;case"request":this.event.request.push(Q);break;case"parse":this.event.parse.push(Q);break;case"transform":this.event.transform.push(Q);break;case"beforeHandle":this.event.beforeHandle.push(Q);break;case"afterHandle":this.event.afterHandle.push(Q);break;case"mapResponse":this.event.mapResponse.push(Q);break;case"onResponse":this.event.onResponse.push(Q);break;case"trace":this.event.trace.push(Q);break;case"error":this.event.error.push(Q);break;case"stop":this.event.stop.push(Q);break}}return this}propagate(){const W=(X)=>{for(let Y of X)if("scope"in Y&&Y.scope==="local")Y.scope="scoped"};return W(this.event.parse),W(this.event.transform),W(this.event.beforeHandle),W(this.event.afterHandle),W(this.event.mapResponse),W(this.event.onResponse),W(this.event.trace),W(this.event.error),this}group(W,X,Y){const Z=new $({...this.config,prefix:""});Z.singleton={...this.singleton},Z.definitions={...this.definitions},Z.getServer=()=>this.server,Z.inference=i9(this.inference),Z.extender={...this.extender};const J=typeof X==="object",z=(J?Y:X)(Z);if(this.singleton=i1(this.singleton,Z.singleton),this.definitions=i1(this.definitions,Z.definitions),z.event.request.length)this.event.request=[...this.event.request||[],...z.event.request||[]];if(z.event.onResponse.length)this.event.onResponse=[...this.event.onResponse||[],...z.event.onResponse||[]];return this.model(z.definitions.type),Object.values(Z.router.history).forEach(({method:Q,path:G,handler:A,hooks:w})=>{if(G=(J?"":this.config.prefix)+W+G,J){const D=X,O=w;this.add(Q,G,A,c1(D,{...O||{},error:!O.error?z.event.error:Array.isArray(O.error)?[...O.error||{},...z.event.error||{}]:[O.error,...z.event.error||{}]}))}else this.add(Q,G,A,c1(w,{error:z.event.error}),{skipPrefix:!0})}),this}guard(W,X){if(!X){if(typeof W==="object"){if(this.applyMacro(W),this.event=o9(this.event,W),this.validator={body:W.body??this.validator?.body,headers:W.headers??this.validator?.headers,params:W.params??this.validator?.params,query:W.query??this.validator?.query,response:W.response??this.validator?.response,cookie:W.cookie??this.validator?.cookie},W.detail)if(this.config.detail)this.config.detail=i1(Object.assign({},this.config.detail),W.detail);else this.config.detail=W.detail;if(W?.tags)if(!this.config.detail)this.config.detail={tags:W.tags};else this.config.detail.tags=W.tags;return this}return this.guard({},W)}const Y=new $({...this.config,prefix:""});Y.singleton={...this.singleton},Y.definitions={...this.definitions},Y.inference=i9(this.inference),Y.extender={...this.extender};const Z=X(Y);if(this.singleton=i1(this.singleton,Y.singleton),this.definitions=i1(this.definitions,Y.definitions),Z.getServer=()=>this.server,Z.event.request.length)this.event.request=[...this.event.request||[],...Z.event.request||[]];if(Z.event.onResponse.length)this.event.onResponse=[...this.event.onResponse||[],...Z.event.onResponse||[]];return this.model(Z.definitions.type),Object.values(Y.router.history).forEach(({method:J,path:z,handler:Q,hooks:G})=>{this.add(J,z,Q,c1(W,{...G||{},error:!G.error?Z.event.error:Array.isArray(G.error)?[...G.error||{},...Z.event.error||[]]:[G.error,...Z.event.error||[]]},{allowMacro:!0}))}),this}use(W,X){if(X?.scoped)return this.guard({},(Y)=>Y.use(W));if(Array.isArray(W)){let Y=this;for(let Z of W)Y=this.use(Z);return Y}if(W instanceof Promise)return this.promisedModules.add(W.then((Y)=>{if(typeof Y==="function")return Y(this);if(Y instanceof $)return this._use(Y);if(typeof Y.default==="function")return Y.default(this);if(Y.default instanceof $)return this._use(Y.default);throw new Error('Invalid plugin type. Expected Elysia instance, function, or module with "default" as Elysia instance or function that returns Elysia instance.')}).then((Y)=>Y.compile())),this;return this._use(W)}_use(W){if(typeof W==="function"){const J=W(this);if(J instanceof Promise)return this.promisedModules.add(J.then((z)=>{if(z instanceof $){this.compile();for(let{method:Q,path:G,handler:A,hooks:w}of Object.values(z.router.history))this.add(Q,G,A,c1(w,{error:z.event.error}));return z}if(typeof z==="function")return z(this);if(typeof z.default==="function")return z.default(this);return this._use(z)}).then((z)=>z.compile())),this;return J}if(W.promisedModules.size)return this.promisedModules.add(W.modules.then(()=>this._use(W)).then((J)=>J.compile())),this;const{name:X,seed:Y}=W.config;W.getServer=()=>this.getServer(),W.model(this.definitions.type),W.error(this.definitions.error);const Z=W.config.scoped;if(Z){if(X){if(!(X in this.dependencies))this.dependencies[X]=[];const z=Y!==void 0?A4(X+JSON.stringify(Y)):0;if(this.dependencies[X].some(({checksum:Q})=>z===Q))return this;this.dependencies[X].push(!this.config?.analytic?{name:W.config.name,seed:W.config.seed,checksum:z,dependencies:W.dependencies}:{name:W.config.name,seed:W.config.seed,checksum:z,dependencies:W.dependencies,stack:W.telemetry.stack,routes:W.router.history,decorators:W.singleton.decorator,store:W.singleton.store,type:W.definitions.type,error:W.definitions.error,derive:W.event.transform.filter((Q)=>Q.subType==="derive").map((Q)=>({fn:Q.fn.toString(),stack:new Error().stack??""})),resolve:W.event.transform.filter((Q)=>Q.subType==="derive").map((Q)=>({fn:Q.fn.toString(),stack:new Error().stack??""}))})}W.extender.macros=this.extender.macros.concat(W.extender.macros);const J=[];for(let z=0;z<W.extender.macros.length;z++){const Q=this.extender.macros[z];if(J.includes(Q.checksum))W.extender.macros.splice(z,1),z--;J.push(Q.checksum)}if(W.onRequest((z)=>{Object.assign(z,this.singleton.decorator),Object.assign(z.store,this.singleton.store)}),W.event.trace.length)W.event.trace.push(...W.event.trace);if(!W.config.prefix)console.warn("It's recommended to use scoped instance with a prefix to prevent collision routing with other instance.");if(W.event.error.length)W.event.error.push(...this.event.error);if(W.config.aot)W.compile();if(Z===!0&&W.config.prefix){this.mount(W.config.prefix+"/",W.fetch);for(let z of W.router.history)this.routeTree.set(z.method+`${W.config.prefix}${z.path}`,this.router.history.length),this.router.history.push({...z,path:`${W.config.prefix}${z.path}`,hooks:c1(z.hooks,{error:this.event.error})})}else{this.mount(W.fetch);for(let z of W.router.history)this.routeTree.set(z.method+`${W.config.prefix}${z.path}`,this.router.history.length),this.router.history.push({...z,path:`${W.config.prefix}${z.path}`,hooks:c1(z.hooks,{error:this.event.error})})}return this}else{this.headers(W.setHeaders),W.reporter=this.reporter;for(let z of W.event.trace)if(z.scope&&z.scope!=="local")this.trace(z);if(X){if(!(X in this.dependencies))this.dependencies[X]=[];const z=Y!==void 0?A4(X+JSON.stringify(Y)):0;if(!this.dependencies[X].some(({checksum:Q})=>z===Q))this.extender.macros=this.extender.macros.concat(W.extender.macros)}else this.extender.macros=this.extender.macros.concat(W.extender.macros);const J=[];for(let z=0;z<this.extender.macros.length;z++){const Q=this.extender.macros[z];if(Q.checksum){if(J.includes(Q.checksum))this.extender.macros.splice(z,1),z--;J.push(Q.checksum)}}this.inference={event:{body:this.inference.event.body||W.inference.event.body,cookie:this.inference.event.cookie||W.inference.event.cookie,headers:this.inference.event.headers||W.inference.event.headers,queries:[...this.inference.event.queries,...W.inference.event.queries],query:this.inference.event.query||W.inference.event.query,set:this.inference.event.set||W.inference.event.set,unknownQueries:this.inference.event.unknownQueries||W.inference.event.unknownQueries},trace:{request:this.inference.trace.request||W.inference.trace.request,parse:this.inference.trace.parse||W.inference.trace.parse,transform:this.inference.trace.transform||W.inference.trace.transform,handle:this.inference.trace.handle||W.inference.trace.handle,beforeHandle:this.inference.trace.beforeHandle||W.inference.trace.beforeHandle,afterHandle:this.inference.trace.afterHandle||W.inference.trace.afterHandle,error:this.inference.trace.error||W.inference.trace.error,context:this.inference.trace.context||W.inference.trace.context,store:this.inference.trace.store||W.inference.trace.store,set:this.inference.trace.set||W.inference.trace.set}}}this.decorate(W.singleton.decorator),this.state(W.singleton.store),this.model(W.definitions.type),this.error(W.definitions.error);for(let{method:J,path:z,handler:Q,hooks:G}of Object.values(W.router.history))this.add(J,z,Q,c1(G,{error:W.event.error}));if(!Z)if(X){if(!(X in this.dependencies))this.dependencies[X]=[];const J=Y!==void 0?A4(X+JSON.stringify(Y)):0;if(this.dependencies[X].some(({checksum:z})=>J===z))return this;this.dependencies[X].push(!this.config?.analytic?{name:W.config.name,seed:W.config.seed,checksum:J,dependencies:W.dependencies}:{name:W.config.name,seed:W.config.seed,checksum:J,dependencies:W.dependencies,stack:W.telemetry.stack,routes:W.router.history,decorators:W.singleton,store:W.singleton.store,type:W.definitions.type,error:W.definitions.error,derive:W.event.transform.filter((z)=>z?.subType==="derive").map((z)=>({fn:z.toString(),stack:new Error().stack??""})),resolve:W.event.transform.filter((z)=>z?.subType==="resolve").map((z)=>({fn:z.toString(),stack:new Error().stack??""}))}),this.event=o9(this.event,_J(W.event),J)}else this.event=o9(this.event,_J(W.event));return this}macro(W){const X={checksum:A4(JSON.stringify({name:this.config.name,seed:this.config.seed,content:W.toString()})),fn:W};return this.extender.macros.push(X),this}mount(W,X){if(W instanceof $||typeof W==="function"||W.length===0||W==="/"){const J=typeof W==="function"?W:W instanceof $?W.compile().fetch:X instanceof $?X.compile().fetch:X,z=async({request:Q,path:G})=>J(new Request(wJ(Q.url,G||"/"),Q));return this.all("/*",z,{type:"none"}),this}const Y=W.length;if(X instanceof $)X=X.compile().fetch;const Z=async({request:J,path:z})=>X(new Request(wJ(J.url,z.slice(Y)||"/"),J));return this.all(W,Z,{type:"none"}),this.all(W+(W.endsWith("/")?"*":"/*"),Z,{type:"none"}),this}get(W,X,Y){return this.add("GET",W,X,Y),this}post(W,X,Y){return this.add("POST",W,X,Y),this}put(W,X,Y){return this.add("PUT",W,X,Y),this}patch(W,X,Y){return this.add("PATCH",W,X,Y),this}delete(W,X,Y){return this.add("DELETE",W,X,Y),this}options(W,X,Y){return this.add("OPTIONS",W,X,Y),this}all(W,X,Y){return this.add("ALL",W,X,Y),this}head(W,X,Y){return this.add("HEAD",W,X,Y),this}connect(W,X,Y){return this.add("CONNECT",W,X,Y),this}route(W,X,Y,Z){return this.add(W.toUpperCase(),X,Y,Z,Z?.config),this}ws(W,X){const Y=X.transformMessage?Array.isArray(X.transformMessage)?X.transformMessage:[X.transformMessage]:void 0;let Z=null;const J=o1(X?.body,{models:this.definitions.type,normalize:this.config.normalize}),z=o1(X?.response,{models:this.definitions.type,normalize:this.config.normalize}),Q=(G)=>{if(typeof G==="string"){const A=G?.charCodeAt(0);if(A===47||A===123)try{G=JSON.parse(G)}catch{}else if(O4(G))G=+G}if(Y?.length)for(let A=0;A<Y.length;A++){const w=Y[A](G);if(w!==void 0)G=w}return G};return this.route("$INTERNALWS",W,(G)=>{const{set:A,path:w,qi:D,headers:O,query:L,params:B}=G;if(Z===null)Z=this.getServer();if(Z?.upgrade(G.request,{headers:typeof X.upgrade==="function"?X.upgrade(G):X.upgrade,data:{validator:z,open(M){X.open?.(new _4(M,G))},message:(M,H)=>{const K=Q(H);if(J?.Check(K)===!1)return void M.send(new p2("message",J,K).message);X.message?.(new _4(M,G),K)},drain(M){X.drain?.(new _4(M,G))},close(M,H,K){X.close?.(new _4(M,G),H,K)}}}))return;return A.status=400,"Expected a websocket connection"},{beforeHandle:X.beforeHandle,transform:X.transform,headers:X.headers,params:X.params,query:X.query}),this}state(W,X){switch(typeof W){case"object":return this.singleton.store=i1(this.singleton.store,W),this;case"function":return this.singleton.store=W(this.singleton.store),this}if(!(W in this.singleton.store))this.singleton.store[W]=X;return this}decorate(W,X){switch(typeof W){case"object":return this.singleton.decorator=i1(this.singleton.decorator,W),this;case"function":return this.singleton.decorator=W(this.singleton.decorator),this}if(!(W in this.singleton.decorator))this.singleton.decorator[W]=X;return this}derive(W,X){if(!X)X=W,W={as:"local"};const Y={subType:"derive",fn:X};return this.onTransform(W,Y)}model(W,X){switch(typeof W){case"object":return Object.entries(W).forEach(([Y,Z])=>{if(!(Y in this.definitions.type))this.definitions.type[Y]=Z}),this;case"function":return this.definitions.type=W(this.definitions.type),this}return this.definitions.type[W]=X,this}mapDerive(W,X){if(!X)X=W,W={as:"local"};const Y={subType:"derive",fn:X};return this.onTransform(W,Y)}affix(W,X,Y){if(Y==="")return this;const Z=["_","-"," "],J=(A)=>A[0].toUpperCase()+A.slice(1),z=W==="prefix"?(A,w)=>Z.includes(A.at(-1)??"")?A+w:A+J(w):Z.includes(Y.at(-1)??"")?(A,w)=>w+A:(A,w)=>w+J(A),Q=(A)=>{const w={};switch(A){case"decorator":for(let D in this.singleton.decorator)w[z(Y,D)]=this.singleton.decorator[D];this.singleton.decorator=w;break;case"state":for(let D in this.singleton.store)w[z(Y,D)]=this.singleton.store[D];this.singleton.store=w;break;case"model":for(let D in this.definitions.type)w[z(Y,D)]=this.definitions.type[D];this.definitions.type=w;break;case"error":for(let D in this.definitions.error)w[z(Y,D)]=this.definitions.error[D];this.definitions.error=w;break}},G=Array.isArray(X)?X:[X];for(let A of G.some((w)=>w==="all")?["decorator","state","model","error"]:G)Q(A);return this}prefix(W,X){return this.affix("prefix",W,X)}suffix(W,X){return this.affix("suffix",W,X)}compile(){if(this.fetch=this.config.aot?FJ(this):KJ(this),typeof this.server?.reload==="function")this.server.reload({...this.server||{},fetch:this.fetch});return this}get modules(){return Promise.all(this.promisedModules.promises)}};var l3=({extract:{body:$="access_token",query:W="access_token",header:X="Bearer"}={body:"access_token",query:"access_token",header:"Bearer"}}={extract:{body:"access_token",query:"access_token",header:"Bearer"}})=>new n0({name:"@elysiajs/bearer",seed:{body:$,query:W,header:X}}).derive(({query:Y,headers:{authorization:Z}})=>({get bearer(){if(Z?.startsWith(X))return Z.slice(X.length+1);const J=Y[W];if(J)return J}})),X6=l3;var Y6=crypto,H5=($)=>$ instanceof CryptoKey;function S4(...$){const W=$.reduce((Z,{length:J})=>Z+J,0),X=new Uint8Array(W);let Y=0;for(let Z of $)X.set(Z,Y),Y+=Z.length;return X}var O1=new TextEncoder,G8=new TextDecoder;var n3=($)=>{let W=$;if(typeof W==="string")W=O1.encode(W);const X=32768,Y=[];for(let Z=0;Z<W.length;Z+=X)Y.push(String.fromCharCode.apply(null,W.subarray(Z,Z+X)));return btoa(Y.join(""))},R4=($)=>{return n3($).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},t3=($)=>{const W=atob($),X=new Uint8Array(W.length);for(let Y=0;Y<W.length;Y++)X[Y]=W.charCodeAt(Y);return X},P4=($)=>{let W=$;if(W instanceof Uint8Array)W=G8.decode(W);W=W.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return t3(W)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class Z6 extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor($){super($);this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class t1 extends Z6{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor($,W,X="unspecified",Y="unspecified"){super($);this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=X,this.reason=Y,this.payload=W}}class E4 extends Z6{static get code(){return"ERR_JWT_EXPIRED"}constructor($,W,X="unspecified",Y="unspecified"){super($);this.code="ERR_JWT_EXPIRED",this.claim=X,this.reason=Y,this.payload=W}}class WX extends Z6{constructor(){super(...arguments);this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class J6 extends Z6{constructor(){super(...arguments);this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class H2 extends Z6{constructor(){super(...arguments);this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class j6 extends Z6{constructor(){super(...arguments);this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class XX extends Z6{constructor(){super(...arguments);this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}var u8=function($,W="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${W} must be ${$}`)},C4=function($,W){return $.name===W},YX=function($){return parseInt($.name.slice(4),10)},r3=function($){switch($){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}},a3=function($,W){if(W.length&&!W.some((X)=>$.usages.includes(X))){let X="CryptoKey does not support this operation, its usages must include ";if(W.length>2){const Y=W.pop();X+=`one of ${W.join(", ")}, or ${Y}.`}else if(W.length===2)X+=`one of ${W[0]} or ${W[1]}.`;else X+=`${W[0]}.`;throw new TypeError(X)}};function nJ($,W,...X){switch(W){case"HS256":case"HS384":case"HS512":{if(!C4($.algorithm,"HMAC"))throw u8("HMAC");const Y=parseInt(W.slice(2),10);if(YX($.algorithm.hash)!==Y)throw u8(`SHA-${Y}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!C4($.algorithm,"RSASSA-PKCS1-v1_5"))throw u8("RSASSA-PKCS1-v1_5");const Y=parseInt(W.slice(2),10);if(YX($.algorithm.hash)!==Y)throw u8(`SHA-${Y}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!C4($.algorithm,"RSA-PSS"))throw u8("RSA-PSS");const Y=parseInt(W.slice(2),10);if(YX($.algorithm.hash)!==Y)throw u8(`SHA-${Y}`,"algorithm.hash");break}case"EdDSA":{if($.algorithm.name!=="Ed25519"&&$.algorithm.name!=="Ed448")throw u8("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!C4($.algorithm,"ECDSA"))throw u8("ECDSA");const Y=r3(W);if($.algorithm.namedCurve!==Y)throw u8(Y,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}a3($,X)}var tJ=function($,W,...X){if(X.length>2){const Y=X.pop();$+=`one of type ${X.join(", ")}, or ${Y}.`}else if(X.length===2)$+=`one of type ${X[0]} or ${X[1]}.`;else $+=`of type ${X[0]}.`;if(W==null)$+=` Received ${W}`;else if(typeof W==="function"&&W.name)$+=` Received function ${W.name}`;else if(typeof W==="object"&&W!=null){if(W.constructor?.name)$+=` Received an instance of ${W.constructor.name}`}return $};function JX($,W,...X){return tJ(`Key for the ${$} algorithm must be `,W,...X)}var ZX=($,...W)=>{return tJ("Key must be ",$,...W)};var zX=($)=>{return H5($)},s1=["CryptoKey"];var e3=(...$)=>{const W=$.filter(Boolean);if(W.length===0||W.length===1)return!0;let X;for(let Y of W){const Z=Object.keys(Y);if(!X||X.size===0){X=new Set(Z);continue}for(let J of Z){if(X.has(J))return!1;X.add(J)}}return!0},q4=e3;var $L=function($){return typeof $==="object"&&$!==null};function z6($){if(!$L($)||Object.prototype.toString.call($)!=="[object Object]")return!1;if(Object.getPrototypeOf($)===null)return!0;let W=$;while(Object.getPrototypeOf(W)!==null)W=Object.getPrototypeOf(W);return Object.getPrototypeOf($)===W}var V4=($,W)=>{if($.startsWith("RS")||$.startsWith("PS")){const{modulusLength:X}=W.algorithm;if(typeof X!=="number"||X<2048)throw new TypeError(`${$} requires key modulusLength to be 2048 bits or larger`)}};var Q6=($,W,X=0)=>{if(X===0)W.unshift(W.length),W.unshift(6);const Y=$.indexOf(W[0],X);if(Y===-1)return!1;const Z=$.subarray(Y,Y+W.length);if(Z.length!==W.length)return!1;return Z.every((J,z)=>J===W[z])||Q6($,W,Y+1)},sJ=($)=>{switch(!0){case Q6($,[42,134,72,206,61,3,1,7]):return"P-256";case Q6($,[43,129,4,0,34]):return"P-384";case Q6($,[43,129,4,0,35]):return"P-521";case Q6($,[43,101,110]):return"X25519";case Q6($,[43,101,111]):return"X448";case Q6($,[43,101,112]):return"Ed25519";case Q6($,[43,101,113]):return"Ed448";default:throw new J6("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},rJ=async($,W,X,Y,Z)=>{let J,z;const Q=new Uint8Array(atob(X.replace($,"")).split("").map((A)=>A.charCodeAt(0))),G=W==="spki";switch(Y){case"PS256":case"PS384":case"PS512":J={name:"RSA-PSS",hash:`SHA-${Y.slice(-3)}`},z=G?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":J={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${Y.slice(-3)}`},z=G?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":J={name:"RSA-OAEP",hash:`SHA-${parseInt(Y.slice(-3),10)||1}`},z=G?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":J={name:"ECDSA",namedCurve:"P-256"},z=G?["verify"]:["sign"];break;case"ES384":J={name:"ECDSA",namedCurve:"P-384"},z=G?["verify"]:["sign"];break;case"ES512":J={name:"ECDSA",namedCurve:"P-521"},z=G?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{const A=sJ(Q);J=A.startsWith("P-")?{name:"ECDH",namedCurve:A}:{name:A},z=G?[]:["deriveBits"];break}case"EdDSA":J={name:sJ(Q)},z=G?["verify"]:["sign"];break;default:throw new J6('Invalid or unsupported "alg" (Algorithm) value')}return Y6.subtle.importKey(W,Q,J,Z?.extractable??!1,z)},aJ=($,W,X)=>{return rJ(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",$,W,X)},eJ=($,W,X)=>{return rJ(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",$,W,X)};async function QX($,W,X){if(typeof $!=="string"||$.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return eJ($,W,X)}async function GX($,W,X){if(typeof $!=="string"||$.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return aJ($,W,X)}var WL=($,W)=>{if(W instanceof Uint8Array)return;if(!zX(W))throw new TypeError(JX($,W,...s1,"Uint8Array"));if(W.type!=="secret")throw new TypeError(`${s1.join(" or ")} instances for symmetric algorithms must be of type "secret"`)},XL=($,W,X)=>{if(!zX(W))throw new TypeError(JX($,W,...s1));if(W.type==="secret")throw new TypeError(`${s1.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(X==="sign"&&W.type==="public")throw new TypeError(`${s1.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(X==="decrypt"&&W.type==="public")throw new TypeError(`${s1.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(W.algorithm&&X==="verify"&&W.type==="private")throw new TypeError(`${s1.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(W.algorithm&&X==="encrypt"&&W.type==="private")throw new TypeError(`${s1.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},YL=($,W,X)=>{if($.startsWith("HS")||$==="dir"||$.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test($))WL($,W);else XL($,W,X)},j4=YL;var ZL=function($,W,X,Y,Z){if(Z.crit!==void 0&&Y?.crit===void 0)throw new $('"crit" (Critical) Header Parameter MUST be integrity protected');if(!Y||Y.crit===void 0)return new Set;if(!Array.isArray(Y.crit)||Y.crit.length===0||Y.crit.some((z)=>typeof z!=="string"||z.length===0))throw new $('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let J;if(X!==void 0)J=new Map([...Object.entries(X),...W.entries()]);else J=W;for(let z of Y.crit){if(!J.has(z))throw new J6(`Extension Header Parameter "${z}" is not recognized`);if(Z[z]===void 0)throw new $(`Extension Header Parameter "${z}" is missing`);if(J.get(z)&&Y[z]===void 0)throw new $(`Extension Header Parameter "${z}" MUST be integrity protected`)}return new Set(Y.crit)},I4=ZL;var JL=($,W)=>{if(W!==void 0&&(!Array.isArray(W)||W.some((X)=>typeof X!=="string")))throw new TypeError(`"${$}" option must be an array of strings`);if(!W)return;return new Set(W)},$z=JL;function D5($,W){const X=`SHA-${$.slice(-3)}`;switch($){case"HS256":case"HS384":case"HS512":return{hash:X,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:X,name:"RSA-PSS",saltLength:$.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:X,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:X,name:"ECDSA",namedCurve:W.namedCurve};case"EdDSA":return{name:W.name};default:throw new J6(`alg ${$} is not supported either by JOSE or your javascript runtime`)}}function B5($,W,X){if(H5(W))return nJ(W,$,X),W;if(W instanceof Uint8Array){if(!$.startsWith("HS"))throw new TypeError(ZX(W,...s1));return Y6.subtle.importKey("raw",W,{hash:`SHA-${$.slice(-3)}`,name:"HMAC"},!1,[X])}throw new TypeError(ZX(W,...s1,"Uint8Array"))}var zL=async($,W,X,Y)=>{const Z=await B5($,W,"verify");V4($,Z);const J=D5($,Z.algorithm);try{return await Y6.subtle.verify(J,Z,X,Y)}catch{return!1}},Wz=zL;async function Xz($,W,X){if(!z6($))throw new H2("Flattened JWS must be an object");if($.protected===void 0&&$.header===void 0)throw new H2('Flattened JWS must have either of the "protected" or "header" members');if($.protected!==void 0&&typeof $.protected!=="string")throw new H2("JWS Protected Header incorrect type");if($.payload===void 0)throw new H2("JWS Payload missing");if(typeof $.signature!=="string")throw new H2("JWS Signature missing or incorrect type");if($.header!==void 0&&!z6($.header))throw new H2("JWS Unprotected Header incorrect type");let Y={};if($.protected)try{const M=P4($.protected);Y=JSON.parse(G8.decode(M))}catch{throw new H2("JWS Protected Header is invalid")}if(!q4(Y,$.header))throw new H2("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const Z={...Y,...$.header},J=I4(H2,new Map([["b64",!0]]),X?.crit,Y,Z);let z=!0;if(J.has("b64")){if(z=Y.b64,typeof z!=="boolean")throw new H2('The "b64" (base64url-encode payload) Header Parameter must be a boolean')}const{alg:Q}=Z;if(typeof Q!=="string"||!Q)throw new H2('JWS "alg" (Algorithm) Header Parameter missing or invalid');const G=X&&$z("algorithms",X.algorithms);if(G&&!G.has(Q))throw new WX('"alg" (Algorithm) Header Parameter value not allowed');if(z){if(typeof $.payload!=="string")throw new H2("JWS Payload must be a string")}else if(typeof $.payload!=="string"&&!($.payload instanceof Uint8Array))throw new H2("JWS Payload must be a string or an Uint8Array instance");let A=!1;if(typeof W==="function")W=await W(Y,$),A=!0;j4(Q,W,"verify");const w=S4(O1.encode($.protected??""),O1.encode("."),typeof $.payload==="string"?O1.encode($.payload):$.payload);let D;try{D=P4($.signature)}catch{throw new H2("Failed to base64url decode the signature")}if(!await Wz(Q,W,D,w))throw new XX;let L;if(z)try{L=P4($.payload)}catch{throw new H2("Failed to base64url decode the payload")}else if(typeof $.payload==="string")L=O1.encode($.payload);else L=$.payload;const B={payload:L};if($.protected!==void 0)B.protectedHeader=Y;if($.header!==void 0)B.unprotectedHeader=$.header;if(A)return{...B,key:W};return B}async function Yz($,W,X){if($ instanceof Uint8Array)$=G8.decode($);if(typeof $!=="string")throw new H2("Compact JWS must be a string or Uint8Array");const{0:Y,1:Z,2:J,length:z}=$.split(".");if(z!==3)throw new H2("Invalid Compact JWS");const Q=await Xz({payload:Z,protected:Y,signature:J},W,X),G={payload:Q.payload,protectedHeader:Q.protectedHeader};if(typeof W==="function")return{...G,key:Q.key};return G}var V8=($)=>Math.floor($.getTime()/1000);var QL=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,I6=($)=>{const W=QL.exec($);if(!W||W[4]&&W[1])throw new TypeError("Invalid time period format");const X=parseFloat(W[2]),Y=W[3].toLowerCase();let Z;switch(Y){case"sec":case"secs":case"second":case"seconds":case"s":Z=Math.round(X);break;case"minute":case"minutes":case"min":case"mins":case"m":Z=Math.round(X*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":Z=Math.round(X*3600);break;case"day":case"days":case"d":Z=Math.round(X*86400);break;case"week":case"weeks":case"w":Z=Math.round(X*604800);break;default:Z=Math.round(X*31557600);break}if(W[1]==="-"||W[4]==="ago")return-Z;return Z};var Zz=($)=>$.toLowerCase().replace(/^application\//,""),GL=($,W)=>{if(typeof $==="string")return W.includes($);if(Array.isArray($))return W.some(Set.prototype.has.bind(new Set($)));return!1},Jz=($,W,X={})=>{let Y;try{Y=JSON.parse(G8.decode(W))}catch{}if(!z6(Y))throw new j6("JWT Claims Set must be a top-level JSON object");const{typ:Z}=X;if(Z&&(typeof $.typ!=="string"||Zz($.typ)!==Zz(Z)))throw new t1('unexpected "typ" JWT header value',Y,"typ","check_failed");const{requiredClaims:J=[],issuer:z,subject:Q,audience:G,maxTokenAge:A}=X,w=[...J];if(A!==void 0)w.push("iat");if(G!==void 0)w.push("aud");if(Q!==void 0)w.push("sub");if(z!==void 0)w.push("iss");for(let B of new Set(w.reverse()))if(!(B in Y))throw new t1(`missing required "${B}" claim`,Y,B,"missing");if(z&&!(Array.isArray(z)?z:[z]).includes(Y.iss))throw new t1('unexpected "iss" claim value',Y,"iss","check_failed");if(Q&&Y.sub!==Q)throw new t1('unexpected "sub" claim value',Y,"sub","check_failed");if(G&&!GL(Y.aud,typeof G==="string"?[G]:G))throw new t1('unexpected "aud" claim value',Y,"aud","check_failed");let D;switch(typeof X.clockTolerance){case"string":D=I6(X.clockTolerance);break;case"number":D=X.clockTolerance;break;case"undefined":D=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:O}=X,L=V8(O||new Date);if((Y.iat!==void 0||A)&&typeof Y.iat!=="number")throw new t1('"iat" claim must be a number',Y,"iat","invalid");if(Y.nbf!==void 0){if(typeof Y.nbf!=="number")throw new t1('"nbf" claim must be a number',Y,"nbf","invalid");if(Y.nbf>L+D)throw new t1('"nbf" claim timestamp check failed',Y,"nbf","check_failed")}if(Y.exp!==void 0){if(typeof Y.exp!=="number")throw new t1('"exp" claim must be a number',Y,"exp","invalid");if(Y.exp<=L-D)throw new E4('"exp" claim timestamp check failed',Y,"exp","check_failed")}if(A){const B=L-Y.iat,M=typeof A==="number"?A:I6(A);if(B-D>M)throw new E4('"iat" claim timestamp check failed (too far in the past)',Y,"iat","check_failed");if(B<0-D)throw new t1('"iat" claim timestamp check failed (it should be in the past)',Y,"iat","check_failed")}return Y};async function UX($,W,X){const Y=await Yz($,W,X);if(Y.protectedHeader.crit?.includes("b64")&&Y.protectedHeader.b64===!1)throw new j6("JWTs MUST NOT use unencoded payload");const J={payload:Jz(Y.protectedHeader,Y.payload,X),protectedHeader:Y.protectedHeader};if(typeof W==="function")return{...J,key:Y.key};return J}var UL=async($,W,X)=>{const Y=await B5($,W,"sign");V4($,Y);const Z=await Y6.subtle.sign(D5($,Y.algorithm),Y,X);return new Uint8Array(Z)},zz=UL;class MX{constructor($){if(!($ instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=$}setProtectedHeader($){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=$,this}setUnprotectedHeader($){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=$,this}async sign($,W){if(!this._protectedHeader&&!this._unprotectedHeader)throw new H2("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!q4(this._protectedHeader,this._unprotectedHeader))throw new H2("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const X={...this._protectedHeader,...this._unprotectedHeader},Y=I4(H2,new Map([["b64",!0]]),W?.crit,this._protectedHeader,X);let Z=!0;if(Y.has("b64")){if(Z=this._protectedHeader.b64,typeof Z!=="boolean")throw new H2('The "b64" (base64url-encode payload) Header Parameter must be a boolean')}const{alg:J}=X;if(typeof J!=="string"||!J)throw new H2('JWS "alg" (Algorithm) Header Parameter missing or invalid');j4(J,$,"sign");let z=this._payload;if(Z)z=O1.encode(R4(z));let Q;if(this._protectedHeader)Q=O1.encode(R4(JSON.stringify(this._protectedHeader)));else Q=O1.encode("");const G=S4(Q,O1.encode("."),z),A=await zz(J,$,G),w={signature:R4(A),payload:""};if(Z)w.payload=G8.decode(z);if(this._unprotectedHeader)w.header=this._unprotectedHeader;if(this._protectedHeader)w.protected=G8.decode(Q);return w}}class wX{constructor($){this._flattened=new MX($)}setProtectedHeader($){return this._flattened.setProtectedHeader($),this}async sign($,W){const X=await this._flattened.sign($,W);if(X.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${X.protected}.${X.payload}.${X.signature}`}}var b6=function($,W){if(!Number.isFinite(W))throw new TypeError(`Invalid ${$} input`);return W};class AX{constructor($={}){if(!z6($))throw new TypeError("JWT Claims Set MUST be an object");this._payload=$}setIssuer($){return this._payload={...this._payload,iss:$},this}setSubject($){return this._payload={...this._payload,sub:$},this}setAudience($){return this._payload={...this._payload,aud:$},this}setJti($){return this._payload={...this._payload,jti:$},this}setNotBefore($){if(typeof $==="number")this._payload={...this._payload,nbf:b6("setNotBefore",$)};else if($ instanceof Date)this._payload={...this._payload,nbf:b6("setNotBefore",V8($))};else this._payload={...this._payload,nbf:V8(new Date)+I6($)};return this}setExpirationTime($){if(typeof $==="number")this._payload={...this._payload,exp:b6("setExpirationTime",$)};else if($ instanceof Date)this._payload={...this._payload,exp:b6("setExpirationTime",V8($))};else this._payload={...this._payload,exp:V8(new Date)+I6($)};return this}setIssuedAt($){if(typeof $==="undefined")this._payload={...this._payload,iat:V8(new Date)};else if($ instanceof Date)this._payload={...this._payload,iat:b6("setIssuedAt",V8($))};else if(typeof $==="string")this._payload={...this._payload,iat:b6("setIssuedAt",V8(new Date)+I6($))};else this._payload={...this._payload,iat:b6("setIssuedAt",$)};return this}}class b4 extends AX{setProtectedHeader($){return this._protectedHeader=$,this}async sign($,W){const X=new wX(O1.encode(JSON.stringify(this._payload)));if(X.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new j6("JWTs MUST NOT use unencoded payload");return X.sign($,W)}}var n4={};n8(n4,{usersTable:()=>{{return J2}},transactionsTable:()=>{{return M8}},transactionTypeTable:()=>{{return UQ}},transactionTagsTable:()=>{{return o8}},tagsTable:()=>{{return w8}}});var W0=function($,W){if(!$||typeof $!=="object")return!1;if($ instanceof W)return!0;if(!Object.prototype.hasOwnProperty.call(W,o))throw new Error(`Class "${W.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let X=$.constructor;if(X)while(X){if(o in X&&X[o]===W[o])return!0;X=Object.getPrototypeOf(X)}return!1},o=Symbol.for("drizzle:entityKind"),Jm=Symbol.for("drizzle:hasOwnEntityKind");class D2{constructor($,W){this.table=$,this.config=W,this.name=W.name,this.notNull=W.notNull,this.default=W.default,this.defaultFn=W.defaultFn,this.hasDefault=W.hasDefault,this.primary=W.primaryKey,this.isUnique=W.isUnique,this.uniqueName=W.uniqueName,this.uniqueType=W.uniqueType,this.dataType=W.dataType,this.columnType=W.columnType}static[o]="Column";name;primary;notNull;default;defaultFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue($){return $}mapToDriverValue($){return $}}var I2=Symbol.for("drizzle:SubqueryConfig");class n2{static[o]="Subquery";[I2];constructor($,W,X,Y=!1){this[I2]={sql:$,selection:W,alias:X,isWith:Y}}}class O5 extends n2{static[o]="WithSubquery"}var x4=function($,...W){return $(...W)};var Qz="0.29.5";var _X,HX,G2={startActiveSpan($,W){if(!_X)return W();if(!HX)HX=_X.trace.getTracer("drizzle-orm",Qz);return x4((X,Y)=>Y.startActiveSpan($,(Z)=>{try{return W(Z)}catch(J){throw Z.setStatus({code:X.SpanStatusCode.ERROR,message:J instanceof Error?J.message:"Unknown error"}),J}finally{Z.end()}}),_X,HX)}};var K2=Symbol.for("drizzle:ViewBaseConfig");var Az=function($){return typeof $==="object"&&$!==null&&wz in $},G6=function($){return $[k4]},k4=Symbol.for("drizzle:Name"),DX=Symbol.for("drizzle:Schema"),Gz=Symbol.for("drizzle:Columns"),BX=Symbol.for("drizzle:OriginalName"),OX=Symbol.for("drizzle:BaseName"),Uz=Symbol.for("drizzle:IsAlias"),Mz=Symbol.for("drizzle:ExtraConfigBuilder"),wz=Symbol.for("drizzle:IsDrizzleTable");class w0{static[o]="Table";static Symbol={Name:k4,Schema:DX,OriginalName:BX,Columns:Gz,BaseName:OX,IsAlias:Uz,ExtraConfigBuilder:Mz};[k4];[BX];[DX];[Gz];[OX];[Uz]=!1;[Mz]=void 0;[wz]=!0;constructor($,W,X){this[k4]=this[BX]=$,this[DX]=W,this[OX]=X}}var NX=function($){return typeof $==="object"&&$!==null&&"getSQL"in $&&typeof $.getSQL==="function"},wL=function($){const W={sql:"",params:[]};for(let X of $)if(W.sql+=X.sql,W.params.push(...X.params),X.typings?.length){if(!W.typings)W.typings=[];W.typings.push(...X.typings)}return W};var _z=function($){return typeof $==="object"&&$!==null&&"mapToDriverValue"in $&&typeof $.mapToDriverValue==="function"};var y=function($,...W){const X=[];if(W.length>0||$.length>0&&$[0]!=="")X.push(new y2($[0]));for(let[Y,Z]of W.entries())X.push(Z,new y2($[Y+1]));return new B0(X)};var x6=function($,W){return $.map((X)=>{if(W0(X,G$)){if(!(X.name in W))throw new Error(`No value for placeholder "${X.name}" was provided`);return W[X.name]}return X})};class y2{static[o]="StringChunk";value;constructor($){this.value=Array.isArray($)?$:[$]}getSQL(){return new B0([this])}}class B0{constructor($){this.queryChunks=$}static[o]="SQL";decoder=Hz;shouldInlineParams=!1;append($){return this.queryChunks.push(...$.queryChunks),this}toQuery($){return G2.startActiveSpan("drizzle.buildSQL",(W)=>{const X=this.buildQueryFromSourceParams(this.queryChunks,$);return W?.setAttributes({"drizzle.query.text":X.sql,"drizzle.query.params":JSON.stringify(X.params)}),X})}buildQueryFromSourceParams($,W){const X=Object.assign({},W,{inlineParams:W.inlineParams||this.shouldInlineParams,paramStartIndex:W.paramStartIndex||{value:0}}),{escapeName:Y,escapeParam:Z,prepareTyping:J,inlineParams:z,paramStartIndex:Q}=X;return wL($.map((G)=>{if(W0(G,y2))return{sql:G.value.join(""),params:[]};if(W0(G,T4))return{sql:Y(G.value),params:[]};if(G===void 0)return{sql:"",params:[]};if(Array.isArray(G)){const A=[new y2("(")];for(let[w,D]of G.entries())if(A.push(D),w<G.length-1)A.push(new y2(", "));return A.push(new y2(")")),this.buildQueryFromSourceParams(A,X)}if(W0(G,B0))return this.buildQueryFromSourceParams(G.queryChunks,{...X,inlineParams:z||G.shouldInlineParams});if(W0(G,w0)){const A=G[w0.Symbol.Schema],w=G[w0.Symbol.Name];return{sql:A===void 0?Y(w):Y(A)+"."+Y(w),params:[]}}if(W0(G,D2))return{sql:Y(G.table[w0.Symbol.Name])+"."+Y(G.name),params:[]};if(W0(G,N1)){const A=G[K2].schema,w=G[K2].name;return{sql:A===void 0?Y(w):Y(A)+"."+Y(w),params:[]}}if(W0(G,r1)){const A=G.value===null?null:G.encoder.mapToDriverValue(G.value);if(W0(A,B0))return this.buildQueryFromSourceParams([A],X);if(z)return{sql:this.mapInlineParam(A,X),params:[]};let w;if(J!==void 0)w=[J(G.encoder)];return{sql:Z(Q.value++,A),params:[A],typings:w}}if(W0(G,G$))return{sql:Z(Q.value++,G),params:[G]};if(W0(G,B0.Aliased)&&G.fieldAlias!==void 0)return{sql:Y(G.fieldAlias),params:[]};if(W0(G,n2)){if(G[I2].isWith)return{sql:Y(G[I2].alias),params:[]};return this.buildQueryFromSourceParams([new y2("("),G[I2].sql,new y2(") "),new T4(G[I2].alias)],X)}if(NX(G))return this.buildQueryFromSourceParams([new y2("("),G.getSQL(),new y2(")")],X);if(z)return{sql:this.mapInlineParam(G,X),params:[]};return{sql:Z(Q.value++,G),params:[G]}}))}mapInlineParam($,{escapeString:W}){if($===null)return"null";if(typeof $==="number"||typeof $==="boolean")return $.toString();if(typeof $==="string")return W($);if(typeof $==="object"){const X=$.toString();if(X==="[object Object]")return W(JSON.stringify($));return W(X)}throw new Error("Unexpected param value: "+$)}getSQL(){return this}as($){if($===void 0)return this;return new B0.Aliased(this,$)}mapWith($){return this.decoder=typeof $==="function"?{mapFromDriverValue:$}:$,this}inlineParams(){return this.shouldInlineParams=!0,this}}class T4{constructor($){this.value=$}static[o]="Name";brand;getSQL(){return new B0([this])}}var Hz={mapFromDriverValue:($)=>$},Dz={mapToDriverValue:($)=>$},Em={...Hz,...Dz};class r1{constructor($,W=Dz){this.value=$,this.encoder=W}static[o]="Param";brand;getSQL(){return new B0([this])}}(($)=>{function W(){return new B0([])}$.empty=W;function X(G){return new B0(G)}$.fromList=X;function Y(G){return new B0([new y2(G)])}$.raw=Y;function Z(G,A){const w=[];for(let[D,O]of G.entries()){if(D>0&&A!==void 0)w.push(A);w.push(O)}return new B0(w)}$.join=Z;function J(G){return new T4(G)}$.identifier=J;function z(G){return new G$(G)}$.placeholder=z;function Q(G,A){return new r1(G,A)}$.param=Q})(y||(y={}));(($)=>{class W{constructor(X,Y){this.sql=X,this.fieldAlias=Y}static[o]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new W(this.sql,this.fieldAlias)}}$.Aliased=W})(B0||(B0={}));class G${constructor($){this.name=$}static[o]="Placeholder";getSQL(){return new B0([this])}}class N1{static[o]="View";[K2];constructor({name:$,schema:W,selectedFields:X,query:Y}){this[K2]={name:$,originalName:$,schema:W,selectedFields:X,query:Y,isExisting:!Y,isAlias:!1}}getSQL(){return new B0([this])}}D2.prototype.getSQL=function(){return new B0([this])};w0.prototype.getSQL=function(){return new B0([this])};n2.prototype.getSQL=function(){return new B0([this])};var g4=function($,W){return new Proxy($,new N5(W,!1))};var j8=function($,W){return new Proxy($,new U$(new Proxy($.table,new N5(W,!1))))},LX=function($,W){return new B0.Aliased(L5($.sql,W),$.fieldAlias)},L5=function($,W){return y.join($.queryChunks.map((X)=>{if(W0(X,D2))return j8(X,W);if(W0(X,B0))return L5(X,W);if(W0(X,B0.Aliased))return LX(X,W);return X}))};class U${constructor($){this.table=$}static[o]="ColumnAliasProxyHandler";get($,W){if(W==="table")return this.table;return $[W]}}class N5{constructor($,W){this.alias=$,this.replaceOriginalName=W}static[o]="TableAliasProxyHandler";get($,W){if(W===w0.Symbol.IsAlias)return!0;if(W===w0.Symbol.Name)return this.alias;if(this.replaceOriginalName&&W===w0.Symbol.OriginalName)return this.alias;if(W===K2)return{...$[K2],name:this.alias,isAlias:!0};if(W===w0.Symbol.Columns){const Y=$[w0.Symbol.Columns];if(!Y)return Y;const Z={};return Object.keys(Y).map((J)=>{Z[J]=new Proxy(Y[J],new U$(new Proxy($,this)))}),Z}const X=$[W];if(W0(X,D2))return new Proxy(X,new U$(new Proxy($,this)));return X}}class FX{static[o]="ColumnBuilder";config;constructor($,W,X){this.config={name:$,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:W,columnType:X}}$type(){return this}notNull(){return this.config.notNull=!0,this}default($){return this.config.default=$,this.config.hasDefault=!0,this}$defaultFn($){return this.config.defaultFn=$,this.config.hasDefault=!0,this}$default=this.$defaultFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}}var AL=function($,W,X,Y,Z=$){const J=new $1($,Y,Z),z=Object.fromEntries(Object.entries(W).map(([G,A])=>{const w=A,D=w.build(J);return J[KX].push(...w.buildForeignKeys(D,J)),[G,D]})),Q=Object.assign(J,z);if(Q[w0.Symbol.Columns]=z,X)Q[$1.Symbol.ExtraConfigBuilder]=X;return Q};var KX=Symbol.for("drizzle:PgInlineForeignKeys");class $1 extends w0{static[o]="PgTable";static Symbol=Object.assign({},w0.Symbol,{InlineForeignKeys:KX});[KX]=[];[w0.Symbol.ExtraConfigBuilder]=void 0}var M$=($,W,X)=>{return AL($,W,X,void 0)};class SX{static[o]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor($,W){if(this.reference=()=>{const{name:X,columns:Y,foreignColumns:Z}=$();return{name:X,columns:Y,foreignTable:Z[0].table,foreignColumns:Z}},W)this._onUpdate=W.onUpdate,this._onDelete=W.onDelete}onUpdate($){return this._onUpdate=$===void 0?"no action":$,this}onDelete($){return this._onDelete=$===void 0?"no action":$,this}build($){return new Bz($,this)}}class Bz{constructor($,W){this.table=$,this.reference=W.reference,this.onUpdate=W._onUpdate,this.onDelete=W._onDelete}static[o]="PgForeignKey";reference;onUpdate;onDelete;getName(){const{name:$,columns:W,foreignColumns:X}=this.reference(),Y=W.map((z)=>z.name),Z=X.map((z)=>z.name),J=[this.table[$1.Symbol.Name],...Y,X[0].table[$1.Symbol.Name],...Z];return $??`${J.join("_")}_fk`}}var Oz=function($,W){return`${$[$1.Symbol.Name]}_${W.join("_")}_unique`};var Nz=function($,W,X){for(let Y=W;Y<$.length;Y++){const Z=$[Y];if(Z==="\\"){Y++;continue}if(Z==='"')return[$.slice(W,Y).replace(/\\/g,""),Y+1];if(X)continue;if(Z===","||Z==="}")return[$.slice(W,Y).replace(/\\/g,""),Y]}return[$.slice(W).replace(/\\/g,""),$.length]},Lz=function($,W=0){const X=[];let Y=W,Z=!1;while(Y<$.length){const J=$[Y];if(J===","){if(Z||Y===W)X.push("");Z=!0,Y++;continue}if(Z=!1,J==="\\"){Y+=2;continue}if(J==='"'){const[G,A]=Nz($,Y+1,!0);X.push(G),Y=A;continue}if(J==="}")return[X,Y+1];if(J==="{"){const[G,A]=Lz($,Y+1);X.push(G),Y=A;continue}const[z,Q]=Nz($,Y,!1);X.push(z),Y=Q}return[X,Y]},Fz=function($){const[W]=Lz($,1);return W},RX=function($){return`{${$.map((W)=>{if(Array.isArray(W))return RX(W);if(typeof W==="string")return`"${W.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`;return`${W}`}).join(",")}}`};class L1 extends FX{foreignKeyConfigs=[];static[o]="PgColumnBuilder";array($){return new Kz(this.config.name,this,$)}references($,W={}){return this.foreignKeyConfigs.push({ref:$,actions:W}),this}unique($,W){return this.config.isUnique=!0,this.config.uniqueName=$,this.config.uniqueType=W?.nulls,this}buildForeignKeys($,W){return this.foreignKeyConfigs.map(({ref:X,actions:Y})=>{return x4((Z,J)=>{const z=new SX(()=>{const Q=Z();return{columns:[$],foreignColumns:[Q]}});if(J.onUpdate)z.onUpdate(J.onUpdate);if(J.onDelete)z.onDelete(J.onDelete);return z.build(W)},X,Y)})}}class U2 extends D2{constructor($,W){if(!W.uniqueName)W.uniqueName=Oz($,[W.name]);super($,W);this.table=$}static[o]="PgColumn"}class Kz extends L1{static[o]="PgArrayBuilder";constructor($,W,X){super($,"array","PgArray");this.config.baseBuilder=W,this.config.size=X}build($){const W=this.config.baseBuilder.build($);return new PX($,this.config,W)}}class PX extends U2{constructor($,W,X,Y){super($,W);this.baseColumn=X,this.range=Y,this.size=W.size}size;static[o]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size==="number"?this.size:""}]`}mapFromDriverValue($){if(typeof $==="string")$=Fz($);return $.map((W)=>this.baseColumn.mapFromDriverValue(W))}mapToDriverValue($,W=!1){const X=$.map((Y)=>Y===null?null:W0(this.baseColumn,PX)?this.baseColumn.mapToDriverValue(Y,!0):this.baseColumn.mapToDriverValue(Y));if(W)return X;return RX(X)}}class f4 extends L1{static[o]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}}class EX extends U2{static[o]="PgDate";getSQLType(){return"date"}mapFromDriverValue($){return new Date($)}mapToDriverValue($){return $.toISOString()}}var U8=function($){return new Sz($)};class Sz extends L1{static[o]="PgIntegerBuilder";constructor($){super($,"number","PgInteger")}build($){return new Rz($,this.config)}}class Rz extends U2{static[o]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue($){if(typeof $==="string")return Number.parseInt($);return $}}class CX extends U2{static[o]="PgJson";constructor($,W){super($,W)}getSQLType(){return"json"}mapToDriverValue($){return JSON.stringify($)}mapFromDriverValue($){if(typeof $==="string")try{return JSON.parse($)}catch{return $}return $}}class qX extends U2{static[o]="PgJsonb";constructor($,W){super($,W)}getSQLType(){return"jsonb"}mapToDriverValue($){return JSON.stringify($)}mapFromDriverValue($){if(typeof $==="string")try{return JSON.parse($)}catch{return $}return $}}class VX extends U2{static[o]="PgNumeric";precision;scale;constructor($,W){super($,W);this.precision=W.precision,this.scale=W.scale}getSQLType(){if(this.precision!==void 0&&this.scale!==void 0)return`numeric(${this.precision}, ${this.scale})`;else if(this.precision===void 0)return"numeric";else return`numeric(${this.precision})`}}var Cz=function($){return new Pz($)};class Pz extends L1{static[o]="PgSerialBuilder";constructor($){super($,"number","PgSerial");this.config.hasDefault=!0,this.config.notNull=!0}build($){return new Ez($,this.config)}}class Ez extends U2{static[o]="PgSerial";getSQLType(){return"serial"}}var Q1=function($,W={}){return new qz($,W)};class qz extends L1{static[o]="PgTextBuilder";constructor($,W){super($,"string","PgText");this.config.enumValues=W.enum}build($){return new Vz($,this.config)}}class Vz extends U2{static[o]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}class jX extends U2{static[o]="PgTime";withTimezone;precision;constructor($,W){super($,W);this.withTimezone=W.withTimezone,this.precision=W.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}var d4=function($,W={}){if(W.mode==="string")return new Iz($,W.withTimezone??!1,W.precision);return new jz($,W.withTimezone??!1,W.precision)};class jz extends f4{static[o]="PgTimestampBuilder";constructor($,W,X){super($,"date","PgTimestamp");this.config.withTimezone=W,this.config.precision=X}build($){return new y4($,this.config)}}class y4 extends U2{static[o]="PgTimestamp";withTimezone;precision;constructor($,W){super($,W);this.withTimezone=W.withTimezone,this.precision=W.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=($)=>{return new Date(this.withTimezone?$:$+"+0000")};mapToDriverValue=($)=>{return this.withTimezone?$.toUTCString():$.toISOString()}}class Iz extends f4{static[o]="PgTimestampStringBuilder";constructor($,W,X){super($,"string","PgTimestampString");this.config.withTimezone=W,this.config.precision=X}build($){return new bz($,this.config)}}class bz extends U2{static[o]="PgTimestampString";withTimezone;precision;constructor($,W){super($,W);this.withTimezone=W.withTimezone,this.precision=W.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}class IX extends U2{static[o]="PgUUID";getSQLType(){return"uuid"}}class G1{static[o]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch($){return this.then(void 0,$)}finally($){return this.then((W)=>{return $?.(),W},(W)=>{throw $?.(),W})}then($,W){return this.execute().then($,W)}}var v4=function($,W,X){const Y={},Z=$.reduce((J,{path:z,field:Q},G)=>{let A;if(W0(Q,D2))A=Q;else if(W0(Q,B0))A=Q.decoder;else A=Q.sql.decoder;let w=J;for(let[D,O]of z.entries())if(D<z.length-1){if(!(O in w))w[O]={};w=w[O]}else{const L=W[G],B=w[O]=L===null?null:A.mapFromDriverValue(L);if(X&&W0(Q,D2)&&z.length===2){const M=z[0];if(!(M in Y))Y[M]=B===null?G6(Q.table):!1;else if(typeof Y[M]==="string"&&Y[M]!==G6(Q.table))Y[M]=!1}}return J},{});if(X&&Object.keys(Y).length>0){for(let[J,z]of Object.entries(Y))if(typeof z==="string"&&!X[z])Z[J]=null}return Z},a1=function($,W){return Object.entries($).reduce((X,[Y,Z])=>{if(typeof Y!=="string")return X;const J=W?[...W,Y]:[Y];if(W0(Z,D2)||W0(Z,B0)||W0(Z,B0.Aliased))X.push({path:J,field:Z});else if(W0(Z,w0))X.push(...a1(Z[w0.Symbol.Columns],J));else X.push(...a1(Z,J));return X},[])},bX=function($,W){const X=Object.keys($),Y=Object.keys(W);if(X.length!==Y.length)return!1;for(let[Z,J]of X.entries())if(J!==Y[Z])return!1;return!0},h4=function($,W){const X=Object.entries(W).filter(([,Y])=>Y!==void 0).map(([Y,Z])=>{if(W0(Z,B0))return[Y,Z];else return[Y,new r1(Z,$[w0.Symbol.Columns][Y])]});if(X.length===0)throw new Error("No values to set");return Object.fromEntries(X)},xz=function($,W){for(let X of W)for(let Y of Object.getOwnPropertyNames(X.prototype)){if(Y==="constructor")continue;Object.defineProperty($.prototype,Y,Object.getOwnPropertyDescriptor(X.prototype,Y)||Object.create(null))}},kz=function($){return $[w0.Symbol.Columns]},xX=function($){return W0($,n2)?$[I2].alias:W0($,N1)?$[K2].name:W0($,B0)?void 0:$[w0.Symbol.IsAlias]?$[w0.Symbol.Name]:$[w0.Symbol.BaseName]};class p4 extends G1{constructor($,W,X,Y){super();this.session=W,this.dialect=X,this.config={table:$,withList:Y}}static[o]="PgDelete";config;where($){return this.config.where=$,this}returning($=this.config.table[w0.Symbol.Columns]){return this.config.returning=a1($),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:$,...W}=this.dialect.sqlToQuery(this.getSQL());return W}_prepare($){return G2.startActiveSpan("drizzle.prepareQuery",()=>{return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,$)})}prepare($){return this._prepare($)}execute=($)=>{return G2.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute($)})};$dynamic(){return this}}class m4{constructor($,W,X,Y){this.table=$,this.session=W,this.dialect=X,this.withList=Y}static[o]="PgInsertBuilder";values($){if($=Array.isArray($)?$:[$],$.length===0)throw new Error("values() must be called with at least one value");const W=$.map((X)=>{const Y={},Z=this.table[w0.Symbol.Columns];for(let J of Object.keys(X)){const z=X[J];Y[J]=W0(z,B0)?z:new r1(z,Z[J])}return Y});return new Tz(this.table,W,this.session,this.dialect,this.withList)}}class Tz extends G1{constructor($,W,X,Y,Z){super();this.session=X,this.dialect=Y,this.config={table:$,values:W,withList:Z}}static[o]="PgInsert";config;returning($=this.config.table[w0.Symbol.Columns]){return this.config.returning=a1($),this}onConflictDoNothing($={}){if($.target===void 0)this.config.onConflict=y`do nothing`;else{let W="";W=Array.isArray($.target)?$.target.map((Y)=>this.dialect.escapeName(Y.name)).join(","):this.dialect.escapeName($.target.name);const X=$.where?y` where ${$.where}`:void 0;this.config.onConflict=y`(${y.raw(W)}) do nothing${X}`}return this}onConflictDoUpdate($){const W=$.where?y` where ${$.where}`:void 0,X=this.dialect.buildUpdateSet(this.config.table,h4(this.config.table,$.set));let Y="";return Y=Array.isArray($.target)?$.target.map((Z)=>this.dialect.escapeName(Z.name)).join(","):this.dialect.escapeName($.target.name),this.config.onConflict=y`(${y.raw(Y)}) do update set ${X}${W}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:$,...W}=this.dialect.sqlToQuery(this.getSQL());return W}_prepare($){return G2.startActiveSpan("drizzle.prepareQuery",()=>{return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,$)})}prepare($){return this._prepare($)}execute=($)=>{return G2.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute($)})};$dynamic(){return this}}class c4 extends Error{static[o]="DrizzleError";constructor({message:$,cause:W}){super($);this.name="DrizzleError",this.cause=W}}class kX extends c4{static[o]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class TX{static[o]="PgPrimaryKeyBuilder";columns;name;constructor($,W){this.columns=$,this.name=W}build($){return new gz($,this.columns,this.name)}}class gz{constructor($,W,X){this.table=$,this.columns=W,this.name=X}static[o]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[$1.Symbol.Name]}_${this.columns.map(($)=>$.name).join("_")}_pk`}}var F1=function($,W){if(_z(W)&&!NX($)&&!W0($,r1)&&!W0($,G$)&&!W0($,D2)&&!W0($,w0)&&!W0($,N1))return new r1($,W);return $},k6=function(...$){const W=$.filter((X)=>X!==void 0);if(W.length===0)return;if(W.length===1)return new B0(W);return new B0([new y2("("),y.join(W,new y2(" and ")),new y2(")")])},yz=function(...$){const W=$.filter((X)=>X!==void 0);if(W.length===0)return;if(W.length===1)return new B0(W);return new B0([new y2("("),y.join(W,new y2(" or ")),new y2(")")])},dz=function($){return y`not ${$}`},cz=function($,W){if(Array.isArray(W)){if(W.length===0)throw new Error("inArray requires at least one value");return y`${$} in ${W.map((X)=>F1(X,$))}`}return y`${$} in ${F1(W,$)}`},uz=function($,W){if(Array.isArray(W)){if(W.length===0)throw new Error("notInArray requires at least one value");return y`${$} not in ${W.map((X)=>F1(X,$))}`}return y`${$} not in ${F1(W,$)}`},oz=function($){return y`${$} is null`},iz=function($){return y`${$} is not null`},lz=function($){return y`exists ${$}`},nz=function($){return y`not exists ${$}`},tz=function($,W,X){return y`${$} between ${F1(W,$)} and ${F1(X,$)}`},sz=function($,W,X){return y`${$} not between ${F1(W,$)} and ${F1(X,$)}`},rz=function($,W){return y`${$} like ${W}`},az=function($,W){return y`${$} not like ${W}`},ez=function($,W){return y`${$} ilike ${W}`},$Q=function($,W){return y`${$} not ilike ${W}`};var e1=($,W)=>{return y`${$} = ${F1(W,$)}`},fz=($,W)=>{return y`${$} <> ${F1(W,$)}`},vz=($,W)=>{return y`${$} > ${F1(W,$)}`},hz=($,W)=>{return y`${$} >= ${F1(W,$)}`},pz=($,W)=>{return y`${$} < ${F1(W,$)}`},mz=($,W)=>{return y`${$} <= ${F1(W,$)}`};var WQ=function($){return y`${$} asc`},XQ=function($){return y`${$} desc`};var ZQ=function(){return{and:k6,between:tz,eq:e1,exists:lz,gt:vz,gte:hz,ilike:ez,inArray:cz,isNull:oz,isNotNull:iz,like:rz,lt:pz,lte:mz,ne:fz,not:dz,notBetween:sz,notExists:nz,notLike:az,notIlike:$Q,notInArray:uz,or:yz,sql:y}},JQ=function(){return{sql:y,asc:WQ,desc:XQ}},o4=function($,W){if(Object.keys($).length===1&&"default"in $&&!W0($.default,w0))$=$.default;const X={},Y={},Z={};for(let[J,z]of Object.entries($))if(Az(z)){const Q=z[w0.Symbol.Name],G=Y[Q];X[Q]=J,Z[J]={tsName:J,dbName:z[w0.Symbol.Name],schema:z[w0.Symbol.Schema],columns:z[w0.Symbol.Columns],relations:G?.relations??{},primaryKey:G?.primaryKey??[]};for(let w of Object.values(z[w0.Symbol.Columns]))if(w.primary)Z[J].primaryKey.push(w);const A=z[w0.Symbol.ExtraConfigBuilder]?.(z);if(A){for(let w of Object.values(A))if(W0(w,TX))Z[J].primaryKey.push(...w.columns)}}else if(W0(z,YQ)){const Q=z.table[w0.Symbol.Name],G=X[Q],A=z.config(W(z.table));let w;for(let[D,O]of Object.entries(A))if(G){const L=Z[G];if(L.relations[D]=O,w)L.primaryKey.push(...w)}else{if(!(Q in Y))Y[Q]={relations:{},primaryKey:w};Y[Q].relations[D]=O}}return{tables:Z,tableNamesMap:X}};var _L=function($){return function W(X,Y){return new U6($,X,Y,Y?.fields.reduce((Z,J)=>Z&&J.notNull,!0)??!1)}},HL=function($){return function W(X,Y){return new F5($,X,Y)}},zQ=function($,W,X){if(W0(X,U6)&&X.config)return{fields:X.config.fields,references:X.config.references};const Y=W[X.referencedTable[w0.Symbol.Name]];if(!Y)throw new Error(`Table "${X.referencedTable[w0.Symbol.Name]}" not found in schema`);const Z=$[Y];if(!Z)throw new Error(`Table "${Y}" not found in schema`);const J=X.sourceTable,z=W[J[w0.Symbol.Name]];if(!z)throw new Error(`Table "${J[w0.Symbol.Name]}" not found in schema`);const Q=[];for(let G of Object.values(Z.relations))if(X.relationName&&X!==G&&G.relationName===X.relationName||!X.relationName&&G.referencedTable===X.sourceTable)Q.push(G);if(Q.length>1)throw X.relationName?new Error(`There are multiple relations with name "${X.relationName}" in table "${Y}"`):new Error(`There are multiple relations between "${Y}" and "${X.sourceTable[w0.Symbol.Name]}". Please specify relation name`);if(Q[0]&&W0(Q[0],U6)&&Q[0].config)return{fields:Q[0].config.references,references:Q[0].config.fields};throw new Error(`There is not enough information to infer relation "${z}.${X.fieldName}"`)},i4=function($){return{one:_L($),many:HL($)}},u4=function($,W,X,Y,Z=(J)=>J){const J={};for(let[z,Q]of Y.entries())if(Q.isJson){const G=W.relations[Q.tsKey],A=X[z],w=typeof A==="string"?JSON.parse(A):A;J[Q.tsKey]=W0(G,U6)?w&&u4($,$[Q.relationTableTsKey],w,Q.selection,Z):w.map((D)=>u4($,$[Q.relationTableTsKey],D,Q.selection,Z))}else{const G=Z(X[z]),A=Q.field;let w;if(W0(A,D2))w=A;else if(W0(A,B0))w=A.decoder;else w=A.sql.decoder;J[Q.tsKey]=G===null?null:w.mapFromDriverValue(G)}return J};class gX{constructor($,W,X){this.sourceTable=$,this.referencedTable=W,this.relationName=X,this.referencedTableName=W[w0.Symbol.Name]}static[o]="Relation";referencedTableName;fieldName}class YQ{constructor($,W){this.table=$,this.config=W}static[o]="Relations"}class U6 extends gX{constructor($,W,X,Y){super($,W,X?.relationName);this.config=X,this.isNullable=Y}static[o]="One";withFieldName($){const W=new U6(this.sourceTable,this.referencedTable,this.config,this.isNullable);return W.fieldName=$,W}}class F5 extends gX{constructor($,W,X){super($,W,X?.relationName);this.config=X}static[o]="Many";withFieldName($){const W=new F5(this.sourceTable,this.referencedTable,this.config);return W.fieldName=$,W}}class K5 extends N1{static[o]="PgViewBase"}class T6{static[o]="PgDialect";async migrate($,W,X){const Y=typeof X==="string"?"__drizzle_migrations":X.migrationsTable??"__drizzle_migrations",Z=typeof X==="string"?"drizzle":X.migrationsSchema??"drizzle",J=y`
			CREATE TABLE IF NOT EXISTS ${y.identifier(Z)}.${y.identifier(Y)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await W.execute(y`CREATE SCHEMA IF NOT EXISTS ${y.identifier(Z)}`),await W.execute(J);const Q=(await W.all(y`select id, hash, created_at from ${y.identifier(Z)}.${y.identifier(Y)} order by created_at desc limit 1`))[0];await W.transaction(async(G)=>{for await(let A of $)if(!Q||Number(Q.created_at)<A.folderMillis){for(let w of A.sql)await G.execute(y.raw(w));await G.execute(y`insert into ${y.identifier(Z)}.${y.identifier(Y)} ("hash", "created_at") values(${A.hash}, ${A.folderMillis})`)}})}escapeName($){return`"${$}"`}escapeParam($){return`\$${$+1}`}escapeString($){return`'${$.replace(/'/g,"''")}'`}buildWithCTE($){if(!$?.length)return;const W=[y`with `];for(let[X,Y]of $.entries())if(W.push(y`${y.identifier(Y[I2].alias)} as (${Y[I2].sql})`),X<$.length-1)W.push(y`, `);return W.push(y` `),y.join(W)}buildDeleteQuery({table:$,where:W,returning:X,withList:Y}){const Z=this.buildWithCTE(Y),J=X?y` returning ${this.buildSelection(X,{isSingleTable:!0})}`:void 0,z=W?y` where ${W}`:void 0;return y`${Z}delete from ${$}${z}${J}`}buildUpdateSet($,W){const X=Object.entries(W),Y=X.length;return y.join(X.flatMap(([Z,J],z)=>{const Q=$[w0.Symbol.Columns][Z],G=y`${y.identifier(Q.name)} = ${J}`;if(z<Y-1)return[G,y.raw(", ")];return[G]}))}buildUpdateQuery({table:$,set:W,where:X,returning:Y,withList:Z}){const J=this.buildWithCTE(Z),z=this.buildUpdateSet($,W),Q=Y?y` returning ${this.buildSelection(Y,{isSingleTable:!0})}`:void 0,G=X?y` where ${X}`:void 0;return y`${J}update ${$} set ${z}${G}${Q}`}buildSelection($,{isSingleTable:W=!1}={}){const X=$.length,Y=$.flatMap(({field:Z},J)=>{const z=[];if(W0(Z,B0.Aliased)&&Z.isSelectionField)z.push(y.identifier(Z.fieldAlias));else if(W0(Z,B0.Aliased)||W0(Z,B0)){const Q=W0(Z,B0.Aliased)?Z.sql:Z;if(W)z.push(new B0(Q.queryChunks.map((G)=>{if(W0(G,U2))return y.identifier(G.name);return G})));else z.push(Q);if(W0(Z,B0.Aliased))z.push(y` as ${y.identifier(Z.fieldAlias)}`)}else if(W0(Z,D2))if(W)z.push(y.identifier(Z.name));else z.push(Z);if(J<X-1)z.push(y`, `);return z});return y.join(Y)}buildSelectQuery({withList:$,fields:W,fieldsFlat:X,where:Y,having:Z,table:J,joins:z,orderBy:Q,groupBy:G,limit:A,offset:w,lockingClause:D,distinct:O,setOperators:L}){const B=X??a1(W);for(let v of B)if(W0(v.field,D2)&&G6(v.field.table)!==(W0(J,n2)?J[I2].alias:W0(J,K5)?J[K2].name:W0(J,B0)?void 0:G6(J))&&!((r)=>z?.some(({alias:$0})=>$0===(r[w0.Symbol.IsAlias]?G6(r):r[w0.Symbol.BaseName])))(v.field.table)){const r=G6(v.field.table);throw new Error(`Your "${v.path.join("->")}" field references a column "${r}"."${v.field.name}", but the table "${r}" is not part of the query! Did you forget to join it?`)}const M=!z||z.length===0,H=this.buildWithCTE($);let K;if(O)K=O===!0?y` distinct`:y` distinct on (${y.join(O.on,y`, `)})`;const S=this.buildSelection(B,{isSingleTable:M}),R=(()=>{if(W0(J,w0)&&J[w0.Symbol.OriginalName]!==J[w0.Symbol.Name]){let v=y`${y.identifier(J[w0.Symbol.OriginalName])}`;if(J[w0.Symbol.Schema])v=y`${y.identifier(J[w0.Symbol.Schema])}.${v}`;return y`${v} ${y.identifier(J[w0.Symbol.Name])}`}return J})(),b=[];if(z)for(let[v,r]of z.entries()){if(v===0)b.push(y` `);const $0=r.table,M0=r.lateral?y` lateral`:void 0;if(W0($0,$1)){const c=$0[$1.Symbol.Name],e=$0[$1.Symbol.Schema],_0=$0[$1.Symbol.OriginalName],n=c===_0?void 0:r.alias;b.push(y`${y.raw(r.joinType)} join${M0} ${e?y`${y.identifier(e)}.`:void 0}${y.identifier(_0)}${n&&y` ${y.identifier(n)}`} on ${r.on}`)}else if(W0($0,N1)){const c=$0[K2].name,e=$0[K2].schema,_0=$0[K2].originalName,n=c===_0?void 0:r.alias;b.push(y`${y.raw(r.joinType)} join${M0} ${e?y`${y.identifier(e)}.`:void 0}${y.identifier(_0)}${n&&y` ${y.identifier(n)}`} on ${r.on}`)}else b.push(y`${y.raw(r.joinType)} join${M0} ${$0} on ${r.on}`);if(v<z.length-1)b.push(y` `)}const f=y.join(b),P=Y?y` where ${Y}`:void 0,I=Z?y` having ${Z}`:void 0;let g;if(Q&&Q.length>0)g=y` order by ${y.join(Q,y`, `)}`;let E;if(G&&G.length>0)E=y` group by ${y.join(G,y`, `)}`;const V=A?y` limit ${A}`:void 0,k=w?y` offset ${w}`:void 0,s=y.empty();if(D){const v=y` for ${y.raw(D.strength)}`;if(D.config.of)v.append(y` of ${y.join(Array.isArray(D.config.of)?D.config.of:[D.config.of],y`, `)}`);if(D.config.noWait)v.append(y` no wait`);else if(D.config.skipLocked)v.append(y` skip locked`);s.append(v)}const a=y`${H}select${K} ${S} from ${R}${f}${P}${E}${I}${g}${V}${k}${s}`;if(L.length>0)return this.buildSetOperations(a,L);return a}buildSetOperations($,W){const[X,...Y]=W;if(!X)throw new Error("Cannot pass undefined values to any set operator");if(Y.length===0)return this.buildSetOperationQuery({leftSelect:$,setOperator:X});return this.buildSetOperations(this.buildSetOperationQuery({leftSelect:$,setOperator:X}),Y)}buildSetOperationQuery({leftSelect:$,setOperator:{type:W,isAll:X,rightSelect:Y,limit:Z,orderBy:J,offset:z}}){const Q=y`(${$.getSQL()}) `,G=y`(${Y.getSQL()})`;let A;if(J&&J.length>0){const L=[];for(let B of J)if(W0(B,U2))L.push(y.identifier(B.name));else if(W0(B,B0)){for(let M=0;M<B.queryChunks.length;M++){const H=B.queryChunks[M];if(W0(H,U2))B.queryChunks[M]=y.identifier(H.name)}L.push(y`${B}`)}else L.push(y`${B}`);A=y` order by ${y.join(L,y`, `)} `}const w=Z?y` limit ${Z}`:void 0,D=y.raw(`${W} ${X?"all ":""}`),O=z?y` offset ${z}`:void 0;return y`${Q}${D}${G}${A}${w}${O}`}buildInsertQuery({table:$,values:W,onConflict:X,returning:Y,withList:Z}){const J=[],z=$[w0.Symbol.Columns],Q=Object.entries(z),G=Q.map(([,L])=>y.identifier(L.name));for(let[L,B]of W.entries()){const M=[];for(let[H,K]of Q){const S=B[H];if(S===void 0||W0(S,r1)&&S.value===void 0)if(K.defaultFn!==void 0){const R=K.defaultFn(),b=W0(R,B0)?R:y.param(R,K);M.push(b)}else M.push(y`default`);else M.push(S)}if(J.push(M),L<W.length-1)J.push(y`, `)}const A=this.buildWithCTE(Z),w=y.join(J),D=Y?y` returning ${this.buildSelection(Y,{isSingleTable:!0})}`:void 0,O=X?y` on conflict ${X}`:void 0;return y`${A}insert into ${$} ${G} values ${w}${O}${D}`}buildRefreshMaterializedViewQuery({view:$,concurrently:W,withNoData:X}){const Y=W?y` concurrently`:void 0,Z=X?y` with no data`:void 0;return y`refresh materialized view${Y} ${$}${Z}`}prepareTyping($){if(W0($,qX)||W0($,CX))return"json";else if(W0($,VX))return"decimal";else if(W0($,jX))return"time";else if(W0($,y4))return"timestamp";else if(W0($,EX))return"date";else if(W0($,IX))return"uuid";else return"none"}sqlToQuery($){return $.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping})}buildRelationalQueryWithoutPK({fullSchema:$,schema:W,tableNamesMap:X,table:Y,tableConfig:Z,queryConfig:J,tableAlias:z,nestedQueryRelation:Q,joinOn:G}){let A=[],w,D,O=[],L;const B=[];if(J===!0)A=Object.entries(Z.columns).map(([K,S])=>({dbKey:S.name,tsKey:K,field:j8(S,z),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{const H=Object.fromEntries(Object.entries(Z.columns).map(([P,I])=>[P,j8(I,z)]));if(J.where){const P=typeof J.where==="function"?J.where(H,ZQ()):J.where;L=P&&L5(P,z)}const K=[];let S=[];if(J.columns){let P=!1;for(let[I,g]of Object.entries(J.columns)){if(g===void 0)continue;if(I in Z.columns){if(!P&&g===!0)P=!0;S.push(I)}}if(S.length>0)S=P?S.filter((I)=>J.columns?.[I]===!0):Object.keys(Z.columns).filter((I)=>!S.includes(I))}else S=Object.keys(Z.columns);for(let P of S){const I=Z.columns[P];K.push({tsKey:P,value:I})}let R=[];if(J.with)R=Object.entries(J.with).filter((P)=>!!P[1]).map(([P,I])=>({tsKey:P,queryConfig:I,relation:Z.relations[P]}));let b;if(J.extras){b=typeof J.extras==="function"?J.extras(H,{sql:y}):J.extras;for(let[P,I]of Object.entries(b))K.push({tsKey:P,value:LX(I,z)})}for(let{tsKey:P,value:I}of K)A.push({dbKey:W0(I,B0.Aliased)?I.fieldAlias:Z.columns[P].name,tsKey:P,field:W0(I,D2)?j8(I,z):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let f=typeof J.orderBy==="function"?J.orderBy(H,JQ()):J.orderBy??[];if(!Array.isArray(f))f=[f];O=f.map((P)=>{if(W0(P,D2))return j8(P,z);return L5(P,z)}),w=J.limit,D=J.offset;for(let{tsKey:P,queryConfig:I,relation:g}of R){const E=zQ(W,X,g),V=g.referencedTable[w0.Symbol.Name],k=X[V],s=`${z}_${P}`,a=k6(...E.fields.map(($0,M0)=>e1(j8(E.references[M0],s),j8($0,z)))),v=this.buildRelationalQueryWithoutPK({fullSchema:$,schema:W,tableNamesMap:X,table:$[k],tableConfig:W[k],queryConfig:W0(g,U6)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:s,joinOn:a,nestedQueryRelation:g}),r=y`${y.identifier(s)}.${y.identifier("data")}`.as(P);B.push({on:y`true`,table:new n2(v.sql,{},s),alias:s,joinType:"left",lateral:!0}),A.push({dbKey:P,tsKey:P,field:r,relationTableTsKey:k,isJson:!0,selection:v.selection})}}if(A.length===0)throw new c4({message:`No fields selected for table "${Z.tsName}" ("${z}")`});let M;if(L=k6(G,L),Q){let H=y`json_build_array(${y.join(A.map(({field:R,tsKey:b,isJson:f})=>f?y`${y.identifier(`${z}_${b}`)}.${y.identifier("data")}`:W0(R,B0.Aliased)?R.sql:R),y`, `)})`;if(W0(Q,F5))H=y`coalesce(json_agg(${H}${O.length>0?y` order by ${y.join(O,y`, `)}`:void 0}), '[]'::json)`;const K=[{dbKey:"data",tsKey:"data",field:H.as("data"),isJson:!0,relationTableTsKey:Z.tsName,selection:A}];if(w!==void 0||D!==void 0||O.length>0)M=this.buildSelectQuery({table:g4(Y,z),fields:{},fieldsFlat:[{path:[],field:y.raw("*")}],where:L,limit:w,offset:D,orderBy:O,setOperators:[]}),L=void 0,w=void 0,D=void 0,O=[];else M=g4(Y,z);M=this.buildSelectQuery({table:W0(M,$1)?M:new n2(M,{},z),fields:{},fieldsFlat:K.map(({field:R})=>({path:[],field:W0(R,D2)?j8(R,z):R})),joins:B,where:L,limit:w,offset:D,orderBy:O,setOperators:[]})}else M=this.buildSelectQuery({table:g4(Y,z),fields:{},fieldsFlat:A.map(({field:H})=>({path:[],field:W0(H,D2)?j8(H,z):H})),joins:B,where:L,limit:w,offset:D,orderBy:O,setOperators:[]});return{tableTsKey:Z.tsName,sql:M,selection:A}}}class fX{static[o]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class K1{static[o]="SelectionProxyHandler";config;constructor($){this.config={...$}}get($,W){if(W===I2)return{...$[I2],selection:new Proxy($[I2].selection,this)};if(W===K2)return{...$[K2],selectedFields:new Proxy($[K2].selectedFields,this)};if(typeof W==="symbol")return $[W];const Y=(W0($,n2)?$[I2].selection:W0($,N1)?$[K2].selectedFields:$)[W];if(W0(Y,B0.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!Y.isSelectionField)return Y.sql;const Z=Y.clone();return Z.isSelectionField=!0,Z}if(W0(Y,B0)){if(this.config.sqlBehavior==="sql")return Y;throw new Error(`You tried to reference "${W}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}if(W0(Y,D2)){if(this.config.alias)return new Proxy(Y,new U$(new Proxy(Y.table,new N5(this.config.alias,this.config.replaceOriginalName??!1))));return Y}if(typeof Y!=="object"||Y===null)return Y;return new Proxy(Y,new K1(this.config))}}var w$=function($,W){return(X,Y,...Z)=>{const J=[Y,...Z].map((z)=>({type:$,isAll:W,rightSelect:z}));for(let z of J)if(!bX(X.getSelectedFields(),z.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return X.addSetOperators(J)}};class U1{static[o]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor($){if(this.fields=$.fields,this.session=$.session,this.dialect=$.dialect,$.withList)this.withList=$.withList;this.distinct=$.distinct}from($){const W=!!this.fields;let X;if(this.fields)X=this.fields;else if(W0($,n2))X=Object.fromEntries(Object.keys($[I2].selection).map((Y)=>[Y,$[Y]]));else if(W0($,K5))X=$[K2].selectedFields;else if(W0($,B0))X={};else X=kz($);return new yX({table:$,fields:X,isPartialSelect:W,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class QQ extends fX{static[o]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:$,fields:W,isPartialSelect:X,session:Y,dialect:Z,withList:J,distinct:z}){super();this.config={withList:J,table:$,fields:{...W},distinct:z,setOperators:[]},this.isPartialSelect=X,this.session=Y,this.dialect=Z,this._={selectedFields:W},this.tableName=xX($),this.joinsNotNullableMap=typeof this.tableName==="string"?{[this.tableName]:!0}:{}}createJoin($){return(W,X)=>{const Y=this.tableName,Z=xX(W);if(typeof Z==="string"&&this.config.joins?.some((J)=>J.alias===Z))throw new Error(`Alias "${Z}" is already used in this query`);if(!this.isPartialSelect){if(Object.keys(this.joinsNotNullableMap).length===1&&typeof Y==="string")this.config.fields={[Y]:this.config.fields};if(typeof Z==="string"&&!W0(W,B0)){const J=W0(W,n2)?W[I2].selection:W0(W,N1)?W[K2].selectedFields:W[w0.Symbol.Columns];this.config.fields[Z]=J}}if(typeof X==="function")X=X(new Proxy(this.config.fields,new K1({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));if(!this.config.joins)this.config.joins=[];if(this.config.joins.push({on:X,table:W,joinType:$,alias:Z}),typeof Z==="string")switch($){case"left":{this.joinsNotNullableMap[Z]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([J])=>[J,!1])),this.joinsNotNullableMap[Z]=!0;break}case"inner":{this.joinsNotNullableMap[Z]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([J])=>[J,!1])),this.joinsNotNullableMap[Z]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator($,W){return(X)=>{const Y=typeof X==="function"?X(DL()):X;if(!bX(this.getSelectedFields(),Y.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:$,isAll:W,rightSelect:Y}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators($){return this.config.setOperators.push(...$),this}where($){if(typeof $==="function")$=$(new Proxy(this.config.fields,new K1({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.where=$,this}having($){if(typeof $==="function")$=$(new Proxy(this.config.fields,new K1({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.having=$,this}groupBy(...$){if(typeof $[0]==="function"){const W=$[0](new Proxy(this.config.fields,new K1({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(W)?W:[W]}else this.config.groupBy=$;return this}orderBy(...$){if(typeof $[0]==="function"){const W=$[0](new Proxy(this.config.fields,new K1({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),X=Array.isArray(W)?W:[W];if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=X;else this.config.orderBy=X}else{const W=$;if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=W;else this.config.orderBy=W}return this}limit($){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).limit=$;else this.config.limit=$;return this}offset($){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).offset=$;else this.config.offset=$;return this}for($,W={}){return this.config.lockingClause={strength:$,config:W},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:$,...W}=this.dialect.sqlToQuery(this.getSQL());return W}as($){return new Proxy(new n2(this.getSQL(),this.config.fields,$),new K1({alias:$,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new K1({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class yX extends QQ{static[o]="PgSelect";_prepare($){const{session:W,config:X,dialect:Y,joinsNotNullableMap:Z}=this;if(!W)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return G2.startActiveSpan("drizzle.prepareQuery",()=>{const J=a1(X.fields),z=W.prepareQuery(Y.sqlToQuery(this.getSQL()),J,$);return z.joinsNotNullableMap=Z,z})}prepare($){return this._prepare($)}execute=($)=>{return G2.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute($)})}}xz(yX,[G1]);var DL=()=>({union:BL,unionAll:OL,intersect:NL,intersectAll:LL,except:FL,exceptAll:KL}),BL=w$("union",!1),OL=w$("union",!0),NL=w$("intersect",!1),LL=w$("intersect",!0),FL=w$("except",!1),KL=w$("except",!0);class dX{static[o]="PgQueryBuilder";dialect;$with($){const W=this;return{as(X){if(typeof X==="function")X=X(W);return new Proxy(new O5(X.getSQL(),X.getSelectedFields(),$,!0),new K1({alias:$,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...$){const W=this;function X(J){return new U1({fields:J??void 0,session:void 0,dialect:W.getDialect(),withList:$})}function Y(J){return new U1({fields:J??void 0,session:void 0,dialect:W.getDialect(),distinct:!0})}function Z(J,z){return new U1({fields:z??void 0,session:void 0,dialect:W.getDialect(),distinct:{on:J}})}return{select:X,selectDistinct:Y,selectDistinctOn:Z}}select($){return new U1({fields:$??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct($){return new U1({fields:$??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn($,W){return new U1({fields:W??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:$}})}getDialect(){if(!this.dialect)this.dialect=new T6;return this.dialect}}class vX extends G1{constructor($,W,X){super();this.session=W,this.dialect=X,this.config={view:$}}static[o]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){const{typings:$,...W}=this.dialect.sqlToQuery(this.getSQL());return W}_prepare($){return G2.startActiveSpan("drizzle.prepareQuery",()=>{return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,$)})}prepare($){return this._prepare($)}execute=($)=>{return G2.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute($)})}}class l4{constructor($,W,X,Y){this.table=$,this.session=W,this.dialect=X,this.withList=Y}static[o]="PgUpdateBuilder";set($){return new GQ(this.table,h4(this.table,$),this.session,this.dialect,this.withList)}}class GQ extends G1{constructor($,W,X,Y,Z){super();this.session=X,this.dialect=Y,this.config={set:W,table:$,withList:Z}}static[o]="PgUpdate";config;where($){return this.config.where=$,this}returning($=this.config.table[w0.Symbol.Columns]){return this.config.returning=a1($),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:$,...W}=this.dialect.sqlToQuery(this.getSQL());return W}_prepare($){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,$)}prepare($){return this._prepare($)}execute=($)=>{return this._prepare().execute($)};$dynamic(){return this}}class pX{constructor($,W,X,Y,Z,J,z){this.fullSchema=$,this.schema=W,this.tableNamesMap=X,this.table=Y,this.tableConfig=Z,this.dialect=J,this.session=z}static[o]="PgRelationalQueryBuilder";findMany($){return new hX(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,$?$:{},"many")}findFirst($){return new hX(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,$?{...$,limit:1}:{limit:1},"first")}}class hX extends G1{constructor($,W,X,Y,Z,J,z,Q,G){super();this.fullSchema=$,this.schema=W,this.tableNamesMap=X,this.table=Y,this.tableConfig=Z,this.dialect=J,this.session=z,this.config=Q,this.mode=G}static[o]="PgRelationalQuery";_prepare($){return G2.startActiveSpan("drizzle.prepareQuery",()=>{const{query:W,builtQuery:X}=this._toSQL();return this.session.prepareQuery(X,void 0,$,(Y,Z)=>{const J=Y.map((z)=>u4(this.schema,this.tableConfig,z,W.selection,Z));if(this.mode==="first")return J[0];return J})})}prepare($){return this._prepare($)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){const $=this._getQuery(),W=this.dialect.sqlToQuery($.sql);return{query:$,builtQuery:W}}toSQL(){return this._toSQL().builtQuery}execute(){return G2.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute()})}}class mX extends G1{constructor($,W,X,Y){super();this.execute=$,this.sql=W,this.query=X,this.mapBatchResult=Y}static[o]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult($,W){return W?this.mapBatchResult($):$}_prepare(){return this}}class g6{constructor($,W,X){if(this.dialect=$,this.session=W,this._=X?{schema:X.schema,tableNamesMap:X.tableNamesMap}:{schema:void 0,tableNamesMap:{}},this.query={},this._.schema)for(let[Y,Z]of Object.entries(this._.schema))this.query[Y]=new pX(X.fullSchema,this._.schema,this._.tableNamesMap,X.fullSchema[Y],Z,$,W)}static[o]="PgDatabase";query;$with($){return{as(W){if(typeof W==="function")W=W(new dX);return new Proxy(new O5(W.getSQL(),W.getSelectedFields(),$,!0),new K1({alias:$,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...$){const W=this;function X(G){return new U1({fields:G??void 0,session:W.session,dialect:W.dialect,withList:$})}function Y(G){return new U1({fields:G??void 0,session:W.session,dialect:W.dialect,withList:$,distinct:!0})}function Z(G,A){return new U1({fields:A??void 0,session:W.session,dialect:W.dialect,withList:$,distinct:{on:G}})}function J(G){return new l4(G,W.session,W.dialect,$)}function z(G){return new m4(G,W.session,W.dialect,$)}function Q(G){return new p4(G,W.session,W.dialect,$)}return{select:X,selectDistinct:Y,selectDistinctOn:Z,update:J,insert:z,delete:Q}}select($){return new U1({fields:$??void 0,session:this.session,dialect:this.dialect})}selectDistinct($){return new U1({fields:$??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn($,W){return new U1({fields:W??void 0,session:this.session,dialect:this.dialect,distinct:{on:$}})}update($){return new l4($,this.session,this.dialect)}insert($){return new m4($,this.session,this.dialect)}delete($){return new p4($,this.session,this.dialect)}refreshMaterializedView($){return new vX($,this.session,this.dialect)}execute($){const W=$.getSQL(),X=this.dialect.sqlToQuery(W),Y=this.session.prepareQuery(X,void 0,void 0);return new mX(()=>Y.execute(),W,X,(Z)=>Y.mapResult(Z,!1))}transaction($,W){return this.session.transaction($,W)}}class S5{constructor($){this.query=$}getQuery(){return this.query}mapResult($,W){return $}static[o]="PgPreparedQuery";joinsNotNullableMap}class R5{constructor($){this.dialect=$}static[o]="PgSession";execute($){return G2.startActiveSpan("drizzle.operation",()=>{return G2.startActiveSpan("drizzle.prepareQuery",()=>{return this.prepareQuery(this.dialect.sqlToQuery($),void 0,void 0)}).execute()})}all($){return this.prepareQuery(this.dialect.sqlToQuery($),void 0,void 0).all()}}class cX extends g6{constructor($,W,X,Y=0){super($,W,X);this.schema=X,this.nestedIndex=Y}static[o]="PgTransaction";rollback(){throw new kX}getTransactionConfigSQL($){const W=[];if($.isolationLevel)W.push(`isolation level ${$.isolationLevel}`);if($.accessMode)W.push($.accessMode);if(typeof $.deferrable==="boolean")W.push($.deferrable?"deferrable":"not deferrable");return y.raw(W.join(" "))}setTransaction($){return this.session.execute(y`set transaction ${this.getTransactionConfigSQL($)}`)}}var P5={id:Cz("id").primaryKey(),dateAdded:d4("date_added").notNull().defaultNow(),lastModified:d4("last_modified").notNull().defaultNow()},UQ=M$("transaction_type",{...P5,description:Q1("description").unique().notNull(),name:Q1("name").unique().notNull()}),M8=M$("transaction",{...P5,agentNumber:Q1("agent_number"),balance:U8("balance"),dateTime:d4("date_time").notNull(),interest:U8("interest").default(0),location:Q1("location"),messageId:U8("source_message_id").notNull(),subject:Q1("subject").notNull(),subjectAccount:Q1("subject_account"),subjectPhoneNumber:Q1("subject_phone_number"),transactionAmount:U8("transaction_amount").notNull(),transactionCode:Q1("transaction_code").unique().notNull(),transactionCost:U8("transaction_cost").default(0),type:U8("type").references(()=>UQ.id).notNull(),userId:U8("user_id").references(()=>J2.id)}),J2=M$("user",{...P5,email:Q1("email").unique().notNull(),password:Q1("password").unique().notNull(),phoneNumber:Q1("phone_number").unique(),username:Q1("username").unique().notNull()}),w8=M$("tags",{...P5,description:Q1("description"),name:Q1("name").notNull(),userId:U8("user_id").references(()=>J2.id)}),o8=M$("transaction_tags_table",{...P5,tagId:U8("tag_id").references(()=>w8.id),transactionId:U8("transaction_id").references(()=>M8.id)});import oL from"os";import iL from"fs";var SL=function($){if(t4.has($))return t4.get($);const W=Error.stackTraceLimit;return Error.stackTraceLimit=4,t4.set($,new Error),Error.stackTraceLimit=W,t4.get($)},t4=new Map,uX=new Map,oX=Symbol("OriginError"),A$={};class $8 extends Promise{constructor($,W,X,Y,Z={}){let J,z;super((Q,G)=>{J=Q,z=G});this.tagged=Array.isArray($.raw),this.strings=$,this.args=W,this.handler=X,this.canceller=Y,this.options=Z,this.state=null,this.statement=null,this.resolve=(Q)=>(this.active=!1,J(Q)),this.reject=(Q)=>(this.active=!1,z(Q)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[oX]=this.handler.debug?new Error:this.tagged&&SL(this.strings)}get origin(){return(this.handler.debug?this[oX].stack:this.tagged&&uX.has(this.strings)?uX.get(this.strings):uX.set(this.strings,this[oX].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor($=1,W){if(this.options.simple=!1,typeof $==="function")W=$,$=1;if(this.cursorRows=$,typeof W==="function")return this.cursorFn=W,this;let X;return{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};X&&X();const Y=new Promise((Z,J)=>{this.cursorFn=(z)=>{return Z({value:z,done:!1}),new Promise((Q)=>X=Q)},this.resolve=()=>(this.active=!1,Z({done:!0})),this.reject=(z)=>(this.active=!1,J(z))});return this.execute(),Y},return(){return X&&X(A$),{done:!0}}})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw new Error(".stream has been renamed to .forEach")}forEach($){return this.forEachFn=$,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}}var MQ=function($,W,X){const{host:Y,port:Z}=X||W,J=Object.assign(new Error("write "+$+" "+(W.path||Y+":"+Z)),{code:$,errno:$,address:W.path||Y},W.path?{}:{port:Z});return Error.captureStackTrace(J,MQ),J},wQ=function($){const W=new _$($);return Error.captureStackTrace(W,wQ),W},AQ=function($,W){const X=Object.assign(new Error($+": "+W),{code:$});return Error.captureStackTrace(X,AQ),X},_Q=function($){const W=Object.assign(new Error($+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:$});return Error.captureStackTrace(W,_Q),W};class _$ extends Error{constructor($){super($.message);this.name=this.constructor.name,Object.assign(this,$)}}var T2={connection:MQ,postgres:wQ,generic:AQ,notSupported:_Q};function $W($,W,X,Y){let Z=$ instanceof I8?$.value:$;if(Z===void 0){if($ instanceof I8?$.value=Y.transform.undefined:Z=$=Y.transform.undefined,Z===void 0)throw T2.generic("UNDEFINED_VALUE","Undefined values are not allowed")}return"$"+X.push($ instanceof I8?(W.push($.value),$.array?$.array[$.type||r4($.value)]||$.type||OQ($.value):$.type):(W.push($),r4($)))}function tX($,W,X,Y,Z,J){for(let z=1;z<$.strings.length;z++)W+=sX(W,X,Y,Z,J)+$.strings[z],X=$.args[z];return W}var sX=function($,W,X,Y,Z){return W instanceof e4?W.build($,X,Y,Z):W instanceof $8?nX(W,X,Y,Z):W instanceof V5?W.value:W&&W[0]instanceof $8?W.reduce((J,z)=>J+" "+nX(z,X,Y,Z),""):$W(W,X,Y,Z)},nX=function($,W,X,Y){return $.fragment=!0,tX($,$.strings[0],$.args[0],W,X,Y)},BQ=function($,W,X,Y,Z){return $.map((J)=>"("+Y.map((z)=>sX("values",J[z],W,X,Z)).join(",")+")").join(",")},HQ=function($,W,X,Y,Z){const J=Array.isArray($[0]),z=W.length?W.flat():Object.keys(J?$[0]:$);return BQ(J?$:[$],X,Y,z,Z)},s4=function($,W,X,Y,Z){if(typeof $==="string"&&($=[$].concat(W)),Array.isArray($))return rX($,Z);let J;return(W.length?W.flat():Object.keys($)).map((Q)=>{return J=$[Q],(J instanceof $8?nX(J,X,Y,Z):J instanceof V5?J.value:$W(J,X,Y,Z))+" as "+WW(Z.transform.column.to?Z.transform.column.to(Q):Q)}).join(",")},iX=function(){throw T2.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")},OQ=function($){if(Array.isArray($))return OQ($[0]);return typeof $==="string"?1009:0},LQ=function($){return Object.keys($).reduce((W,X)=>{if($[X].from&&[].concat($[X].from).forEach((Y)=>W.parsers[Y]=$[X].parse),$[X].serialize)W.serializers[$[X].to]=$[X].serialize,$[X].from&&[].concat($[X].from).forEach((Y)=>W.serializers[Y]=$[X].serialize);return W},{parsers:{},serializers:{}})},rX=function($,{transform:{column:W}}){return $.map((X)=>WW(W.to?W.to(X):X)).join(",")},jL=function($){return $.replace(qL,"\\\\").replace(VL,'\\"')},SQ=function($,W,X,Y){const Z=[],J=Y===1020?";":",";for(;$.i<W.length;$.i++){if($.char=W[$.i],$.quoted)if($.char==="\\")$.str+=W[++$.i];else if($.char==='"')Z.push(X?X($.str):$.str),$.str="",$.quoted=W[$.i+1]==='"',$.last=$.i+2;else $.str+=$.char;else if($.char==='"')$.quoted=!0;else if($.char==="{")$.last=++$.i,Z.push(SQ($,W,X,Y));else if($.char==="}"){$.quoted=!1,$.last<$.i&&Z.push(X?X(W.slice($.last,$.i)):W.slice($.last,$.i)),$.last=$.i+1;break}else if($.char===J&&$.p!=="}"&&$.p!=='"')Z.push(X?X(W.slice($.last,$.i)):W.slice($.last,$.i)),$.last=$.i+1;$.p=$.char}return $.last<$.i&&Z.push(X?X(W.slice($.last,$.i+1)):W.slice($.last,$.i+1)),Z},aX=function($){return function W(X,Y){return typeof X==="object"&&X!==null&&(Y.type===114||Y.type===3802)?Array.isArray(X)?X.map((Z)=>W(Z,Y)):Object.entries(X).reduce((Z,[J,z])=>Object.assign(Z,{[$(J)]:W(z,Y)}),{}):X}},RL={string:{to:25,from:null,serialize:($)=>""+$},number:{to:0,from:[21,23,26,700,701],serialize:($)=>""+$,parse:($)=>+$},json:{to:114,from:[114,3802],serialize:($)=>JSON.stringify($),parse:($)=>JSON.parse($)},boolean:{to:16,from:16,serialize:($)=>$===!0?"t":"f",parse:($)=>$==="t"},date:{to:1184,from:[1082,1114,1184],serialize:($)=>($ instanceof Date?$:new Date($)).toISOString(),parse:($)=>new Date($)},bytea:{to:17,from:17,serialize:($)=>"\\x"+Buffer.from($).toString("hex"),parse:($)=>Buffer.from($.slice(2),"hex")}};class a4{then(){iX()}catch(){iX()}finally(){iX()}}class V5 extends a4{constructor($){super();this.value=WW($)}}class I8 extends a4{constructor($,W,X){super();this.value=$,this.type=W,this.array=X}}class e4 extends a4{constructor($,W){super();this.first=$,this.rest=W}build($,W,X,Y){const Z=PL.map(([J,z])=>({fn:z,i:$.search(J)})).sort((J,z)=>J.i-z.i).pop();return Z.i===-1?rX(this.first,Y):Z.fn(this.first,this.rest,W,X,Y)}}var DQ=LQ(RL),PL=Object.entries({values:HQ,in:(...$)=>{const W=HQ(...$);return W==="()"?"(null)":W},select:s4,as:s4,returning:s4,"\\(":s4,update($,W,X,Y,Z){return(W.length?W.flat():Object.keys($)).map((J)=>WW(Z.transform.column.to?Z.transform.column.to(J):J)+"="+sX("values",$[J],X,Y,Z))},insert($,W,X,Y,Z){const J=W.length?W.flat():Object.keys(Array.isArray($)?$[0]:$);return"("+rX(J,Z)+")values"+BQ(Array.isArray($)?$:[$],X,Y,J,Z)}}).map(([$,W])=>[new RegExp("((?:^|[\\s(])"+$+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),W]),EL=DQ.serializers,CL=DQ.parsers;var NQ=function($){const W=LQ($||{});return{serializers:Object.assign({},EL,W.serializers),parsers:Object.assign({},CL,W.parsers)}},WW=function $(W){return'"'+W.replace(/"/g,'""').replace(/\./g,'"."')+'"'},r4=function $(W){return W instanceof I8?W.type:W instanceof Date?1184:W instanceof Uint8Array?17:W===!0||W===!1?16:typeof W==="bigint"?20:Array.isArray(W)?$(W[0]):0},qL=/\\/g,VL=/"/g,FQ=function $(W,X,Y,Z){if(Array.isArray(W)===!1)return W;if(!W.length)return"{}";const J=W[0],z=Z===1020?";":",";if(Array.isArray(J)&&!J.type)return"{"+W.map((Q)=>$(Q,X,Y,Z)).join(z)+"}";return"{"+W.map((Q)=>{if(Q===void 0){if(Q=Y.transform.undefined,Q===void 0)throw T2.generic("UNDEFINED_VALUE","Undefined values are not allowed")}return Q===null?"null":'"'+jL(X?X(Q.type?Q.value:Q):""+Q)+'"'}).join(z)+"}"},lX={i:0,char:null,str:"",quoted:!1,last:0},KQ=function $(W,X,Y){return lX.i=lX.last=0,SQ(lX,W,X,Y)},f6=($)=>{let W=$[0];for(let X=1;X<$.length;X++)W+=$[X]==="_"?$[++X].toUpperCase():$[X];return W},y6=($)=>{let W=$[0].toUpperCase();for(let X=1;X<$.length;X++)W+=$[X]==="_"?$[++X].toUpperCase():$[X];return W},d6=($)=>$.replace(/_/g,"-"),E5=($)=>$.replace(/([A-Z])/g,"_$1").toLowerCase(),C5=($)=>($.slice(0,1)+$.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),q5=($)=>$.replace(/-/g,"_");f6.column={from:f6};f6.value={from:aX(f6)};E5.column={to:E5};var eX={...f6};eX.column.to=E5;y6.column={from:y6};y6.value={from:aX(y6)};C5.column={to:C5};var $7={...y6};$7.column.to=C5;d6.column={from:d6};d6.value={from:aX(d6)};q5.column={to:q5};var W7={...d6};W7.column.to=q5;import RQ from"net";import kL from"tls";import j5 from"crypto";import X7 from"stream";import{performance as PQ} from"perf_hooks";class v6 extends Array{constructor(){super();Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}var IL=function($=[]){let W=$.slice(),X=0;return{get length(){return W.length-X},remove:(Y)=>{const Z=W.indexOf(Y);return Z===-1?null:(W.splice(Z,1),Y)},push:(Y)=>(W.push(Y),Y),shift:()=>{const Y=W[X++];if(X===W.length)X=0,W=[];else W[X-1]=void 0;return Y}}},g1=IL;var XW=function($){if(W1.length-z2.i<$){const W=W1,X=W.length;W1=Buffer.allocUnsafe(X+(X>>1)+$),W.copy(W1)}},xL=function(){return z2.i=0,z2};var W1=Buffer.allocUnsafe(256),bL="BCcDdEFfHPpQSX".split("").reduce(($,W)=>{const X=W.charCodeAt(0);return $[W]=()=>{return W1[0]=X,z2.i=5,z2},$},{}),z2=Object.assign(xL,bL,{N:String.fromCharCode(0),i:0,inc($){return z2.i+=$,z2},str($){const W=Buffer.byteLength($);return XW(W),z2.i+=W1.write($,z2.i,W,"utf8"),z2},i16($){return XW(2),W1.writeUInt16BE($,z2.i),z2.i+=2,z2},i32($,W){if(W||W===0)return W1.writeUInt32BE($,W),z2;return XW(4),W1.writeUInt32BE($,z2.i),z2.i+=4,z2},z($){return XW($),W1.fill(0,z2.i,z2.i+$),z2.i+=$,z2},raw($){return W1=Buffer.concat([W1.subarray(0,z2.i),$]),z2.i=W1.length,z2},end($=1){W1.writeUInt32BE(z2.i-$,$);const W=W1.subarray(0,z2.i);return z2.i=0,W1=Buffer.allocUnsafe(256),W}}),O0=z2;var qQ=function($,W={},{onopen:X=H$,onend:Y=H$,onclose:Z=H$}={}){const{ssl:J,max:z,user:Q,host:G,port:A,database:w,parsers:D,transform:O,onnotice:L,onnotify:B,onparameter:M,max_pipeline:H,keep_alive:K,backoff:S,target_session_attrs:R}=$,b=g1(),f=TL++,P={pid:null,secret:null},I=Z7(DW,$.idle_timeout),g=Z7(DW,$.max_lifetime),E=Z7(j,$.connect_timeout);let V=null,k,s=new v6,a=Buffer.alloc(0),v=$.fetch_types,r={},$0={},M0=Math.random().toString(36).slice(2),c=1,e=0,_0=0,n=0,i=0,t=0,A0=0,F0=0,T0=null,v0=null,u0=!1,C=null,J0=null,T=null,H0=null,Y0=null,X0=null,j0=null,Z2=null,Z0=null,b2=null;const t0={queue:W.closed,idleTimer:I,connect(q){T=q||!0,E2()},terminate:N$,execute:g2,cancel:b8,end:DW,count:0,id:f};return W.closed&&W.closed.push(t0),t0;async function _8(){let q;try{q=$.socket?await Promise.resolve($.socket($)):new RQ.Socket}catch(p){h0(p);return}return q.on("error",h0),q.on("close",S7),q.on("drain",l),q}async function b8({pid:q,secret:p},L0,l0){try{k=O0().i32(16).i32(80877102).i32(q).i32(p).end(16),await a0(),V.once("error",l0),V.once("close",L0)}catch(S2){l0(S2)}}function g2(q){if(u0)return h5(q,T2.connection("CONNECTION_DESTROYED",$));if(q.cancelled)return;try{return q.state=P,Z0?b.push(q):(Z0=q,Z0.active=!0),U(q),_(u6(q))&&!q.describeFirst&&!q.cursorFn&&b.length<H&&(!q.options.onexecute||q.options.onexecute(t0))}catch(p){return b.length===0&&_(M6),i0(p),!0}}function u6(q){if(q.parameters.length>=65534)throw T2.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return q.options.simple?O0().Q().str(q.statement.string+O0.N).end():q.describeFirst?Buffer.concat([d5(q),EQ]):q.prepare?q.prepared?M1(q):Buffer.concat([d5(q),M1(q)]):v5(q)}function d5(q){return Buffer.concat([P7(q.statement.string,q.parameters,q.statement.types,q.statement.name),hU("S",q.statement.name)])}function M1(q){return Buffer.concat([vU(q.parameters,q.statement.types,q.statement.name,q.cursorName),q.cursorFn?E7("",q.cursorRows):fL])}function v5(q){return Buffer.concat([P7(q.statement.string,q.parameters,q.statement.types),yL,M1(q)])}function U(q){const p=[],L0=[],l0=tX(q,q.strings[0],q.args[0],p,L0,$);!q.tagged&&q.args.forEach((S2)=>$W(S2,p,L0,$)),q.prepare=$.prepare&&("prepare"in q.options?q.options.prepare:!0),q.string=l0,q.signature=q.prepare&&L0+l0,q.onlyDescribe&&delete $0[q.signature],q.parameters=q.parameters||p,q.prepared=q.prepare&&q.signature in $0,q.describeFirst=q.onlyDescribe||p.length&&!q.prepared,q.statement=q.prepared?$0[q.signature]:{string:l0,types:L0,name:q.prepare?M0+c++:""},typeof $.debug==="function"&&$.debug(f,l0,p,L0)}function _(q,p){if(X0=X0?Buffer.concat([X0,q]):Buffer.from(q),p||X0.length>=1024)return N(p);return v0===null&&(v0=setImmediate(N)),!0}function N(q){const p=V.write(X0,q);return v0!==null&&clearImmediate(v0),X0=v0=null,p}function j(){i0(T2.connection("CONNECT_TIMEOUT",$,V)),V.destroy()}async function d(){if(_(gL),!await new Promise((p)=>V.once("data",(L0)=>p(L0[0]===83)))&&J==="prefer")return o0();V.removeAllListeners(),V=kL.connect({socket:V,servername:RQ.isIP(V.host)?void 0:V.host,...J==="require"||J==="allow"||J==="prefer"?{rejectUnauthorized:!1}:J==="verify-full"?{}:typeof J==="object"?J:{}}),V.on("secureConnect",o0),V.on("error",h0),V.on("close",S7),V.on("drain",l)}function l(){!Z0&&X(t0)}function z0(q){if(C){if(C.push(q),_0-=q.length,_0>=0)return}a=C?Buffer.concat(C,t-_0):a.length===0?q:Buffer.concat([a,q],a.length+q.length);while(a.length>4){if(t=a.readUInt32BE(1),t>=a.length){_0=t-a.length,C=[a];break}try{YU(a.subarray(0,t+1))}catch(p){Z0&&(Z0.cursorFn||Z0.describeFirst)&&_(M6),i0(p)}a=a.subarray(t+1),_0=0,C=null}}async function a0(){if(u0=!1,r={},V||(V=await _8()),!V)return;if(E.start(),$.socket)return J?d():o0();if(V.on("connect",J?d:o0),$.path)return V.connect($.path);V.ssl=J,V.connect(A[n],G[n]),V.host=G[n],V.port=A[n],n=(n+1)%A.length}function E2(){setTimeout(a0,e?e+A0-PQ.now():0)}function o0(){try{$0={},v=$.fetch_types,M0=Math.random().toString(36).slice(2),c=1,g.start(),V.on("data",z0),K&&V.setKeepAlive&&V.setKeepAlive(!0,1000*K);const q=mU();_(q)}catch(q){h0(q)}}function h0(q){if(t0.queue===W.connecting&&$.host[i+1])return;i0(q);while(b.length)h5(b.shift(),q)}function i0(q){Y0&&(Y0.destroy(q),Y0=null),Z0&&h5(Z0,q),T&&(h5(T,q),T=null)}function h5(q,p){Object.defineProperties(p,{stack:{value:p.stack+q.origin.replace(/.*\n/,"\n"),enumerable:$.debug},query:{value:q.string,enumerable:$.debug},parameters:{value:q.parameters,enumerable:$.debug},args:{value:q.args,enumerable:$.debug},types:{value:q.statement&&q.statement.types,enumerable:$.debug}}),q.reject(p)}function DW(){return H0||(!t0.reserved&&Y(t0),!t0.reserved&&!T&&!Z0&&b.length===0?(N$(),new Promise((q)=>V&&V.readyState!=="closed"?V.once("close",q):q())):H0=new Promise((q)=>j0=q))}function N$(){if(u0=!0,Y0||Z0||T||b.length)h0(T2.connection("CONNECTION_DESTROYED",$));if(clearImmediate(v0),V)V.removeListener("data",z0),V.removeListener("connect",o0),V.readyState==="open"&&V.end(O0().X().end());j0&&(j0(),H0=j0=null)}async function S7(q){if(a=Buffer.alloc(0),_0=0,C=null,clearImmediate(v0),V.removeListener("data",z0),V.removeListener("connect",o0),I.cancel(),g.cancel(),E.cancel(),V.removeAllListeners(),V=null,T)return E2();!q&&(Z0||b.length)&&h0(T2.connection("CONNECTION_CLOSED",$,V)),e=PQ.now(),q&&$.shared.retries++,A0=(typeof S==="function"?S($.shared.retries):S)*1000,Z(t0,T2.connection("CONNECTION_CLOSED",$,V))}function YU(q,p=q[0]){(p===68?ZU:p===100?bU:p===65?EU:p===83?JU:p===90?zU:p===67?QU:p===50?R7:p===49?GU:p===116?UU:p===84?MU:p===82?wU:p===110?OU:p===75?NU:p===69?RU:p===115?CU:p===51?qU:p===71?VU:p===78?kU:p===72?jU:p===99?xU:p===73?TU:p===86?gU:p===118?fU:p===87?IU:yU)(q)}function ZU(q){let p=7,L0,l0,S2;const t2=Z0.isRaw?new Array(Z0.statement.columns.length):{};for(let Y1=0;Y1<Z0.statement.columns.length;Y1++)l0=Z0.statement.columns[Y1],L0=q.readInt32BE(p),p+=4,S2=L0===-1?null:Z0.isRaw===!0?q.subarray(p,p+=L0):l0.parser===void 0?q.toString("utf8",p,p+=L0):l0.parser.array===!0?l0.parser(q.toString("utf8",p+1,p+=L0)):l0.parser(q.toString("utf8",p,p+=L0)),Z0.isRaw?t2[Y1]=Z0.isRaw===!0?S2:O.value.from?O.value.from(S2,l0):S2:t2[l0.name]=O.value.from?O.value.from(S2,l0):S2;Z0.forEachFn?Z0.forEachFn(O.row.from?O.row.from(t2):t2,s):s[F0++]=O.row.from?O.row.from(t2):t2}function JU(q){const[p,L0]=q.toString("utf8",5,q.length-1).split(O0.N);if(r[p]=L0,$.parameters[p]!==L0)$.parameters[p]=L0,M&&M(p,L0)}function zU(q){if(Z0&&Z0.options.simple&&Z0.resolve(J0||s),Z0=J0=null,s=new v6,E.cancel(),T){if(R){if(!r.in_hot_standby||!r.default_transaction_read_only)return SU();else if(KU(R,r))return N$()}if(v)return T===!0&&(T=null),LU();T!==!0&&g2(T),$.shared.retries=i=0,T=null;return}while(b.length&&(Z0=b.shift())&&(Z0.active=!0,Z0.cancelled))qQ($).cancel(Z0.state,Z0.cancelled.resolve,Z0.cancelled.reject);if(Z0)return;t0.reserved?!t0.reserved.release&&q[5]===73?H0?N$():(t0.reserved=null,X(t0)):t0.reserved():H0?N$():X(t0)}function QU(q){F0=0;for(let p=q.length-1;p>0;p--){if(q[p]===32&&q[p+1]<58&&s.count===null)s.count=+q.toString("utf8",p+1,q.length-1);if(q[p-1]>=65){s.command=q.toString("utf8",5,p),s.state=P;break}}if(b2&&(b2(),b2=null),s.command==="BEGIN"&&z!==1&&!t0.reserved)return i0(T2.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"));if(Z0.options.simple)return R7();if(Z0.cursorFn)s.count&&Z0.cursorFn(s),_(M6);Z0.resolve(s)}function GU(){Z0.parsing=!1}function R7(){!s.statement&&(s.statement=Z0.statement),s.columns=Z0.statement.columns}function UU(q){const p=q.readUInt16BE(5);for(let L0=0;L0<p;++L0)!Z0.statement.types[L0]&&(Z0.statement.types[L0]=q.readUInt32BE(7+L0*4));Z0.prepare&&($0[Z0.signature]=Z0.statement),Z0.describeFirst&&!Z0.onlyDescribe&&(_(M1(Z0)),Z0.describeFirst=!1)}function MU(q){if(s.command)J0=J0||[s],J0.push(s=new v6),s.count=null,Z0.statement.columns=null;const p=q.readUInt16BE(5);let L0=7,l0;Z0.statement.columns=Array(p);for(let S2=0;S2<p;++S2){l0=L0;while(q[L0++]!==0);const t2=q.readUInt32BE(L0),Y1=q.readUInt16BE(L0+4),l8=q.readUInt32BE(L0+6);Z0.statement.columns[S2]={name:O.column.from?O.column.from(q.toString("utf8",l0,L0-1)):q.toString("utf8",l0,L0-1),parser:D[l8],table:t2,number:Y1,type:l8},L0+=18}if(s.statement=Z0.statement,Z0.onlyDescribe)return Z0.resolve(Z0.statement),_(M6)}async function wU(q,p=q.readUInt32BE(5)){(p===3?AU:p===5?_U:p===10?HU:p===11?DU:p===12?BU:p!==0?dU:H$)(q,p)}async function AU(){const q=await BW();_(O0().p().str(q).z(1).end())}async function _U(q){const p="md5"+await CQ(Buffer.concat([Buffer.from(await CQ(await BW()+Q)),q.subarray(9)]));_(O0().p().str(p).z(1).end())}async function HU(){Z2=(await j5.randomBytes(18)).toString("base64"),O0().p().str("SCRAM-SHA-256"+O0.N);const q=O0.i;_(O0.inc(4).str("n,,n=*,r="+Z2).i32(O0.i-q-4,q).end())}async function DU(q){const p=q.toString("utf8",9).split(",").reduce((Y1,l8)=>(Y1[l8[0]]=l8.slice(2),Y1),{}),L0=await j5.pbkdf2Sync(await BW(),Buffer.from(p.s,"base64"),parseInt(p.i),32,"sha256"),l0=await YW(L0,"Client Key"),S2="n=*,r="+Z2+",r="+p.r+",s="+p.s+",i="+p.i+",c=biws,r="+p.r;T0=(await YW(await YW(L0,"Server Key"),S2)).toString("base64");const t2="c=biws,r="+p.r+",p="+pL(l0,Buffer.from(await YW(await hL(l0),S2))).toString("base64");_(O0().p().str(t2).end())}function BU(q){if(q.toString("utf8",9).split(O0.N,1)[0].slice(2)===T0)return;i0(T2.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),V.destroy()}function BW(){return Promise.resolve(typeof $.pass==="function"?$.pass():$.pass)}function OU(){if(s.statement=Z0.statement,s.statement.columns=[],Z0.onlyDescribe)return Z0.resolve(Z0.statement),_(M6)}function NU(q){P.pid=q.readUInt32BE(5),P.secret=q.readUInt32BE(9)}async function LU(){v=!1,(await new $8([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],g2)).forEach(({oid:p,typarray:L0})=>FU(p,L0))}function FU(q,p){if(!!$.parsers[p]&&!!$.serializers[p])return;const L0=$.parsers[q];$.shared.typeArrayMap[q]=p,$.parsers[p]=(l0)=>KQ(l0,L0,p),$.parsers[p].array=!0,$.serializers[p]=(l0)=>FQ(l0,$.serializers[q],$,p)}function KU(q,p){return q==="read-write"&&p.default_transaction_read_only==="on"||q==="read-only"&&p.default_transaction_read_only==="off"||q==="primary"&&p.in_hot_standby==="on"||q==="standby"&&p.in_hot_standby==="off"||q==="prefer-standby"&&p.in_hot_standby==="off"&&$.host[i]}function SU(){const q=new $8([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],g2,null,{simple:!0});q.resolve=([[p],[L0]])=>{r.default_transaction_read_only=p.transaction_read_only,r.in_hot_standby=L0.pg_is_in_recovery?"on":"off"},q.execute()}function RU(q){Z0&&(Z0.cursorFn||Z0.describeFirst)&&_(M6);const p=T2.postgres(Y7(q));Z0&&Z0.retried?i0(Z0.retried):Z0&&Z0.prepared&&dL.has(p.routine)?PU(Z0,p):i0(p)}function PU(q,p){delete $0[q.signature],q.retried=p,g2(q)}function EU(q){if(!B)return;let p=9;while(q[p++]!==0);B(q.toString("utf8",9,p-1),q.toString("utf8",p,q.length-1))}async function CU(){try{const q=await Promise.resolve(Z0.cursorFn(s));F0=0,q===A$?_(pU(Z0.portal)):(s=new v6,_(E7("",Z0.cursorRows)))}catch(q){_(M6),Z0.reject(q)}}function qU(){s.count&&Z0.cursorFn(s),Z0.resolve(s)}function VU(){Y0=new X7.Writable({autoDestroy:!0,write(q,p,L0){V.write(O0().d().raw(q).end(),L0)},destroy(q,p){p(q),V.write(O0().f().str(q+O0.N).end()),Y0=null},final(q){V.write(O0().c().end()),b2=q}}),Z0.resolve(Y0)}function jU(){Y0=new X7.Readable({read(){V.resume()}}),Z0.resolve(Y0)}function IU(){Y0=new X7.Duplex({autoDestroy:!0,read(){V.resume()},write(q,p,L0){V.write(O0().d().raw(q).end(),L0)},destroy(q,p){p(q),V.write(O0().f().str(q+O0.N).end()),Y0=null},final(q){V.write(O0().c().end()),b2=q}}),Z0.resolve(Y0)}function bU(q){Y0&&(Y0.push(q.subarray(5))||V.pause())}function xU(){Y0&&Y0.push(null),Y0=null}function kU(q){L?L(Y7(q)):console.log(Y7(q))}function TU(){}function gU(){i0(T2.notSupported("FunctionCallResponse"))}function fU(){i0(T2.notSupported("NegotiateProtocolVersion"))}function yU(q){console.error("Postgres.js : Unknown Message:",q[0])}function dU(q,p){console.error("Postgres.js : Unknown Auth:",p)}function vU(q,p,L0="",l0=""){let S2,t2;return O0().B().str(l0+O0.N).str(L0+O0.N).i16(0).i16(q.length),q.forEach((Y1,l8)=>{if(Y1===null)return O0.i32(4294967295);t2=p[l8],q[l8]=Y1=t2 in $.serializers?$.serializers[t2](Y1):""+Y1,S2=O0.i,O0.inc(4).str(Y1).i32(O0.i-S2-4,S2)}),O0.i16(0),O0.end()}function P7(q,p,L0,l0=""){return O0().P().str(l0+O0.N).str(q+O0.N).i16(p.length),p.forEach((S2,t2)=>O0.i32(L0[t2]||0)),O0.end()}function hU(q,p=""){return O0().D().str(q).str(p+O0.N).end()}function E7(q="",p=0){return Buffer.concat([O0().E().str(q+O0.N).i32(p).end(),EQ])}function pU(q=""){return Buffer.concat([O0().C().str("P").str(q+O0.N).end(),O0().S().end()])}function mU(){return k||O0().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:Q,database:w,client_encoding:"UTF8"},$.connection)).filter(([,q])=>q).map(([q,p])=>q+O0.N+p).join(O0.N)).z(2).end(0)}},Y7=function($){const W={};let X=5;for(let Y=5;Y<$.length-1;Y++)if($[Y]===0)W[vL[$[X]]]=$.toString("utf8",X+1,Y),X=Y+1;return W},CQ=function($){return j5.createHash("md5").update($).digest("hex")},YW=function($,W){return j5.createHmac("sha256",$).update(W).digest()},hL=function($){return j5.createHash("sha256").update($).digest()},pL=function($,W){const X=Math.max($.length,W.length),Y=Buffer.allocUnsafe(X);for(let Z=0;Z<X;Z++)Y[Z]=$[Z]^W[Z];return Y},Z7=function($,W){if(W=typeof W==="function"?W():W,!W)return{cancel:H$,start:H$};let X;return{cancel(){X&&(clearTimeout(X),X=null)},start(){X&&clearTimeout(X),X=setTimeout(Y,W*1000,arguments)}};function Y(Z){$.apply(null,Z),X=null}},J7=qQ,TL=1,M6=O0().S().end(),EQ=O0().H().end(),gL=O0().i32(8).i32(80877103).end(8),fL=Buffer.concat([O0().E().str(O0.N).i32(0).end(),M6]),yL=O0().D().str("S").str(O0.N).end(),H$=()=>{},dL=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),vL={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};var mL=function($){return new Date(Date.UTC(2000,0,1)+Number($/BigInt(1000)))},cL=function($,W,X,Y,Z){const J=(z,[Q,G])=>(z[Q.charCodeAt(0)]=G,z);Object.entries({R:(z)=>{let Q=1;const G=W[z.readUInt32BE(Q)]={schema:z.toString("utf8",Q+=4,Q=z.indexOf(0,Q))||"pg_catalog",table:z.toString("utf8",Q+1,Q=z.indexOf(0,Q+1)),columns:Array(z.readUInt16BE(Q+=2)),keys:[]};Q+=2;let A=0,w;while(Q<z.length)w=G.columns[A++]={key:z[Q++],name:Z.column.from?Z.column.from(z.toString("utf8",Q,Q=z.indexOf(0,Q))):z.toString("utf8",Q,Q=z.indexOf(0,Q)),type:z.readUInt32BE(Q+=1),parser:X[z.readUInt32BE(Q)],atttypmod:z.readUInt32BE(Q+=4)},w.key&&G.keys.push(w),Q+=4},Y:()=>{},O:()=>{},B:(z)=>{W.date=mL(z.readBigInt64BE(9)),W.lsn=z.subarray(1,9)},I:(z)=>{let Q=1;const G=W[z.readUInt32BE(Q)],{row:A}=ZW(z,G.columns,Q+=7,Z);Y(A,{command:"insert",relation:G})},D:(z)=>{let Q=1;const G=W[z.readUInt32BE(Q)];Q+=4;const A=z[Q]===75;Y(A||z[Q]===79?ZW(z,G.columns,Q+=3,Z).row:null,{command:"delete",relation:G,key:A})},U:(z)=>{let Q=1;const G=W[z.readUInt32BE(Q)];Q+=4;const A=z[Q]===75,w=A||z[Q]===79?ZW(z,G.columns,Q+=3,Z):null;w&&(Q=w.i);const{row:D}=ZW(z,G.columns,Q+3,Z);Y(D,{command:"update",relation:G,key:A,old:w&&w.row})},T:()=>{},C:()=>{}}).reduce(J,{})[$[0]]($)},ZW=function($,W,X,Y){let Z,J,z;const Q=Y.raw?new Array(W.length):{};for(let G=0;G<W.length;G++)Z=$[X++],J=W[G],z=Z===110?null:Z===117?void 0:J.parser===void 0?$.toString("utf8",X+4,X+=4+$.readUInt32BE(X)):J.parser.array===!0?J.parser($.toString("utf8",X+5,X+=4+$.readUInt32BE(X))):J.parser($.toString("utf8",X+4,X+=4+$.readUInt32BE(X))),Y.raw?Q[G]=Y.raw===!0?z:Y.value.from?Y.value.from(z,J):z:Q[J.name]=Y.value.from?Y.value.from(z,J):z;return{i:X,row:Y.row.from?Y.row.from(Q):Q}},uL=function($){const W=$.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!W)throw new Error("Malformed subscribe pattern: "+$);const[,X,Y,Z]=W;return(X||"*")+(Y?":"+(Y.indexOf(".")===-1?"public."+Y:Y):"")+(Z?"="+Z:"")},VQ=()=>{};function z7($,W){const X=new Map,Y="postgresjs_"+Math.random().toString(36).slice(2),Z={};let J,z,Q=!1;const G=D.sql=$({...W,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...W.connection,replication:"database"},onclose:async function(){if(Q)return;z=null,Z.pid=Z.secret=void 0,O(await L(G,Y,W.publications)),X.forEach((M)=>M.forEach(({onsubscribe:H})=>H()))},no_subscribe:!0}),A=G.end,w=G.close;return G.end=async()=>{return Q=!0,z&&await new Promise((M)=>(z.once("close",M),z.end())),A()},G.close=async()=>{return z&&await new Promise((M)=>(z.once("close",M),z.end())),w()},D;async function D(M,H,K=VQ,S=VQ){if(M=uL(M),!J)J=L(G,Y,W.publications);const R={fn:H,onsubscribe:K},b=X.has(M)?X.get(M).add(R):X.set(M,new Set([R])).get(M),f=()=>{b.delete(R),b.size===0&&X.delete(M)};return J.then((P)=>{return O(P),K(),z&&z.on("error",S),{unsubscribe:f,state:Z,sql:G}})}function O(M){z=M.stream,Z.pid=M.state.pid,Z.secret=M.state.secret}async function L(M,H,K){if(!K)throw new Error("Missing publication names");const S=await M.unsafe(`CREATE_REPLICATION_SLOT ${H} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[R]=S,b=await M.unsafe(`START_REPLICATION SLOT ${H} LOGICAL ${R.consistent_point} (proto_version '1', publication_names '${K}')`).writable(),f={lsn:Buffer.concat(R.consistent_point.split("/").map((V)=>Buffer.from(("00000000"+V).slice(-8),"hex")))};return b.on("data",I),b.on("error",P),b.on("close",M.close),{stream:b,state:S.state};function P(V){console.error("Unexpected error during logical streaming - reconnecting",V)}function I(V){if(V[0]===119)cL(V.subarray(25),f,M.options.parsers,g,W.transform);else if(V[0]===107&&V[17])f.lsn=V.subarray(1,9),E()}function g(V,k){const s=k.relation.schema+"."+k.relation.table;B("*",V,k),B("*:"+s,V,k),k.relation.keys.length&&B("*:"+s+"="+k.relation.keys.map((a)=>V[a.name]),V,k),B(k.command,V,k),B(k.command+":"+s,V,k),k.relation.keys.length&&B(k.command+":"+s+"="+k.relation.keys.map((a)=>V[a.name]),V,k)}function E(){const V=Buffer.alloc(34);V[0]="r".charCodeAt(0),V.fill(f.lsn,1),V.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2000,0,1))*BigInt(1000),25),b.write(V)}}function B(M,H,K){X.has(M)&&X.get(M).forEach(({fn:S})=>S(H,K,M))}}import jQ from"stream";function Q7($,W,X=131072|262144){return new Promise(async(Y,Z)=>{await $.begin(async(J)=>{let z;!W&&([{oid:W}]=await J`select lo_creat(-1) as oid`);const[{fd:Q}]=await J`select lo_open(${W}, ${X}) as fd`,G={writable:w,readable:A,close:()=>J`select lo_close(${Q})`.then(z),tell:()=>J`select lo_tell64(${Q})`,read:(D)=>J`select loread(${Q}, ${D}) as data`,write:(D)=>J`select lowrite(${Q}, ${D})`,truncate:(D)=>J`select lo_truncate64(${Q}, ${D})`,seek:(D,O=0)=>J`select lo_lseek64(${Q}, ${D}, ${O})`,size:()=>J`
          select
            lo_lseek64(${Q}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return Y(G),new Promise(async(D)=>z=D);async function A({highWaterMark:D=16384,start:O=0,end:L=1/0}={}){let B=L-O;return O&&await G.seek(O),new jQ.Readable({highWaterMark:D,async read(M){const H=M>B?M-B:M;B-=M;const[{data:K}]=await G.read(H);if(this.push(K),K.length<M)this.push(null)}})}async function w({highWaterMark:D=16384,start:O=0}={}){return O&&await G.seek(O),new jQ.Writable({highWaterMark:D,write(L,B,M){G.write(L).then(()=>M(),M)}})}}).catch(Z)})}var JW=function($,W){const X=lL($,W),Y=X.no_subscribe||z7(JW,{...X});let Z=!1;const J=g1(),z=g1(),Q=g1(),G=g1(),A=g1(),w=g1(),D=g1(),O=g1(),L={connecting:z,reserved:Q,closed:G,ended:A,open:w,busy:D,full:O},B=[...Array(X.max)].map(()=>J7(X,L,{onopen:$0,onend:r,onclose:M0})),M=H(g);return Object.assign(M,{get parameters(){return X.parameters},largeObject:Q7.bind(null,M),subscribe:Y,CLOSE:A$,END:A$,PostgresError:_$,options:X,reserve:R,listen:K,begin:b,close:s,end:k}),M;function H(c){return c.debug=X.debug,Object.entries(X.types).reduce((t,[A0,F0])=>{return t[A0]=(T0)=>new I8(T0,F0.to),t},e),Object.assign(_0,{types:e,typed:e,unsafe:n,notify:S,array:I,json:P,file:i}),_0;function e(t,A0){return new I8(t,A0)}function _0(t,...A0){return t&&Array.isArray(t.raw)?new $8(t,A0,c,V):typeof t==="string"&&!A0.length?new V5(X.transform.column.to?X.transform.column.to(t):t):new e4(t,A0)}function n(t,A0=[],F0={}){return arguments.length===2&&!Array.isArray(A0)&&(F0=A0,A0=[]),new $8([t],A0,c,V,{prepare:!1,...F0,simple:"simple"in F0?F0.simple:A0.length===0})}function i(t,A0=[],F0={}){return arguments.length===2&&!Array.isArray(A0)&&(F0=A0,A0=[]),new $8([],A0,(v0)=>{iL.readFile(t,"utf8",(u0,C)=>{if(u0)return v0.reject(u0);v0.strings=[C],c(v0)})},V,{...F0,simple:"simple"in F0?F0.simple:A0.length===0})}}async function K(c,e,_0){const n={fn:e,onlisten:_0},i=K.sql||(K.sql=JW({...X,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(K.channels).forEach(([v0,{listeners:u0}])=>{delete K.channels[v0],Promise.all(u0.map((C)=>K(v0,C.fn,C.onlisten).catch(()=>{})))})},onnotify(v0,u0){v0 in K.channels&&K.channels[v0].listeners.forEach((C)=>C.fn(u0))}})),t=K.channels||(K.channels={});if(c in t){t[c].listeners.push(n);const v0=await t[c].result;return n.onlisten&&n.onlisten(),{state:v0.state,unlisten:T0}}t[c]={result:i`listen ${i.unsafe('"'+c.replace(/"/g,'""')+'"')}`,listeners:[n]};const F0=await t[c].result;return n.onlisten&&n.onlisten(),{state:F0.state,unlisten:T0};async function T0(){if(c in t===!1)return;if(t[c].listeners=t[c].listeners.filter((v0)=>v0!==n),t[c].listeners.length)return;return delete t[c],i`unlisten ${i.unsafe('"'+c.replace(/"/g,'""')+'"')}`}}async function S(c,e){return await M`select pg_notify(${c}, ${""+e})`}async function R(){const c=g1(),e=w.length?w.shift():await new Promise((i)=>{J.push({reserve:i}),G.length&&v(G.shift())});f(e,Q),e.reserved=()=>c.length?e.execute(c.shift()):f(e,Q),e.reserved.release=!0;const _0=H(n);return _0.release=()=>{e.reserved=null,$0(e)},_0;function n(i){e.queue===O?c.push(i):e.execute(i)||f(e,O)}}async function b(c,e){!e&&(e=c,c="");const _0=g1();let n=0,i,t=null;try{return await M.unsafe("begin "+c.replace(/[^a-z ]/ig,""),[],{onexecute:F0}).execute(),await Promise.race([A0(i,e),new Promise((T0,v0)=>i.onclose=v0)])}catch(T0){throw T0}async function A0(T0,v0,u0){const C=H(Y0);C.savepoint=H0,C.prepare=(X0)=>t=X0.replace(/[^a-z0-9$-_. ]/gi);let J0,T;u0&&await C`savepoint ${C(u0)}`;try{if(T=await new Promise((X0,j0)=>{const Z2=v0(C);Promise.resolve(Array.isArray(Z2)?Promise.all(Z2):Z2).then(X0,j0)}),J0)throw J0}catch(X0){throw await(u0?C`rollback to ${C(u0)}`:C`rollback`),X0 instanceof _$&&X0.code==="25P02"&&J0||X0}if(!u0)t?await C`prepare transaction '${C.unsafe(t)}'`:await C`commit`;return T;function H0(X0,j0){if(X0&&Array.isArray(X0.raw))return H0((Z2)=>Z2.apply(Z2,arguments));return arguments.length===1&&(j0=X0,X0=null),A0(T0,j0,"s"+n+++(X0?"_"+X0:""))}function Y0(X0){X0.catch((j0)=>J0||(J0=j0)),T0.queue===O?_0.push(X0):T0.execute(X0)||f(T0,O)}}function F0(T0){i=T0,f(T0,Q),T0.reserved=()=>_0.length?T0.execute(_0.shift()):f(T0,Q)}}function f(c,e){return c.queue.remove(c),e.push(c),c.queue=e,e===w?c.idleTimer.start():c.idleTimer.cancel(),c}function P(c){return new I8(c,3802)}function I(c,e){if(!Array.isArray(c))return I(Array.from(arguments));return new I8(c,e||(c.length?r4(c)||25:0),X.shared.typeArrayMap)}function g(c){if(Z)return c.reject(T2.connection("CONNECTION_ENDED",X,X));if(w.length)return E(w.shift(),c);if(G.length)return v(G.shift(),c);D.length?E(D.shift(),c):J.push(c)}function E(c,e){return c.execute(e)?f(c,D):f(c,O)}function V(c){return new Promise((e,_0)=>{c.state?c.active?J7(X).cancel(c.state,e,_0):c.cancelled={resolve:e,reject:_0}:(J.remove(c),c.cancelled=!0,c.reject(T2.generic("57014","canceling statement due to user request")),e())})}async function k({timeout:c=null}={}){if(Z)return Z;await 1;let e;return Z=Promise.race([new Promise((_0)=>c!==null&&(e=setTimeout(a,c*1000,_0))),Promise.all(B.map((_0)=>_0.end()).concat(K.sql?K.sql.end({timeout:0}):[],Y.sql?Y.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(e))}async function s(){await Promise.all(B.map((c)=>c.end()))}async function a(c){await Promise.all(B.map((e)=>e.terminate()));while(J.length)J.shift().reject(T2.connection("CONNECTION_DESTROYED",X));c()}function v(c,e){return f(c,z),c.connect(e),c}function r(c){f(c,A)}function $0(c){if(J.length===0)return f(c,w);let e=Math.ceil(J.length/(z.length+1)),_0=!0;while(_0&&J.length&&e-- >0){const n=J.shift();if(n.reserve)return n.reserve(c);_0=c.execute(n)}_0?f(c,D):f(c,O)}function M0(c,e){f(c,G),c.reserved=null,c.onclose&&(c.onclose(e),c.onclose=null),X.onclose&&X.onclose(c.id),J.length&&v(c,J.shift())}},lL=function($,W){if($&&$.shared)return $;const X=process.env,Y=(!$||typeof $==="string"?W:$)||{},{url:Z,multihost:J}=aL($),z=[...Z.searchParams].reduce((O,[L,B])=>(O[L]=B,O),{}),Q=Y.hostname||Y.host||J||Z.hostname||X.PGHOST||"localhost",G=Y.port||Z.port||X.PGPORT||5432,A=Y.user||Y.username||Z.username||X.PGUSERNAME||X.PGUSER||eL();Y.no_prepare&&(Y.prepare=!1),z.sslmode&&(z.ssl=z.sslmode,delete z.sslmode),"timeout"in Y&&(console.log("The timeout option is deprecated, use idle_timeout instead"),Y.idle_timeout=Y.timeout),z.sslrootcert==="system"&&(z.ssl="verify-full");const w=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],D={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:sL,max_pipeline:100,backoff:tL,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(Q)?Q:Q.split(",").map((O)=>O.split(":")[0]),port:Array.isArray(G)?G:Q.split(",").map((O)=>parseInt(O.split(":")[1]||G)),path:Y.path||Q.indexOf("/")>-1&&Q+"/.s.PGSQL."+G,database:Y.database||Y.db||(Z.pathname||"").slice(1)||X.PGDATABASE||A,user:A,pass:Y.pass||Y.password||Z.password||X.PGPASSWORD||"",...Object.entries(D).reduce((O,[L,B])=>{const M=L in Y?Y[L]:(L in z)?z[L]==="disable"||z[L]==="false"?!1:z[L]:X["PG"+L.toUpperCase()]||B;return O[L]=typeof M==="string"&&w.includes(L)?+M:M,O},{}),connection:{application_name:"postgres.js",...Y.connection,...Object.entries(z).reduce((O,[L,B])=>((L in D)||(O[L]=B),O),{})},types:Y.types||{},target_session_attrs:nL(Y,Z,X),onnotice:Y.onnotice,onnotify:Y.onnotify,onclose:Y.onclose,onparameter:Y.onparameter,socket:Y.socket,transform:rL(Y.transform||{undefined:void 0}),parameters:{},shared:{retries:0,typeArrayMap:{}},...NQ(Y.types)}},nL=function($,W,X){const Y=$.target_session_attrs||W.searchParams.get("target_session_attrs")||X.PGTARGETSESSIONATTRS;if(!Y||["read-write","read-only","primary","standby","prefer-standby"].includes(Y))return Y;throw new Error("target_session_attrs "+Y+" is not supported")},tL=function($){return(0.5+Math.random()/2)*Math.min(3**$/100,20)},sL=function(){return 60*(30+Math.random()*30)},rL=function($){return{undefined:$.undefined,column:{from:typeof $.column==="function"?$.column:$.column&&$.column.from,to:$.column&&$.column.to},value:{from:typeof $.value==="function"?$.value:$.value&&$.value.from,to:$.value&&$.value.to},row:{from:typeof $.row==="function"?$.row:$.row&&$.row.from,to:$.row&&$.row.to}}},aL=function($){if(!$||typeof $!=="string")return{url:{searchParams:new Map}};let W=$;W=W.slice(W.indexOf("://")+3).split(/[?/]/)[0],W=decodeURIComponent(W.slice(W.indexOf("@")+1));const X=new URL($.replace(W,W.split(",")[0]));return{url:{username:decodeURIComponent(X.username),password:decodeURIComponent(X.password),host:X.host,hostname:X.hostname,port:X.port,pathname:X.pathname,searchParams:X.searchParams},multihost:W.indexOf(",")>-1&&W}},eL=function(){try{return oL.userInfo().username}catch($){return process.env.USERNAME||"leo"}};Object.assign(JW,{PostgresError:_$,toPascal:y6,pascal:$7,toCamel:f6,camel:eX,toKebab:d6,kebab:W7,fromPascal:C5,fromCamel:E5,fromKebab:q5,BigInt:{to:20,from:[20],parse:($)=>BigInt($),serialize:($)=>$.toString()}});var IQ=JW;var b5=function($){let W=1779033703,X=3144134277,Y=1013904242,Z=2773480762,J=1359893119,z=2600822924,Q=528734635,G=1541459225,A=0,w=0,D=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],O=F((S,R)=>S>>>R|S<<32-R,"rrot"),L=new Uint32Array(64),B=new Uint8Array(64),M=F(()=>{for(let V=0,k=0;V<16;V++,k+=4)L[V]=B[k]<<24|B[k+1]<<16|B[k+2]<<8|B[k+3];for(let V=16;V<64;V++){let k=O(L[V-15],7)^O(L[V-15],18)^L[V-15]>>>3,s=O(L[V-2],17)^O(L[V-2],19)^L[V-2]>>>10;L[V]=L[V-16]+k+L[V-7]+s|0}let S=W,R=X,b=Y,f=Z,P=J,I=z,g=Q,E=G;for(let V=0;V<64;V++){let k=O(P,6)^O(P,11)^O(P,25),s=P&I^~P&g,a=E+k+s+D[V]+L[V]|0,v=O(S,2)^O(S,13)^O(S,22),r=S&R^S&b^R&b,$0=v+r|0;E=g,g=I,I=P,P=f+a|0,f=b,b=R,R=S,S=a+$0|0}W=W+S|0,X=X+R|0,Y=Y+b|0,Z=Z+f|0,J=J+P|0,z=z+I|0,Q=Q+g|0,G=G+E|0,w=0},"process"),H=F((S)=>{typeof S=="string"&&(S=(new TextEncoder()).encode(S));for(let R=0;R<S.length;R++)B[w++]=S[R],w===64&&M();A+=S.length},"add"),K=F(()=>{if(B[w++]=128,w==64&&M(),w+8>64){for(;w<64;)B[w++]=0;M()}for(;w<58;)B[w++]=0;let S=A*8;B[w++]=S/1099511627776&255,B[w++]=S/4294967296&255,B[w++]=S>>>24,B[w++]=S>>>16&255,B[w++]=S>>>8&255,B[w++]=S&255,M();let R=new Uint8Array(32);return R[0]=W>>>24,R[1]=W>>>16&255,R[2]=W>>>8&255,R[3]=W&255,R[4]=X>>>24,R[5]=X>>>16&255,R[6]=X>>>8&255,R[7]=X&255,R[8]=Y>>>24,R[9]=Y>>>16&255,R[10]=Y>>>8&255,R[11]=Y&255,R[12]=Z>>>24,R[13]=Z>>>16&255,R[14]=Z>>>8&255,R[15]=Z&255,R[16]=J>>>24,R[17]=J>>>16&255,R[18]=J>>>8&255,R[19]=J&255,R[20]=z>>>24,R[21]=z>>>16&255,R[22]=z>>>8&255,R[23]=z&255,R[24]=Q>>>24,R[25]=Q>>>16&255,R[26]=Q>>>8&255,R[27]=Q&255,R[28]=G>>>24,R[29]=G>>>16&255,R[30]=G>>>8&255,R[31]=G&255,R},"digest");return $===void 0?{add:H,digest:K}:(H($),K())},yQ=function($){return X1.getRandomValues(R0.alloc($))},dQ=function($){if($==="sha256")return{update:F(function(W){return{digest:F(function(){return R0.from(b5(W))},"digest")}},"update")};if($==="md5")return{update:F(function(W){return{digest:F(function(){return typeof W=="string"?U7.hashStr(W):U7.hashByteArray(W)},"digest")}},"update")};throw new Error(`Hash type '${$}' not supported`)},vQ=function($,W){if($!=="sha256")throw new Error(`Only sha256 is supported (requested: '${$}')`);return{update:F(function(X){return{digest:F(function(){typeof W=="string"&&(W=(new TextEncoder()).encode(W)),typeof X=="string"&&(X=(new TextEncoder()).encode(X));let Y=W.length;if(Y>64)W=b5(W);else if(Y<64){let G=new Uint8Array(64);G.set(W),W=G}let Z=new Uint8Array(64),J=new Uint8Array(64);for(let G=0;G<64;G++)Z[G]=54^W[G],J[G]=92^W[G];let z=new Uint8Array(X.length+64);z.set(Z,0),z.set(X,64);let Q=new Uint8Array(96);return Q.set(J,0),Q.set(b5(z),64),R0.from(b5(Q))},"digest")}},"update")}},cQ=function(...$){return $.join("/")},oQ=function($,W){W(new Error("No filesystem"))},B7=function($,W=!1){let{protocol:X}=new URL($),Y="http:"+$.substring(X.length),{username:Z,password:J,host:z,hostname:Q,port:G,pathname:A,search:w,searchParams:D,hash:O}=new URL(Y);J=decodeURIComponent(J),Z=decodeURIComponent(Z),A=decodeURIComponent(A);let L=Z+":"+J,B=W?Object.fromEntries(D.entries()):w;return{href:$,protocol:X,auth:L,username:Z,password:J,host:z,hostname:Q,port:G,pathname:A,search:w,query:B,hash:O}},YG=function($){return 0},QG=function({socket:$,servername:W}){return $.startTls(W),$},_W=function($,{arrayMode:W,fullResults:X,fetchOptions:Y,isolationLevel:Z,readOnly:J,deferrable:z,queryCallback:Q,resultCallback:G}={}){if(!$)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let A;try{A=B7($)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String($))}let{protocol:w,username:D,password:O,hostname:L,port:B,pathname:M}=A;if(w!=="postgres:"&&w!=="postgresql:"||!D||!O||!L||!M)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function H(S,...R){let b,f;if(typeof S=="string")b=S,f=R[1],R=R[0]??[];else{b="";for(let I=0;I<S.length;I++)b+=S[I],I<R.length&&(b+="$"+(I+1))}R=R.map((I)=>hF.prepareValue(I));let P={query:b,params:R};return Q&&Q(P),_G(K,P,f)}F(H,"resolve"),H.transaction=async(S,R)=>{if(typeof S=="function"&&(S=S(H)),!Array.isArray(S))throw new Error(TQ);S.forEach((P)=>{if(P[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(TQ)});let b=S.map((P)=>P.parameterizedQuery),f=S.map((P)=>P.opts??{});return K(b,f,R)};async function K(S,R,b){let{fetchEndpoint:f,fetchFunction:P}=AW,I=typeof f=="function"?f(L,B):f,g=Array.isArray(S)?{queries:S}:S,E=Y??{},V=W??!1,k=X??!1,s=Z,a=J,v=z;b!==void 0&&(b.fetchOptions!==void 0&&(E={...E,...b.fetchOptions}),b.arrayMode!==void 0&&(V=b.arrayMode),b.fullResults!==void 0&&(k=b.fullResults),b.isolationLevel!==void 0&&(s=b.isolationLevel),b.readOnly!==void 0&&(a=b.readOnly),b.deferrable!==void 0&&(v=b.deferrable)),R!==void 0&&!Array.isArray(R)&&R.fetchOptions!==void 0&&(E={...E,...R.fetchOptions});let r={"Neon-Connection-String":$,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"};Array.isArray(S)&&(s!==void 0&&(r["Neon-Batch-Isolation-Level"]=s),a!==void 0&&(r["Neon-Batch-Read-Only"]=String(a)),v!==void 0&&(r["Neon-Batch-Deferrable"]=String(v)));let $0;try{$0=await(P??fetch)(I,{method:"POST",body:JSON.stringify(g),headers:r,...E})}catch(M0){let c=new zW(`Error connecting to database: ${M0.message}`);throw c.sourceError=M0,c}if($0.ok){let M0=await $0.json();if(Array.isArray(S)){let c=M0.results;if(!Array.isArray(c))throw new zW("Neon internal error: unexpected result format");return c.map((e,_0)=>{let n=R[_0]??{},i=n.arrayMode??V,t=n.fullResults??k;return M7(e,{arrayMode:i,fullResults:t,parameterizedQuery:S[_0],resultCallback:G})})}else{let c=R??{},e=c.arrayMode??V,_0=c.fullResults??k;return M7(M0,{arrayMode:e,fullResults:_0,parameterizedQuery:S,resultCallback:G})}}else{let{status:M0}=$0;if(M0===400){let c=await $0.json(),e=new zW(c.message);for(let _0 of pF)e[_0]=c[_0]??void 0;throw e}else{let c=await $0.text();throw new zW(`Server error (HTTP status ${M0}): ${c}`)}}}return F(K,"execute"),H},_G=function($,W,X){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:W,opts:X,then:F((Y,Z)=>$(W,X).then(Y,Z),"then"),catch:F((Y)=>$(W,X).catch(Y),"catch"),finally:F((Y)=>$(W,X).finally(Y),"finally")}},M7=function($,{arrayMode:W,fullResults:X,parameterizedQuery:Y,resultCallback:Z}){let J=$.fields.map((G)=>G.name),z=$.fields.map((G)=>p6.types.getTypeParser(G.dataTypeID)),Q=W===!0?$.rows.map((G)=>G.map((A,w)=>A===null?null:z[w](A))):$.rows.map((G)=>Object.fromEntries(G.map((A,w)=>[J[w],A===null?null:z[w](A)])));return Z&&Z(Y,$,Q,{arrayMode:W,fullResults:X}),X?($.viaNeonFetch=!0,$.rowAsArray=W,$.rows=Q,$):Q},DG=function($,W){if(W)return{callback:W,result:void 0};let X,Y,Z=F(function(z,Q){z?X(z):Y(Q)},"cb"),J=new $(function(z,Q){Y=z,X=Q});return{callback:Z,result:J}},$F=Object.create,D$=Object.defineProperty,WF=Object.getOwnPropertyDescriptor,XF=Object.getOwnPropertyNames,YF=Object.getPrototypeOf,ZF=Object.prototype.hasOwnProperty,JF=($,W,X)=>(W in $)?D$($,W,{enumerable:!0,configurable:!0,writable:!0,value:X}):$[W]=X,F=($,W)=>D$($,"name",{value:W,configurable:!0}),S1=($,W)=>()=>($&&(W=$($=0)),W),V0=($,W)=>()=>(W||$((W={exports:{}}).exports,W),W.exports),A8=($,W)=>{for(var X in W)D$($,X,{get:W[X],enumerable:!0})},gQ=($,W,X,Y)=>{if(W&&typeof W=="object"||typeof W=="function")for(let Z of XF(W))!ZF.call($,Z)&&Z!==X&&D$($,Z,{get:()=>W[Z],enumerable:!(Y=WF(W,Z))||Y.enumerable});return $},x5=($,W,X)=>(X=$!=null?$F(YF($)):{},gQ(W||!$||!$.__esModule?D$(X,"default",{value:$,enumerable:!0}):X,$)),m2=($)=>gQ(D$({},"__esModule",{value:!0}),$),S0=($,W,X)=>JF($,typeof W!="symbol"?W+"":W,X),zF=V0(($)=>{N0(),$.byteLength=G,$.toByteArray=w,$.fromByteArray=L;var W=[],X=[],Y=typeof Uint8Array<"u"?Uint8Array:Array,Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(J=0,z=Z.length;J<z;++J)W[J]=Z[J],X[Z.charCodeAt(J)]=J;var J,z;X[45]=62,X[95]=63;function Q(B){var M=B.length;if(M%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var H=B.indexOf("=");H===-1&&(H=M);var K=H===M?0:4-H%4;return[H,K]}F(Q,"getLens");function G(B){var M=Q(B),H=M[0],K=M[1];return(H+K)*3/4-K}F(G,"byteLength");function A(B,M,H){return(M+H)*3/4-H}F(A,"_byteLength");function w(B){var M,H=Q(B),K=H[0],S=H[1],R=new Y(A(B,K,S)),b=0,f=S>0?K-4:K,P;for(P=0;P<f;P+=4)M=X[B.charCodeAt(P)]<<18|X[B.charCodeAt(P+1)]<<12|X[B.charCodeAt(P+2)]<<6|X[B.charCodeAt(P+3)],R[b++]=M>>16&255,R[b++]=M>>8&255,R[b++]=M&255;return S===2&&(M=X[B.charCodeAt(P)]<<2|X[B.charCodeAt(P+1)]>>4,R[b++]=M&255),S===1&&(M=X[B.charCodeAt(P)]<<10|X[B.charCodeAt(P+1)]<<4|X[B.charCodeAt(P+2)]>>2,R[b++]=M>>8&255,R[b++]=M&255),R}F(w,"toByteArray");function D(B){return W[B>>18&63]+W[B>>12&63]+W[B>>6&63]+W[B&63]}F(D,"tripletToBase64");function O(B,M,H){for(var K,S=[],R=M;R<H;R+=3)K=(B[R]<<16&16711680)+(B[R+1]<<8&65280)+(B[R+2]&255),S.push(D(K));return S.join("")}F(O,"encodeChunk");function L(B){for(var M,H=B.length,K=H%3,S=[],R=16383,b=0,f=H-K;b<f;b+=R)S.push(O(B,b,b+R>f?f:b+R));return K===1?(M=B[H-1],S.push(W[M>>2]+W[M<<4&63]+"==")):K===2&&(M=(B[H-2]<<8)+B[H-1],S.push(W[M>>10]+W[M>>4&63]+W[M<<2&63]+"=")),S.join("")}F(L,"fromByteArray")}),QF=V0(($)=>{N0(),$.read=function(W,X,Y,Z,J){var z,Q,G=J*8-Z-1,A=(1<<G)-1,w=A>>1,D=-7,O=Y?J-1:0,L=Y?-1:1,B=W[X+O];for(O+=L,z=B&(1<<-D)-1,B>>=-D,D+=G;D>0;z=z*256+W[X+O],O+=L,D-=8);for(Q=z&(1<<-D)-1,z>>=-D,D+=Z;D>0;Q=Q*256+W[X+O],O+=L,D-=8);if(z===0)z=1-w;else{if(z===A)return Q?NaN:(B?-1:1)*(1/0);Q=Q+Math.pow(2,Z),z=z-w}return(B?-1:1)*Q*Math.pow(2,z-Z)},$.write=function(W,X,Y,Z,J,z){var Q,G,A,w=z*8-J-1,D=(1<<w)-1,O=D>>1,L=J===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=Z?0:z-1,M=Z?1:-1,H=X<0||X===0&&1/X<0?1:0;for(X=Math.abs(X),isNaN(X)||X===1/0?(G=isNaN(X)?1:0,Q=D):(Q=Math.floor(Math.log(X)/Math.LN2),X*(A=Math.pow(2,-Q))<1&&(Q--,A*=2),Q+O>=1?X+=L/A:X+=L*Math.pow(2,1-O),X*A>=2&&(Q++,A/=2),Q+O>=D?(G=0,Q=D):Q+O>=1?(G=(X*A-1)*Math.pow(2,J),Q=Q+O):(G=X*Math.pow(2,O-1)*Math.pow(2,J),Q=0));J>=8;W[Y+B]=G&255,B+=M,G/=256,J-=8);for(Q=Q<<J|G,w+=J;w>0;W[Y+B]=Q&255,B+=M,Q/=256,w-=8);W[Y+B-M]|=H*128}}),GF=V0(($)=>{N0();var W=zF(),X=QF(),Y=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;$.Buffer=Q,$.SlowBuffer=S,$.INSPECT_MAX_BYTES=50;var Z=2147483647;$.kMaxLength=Z,Q.TYPED_ARRAY_SUPPORT=J(),!Q.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function J(){try{let U=new Uint8Array(1),_={foo:F(function(){return 42},"foo")};return Object.setPrototypeOf(_,Uint8Array.prototype),Object.setPrototypeOf(U,_),U.foo()===42}catch{return!1}}F(J,"typedArraySupport"),Object.defineProperty(Q.prototype,"parent",{enumerable:!0,get:F(function(){if(Q.isBuffer(this))return this.buffer},"get")}),Object.defineProperty(Q.prototype,"offset",{enumerable:!0,get:F(function(){if(Q.isBuffer(this))return this.byteOffset},"get")});function z(U){if(U>Z)throw new RangeError('The value "'+U+'" is invalid for option "size"');let _=new Uint8Array(U);return Object.setPrototypeOf(_,Q.prototype),_}F(z,"createBuffer");function Q(U,_,N){if(typeof U=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return D(U)}return G(U,_,N)}F(Q,"Buffer"),Q.poolSize=8192;function G(U,_,N){if(typeof U=="string")return O(U,_);if(ArrayBuffer.isView(U))return B(U);if(U==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U);if(g2(U,ArrayBuffer)||U&&g2(U.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(g2(U,SharedArrayBuffer)||U&&g2(U.buffer,SharedArrayBuffer)))return M(U,_,N);if(typeof U=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let j=U.valueOf&&U.valueOf();if(j!=null&&j!==U)return Q.from(j,_,N);let d=H(U);if(d)return d;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof U[Symbol.toPrimitive]=="function")return Q.from(U[Symbol.toPrimitive]("string"),_,N);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U)}F(G,"from"),Q.from=function(U,_,N){return G(U,_,N)},Object.setPrototypeOf(Q.prototype,Uint8Array.prototype),Object.setPrototypeOf(Q,Uint8Array);function A(U){if(typeof U!="number")throw new TypeError('"size" argument must be of type number');if(U<0)throw new RangeError('The value "'+U+'" is invalid for option "size"')}F(A,"assertSize");function w(U,_,N){return A(U),U<=0?z(U):_!==void 0?typeof N=="string"?z(U).fill(_,N):z(U).fill(_):z(U)}F(w,"alloc"),Q.alloc=function(U,_,N){return w(U,_,N)};function D(U){return A(U),z(U<0?0:K(U)|0)}F(D,"allocUnsafe"),Q.allocUnsafe=function(U){return D(U)},Q.allocUnsafeSlow=function(U){return D(U)};function O(U,_){if((typeof _!="string"||_==="")&&(_="utf8"),!Q.isEncoding(_))throw new TypeError("Unknown encoding: "+_);let N=R(U,_)|0,j=z(N),d=j.write(U,_);return d!==N&&(j=j.slice(0,d)),j}F(O,"fromString");function L(U){let _=U.length<0?0:K(U.length)|0,N=z(_);for(let j=0;j<_;j+=1)N[j]=U[j]&255;return N}F(L,"fromArrayLike");function B(U){if(g2(U,Uint8Array)){let _=new Uint8Array(U);return M(_.buffer,_.byteOffset,_.byteLength)}return L(U)}F(B,"fromArrayView");function M(U,_,N){if(_<0||U.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(U.byteLength<_+(N||0))throw new RangeError('"length" is outside of buffer bounds');let j;return _===void 0&&N===void 0?j=new Uint8Array(U):N===void 0?j=new Uint8Array(U,_):j=new Uint8Array(U,_,N),Object.setPrototypeOf(j,Q.prototype),j}F(M,"fromArrayBuffer");function H(U){if(Q.isBuffer(U)){let _=K(U.length)|0,N=z(_);return N.length===0||U.copy(N,0,0,_),N}if(U.length!==void 0)return typeof U.length!="number"||u6(U.length)?z(0):L(U);if(U.type==="Buffer"&&Array.isArray(U.data))return L(U.data)}F(H,"fromObject");function K(U){if(U>=Z)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Z.toString(16)+" bytes");return U|0}F(K,"checked");function S(U){return+U!=U&&(U=0),Q.alloc(+U)}F(S,"SlowBuffer"),Q.isBuffer=F(function(U){return U!=null&&U._isBuffer===!0&&U!==Q.prototype},"isBuffer"),Q.compare=F(function(U,_){if(g2(U,Uint8Array)&&(U=Q.from(U,U.offset,U.byteLength)),g2(_,Uint8Array)&&(_=Q.from(_,_.offset,_.byteLength)),!Q.isBuffer(U)||!Q.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(U===_)return 0;let N=U.length,j=_.length;for(let d=0,l=Math.min(N,j);d<l;++d)if(U[d]!==_[d]){N=U[d],j=_[d];break}return N<j?-1:j<N?1:0},"compare"),Q.isEncoding=F(function(U){switch(String(U).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},"isEncoding"),Q.concat=F(function(U,_){if(!Array.isArray(U))throw new TypeError('"list" argument must be an Array of Buffers');if(U.length===0)return Q.alloc(0);let N;if(_===void 0)for(_=0,N=0;N<U.length;++N)_+=U[N].length;let j=Q.allocUnsafe(_),d=0;for(N=0;N<U.length;++N){let l=U[N];if(g2(l,Uint8Array))d+l.length>j.length?(Q.isBuffer(l)||(l=Q.from(l)),l.copy(j,d)):Uint8Array.prototype.set.call(j,l,d);else if(Q.isBuffer(l))l.copy(j,d);else throw new TypeError('"list" argument must be an Array of Buffers');d+=l.length}return j},"concat");function R(U,_){if(Q.isBuffer(U))return U.length;if(ArrayBuffer.isView(U)||g2(U,ArrayBuffer))return U.byteLength;if(typeof U!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof U);let N=U.length,j=arguments.length>2&&arguments[2]===!0;if(!j&&N===0)return 0;let d=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return N;case"utf8":case"utf-8":return Z0(U).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N*2;case"hex":return N>>>1;case"base64":return _8(U).length;default:if(d)return j?-1:Z0(U).length;_=(""+_).toLowerCase(),d=!0}}F(R,"byteLength"),Q.byteLength=R;function b(U,_,N){let j=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((N===void 0||N>this.length)&&(N=this.length),N<=0)||(N>>>=0,_>>>=0,N<=_))return"";for(U||(U="utf8");;)switch(U){case"hex":return e(this,_,N);case"utf8":case"utf-8":return v(this,_,N);case"ascii":return M0(this,_,N);case"latin1":case"binary":return c(this,_,N);case"base64":return a(this,_,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _0(this,_,N);default:if(j)throw new TypeError("Unknown encoding: "+U);U=(U+"").toLowerCase(),j=!0}}F(b,"slowToString"),Q.prototype._isBuffer=!0;function f(U,_,N){let j=U[_];U[_]=U[N],U[N]=j}F(f,"swap"),Q.prototype.swap16=F(function(){let U=this.length;if(U%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<U;_+=2)f(this,_,_+1);return this},"swap16"),Q.prototype.swap32=F(function(){let U=this.length;if(U%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<U;_+=4)f(this,_,_+3),f(this,_+1,_+2);return this},"swap32"),Q.prototype.swap64=F(function(){let U=this.length;if(U%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<U;_+=8)f(this,_,_+7),f(this,_+1,_+6),f(this,_+2,_+5),f(this,_+3,_+4);return this},"swap64"),Q.prototype.toString=F(function(){let U=this.length;return U===0?"":arguments.length===0?v(this,0,U):b.apply(this,arguments)},"toString"),Q.prototype.toLocaleString=Q.prototype.toString,Q.prototype.equals=F(function(U){if(!Q.isBuffer(U))throw new TypeError("Argument must be a Buffer");return this===U?!0:Q.compare(this,U)===0},"equals"),Q.prototype.inspect=F(function(){let U="",_=$.INSPECT_MAX_BYTES;return U=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(U+=" ... "),"<Buffer "+U+">"},"inspect"),Y&&(Q.prototype[Y]=Q.prototype.inspect),Q.prototype.compare=F(function(U,_,N,j,d){if(g2(U,Uint8Array)&&(U=Q.from(U,U.offset,U.byteLength)),!Q.isBuffer(U))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof U);if(_===void 0&&(_=0),N===void 0&&(N=U?U.length:0),j===void 0&&(j=0),d===void 0&&(d=this.length),_<0||N>U.length||j<0||d>this.length)throw new RangeError("out of range index");if(j>=d&&_>=N)return 0;if(j>=d)return-1;if(_>=N)return 1;if(_>>>=0,N>>>=0,j>>>=0,d>>>=0,this===U)return 0;let l=d-j,z0=N-_,a0=Math.min(l,z0),E2=this.slice(j,d),o0=U.slice(_,N);for(let h0=0;h0<a0;++h0)if(E2[h0]!==o0[h0]){l=E2[h0],z0=o0[h0];break}return l<z0?-1:z0<l?1:0},"compare");function P(U,_,N,j,d){if(U.length===0)return-1;if(typeof N=="string"?(j=N,N=0):N>2147483647?N=2147483647:N<-2147483648&&(N=-2147483648),N=+N,u6(N)&&(N=d?0:U.length-1),N<0&&(N=U.length+N),N>=U.length){if(d)return-1;N=U.length-1}else if(N<0)if(d)N=0;else return-1;if(typeof _=="string"&&(_=Q.from(_,j)),Q.isBuffer(_))return _.length===0?-1:I(U,_,N,j,d);if(typeof _=="number")return _=_&255,typeof Uint8Array.prototype.indexOf=="function"?d?Uint8Array.prototype.indexOf.call(U,_,N):Uint8Array.prototype.lastIndexOf.call(U,_,N):I(U,[_],N,j,d);throw new TypeError("val must be string, number or Buffer")}F(P,"bidirectionalIndexOf");function I(U,_,N,j,d){let l=1,z0=U.length,a0=_.length;if(j!==void 0&&(j=String(j).toLowerCase(),j==="ucs2"||j==="ucs-2"||j==="utf16le"||j==="utf-16le")){if(U.length<2||_.length<2)return-1;l=2,z0/=2,a0/=2,N/=2}function E2(h0,i0){return l===1?h0[i0]:h0.readUInt16BE(i0*l)}F(E2,"read");let o0;if(d){let h0=-1;for(o0=N;o0<z0;o0++)if(E2(U,o0)===E2(_,h0===-1?0:o0-h0)){if(h0===-1&&(h0=o0),o0-h0+1===a0)return h0*l}else h0!==-1&&(o0-=o0-h0),h0=-1}else for(N+a0>z0&&(N=z0-a0),o0=N;o0>=0;o0--){let h0=!0;for(let i0=0;i0<a0;i0++)if(E2(U,o0+i0)!==E2(_,i0)){h0=!1;break}if(h0)return o0}return-1}F(I,"arrayIndexOf"),Q.prototype.includes=F(function(U,_,N){return this.indexOf(U,_,N)!==-1},"includes"),Q.prototype.indexOf=F(function(U,_,N){return P(this,U,_,N,!0)},"indexOf"),Q.prototype.lastIndexOf=F(function(U,_,N){return P(this,U,_,N,!1)},"lastIndexOf");function g(U,_,N,j){N=Number(N)||0;let d=U.length-N;j?(j=Number(j),j>d&&(j=d)):j=d;let l=_.length;j>l/2&&(j=l/2);let z0;for(z0=0;z0<j;++z0){let a0=parseInt(_.substr(z0*2,2),16);if(u6(a0))return z0;U[N+z0]=a0}return z0}F(g,"hexWrite");function E(U,_,N,j){return b8(Z0(_,U.length-N),U,N,j)}F(E,"utf8Write");function V(U,_,N,j){return b8(b2(_),U,N,j)}F(V,"asciiWrite");function k(U,_,N,j){return b8(_8(_),U,N,j)}F(k,"base64Write");function s(U,_,N,j){return b8(t0(_,U.length-N),U,N,j)}F(s,"ucs2Write"),Q.prototype.write=F(function(U,_,N,j){if(_===void 0)j="utf8",N=this.length,_=0;else if(N===void 0&&typeof _=="string")j=_,N=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(N)?(N=N>>>0,j===void 0&&(j="utf8")):(j=N,N=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let d=this.length-_;if((N===void 0||N>d)&&(N=d),U.length>0&&(N<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");j||(j="utf8");let l=!1;for(;;)switch(j){case"hex":return g(this,U,_,N);case"utf8":case"utf-8":return E(this,U,_,N);case"ascii":case"latin1":case"binary":return V(this,U,_,N);case"base64":return k(this,U,_,N);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s(this,U,_,N);default:if(l)throw new TypeError("Unknown encoding: "+j);j=(""+j).toLowerCase(),l=!0}},"write"),Q.prototype.toJSON=F(function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},"toJSON");function a(U,_,N){return _===0&&N===U.length?W.fromByteArray(U):W.fromByteArray(U.slice(_,N))}F(a,"base64Slice");function v(U,_,N){N=Math.min(U.length,N);let j=[],d=_;for(;d<N;){let l=U[d],z0=null,a0=l>239?4:l>223?3:l>191?2:1;if(d+a0<=N){let E2,o0,h0,i0;switch(a0){case 1:l<128&&(z0=l);break;case 2:E2=U[d+1],(E2&192)===128&&(i0=(l&31)<<6|E2&63,i0>127&&(z0=i0));break;case 3:E2=U[d+1],o0=U[d+2],(E2&192)===128&&(o0&192)===128&&(i0=(l&15)<<12|(E2&63)<<6|o0&63,i0>2047&&(i0<55296||i0>57343)&&(z0=i0));break;case 4:E2=U[d+1],o0=U[d+2],h0=U[d+3],(E2&192)===128&&(o0&192)===128&&(h0&192)===128&&(i0=(l&15)<<18|(E2&63)<<12|(o0&63)<<6|h0&63,i0>65535&&i0<1114112&&(z0=i0))}}z0===null?(z0=65533,a0=1):z0>65535&&(z0-=65536,j.push(z0>>>10&1023|55296),z0=56320|z0&1023),j.push(z0),d+=a0}return $0(j)}F(v,"utf8Slice");var r=4096;function $0(U){let _=U.length;if(_<=r)return String.fromCharCode.apply(String,U);let N="",j=0;for(;j<_;)N+=String.fromCharCode.apply(String,U.slice(j,j+=r));return N}F($0,"decodeCodePointsArray");function M0(U,_,N){let j="";N=Math.min(U.length,N);for(let d=_;d<N;++d)j+=String.fromCharCode(U[d]&127);return j}F(M0,"asciiSlice");function c(U,_,N){let j="";N=Math.min(U.length,N);for(let d=_;d<N;++d)j+=String.fromCharCode(U[d]);return j}F(c,"latin1Slice");function e(U,_,N){let j=U.length;(!_||_<0)&&(_=0),(!N||N<0||N>j)&&(N=j);let d="";for(let l=_;l<N;++l)d+=d5[U[l]];return d}F(e,"hexSlice");function _0(U,_,N){let j=U.slice(_,N),d="";for(let l=0;l<j.length-1;l+=2)d+=String.fromCharCode(j[l]+j[l+1]*256);return d}F(_0,"utf16leSlice"),Q.prototype.slice=F(function(U,_){let N=this.length;U=~~U,_=_===void 0?N:~~_,U<0?(U+=N,U<0&&(U=0)):U>N&&(U=N),_<0?(_+=N,_<0&&(_=0)):_>N&&(_=N),_<U&&(_=U);let j=this.subarray(U,_);return Object.setPrototypeOf(j,Q.prototype),j},"slice");function n(U,_,N){if(U%1!==0||U<0)throw new RangeError("offset is not uint");if(U+_>N)throw new RangeError("Trying to access beyond buffer length")}F(n,"checkOffset"),Q.prototype.readUintLE=Q.prototype.readUIntLE=F(function(U,_,N){U=U>>>0,_=_>>>0,N||n(U,_,this.length);let j=this[U],d=1,l=0;for(;++l<_&&(d*=256);)j+=this[U+l]*d;return j},"readUIntLE"),Q.prototype.readUintBE=Q.prototype.readUIntBE=F(function(U,_,N){U=U>>>0,_=_>>>0,N||n(U,_,this.length);let j=this[U+--_],d=1;for(;_>0&&(d*=256);)j+=this[U+--_]*d;return j},"readUIntBE"),Q.prototype.readUint8=Q.prototype.readUInt8=F(function(U,_){return U=U>>>0,_||n(U,1,this.length),this[U]},"readUInt8"),Q.prototype.readUint16LE=Q.prototype.readUInt16LE=F(function(U,_){return U=U>>>0,_||n(U,2,this.length),this[U]|this[U+1]<<8},"readUInt16LE"),Q.prototype.readUint16BE=Q.prototype.readUInt16BE=F(function(U,_){return U=U>>>0,_||n(U,2,this.length),this[U]<<8|this[U+1]},"readUInt16BE"),Q.prototype.readUint32LE=Q.prototype.readUInt32LE=F(function(U,_){return U=U>>>0,_||n(U,4,this.length),(this[U]|this[U+1]<<8|this[U+2]<<16)+this[U+3]*16777216},"readUInt32LE"),Q.prototype.readUint32BE=Q.prototype.readUInt32BE=F(function(U,_){return U=U>>>0,_||n(U,4,this.length),this[U]*16777216+(this[U+1]<<16|this[U+2]<<8|this[U+3])},"readUInt32BE"),Q.prototype.readBigUInt64LE=M1(F(function(U){U=U>>>0,Y0(U,"offset");let _=this[U],N=this[U+7];(_===void 0||N===void 0)&&X0(U,this.length-8);let j=_+this[++U]*256+this[++U]*65536+this[++U]*16777216,d=this[++U]+this[++U]*256+this[++U]*65536+N*16777216;return BigInt(j)+(BigInt(d)<<BigInt(32))},"readBigUInt64LE")),Q.prototype.readBigUInt64BE=M1(F(function(U){U=U>>>0,Y0(U,"offset");let _=this[U],N=this[U+7];(_===void 0||N===void 0)&&X0(U,this.length-8);let j=_*16777216+this[++U]*65536+this[++U]*256+this[++U],d=this[++U]*16777216+this[++U]*65536+this[++U]*256+N;return(BigInt(j)<<BigInt(32))+BigInt(d)},"readBigUInt64BE")),Q.prototype.readIntLE=F(function(U,_,N){U=U>>>0,_=_>>>0,N||n(U,_,this.length);let j=this[U],d=1,l=0;for(;++l<_&&(d*=256);)j+=this[U+l]*d;return d*=128,j>=d&&(j-=Math.pow(2,8*_)),j},"readIntLE"),Q.prototype.readIntBE=F(function(U,_,N){U=U>>>0,_=_>>>0,N||n(U,_,this.length);let j=_,d=1,l=this[U+--j];for(;j>0&&(d*=256);)l+=this[U+--j]*d;return d*=128,l>=d&&(l-=Math.pow(2,8*_)),l},"readIntBE"),Q.prototype.readInt8=F(function(U,_){return U=U>>>0,_||n(U,1,this.length),this[U]&128?(255-this[U]+1)*-1:this[U]},"readInt8"),Q.prototype.readInt16LE=F(function(U,_){U=U>>>0,_||n(U,2,this.length);let N=this[U]|this[U+1]<<8;return N&32768?N|4294901760:N},"readInt16LE"),Q.prototype.readInt16BE=F(function(U,_){U=U>>>0,_||n(U,2,this.length);let N=this[U+1]|this[U]<<8;return N&32768?N|4294901760:N},"readInt16BE"),Q.prototype.readInt32LE=F(function(U,_){return U=U>>>0,_||n(U,4,this.length),this[U]|this[U+1]<<8|this[U+2]<<16|this[U+3]<<24},"readInt32LE"),Q.prototype.readInt32BE=F(function(U,_){return U=U>>>0,_||n(U,4,this.length),this[U]<<24|this[U+1]<<16|this[U+2]<<8|this[U+3]},"readInt32BE"),Q.prototype.readBigInt64LE=M1(F(function(U){U=U>>>0,Y0(U,"offset");let _=this[U],N=this[U+7];(_===void 0||N===void 0)&&X0(U,this.length-8);let j=this[U+4]+this[U+5]*256+this[U+6]*65536+(N<<24);return(BigInt(j)<<BigInt(32))+BigInt(_+this[++U]*256+this[++U]*65536+this[++U]*16777216)},"readBigInt64LE")),Q.prototype.readBigInt64BE=M1(F(function(U){U=U>>>0,Y0(U,"offset");let _=this[U],N=this[U+7];(_===void 0||N===void 0)&&X0(U,this.length-8);let j=(_<<24)+this[++U]*65536+this[++U]*256+this[++U];return(BigInt(j)<<BigInt(32))+BigInt(this[++U]*16777216+this[++U]*65536+this[++U]*256+N)},"readBigInt64BE")),Q.prototype.readFloatLE=F(function(U,_){return U=U>>>0,_||n(U,4,this.length),X.read(this,U,!0,23,4)},"readFloatLE"),Q.prototype.readFloatBE=F(function(U,_){return U=U>>>0,_||n(U,4,this.length),X.read(this,U,!1,23,4)},"readFloatBE"),Q.prototype.readDoubleLE=F(function(U,_){return U=U>>>0,_||n(U,8,this.length),X.read(this,U,!0,52,8)},"readDoubleLE"),Q.prototype.readDoubleBE=F(function(U,_){return U=U>>>0,_||n(U,8,this.length),X.read(this,U,!1,52,8)},"readDoubleBE");function i(U,_,N,j,d,l){if(!Q.isBuffer(U))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>d||_<l)throw new RangeError('"value" argument is out of bounds');if(N+j>U.length)throw new RangeError("Index out of range")}F(i,"checkInt"),Q.prototype.writeUintLE=Q.prototype.writeUIntLE=F(function(U,_,N,j){if(U=+U,_=_>>>0,N=N>>>0,!j){let z0=Math.pow(2,8*N)-1;i(this,U,_,N,z0,0)}let d=1,l=0;for(this[_]=U&255;++l<N&&(d*=256);)this[_+l]=U/d&255;return _+N},"writeUIntLE"),Q.prototype.writeUintBE=Q.prototype.writeUIntBE=F(function(U,_,N,j){if(U=+U,_=_>>>0,N=N>>>0,!j){let z0=Math.pow(2,8*N)-1;i(this,U,_,N,z0,0)}let d=N-1,l=1;for(this[_+d]=U&255;--d>=0&&(l*=256);)this[_+d]=U/l&255;return _+N},"writeUIntBE"),Q.prototype.writeUint8=Q.prototype.writeUInt8=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,1,255,0),this[_]=U&255,_+1},"writeUInt8"),Q.prototype.writeUint16LE=Q.prototype.writeUInt16LE=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,2,65535,0),this[_]=U&255,this[_+1]=U>>>8,_+2},"writeUInt16LE"),Q.prototype.writeUint16BE=Q.prototype.writeUInt16BE=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,2,65535,0),this[_]=U>>>8,this[_+1]=U&255,_+2},"writeUInt16BE"),Q.prototype.writeUint32LE=Q.prototype.writeUInt32LE=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,4,4294967295,0),this[_+3]=U>>>24,this[_+2]=U>>>16,this[_+1]=U>>>8,this[_]=U&255,_+4},"writeUInt32LE"),Q.prototype.writeUint32BE=Q.prototype.writeUInt32BE=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,4,4294967295,0),this[_]=U>>>24,this[_+1]=U>>>16,this[_+2]=U>>>8,this[_+3]=U&255,_+4},"writeUInt32BE");function t(U,_,N,j,d){H0(_,j,d,U,N,7);let l=Number(_&BigInt(4294967295));U[N++]=l,l=l>>8,U[N++]=l,l=l>>8,U[N++]=l,l=l>>8,U[N++]=l;let z0=Number(_>>BigInt(32)&BigInt(4294967295));return U[N++]=z0,z0=z0>>8,U[N++]=z0,z0=z0>>8,U[N++]=z0,z0=z0>>8,U[N++]=z0,N}F(t,"wrtBigUInt64LE");function A0(U,_,N,j,d){H0(_,j,d,U,N,7);let l=Number(_&BigInt(4294967295));U[N+7]=l,l=l>>8,U[N+6]=l,l=l>>8,U[N+5]=l,l=l>>8,U[N+4]=l;let z0=Number(_>>BigInt(32)&BigInt(4294967295));return U[N+3]=z0,z0=z0>>8,U[N+2]=z0,z0=z0>>8,U[N+1]=z0,z0=z0>>8,U[N]=z0,N+8}F(A0,"wrtBigUInt64BE"),Q.prototype.writeBigUInt64LE=M1(F(function(U,_=0){return t(this,U,_,BigInt(0),BigInt("0xffffffffffffffff"))},"writeBigUInt64LE")),Q.prototype.writeBigUInt64BE=M1(F(function(U,_=0){return A0(this,U,_,BigInt(0),BigInt("0xffffffffffffffff"))},"writeBigUInt64BE")),Q.prototype.writeIntLE=F(function(U,_,N,j){if(U=+U,_=_>>>0,!j){let a0=Math.pow(2,8*N-1);i(this,U,_,N,a0-1,-a0)}let d=0,l=1,z0=0;for(this[_]=U&255;++d<N&&(l*=256);)U<0&&z0===0&&this[_+d-1]!==0&&(z0=1),this[_+d]=(U/l>>0)-z0&255;return _+N},"writeIntLE"),Q.prototype.writeIntBE=F(function(U,_,N,j){if(U=+U,_=_>>>0,!j){let a0=Math.pow(2,8*N-1);i(this,U,_,N,a0-1,-a0)}let d=N-1,l=1,z0=0;for(this[_+d]=U&255;--d>=0&&(l*=256);)U<0&&z0===0&&this[_+d+1]!==0&&(z0=1),this[_+d]=(U/l>>0)-z0&255;return _+N},"writeIntBE"),Q.prototype.writeInt8=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,1,127,-128),U<0&&(U=255+U+1),this[_]=U&255,_+1},"writeInt8"),Q.prototype.writeInt16LE=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,2,32767,-32768),this[_]=U&255,this[_+1]=U>>>8,_+2},"writeInt16LE"),Q.prototype.writeInt16BE=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,2,32767,-32768),this[_]=U>>>8,this[_+1]=U&255,_+2},"writeInt16BE"),Q.prototype.writeInt32LE=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,4,2147483647,-2147483648),this[_]=U&255,this[_+1]=U>>>8,this[_+2]=U>>>16,this[_+3]=U>>>24,_+4},"writeInt32LE"),Q.prototype.writeInt32BE=F(function(U,_,N){return U=+U,_=_>>>0,N||i(this,U,_,4,2147483647,-2147483648),U<0&&(U=4294967295+U+1),this[_]=U>>>24,this[_+1]=U>>>16,this[_+2]=U>>>8,this[_+3]=U&255,_+4},"writeInt32BE"),Q.prototype.writeBigInt64LE=M1(F(function(U,_=0){return t(this,U,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))},"writeBigInt64LE")),Q.prototype.writeBigInt64BE=M1(F(function(U,_=0){return A0(this,U,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))},"writeBigInt64BE"));function F0(U,_,N,j,d,l){if(N+j>U.length)throw new RangeError("Index out of range");if(N<0)throw new RangeError("Index out of range")}F(F0,"checkIEEE754");function T0(U,_,N,j,d){return _=+_,N=N>>>0,d||F0(U,_,N,4,340282346638528860000000000000000000000,-340282346638528860000000000000000000000),X.write(U,_,N,j,23,4),N+4}F(T0,"writeFloat"),Q.prototype.writeFloatLE=F(function(U,_,N){return T0(this,U,_,!0,N)},"writeFloatLE"),Q.prototype.writeFloatBE=F(function(U,_,N){return T0(this,U,_,!1,N)},"writeFloatBE");function v0(U,_,N,j,d){return _=+_,N=N>>>0,d||F0(U,_,N,8,179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,-179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000),X.write(U,_,N,j,52,8),N+8}F(v0,"writeDouble"),Q.prototype.writeDoubleLE=F(function(U,_,N){return v0(this,U,_,!0,N)},"writeDoubleLE"),Q.prototype.writeDoubleBE=F(function(U,_,N){return v0(this,U,_,!1,N)},"writeDoubleBE"),Q.prototype.copy=F(function(U,_,N,j){if(!Q.isBuffer(U))throw new TypeError("argument should be a Buffer");if(N||(N=0),!j&&j!==0&&(j=this.length),_>=U.length&&(_=U.length),_||(_=0),j>0&&j<N&&(j=N),j===N||U.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(N<0||N>=this.length)throw new RangeError("Index out of range");if(j<0)throw new RangeError("sourceEnd out of bounds");j>this.length&&(j=this.length),U.length-_<j-N&&(j=U.length-_+N);let d=j-N;return this===U&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(_,N,j):Uint8Array.prototype.set.call(U,this.subarray(N,j),_),d},"copy"),Q.prototype.fill=F(function(U,_,N,j){if(typeof U=="string"){if(typeof _=="string"?(j=_,_=0,N=this.length):typeof N=="string"&&(j=N,N=this.length),j!==void 0&&typeof j!="string")throw new TypeError("encoding must be a string");if(typeof j=="string"&&!Q.isEncoding(j))throw new TypeError("Unknown encoding: "+j);if(U.length===1){let l=U.charCodeAt(0);(j==="utf8"&&l<128||j==="latin1")&&(U=l)}}else typeof U=="number"?U=U&255:typeof U=="boolean"&&(U=Number(U));if(_<0||this.length<_||this.length<N)throw new RangeError("Out of range index");if(N<=_)return this;_=_>>>0,N=N===void 0?this.length:N>>>0,U||(U=0);let d;if(typeof U=="number")for(d=_;d<N;++d)this[d]=U;else{let l=Q.isBuffer(U)?U:Q.from(U,j),z0=l.length;if(z0===0)throw new TypeError('The value "'+U+'" is invalid for argument "value"');for(d=0;d<N-_;++d)this[d+_]=l[d%z0]}return this},"fill");var u0={};function C(U,_,N){var j;u0[U]=(j=class extends N{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${U}]`,this.stack,delete this.name}get code(){return U}set code(d){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:d,writable:!0})}toString(){return`${this.name} [${U}]: ${this.message}`}},F(j,"NodeError"),j)}F(C,"E"),C("ERR_BUFFER_OUT_OF_BOUNDS",function(U){return U?`${U} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),C("ERR_INVALID_ARG_TYPE",function(U,_){return`The "${U}" argument must be of type number. Received type ${typeof _}`},TypeError),C("ERR_OUT_OF_RANGE",function(U,_,N){let j=`The value of "${U}" is out of range.`,d=N;return Number.isInteger(N)&&Math.abs(N)>4294967296?d=J0(String(N)):typeof N=="bigint"&&(d=String(N),(N>BigInt(2)**BigInt(32)||N<-(BigInt(2)**BigInt(32)))&&(d=J0(d)),d+="n"),j+=` It must be ${_}. Received ${d}`,j},RangeError);function J0(U){let _="",N=U.length,j=U[0]==="-"?1:0;for(;N>=j+4;N-=3)_=`_${U.slice(N-3,N)}${_}`;return`${U.slice(0,N)}${_}`}F(J0,"addNumericalSeparator");function T(U,_,N){Y0(_,"offset"),(U[_]===void 0||U[_+N]===void 0)&&X0(_,U.length-(N+1))}F(T,"checkBounds");function H0(U,_,N,j,d,l){if(U>N||U<_){let z0=typeof _=="bigint"?"n":"",a0;throw l>3?_===0||_===BigInt(0)?a0=`>= 0${z0} and < 2${z0} ** ${(l+1)*8}${z0}`:a0=`>= -(2${z0} ** ${(l+1)*8-1}${z0}) and < 2 ** ${(l+1)*8-1}${z0}`:a0=`>= ${_}${z0} and <= ${N}${z0}`,new u0.ERR_OUT_OF_RANGE("value",a0,U)}T(j,d,l)}F(H0,"checkIntBI");function Y0(U,_){if(typeof U!="number")throw new u0.ERR_INVALID_ARG_TYPE(_,"number",U)}F(Y0,"validateNumber");function X0(U,_,N){throw Math.floor(U)!==U?(Y0(U,N),new u0.ERR_OUT_OF_RANGE(N||"offset","an integer",U)):_<0?new u0.ERR_BUFFER_OUT_OF_BOUNDS:new u0.ERR_OUT_OF_RANGE(N||"offset",`>= ${N?1:0} and <= ${_}`,U)}F(X0,"boundsError");var j0=/[^+/0-9A-Za-z-_]/g;function Z2(U){if(U=U.split("=")[0],U=U.trim().replace(j0,""),U.length<2)return"";for(;U.length%4!==0;)U=U+"=";return U}F(Z2,"base64clean");function Z0(U,_){_=_||1/0;let N,j=U.length,d=null,l=[];for(let z0=0;z0<j;++z0){if(N=U.charCodeAt(z0),N>55295&&N<57344){if(!d){if(N>56319){(_-=3)>-1&&l.push(239,191,189);continue}else if(z0+1===j){(_-=3)>-1&&l.push(239,191,189);continue}d=N;continue}if(N<56320){(_-=3)>-1&&l.push(239,191,189),d=N;continue}N=(d-55296<<10|N-56320)+65536}else d&&(_-=3)>-1&&l.push(239,191,189);if(d=null,N<128){if((_-=1)<0)break;l.push(N)}else if(N<2048){if((_-=2)<0)break;l.push(N>>6|192,N&63|128)}else if(N<65536){if((_-=3)<0)break;l.push(N>>12|224,N>>6&63|128,N&63|128)}else if(N<1114112){if((_-=4)<0)break;l.push(N>>18|240,N>>12&63|128,N>>6&63|128,N&63|128)}else throw new Error("Invalid code point")}return l}F(Z0,"utf8ToBytes");function b2(U){let _=[];for(let N=0;N<U.length;++N)_.push(U.charCodeAt(N)&255);return _}F(b2,"asciiToBytes");function t0(U,_){let N,j,d,l=[];for(let z0=0;z0<U.length&&!((_-=2)<0);++z0)N=U.charCodeAt(z0),j=N>>8,d=N%256,l.push(d),l.push(j);return l}F(t0,"utf16leToBytes");function _8(U){return W.toByteArray(Z2(U))}F(_8,"base64ToBytes");function b8(U,_,N,j){let d;for(d=0;d<j&&!(d+N>=_.length||d>=U.length);++d)_[d+N]=U[d];return d}F(b8,"blitBuffer");function g2(U,_){return U instanceof _||U!=null&&U.constructor!=null&&U.constructor.name!=null&&U.constructor.name===_.name}F(g2,"isInstance");function u6(U){return U!==U}F(u6,"numberIsNaN");var d5=function(){let U="0123456789abcdef",_=new Array(256);for(let N=0;N<16;++N){let j=N*16;for(let d=0;d<16;++d)_[j+d]=U[N]+U[d]}return _}();function M1(U){return typeof BigInt>"u"?v5:U}F(M1,"defineBigIntMethod");function v5(){throw new Error("BigInt not supported")}F(v5,"BufferBigIntNotDefined")}),QW,w7,UF,X1,R0,q0,N0=S1(()=>{QW=globalThis,w7=globalThis.setImmediate??(($)=>setTimeout($,0)),UF=globalThis.clearImmediate??(($)=>clearTimeout($)),X1=globalThis.crypto??{},X1.subtle??(X1.subtle={}),R0=typeof globalThis.Buffer=="function"&&typeof globalThis.Buffer.allocUnsafe=="function"?globalThis.Buffer:GF().Buffer,q0=globalThis.process??{},q0.env??(q0.env={});try{q0.nextTick(()=>{})}catch{let $=Promise.resolve();q0.nextTick=$.then.bind($)}}),h6=V0(($,W)=>{N0();var X=typeof Reflect=="object"?Reflect:null,Y=X&&typeof X.apply=="function"?X.apply:F(function(P,I,g){return Function.prototype.apply.call(P,I,g)},"ReflectApply"),Z;X&&typeof X.ownKeys=="function"?Z=X.ownKeys:Object.getOwnPropertySymbols?Z=F(function(P){return Object.getOwnPropertyNames(P).concat(Object.getOwnPropertySymbols(P))},"ReflectOwnKeys"):Z=F(function(P){return Object.getOwnPropertyNames(P)},"ReflectOwnKeys");function J(P){console&&console.warn&&console.warn(P)}F(J,"ProcessEmitWarning");var z=Number.isNaN||F(function(P){return P!==P},"NumberIsNaN");function Q(){Q.init.call(this)}F(Q,"EventEmitter"),W.exports=Q,W.exports.once=R,Q.EventEmitter=Q,Q.prototype._events=void 0,Q.prototype._eventsCount=0,Q.prototype._maxListeners=void 0;var G=10;function A(P){if(typeof P!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}F(A,"checkListener"),Object.defineProperty(Q,"defaultMaxListeners",{enumerable:!0,get:F(function(){return G},"get"),set:F(function(P){if(typeof P!="number"||P<0||z(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");G=P},"set")}),Q.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Q.prototype.setMaxListeners=F(function(P){if(typeof P!="number"||P<0||z(P))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+P+".");return this._maxListeners=P,this},"setMaxListeners");function w(P){return P._maxListeners===void 0?Q.defaultMaxListeners:P._maxListeners}F(w,"_getMaxListeners"),Q.prototype.getMaxListeners=F(function(){return w(this)},"getMaxListeners"),Q.prototype.emit=F(function(P){for(var I=[],g=1;g<arguments.length;g++)I.push(arguments[g]);var E=P==="error",V=this._events;if(V!==void 0)E=E&&V.error===void 0;else if(!E)return!1;if(E){var k;if(I.length>0&&(k=I[0]),k instanceof Error)throw k;var s=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw s.context=k,s}var a=V[P];if(a===void 0)return!1;if(typeof a=="function")Y(a,this,I);else for(var v=a.length,r=H(a,v),g=0;g<v;++g)Y(r[g],this,I);return!0},"emit");function D(P,I,g,E){var V,k,s;if(A(g),k=P._events,k===void 0?(k=P._events=Object.create(null),P._eventsCount=0):(k.newListener!==void 0&&(P.emit("newListener",I,g.listener?g.listener:g),k=P._events),s=k[I]),s===void 0)s=k[I]=g,++P._eventsCount;else if(typeof s=="function"?s=k[I]=E?[g,s]:[s,g]:E?s.unshift(g):s.push(g),V=w(P),V>0&&s.length>V&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=P,a.type=I,a.count=s.length,J(a)}return P}F(D,"_addListener"),Q.prototype.addListener=F(function(P,I){return D(this,P,I,!1)},"addListener"),Q.prototype.on=Q.prototype.addListener,Q.prototype.prependListener=F(function(P,I){return D(this,P,I,!0)},"prependListener");function O(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}F(O,"onceWrapper");function L(P,I,g){var E={fired:!1,wrapFn:void 0,target:P,type:I,listener:g},V=O.bind(E);return V.listener=g,E.wrapFn=V,V}F(L,"_onceWrap"),Q.prototype.once=F(function(P,I){return A(I),this.on(P,L(this,P,I)),this},"once"),Q.prototype.prependOnceListener=F(function(P,I){return A(I),this.prependListener(P,L(this,P,I)),this},"prependOnceListener"),Q.prototype.removeListener=F(function(P,I){var g,E,V,k,s;if(A(I),E=this._events,E===void 0)return this;if(g=E[P],g===void 0)return this;if(g===I||g.listener===I)--this._eventsCount===0?this._events=Object.create(null):(delete E[P],E.removeListener&&this.emit("removeListener",P,g.listener||I));else if(typeof g!="function"){for(V=-1,k=g.length-1;k>=0;k--)if(g[k]===I||g[k].listener===I){s=g[k].listener,V=k;break}if(V<0)return this;V===0?g.shift():K(g,V),g.length===1&&(E[P]=g[0]),E.removeListener!==void 0&&this.emit("removeListener",P,s||I)}return this},"removeListener"),Q.prototype.off=Q.prototype.removeListener,Q.prototype.removeAllListeners=F(function(P){var I,g,E;if(g=this._events,g===void 0)return this;if(g.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):g[P]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete g[P]),this;if(arguments.length===0){var V=Object.keys(g),k;for(E=0;E<V.length;++E)k=V[E],k!=="removeListener"&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(I=g[P],typeof I=="function")this.removeListener(P,I);else if(I!==void 0)for(E=I.length-1;E>=0;E--)this.removeListener(P,I[E]);return this},"removeAllListeners");function B(P,I,g){var E=P._events;if(E===void 0)return[];var V=E[I];return V===void 0?[]:typeof V=="function"?g?[V.listener||V]:[V]:g?S(V):H(V,V.length)}F(B,"_listeners"),Q.prototype.listeners=F(function(P){return B(this,P,!0)},"listeners"),Q.prototype.rawListeners=F(function(P){return B(this,P,!1)},"rawListeners"),Q.listenerCount=function(P,I){return typeof P.listenerCount=="function"?P.listenerCount(I):M.call(P,I)},Q.prototype.listenerCount=M;function M(P){var I=this._events;if(I!==void 0){var g=I[P];if(typeof g=="function")return 1;if(g!==void 0)return g.length}return 0}F(M,"listenerCount"),Q.prototype.eventNames=F(function(){return this._eventsCount>0?Z(this._events):[]},"eventNames");function H(P,I){for(var g=new Array(I),E=0;E<I;++E)g[E]=P[E];return g}F(H,"arrayClone");function K(P,I){for(;I+1<P.length;I++)P[I]=P[I+1];P.pop()}F(K,"spliceOne");function S(P){for(var I=new Array(P.length),g=0;g<I.length;++g)I[g]=P[g].listener||P[g];return I}F(S,"unwrapListeners");function R(P,I){return new Promise(function(g,E){function V(s){P.removeListener(I,k),E(s)}F(V,"errorListener");function k(){typeof P.removeListener=="function"&&P.removeListener("error",V),g([].slice.call(arguments))}F(k,"resolver"),f(P,I,k,{once:!0}),I!=="error"&&b(P,V,{once:!0})})}F(R,"once");function b(P,I,g){typeof P.on=="function"&&f(P,"error",I,g)}F(b,"addErrorHandlerIfEventEmitter");function f(P,I,g,E){if(typeof P.on=="function")E.once?P.once(I,g):P.on(I,g);else if(typeof P.addEventListener=="function")P.addEventListener(I,F(function V(k){E.once&&P.removeEventListener(I,V),g(k)},"wrapListener"));else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P)}F(f,"eventTargetAgnosticAddListener")}),k5={};A8(k5,{default:()=>fQ});var fQ,GW=S1(()=>{N0(),fQ={}}),MF=S1(()=>{N0(),F(b5,"sha256")}),i8,U7,wF=S1(()=>{N0(),i8=class ${constructor(){S0(this,"_dataLength",0),S0(this,"_bufferLength",0),S0(this,"_state",new Int32Array(4)),S0(this,"_buffer",new ArrayBuffer(68)),S0(this,"_buffer8"),S0(this,"_buffer32"),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashByteArray(W,X=!1){return this.onePassHasher.start().appendByteArray(W).end(X)}static hashStr(W,X=!1){return this.onePassHasher.start().appendStr(W).end(X)}static hashAsciiStr(W,X=!1){return this.onePassHasher.start().appendAsciiStr(W).end(X)}static _hex(W){let{hexChars:X,hexOut:Y}=$,Z,J,z,Q;for(Q=0;Q<4;Q+=1)for(J=Q*8,Z=W[Q],z=0;z<8;z+=2)Y[J+1+z]=X.charAt(Z&15),Z>>>=4,Y[J+0+z]=X.charAt(Z&15),Z>>>=4;return Y.join("")}static _md5cycle(W,X){let Y=W[0],Z=W[1],J=W[2],z=W[3];Y+=(Z&J|~Z&z)+X[0]-680876936|0,Y=(Y<<7|Y>>>25)+Z|0,z+=(Y&Z|~Y&J)+X[1]-389564586|0,z=(z<<12|z>>>20)+Y|0,J+=(z&Y|~z&Z)+X[2]+606105819|0,J=(J<<17|J>>>15)+z|0,Z+=(J&z|~J&Y)+X[3]-1044525330|0,Z=(Z<<22|Z>>>10)+J|0,Y+=(Z&J|~Z&z)+X[4]-176418897|0,Y=(Y<<7|Y>>>25)+Z|0,z+=(Y&Z|~Y&J)+X[5]+1200080426|0,z=(z<<12|z>>>20)+Y|0,J+=(z&Y|~z&Z)+X[6]-1473231341|0,J=(J<<17|J>>>15)+z|0,Z+=(J&z|~J&Y)+X[7]-45705983|0,Z=(Z<<22|Z>>>10)+J|0,Y+=(Z&J|~Z&z)+X[8]+1770035416|0,Y=(Y<<7|Y>>>25)+Z|0,z+=(Y&Z|~Y&J)+X[9]-1958414417|0,z=(z<<12|z>>>20)+Y|0,J+=(z&Y|~z&Z)+X[10]-42063|0,J=(J<<17|J>>>15)+z|0,Z+=(J&z|~J&Y)+X[11]-1990404162|0,Z=(Z<<22|Z>>>10)+J|0,Y+=(Z&J|~Z&z)+X[12]+1804603682|0,Y=(Y<<7|Y>>>25)+Z|0,z+=(Y&Z|~Y&J)+X[13]-40341101|0,z=(z<<12|z>>>20)+Y|0,J+=(z&Y|~z&Z)+X[14]-1502002290|0,J=(J<<17|J>>>15)+z|0,Z+=(J&z|~J&Y)+X[15]+1236535329|0,Z=(Z<<22|Z>>>10)+J|0,Y+=(Z&z|J&~z)+X[1]-165796510|0,Y=(Y<<5|Y>>>27)+Z|0,z+=(Y&J|Z&~J)+X[6]-1069501632|0,z=(z<<9|z>>>23)+Y|0,J+=(z&Z|Y&~Z)+X[11]+643717713|0,J=(J<<14|J>>>18)+z|0,Z+=(J&Y|z&~Y)+X[0]-373897302|0,Z=(Z<<20|Z>>>12)+J|0,Y+=(Z&z|J&~z)+X[5]-701558691|0,Y=(Y<<5|Y>>>27)+Z|0,z+=(Y&J|Z&~J)+X[10]+38016083|0,z=(z<<9|z>>>23)+Y|0,J+=(z&Z|Y&~Z)+X[15]-660478335|0,J=(J<<14|J>>>18)+z|0,Z+=(J&Y|z&~Y)+X[4]-405537848|0,Z=(Z<<20|Z>>>12)+J|0,Y+=(Z&z|J&~z)+X[9]+568446438|0,Y=(Y<<5|Y>>>27)+Z|0,z+=(Y&J|Z&~J)+X[14]-1019803690|0,z=(z<<9|z>>>23)+Y|0,J+=(z&Z|Y&~Z)+X[3]-187363961|0,J=(J<<14|J>>>18)+z|0,Z+=(J&Y|z&~Y)+X[8]+1163531501|0,Z=(Z<<20|Z>>>12)+J|0,Y+=(Z&z|J&~z)+X[13]-1444681467|0,Y=(Y<<5|Y>>>27)+Z|0,z+=(Y&J|Z&~J)+X[2]-51403784|0,z=(z<<9|z>>>23)+Y|0,J+=(z&Z|Y&~Z)+X[7]+1735328473|0,J=(J<<14|J>>>18)+z|0,Z+=(J&Y|z&~Y)+X[12]-1926607734|0,Z=(Z<<20|Z>>>12)+J|0,Y+=(Z^J^z)+X[5]-378558|0,Y=(Y<<4|Y>>>28)+Z|0,z+=(Y^Z^J)+X[8]-2022574463|0,z=(z<<11|z>>>21)+Y|0,J+=(z^Y^Z)+X[11]+1839030562|0,J=(J<<16|J>>>16)+z|0,Z+=(J^z^Y)+X[14]-35309556|0,Z=(Z<<23|Z>>>9)+J|0,Y+=(Z^J^z)+X[1]-1530992060|0,Y=(Y<<4|Y>>>28)+Z|0,z+=(Y^Z^J)+X[4]+1272893353|0,z=(z<<11|z>>>21)+Y|0,J+=(z^Y^Z)+X[7]-155497632|0,J=(J<<16|J>>>16)+z|0,Z+=(J^z^Y)+X[10]-1094730640|0,Z=(Z<<23|Z>>>9)+J|0,Y+=(Z^J^z)+X[13]+681279174|0,Y=(Y<<4|Y>>>28)+Z|0,z+=(Y^Z^J)+X[0]-358537222|0,z=(z<<11|z>>>21)+Y|0,J+=(z^Y^Z)+X[3]-722521979|0,J=(J<<16|J>>>16)+z|0,Z+=(J^z^Y)+X[6]+76029189|0,Z=(Z<<23|Z>>>9)+J|0,Y+=(Z^J^z)+X[9]-640364487|0,Y=(Y<<4|Y>>>28)+Z|0,z+=(Y^Z^J)+X[12]-421815835|0,z=(z<<11|z>>>21)+Y|0,J+=(z^Y^Z)+X[15]+530742520|0,J=(J<<16|J>>>16)+z|0,Z+=(J^z^Y)+X[2]-995338651|0,Z=(Z<<23|Z>>>9)+J|0,Y+=(J^(Z|~z))+X[0]-198630844|0,Y=(Y<<6|Y>>>26)+Z|0,z+=(Z^(Y|~J))+X[7]+1126891415|0,z=(z<<10|z>>>22)+Y|0,J+=(Y^(z|~Z))+X[14]-1416354905|0,J=(J<<15|J>>>17)+z|0,Z+=(z^(J|~Y))+X[5]-57434055|0,Z=(Z<<21|Z>>>11)+J|0,Y+=(J^(Z|~z))+X[12]+1700485571|0,Y=(Y<<6|Y>>>26)+Z|0,z+=(Z^(Y|~J))+X[3]-1894986606|0,z=(z<<10|z>>>22)+Y|0,J+=(Y^(z|~Z))+X[10]-1051523|0,J=(J<<15|J>>>17)+z|0,Z+=(z^(J|~Y))+X[1]-2054922799|0,Z=(Z<<21|Z>>>11)+J|0,Y+=(J^(Z|~z))+X[8]+1873313359|0,Y=(Y<<6|Y>>>26)+Z|0,z+=(Z^(Y|~J))+X[15]-30611744|0,z=(z<<10|z>>>22)+Y|0,J+=(Y^(z|~Z))+X[6]-1560198380|0,J=(J<<15|J>>>17)+z|0,Z+=(z^(J|~Y))+X[13]+1309151649|0,Z=(Z<<21|Z>>>11)+J|0,Y+=(J^(Z|~z))+X[4]-145523070|0,Y=(Y<<6|Y>>>26)+Z|0,z+=(Z^(Y|~J))+X[11]-1120210379|0,z=(z<<10|z>>>22)+Y|0,J+=(Y^(z|~Z))+X[2]+718787259|0,J=(J<<15|J>>>17)+z|0,Z+=(z^(J|~Y))+X[9]-343485551|0,Z=(Z<<21|Z>>>11)+J|0,W[0]=Y+W[0]|0,W[1]=Z+W[1]|0,W[2]=J+W[2]|0,W[3]=z+W[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set($.stateIdentity),this}appendStr(W){let X=this._buffer8,Y=this._buffer32,Z=this._bufferLength,J,z;for(z=0;z<W.length;z+=1){if(J=W.charCodeAt(z),J<128)X[Z++]=J;else if(J<2048)X[Z++]=(J>>>6)+192,X[Z++]=J&63|128;else if(J<55296||J>56319)X[Z++]=(J>>>12)+224,X[Z++]=J>>>6&63|128,X[Z++]=J&63|128;else{if(J=(J-55296)*1024+(W.charCodeAt(++z)-56320)+65536,J>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");X[Z++]=(J>>>18)+240,X[Z++]=J>>>12&63|128,X[Z++]=J>>>6&63|128,X[Z++]=J&63|128}Z>=64&&(this._dataLength+=64,$._md5cycle(this._state,Y),Z-=64,Y[0]=Y[16])}return this._bufferLength=Z,this}appendAsciiStr(W){let X=this._buffer8,Y=this._buffer32,Z=this._bufferLength,J,z=0;for(;;){for(J=Math.min(W.length-z,64-Z);J--;)X[Z++]=W.charCodeAt(z++);if(Z<64)break;this._dataLength+=64,$._md5cycle(this._state,Y),Z=0}return this._bufferLength=Z,this}appendByteArray(W){let X=this._buffer8,Y=this._buffer32,Z=this._bufferLength,J,z=0;for(;;){for(J=Math.min(W.length-z,64-Z);J--;)X[Z++]=W[z++];if(Z<64)break;this._dataLength+=64,$._md5cycle(this._state,Y),Z=0}return this._bufferLength=Z,this}getState(){let W=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[W[0],W[1],W[2],W[3]]}}setState(W){let{buffer:X,state:Y}=W,Z=this._state,J;for(this._dataLength=W.length,this._bufferLength=W.buflen,Z[0]=Y[0],Z[1]=Y[1],Z[2]=Y[2],Z[3]=Y[3],J=0;J<X.length;J+=1)this._buffer8[J]=X.charCodeAt(J)}end(W=!1){let X=this._bufferLength,Y=this._buffer8,Z=this._buffer32,J=(X>>2)+1;this._dataLength+=X;let z=this._dataLength*8;if(Y[X]=128,Y[X+1]=Y[X+2]=Y[X+3]=0,Z.set($.buffer32Identity.subarray(J),J),X>55&&($._md5cycle(this._state,Z),Z.set($.buffer32Identity)),z<=4294967295)Z[14]=z;else{let Q=z.toString(16).match(/(.*?)(.{0,8})$/);if(Q===null)return;let G=parseInt(Q[2],16),A=parseInt(Q[1],16)||0;Z[14]=G,Z[15]=A}return $._md5cycle(this._state,Z),W?this._state:$._hex(this._state)}},F(i8,"Md5"),S0(i8,"stateIdentity",new Int32Array([1732584193,-271733879,-1732584194,271733878])),S0(i8,"buffer32Identity",new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),S0(i8,"hexChars","0123456789abcdef"),S0(i8,"hexOut",[]),S0(i8,"onePassHasher",new i8),U7=i8}),A7={};A8(A7,{createHash:()=>dQ,createHmac:()=>vQ,randomBytes:()=>yQ});var hQ=S1(()=>{N0(),MF(),wF(),F(yQ,"randomBytes"),F(dQ,"createHash"),F(vQ,"createHmac")}),pQ=V0(($)=>{N0(),$.parse=function(Z,J){return new X(Z,J).parse()};var W=class Z{constructor(J,z){this.source=J,this.transform=z||Y,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var J=this.source[this.position++];return J==="\\"?{value:this.source[this.position++],escaped:!0}:{value:J,escaped:!1}}record(J){this.recorded.push(J)}newEntry(J){var z;(this.recorded.length>0||J)&&(z=this.recorded.join(""),z==="NULL"&&!J&&(z=null),z!==null&&(z=this.transform(z)),this.entries.push(z),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var J=this.nextCharacter();if(J.value==="=")break}}parse(J){var z,Q,G;for(this.consumeDimensions();!this.isEof();)if(z=this.nextCharacter(),z.value==="{"&&!G)this.dimension++,this.dimension>1&&(Q=new Z(this.source.substr(this.position-1),this.transform),this.entries.push(Q.parse(!0)),this.position+=Q.position-2);else if(z.value==="}"&&!G){if(this.dimension--,!this.dimension&&(this.newEntry(),J))return this.entries}else z.value==='"'&&!z.escaped?(G&&this.newEntry(!0),G=!G):z.value===","&&!G?this.newEntry():this.record(z.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};F(W,"ArrayParser");var X=W;function Y(Z){return Z}F(Y,"identity")}),mQ=V0(($,W)=>{N0();var X=pQ();W.exports={create:F(function(Y,Z){return{parse:F(function(){return X.parse(Y,Z)},"parse")}},"create")}}),AF=V0(($,W)=>{N0();var X=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Y=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Z=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,J=/^-?infinity$/;W.exports=F(function(w){if(J.test(w))return Number(w.replace("i","I"));var D=X.exec(w);if(!D)return z(w)||null;var O=!!D[8],L=parseInt(D[1],10);O&&(L=G(L));var B=parseInt(D[2],10)-1,M=D[3],H=parseInt(D[4],10),K=parseInt(D[5],10),S=parseInt(D[6],10),R=D[7];R=R?1000*parseFloat(R):0;var b,f=Q(w);return f!=null?(b=new Date(Date.UTC(L,B,M,H,K,S,R)),A(L)&&b.setUTCFullYear(L),f!==0&&b.setTime(b.getTime()-f)):(b=new Date(L,B,M,H,K,S,R),A(L)&&b.setFullYear(L)),b},"parseDate");function z(w){var D=Y.exec(w);if(D){var O=parseInt(D[1],10),L=!!D[4];L&&(O=G(O));var B=parseInt(D[2],10)-1,M=D[3],H=new Date(O,B,M);return A(O)&&H.setFullYear(O),H}}F(z,"getDate");function Q(w){if(w.endsWith("+00"))return 0;var D=Z.exec(w.split(" ")[1]);if(D){var O=D[1];if(O==="Z")return 0;var L=O==="-"?-1:1,B=parseInt(D[2],10)*3600+parseInt(D[3]||0,10)*60+parseInt(D[4]||0,10);return B*L*1000}}F(Q,"timeZoneOffset");function G(w){return-(w-1)}F(G,"bcYearToNegativeYear");function A(w){return w>=0&&w<100}F(A,"is0To99")}),_F=V0(($,W)=>{N0(),W.exports=Y;var X=Object.prototype.hasOwnProperty;function Y(Z){for(var J=1;J<arguments.length;J++){var z=arguments[J];for(var Q in z)X.call(z,Q)&&(Z[Q]=z[Q])}return Z}F(Y,"extend")}),HF=V0(($,W)=>{N0();var X=_F();W.exports=Y;function Y(S){if(!(this instanceof Y))return new Y(S);X(this,K(S))}F(Y,"PostgresInterval");var Z=["seconds","minutes","hours","days","months","years"];Y.prototype.toPostgres=function(){var S=Z.filter(this.hasOwnProperty,this);return this.milliseconds&&S.indexOf("seconds")<0&&S.push("seconds"),S.length===0?"0":S.map(function(R){var b=this[R]||0;return R==="seconds"&&this.milliseconds&&(b=(b+this.milliseconds/1000).toFixed(6).replace(/\.?0+$/,"")),b+" "+R},this).join(" ")};var J={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},z=["years","months","days"],Q=["hours","minutes","seconds"];Y.prototype.toISOString=Y.prototype.toISO=function(){var S=z.map(b,this).join(""),R=Q.map(b,this).join("");return"P"+S+"T"+R;function b(f){var P=this[f]||0;return f==="seconds"&&this.milliseconds&&(P=(P+this.milliseconds/1000).toFixed(6).replace(/0+$/,"")),P+J[f]}};var G="([+-]?\\d+)",A=G+"\\s+years?",w=G+"\\s+mons?",D=G+"\\s+days?",O="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",L=new RegExp([A,w,D,O].map(function(S){return"("+S+")?"}).join("\\s*")),B={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},M=["hours","minutes","seconds","milliseconds"];function H(S){var R=S+"000000".slice(S.length);return parseInt(R,10)/1000}F(H,"parseMilliseconds");function K(S){if(!S)return{};var R=L.exec(S),b=R[8]==="-";return Object.keys(B).reduce(function(f,P){var I=B[P],g=R[I];return!g||(g=P==="milliseconds"?H(g):parseInt(g,10),!g)||(b&&~M.indexOf(P)&&(g*=-1),f[P]=g),f},{})}F(K,"parse")}),DF=V0(($,W)=>{N0(),W.exports=F(function(X){if(/^\\x/.test(X))return new R0(X.substr(2),"hex");for(var Y="",Z=0;Z<X.length;)if(X[Z]!=="\\")Y+=X[Z],++Z;else if(/[0-7]{3}/.test(X.substr(Z+1,3)))Y+=String.fromCharCode(parseInt(X.substr(Z+1,3),8)),Z+=4;else{for(var J=1;Z+J<X.length&&X[Z+J]==="\\";)J++;for(var z=0;z<Math.floor(J/2);++z)Y+="\\";Z+=Math.floor(J/2)*2}return new R0(Y,"binary")},"parseBytea")}),BF=V0(($,W)=>{N0();var X=pQ(),Y=mQ(),Z=AF(),J=HF(),z=DF();function Q(E){return F(function(V){return V===null?V:E(V)},"nullAllowed")}F(Q,"allowNull");function G(E){return E===null?E:E==="TRUE"||E==="t"||E==="true"||E==="y"||E==="yes"||E==="on"||E==="1"}F(G,"parseBool");function A(E){return E?X.parse(E,G):null}F(A,"parseBoolArray");function w(E){return parseInt(E,10)}F(w,"parseBaseTenInt");function D(E){return E?X.parse(E,Q(w)):null}F(D,"parseIntegerArray");function O(E){return E?X.parse(E,Q(function(V){return b(V).trim()})):null}F(O,"parseBigIntegerArray");var L=F(function(E){if(!E)return null;var V=Y.create(E,function(k){return k!==null&&(k=P(k)),k});return V.parse()},"parsePointArray"),B=F(function(E){if(!E)return null;var V=Y.create(E,function(k){return k!==null&&(k=parseFloat(k)),k});return V.parse()},"parseFloatArray"),M=F(function(E){if(!E)return null;var V=Y.create(E);return V.parse()},"parseStringArray"),H=F(function(E){if(!E)return null;var V=Y.create(E,function(k){return k!==null&&(k=Z(k)),k});return V.parse()},"parseDateArray"),K=F(function(E){if(!E)return null;var V=Y.create(E,function(k){return k!==null&&(k=J(k)),k});return V.parse()},"parseIntervalArray"),S=F(function(E){return E?X.parse(E,Q(z)):null},"parseByteAArray"),R=F(function(E){return parseInt(E,10)},"parseInteger"),b=F(function(E){var V=String(E);return/^\d+$/.test(V)?V:E},"parseBigInteger"),f=F(function(E){return E?X.parse(E,Q(JSON.parse)):null},"parseJsonArray"),P=F(function(E){return E[0]!=="("?null:(E=E.substring(1,E.length-1).split(","),{x:parseFloat(E[0]),y:parseFloat(E[1])})},"parsePoint"),I=F(function(E){if(E[0]!=="<"&&E[1]!=="(")return null;for(var V="(",k="",s=!1,a=2;a<E.length-1;a++){if(s||(V+=E[a]),E[a]===")"){s=!0;continue}else if(!s)continue;E[a]!==","&&(k+=E[a])}var v=P(V);return v.radius=parseFloat(k),v},"parseCircle"),g=F(function(E){E(20,b),E(21,R),E(23,R),E(26,R),E(700,parseFloat),E(701,parseFloat),E(16,G),E(1082,Z),E(1114,Z),E(1184,Z),E(600,P),E(651,M),E(718,I),E(1000,A),E(1001,S),E(1005,D),E(1007,D),E(1028,D),E(1016,O),E(1017,L),E(1021,B),E(1022,B),E(1231,B),E(1014,M),E(1015,M),E(1008,M),E(1009,M),E(1040,M),E(1041,M),E(1115,H),E(1182,H),E(1185,H),E(1186,J),E(1187,K),E(17,z),E(114,JSON.parse.bind(JSON)),E(3802,JSON.parse.bind(JSON)),E(199,f),E(3807,f),E(3907,M),E(2951,M),E(791,M),E(1183,M),E(1270,M)},"init");W.exports={init:g}}),OF=V0(($,W)=>{N0();var X=1e6;function Y(Z){var J=Z.readInt32BE(0),z=Z.readUInt32BE(4),Q="";J<0&&(J=~J+(z===0),z=~z+1>>>0,Q="-");var G="",A,w,D,O,L,B;{if(A=J%X,J=J/X>>>0,w=4294967296*A+z,z=w/X>>>0,D=""+(w-X*z),z===0&&J===0)return Q+D+G;for(O="",L=6-D.length,B=0;B<L;B++)O+="0";G=O+D+G}{if(A=J%X,J=J/X>>>0,w=4294967296*A+z,z=w/X>>>0,D=""+(w-X*z),z===0&&J===0)return Q+D+G;for(O="",L=6-D.length,B=0;B<L;B++)O+="0";G=O+D+G}{if(A=J%X,J=J/X>>>0,w=4294967296*A+z,z=w/X>>>0,D=""+(w-X*z),z===0&&J===0)return Q+D+G;for(O="",L=6-D.length,B=0;B<L;B++)O+="0";G=O+D+G}return A=J%X,w=4294967296*A+z,D=""+w%X,Q+D+G}F(Y,"readInt8"),W.exports=Y}),NF=V0(($,W)=>{N0();var X=OF(),Y=F(function(M,H,K,S,R){K=K||0,S=S||!1,R=R||function(s,a,v){return s*Math.pow(2,v)+a};var b=K>>3,f=F(function(s){return S?~s&255:s},"inv"),P=255,I=8-K%8;H<I&&(P=255<<8-H&255,I=H),K&&(P=P>>K%8);var g=0;K%8+H>=8&&(g=R(0,f(M[b])&P,I));for(var E=H+K>>3,V=b+1;V<E;V++)g=R(g,f(M[V]),8);var k=(H+K)%8;return k>0&&(g=R(g,f(M[E])>>8-k,k)),g},"parseBits"),Z=F(function(M,H,K){var S=Math.pow(2,K-1)-1,R=Y(M,1),b=Y(M,K,1);if(b===0)return 0;var f=1,P=F(function(g,E,V){g===0&&(g=1);for(var k=1;k<=V;k++)f/=2,(E&1<<V-k)>0&&(g+=f);return g},"parsePrecisionBits"),I=Y(M,H,K+1,!1,P);return b==Math.pow(2,K+1)-1?I===0?R===0?1/0:-1/0:NaN:(R===0?1:-1)*Math.pow(2,b-S)*I},"parseFloatFromBits"),J=F(function(M){return Y(M,1)==1?-1*(Y(M,15,1,!0)+1):Y(M,15,1)},"parseInt16"),z=F(function(M){return Y(M,1)==1?-1*(Y(M,31,1,!0)+1):Y(M,31,1)},"parseInt32"),Q=F(function(M){return Z(M,23,8)},"parseFloat32"),G=F(function(M){return Z(M,52,11)},"parseFloat64"),A=F(function(M){var H=Y(M,16,32);if(H==49152)return NaN;for(var K=Math.pow(1e4,Y(M,16,16)),S=0,R=[],b=Y(M,16),f=0;f<b;f++)S+=Y(M,16,64+16*f)*K,K/=1e4;var P=Math.pow(10,Y(M,16,48));return(H===0?1:-1)*Math.round(S*P)/P},"parseNumeric"),w=F(function(M,H){var K=Y(H,1),S=Y(H,63,1),R=new Date((K===0?1:-1)*S/1000+946684800000);return M||R.setTime(R.getTime()+R.getTimezoneOffset()*60000),R.usec=S%1000,R.getMicroSeconds=function(){return this.usec},R.setMicroSeconds=function(b){this.usec=b},R.getUTCMicroSeconds=function(){return this.usec},R},"parseDate"),D=F(function(M){for(var H=Y(M,32),K=Y(M,32,32),S=Y(M,32,64),R=96,b=[],f=0;f<H;f++)b[f]=Y(M,32,R),R+=32,R+=32;var P=F(function(g){var E=Y(M,32,R);if(R+=32,E==4294967295)return null;var V;if(g==23||g==20)return V=Y(M,E*8,R),R+=E*8,V;if(g==25)return V=M.toString(this.encoding,R>>3,(R+=E<<3)>>3),V;console.log("ERROR: ElementType not implemented: "+g)},"parseElement"),I=F(function(g,E){var V=[],k;if(g.length>1){var s=g.shift();for(k=0;k<s;k++)V[k]=I(g,E);g.unshift(s)}else for(k=0;k<g[0];k++)V[k]=P(E);return V},"parse");return I(b,S)},"parseArray"),O=F(function(M){return M.toString("utf8")},"parseText"),L=F(function(M){return M===null?null:Y(M,8)>0},"parseBool"),B=F(function(M){M(20,X),M(21,J),M(23,z),M(26,z),M(1700,A),M(700,Q),M(701,G),M(16,L),M(1114,w.bind(null,!1)),M(1184,w.bind(null,!0)),M(1000,D),M(1007,D),M(1016,D),M(1008,D),M(1009,D),M(25,O)},"init");W.exports={init:B}}),LF=V0(($,W)=>{N0(),W.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}}),UW=V0(($)=>{N0();var W=BF(),X=NF(),Y=mQ(),Z=LF();$.getTypeParser=Q,$.setTypeParser=G,$.arrayParser=Y,$.builtins=Z;var J={text:{},binary:{}};function z(A){return String(A)}F(z,"noParse");function Q(A,w){return w=w||"text",J[w]&&J[w][A]||z}F(Q,"getTypeParser");function G(A,w,D){typeof w=="function"&&(D=w,w="text"),J[w][A]=D}F(G,"setTypeParser"),W.init(function(A,w){J.text[A]=w}),X.init(function(A,w){J.binary[A]=w})}),MW=V0(($,W)=>{N0(),W.exports={host:"localhost",user:q0.platform==="win32"?q0.env.USERNAME:q0.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:30000,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var X=UW(),Y=X.getTypeParser(20,"text"),Z=X.getTypeParser(1016,"text");W.exports.__defineSetter__("parseInt8",function(J){X.setTypeParser(20,"text",J?X.getTypeParser(23,"text"):Y),X.setTypeParser(1016,"text",J?X.getTypeParser(1007,"text"):Z)})}),wW=V0(($,W)=>{N0();var X=(hQ(),m2(A7)),Y=MW();function Z(B){var M=B.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+M+'"'}F(Z,"escapeElement");function J(B){for(var M="{",H=0;H<B.length;H++)H>0&&(M=M+","),B[H]===null||typeof B[H]>"u"?M=M+"NULL":Array.isArray(B[H])?M=M+J(B[H]):B[H]instanceof R0?M+="\\\\x"+B[H].toString("hex"):M+=Z(z(B[H]));return M=M+"}",M}F(J,"arrayString");var z=F(function(B,M){if(B==null)return null;if(B instanceof R0)return B;if(ArrayBuffer.isView(B)){var H=R0.from(B.buffer,B.byteOffset,B.byteLength);return H.length===B.byteLength?H:H.slice(B.byteOffset,B.byteOffset+B.byteLength)}return B instanceof Date?Y.parseInputDatesAsUTC?w(B):A(B):Array.isArray(B)?J(B):typeof B=="object"?Q(B,M):B.toString()},"prepareValue");function Q(B,M){if(B&&typeof B.toPostgres=="function"){if(M=M||[],M.indexOf(B)!==-1)throw new Error('circular reference detected while preparing "'+B+'" for query');return M.push(B),z(B.toPostgres(z),M)}return JSON.stringify(B)}F(Q,"prepareObject");function G(B,M){for(B=""+B;B.length<M;)B="0"+B;return B}F(G,"pad");function A(B){var M=-B.getTimezoneOffset(),H=B.getFullYear(),K=H<1;K&&(H=Math.abs(H)+1);var S=G(H,4)+"-"+G(B.getMonth()+1,2)+"-"+G(B.getDate(),2)+"T"+G(B.getHours(),2)+":"+G(B.getMinutes(),2)+":"+G(B.getSeconds(),2)+"."+G(B.getMilliseconds(),3);return M<0?(S+="-",M*=-1):S+="+",S+=G(Math.floor(M/60),2)+":"+G(M%60,2),K&&(S+=" BC"),S}F(A,"dateToString");function w(B){var M=B.getUTCFullYear(),H=M<1;H&&(M=Math.abs(M)+1);var K=G(M,4)+"-"+G(B.getUTCMonth()+1,2)+"-"+G(B.getUTCDate(),2)+"T"+G(B.getUTCHours(),2)+":"+G(B.getUTCMinutes(),2)+":"+G(B.getUTCSeconds(),2)+"."+G(B.getUTCMilliseconds(),3);return K+="+00:00",H&&(K+=" BC"),K}F(w,"dateToStringUTC");function D(B,M,H){return B=typeof B=="string"?{text:B}:B,M&&(typeof M=="function"?B.callback=M:B.values=M),H&&(B.callback=H),B}F(D,"normalizeQueryConfig");var O=F(function(B){return X.createHash("md5").update(B,"utf-8").digest("hex")},"md5"),L=F(function(B,M,H){var K=O(M+B),S=O(R0.concat([R0.from(K),H]));return"md5"+S},"postgresMd5PasswordHash");W.exports={prepareValue:F(function(B){return z(B)},"prepareValueWrapper"),normalizeQueryConfig:D,postgresMd5PasswordHash:L,md5:O}}),FF=V0(($,W)=>{N0();var X=(hQ(),m2(A7));function Y(M){if(M.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let H=X.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:H,response:"n,,n=*,r="+H,message:"SASLInitialResponse"}}F(Y,"startSession");function Z(M,H,K){if(M.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof H!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(typeof K!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let S=A(K);if(S.nonce.startsWith(M.clientNonce)){if(S.nonce.length===M.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var R=R0.from(S.salt,"base64"),b=B(H,R,S.iteration),f=L(b,"Client Key"),P=O(f),I="n=*,r="+M.clientNonce,g="r="+S.nonce+",s="+S.salt+",i="+S.iteration,E="c=biws,r="+S.nonce,V=I+","+g+","+E,k=L(P,V),s=D(f,k),a=s.toString("base64"),v=L(b,"Server Key"),r=L(v,V);M.message="SASLResponse",M.serverSignature=r.toString("base64"),M.response=E+",p="+a}F(Z,"continueSession");function J(M,H){if(M.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof H!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:K}=w(H);if(K!==M.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}F(J,"finalizeSession");function z(M){if(typeof M!="string")throw new TypeError("SASL: text must be a string");return M.split("").map((H,K)=>M.charCodeAt(K)).every((H)=>H>=33&&H<=43||H>=45&&H<=126)}F(z,"isPrintableChars");function Q(M){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(M)}F(Q,"isBase64");function G(M){if(typeof M!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(M.split(",").map((H)=>{if(!/^.=/.test(H))throw new Error("SASL: Invalid attribute pair entry");let K=H[0],S=H.substring(2);return[K,S]}))}F(G,"parseAttributePairs");function A(M){let H=G(M),K=H.get("r");if(K){if(!z(K))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let S=H.get("s");if(S){if(!Q(S))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let R=H.get("i");if(R){if(!/^[1-9][0-9]*$/.test(R))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let b=parseInt(R,10);return{nonce:K,salt:S,iteration:b}}F(A,"parseServerFirstMessage");function w(M){let H=G(M).get("v");if(H){if(!Q(H))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:H}}F(w,"parseServerFinalMessage");function D(M,H){if(!R0.isBuffer(M))throw new TypeError("first argument must be a Buffer");if(!R0.isBuffer(H))throw new TypeError("second argument must be a Buffer");if(M.length!==H.length)throw new Error("Buffer lengths must match");if(M.length===0)throw new Error("Buffers cannot be empty");return R0.from(M.map((K,S)=>M[S]^H[S]))}F(D,"xorBuffers");function O(M){return X.createHash("sha256").update(M).digest()}F(O,"sha256");function L(M,H){return X.createHmac("sha256",M).update(H).digest()}F(L,"hmacSha256");function B(M,H,K){for(var S=L(M,R0.concat([H,R0.from([0,0,0,1])])),R=S,b=0;b<K-1;b++)S=L(M,S),R=D(R,S);return R}F(B,"Hi"),W.exports={startSession:Y,continueSession:Z,finalizeSession:J}}),_7={};A8(_7,{join:()=>cQ});var uQ=S1(()=>{N0(),F(cQ,"join")}),H7={};A8(H7,{stat:()=>oQ});var iQ=S1(()=>{N0(),F(oQ,"stat")}),D7={};A8(D7,{default:()=>lQ});var lQ,nQ=S1(()=>{N0(),lQ={}}),tQ={};A8(tQ,{StringDecoder:()=>sQ});var G7,sQ,KF=S1(()=>{N0(),G7=class ${constructor(W){S0(this,"td"),this.td=new TextDecoder(W)}write(W){return this.td.decode(W,{stream:!0})}end(W){return this.td.decode(W)}},F(G7,"StringDecoder"),sQ=G7}),SF=V0(($,W)=>{N0();var{Transform:X}=(nQ(),m2(D7)),{StringDecoder:Y}=(KF(),m2(tQ)),Z=Symbol("last"),J=Symbol("decoder");function z(D,O,L){let B;if(this.overflow){if(B=this[J].write(D).split(this.matcher),B.length===1)return L();B.shift(),this.overflow=!1}else this[Z]+=this[J].write(D),B=this[Z].split(this.matcher);this[Z]=B.pop();for(let M=0;M<B.length;M++)try{G(this,this.mapper(B[M]))}catch(H){return L(H)}if(this.overflow=this[Z].length>this.maxLength,this.overflow&&!this.skipOverflow){L(new Error("maximum buffer reached"));return}L()}F(z,"transform");function Q(D){if(this[Z]+=this[J].end(),this[Z])try{G(this,this.mapper(this[Z]))}catch(O){return D(O)}D()}F(Q,"flush");function G(D,O){O!==void 0&&D.push(O)}F(G,"push");function A(D){return D}F(A,"noop");function w(D,O,L){switch(D=D||/\r?\n/,O=O||A,L=L||{},arguments.length){case 1:typeof D=="function"?(O=D,D=/\r?\n/):typeof D=="object"&&!(D instanceof RegExp)&&!D[Symbol.split]&&(L=D,D=/\r?\n/);break;case 2:typeof D=="function"?(L=O,O=D,D=/\r?\n/):typeof O=="object"&&(L=O,O=A)}L=Object.assign({},L),L.autoDestroy=!0,L.transform=z,L.flush=Q,L.readableObjectMode=!0;let B=new X(L);return B[Z]="",B[J]=new Y("utf8"),B.matcher=D,B.mapper=O,B.maxLength=L.maxLength,B.skipOverflow=L.skipOverflow||!1,B.overflow=!1,B._destroy=function(M,H){this._writableState.errorEmitted=!1,H(M)},B}F(w,"split"),W.exports=w}),RF=V0(($,W)=>{N0();var X=(uQ(),m2(_7)),Y=(nQ(),m2(D7)).Stream,Z=SF(),J=(GW(),m2(k5)),z=5432,Q=q0.platform==="win32",G=q0.stderr,A=56,w=7,D=61440,O=32768;function L(f){return(f&D)==O}F(L,"isRegFile");var B=["host","port","database","user","password"],M=B.length,H=B[M-1];function K(){var f=G instanceof Y&&G.writable===!0;if(f){var P=Array.prototype.slice.call(arguments).concat(`
`);G.write(J.format.apply(J,P))}}F(K,"warn"),Object.defineProperty(W.exports,"isWin",{get:F(function(){return Q},"get"),set:F(function(f){Q=f},"set")}),W.exports.warnTo=function(f){var P=G;return G=f,P},W.exports.getFileName=function(f){var P=f||q0.env,I=P.PGPASSFILE||(Q?X.join(P.APPDATA||"./","postgresql","pgpass.conf"):X.join(P.HOME||"./",".pgpass"));return I},W.exports.usePgPass=function(f,P){return Object.prototype.hasOwnProperty.call(q0.env,"PGPASSWORD")?!1:Q?!0:(P=P||"<unkn>",L(f.mode)?f.mode&(A|w)?(K('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',P),!1):!0:(K('WARNING: password file "%s" is not a plain file',P),!1))};var S=W.exports.match=function(f,P){return B.slice(0,-1).reduce(function(I,g,E){return E==1&&Number(f[g]||z)===Number(P[g])?I&&!0:I&&(P[g]==="*"||P[g]===f[g])},!0)};W.exports.getPassword=function(f,P,I){var g,E=P.pipe(Z());function V(a){var v=R(a);v&&b(v)&&S(f,v)&&(g=v[H],E.end())}F(V,"onLine");var k=F(function(){P.destroy(),I(g)},"onEnd"),s=F(function(a){P.destroy(),K("WARNING: error on reading file: %s",a),I(void 0)},"onErr");P.on("error",s),E.on("data",V).on("end",k).on("error",s)};var R=W.exports.parseLine=function(f){if(f.length<11||f.match(/^\s+#/))return null;for(var P="",I="",g=0,E=0,V=0,k={},s=!1,a=F(function(r,$0,M0){var c=f.substring($0,M0);Object.hasOwnProperty.call(q0.env,"PGPASS_NO_DEESCAPE")||(c=c.replace(/\\([:\\])/g,"$1")),k[B[r]]=c},"addToObj"),v=0;v<f.length-1;v+=1){if(P=f.charAt(v+1),I=f.charAt(v),s=g==M-1,s){a(g,E);break}v>=0&&P==":"&&I!=="\\"&&(a(g,E,v+1),E=v+2,g+=1)}return k=Object.keys(k).length===M?k:null,k},b=W.exports.isValidEntry=function(f){for(var P={0:function(k){return k.length>0},1:function(k){return k==="*"?!0:(k=Number(k),isFinite(k)&&k>0&&k<9007199254740992&&Math.floor(k)===k)},2:function(k){return k.length>0},3:function(k){return k.length>0},4:function(k){return k.length>0}},I=0;I<B.length;I+=1){var g=P[I],E=f[B[I]]||"",V=g(E);if(!V)return!1}return!0}}),PF=V0(($,W)=>{N0();var X=(uQ(),m2(_7)),Y=(iQ(),m2(H7)),Z=RF();W.exports=function(J,z){var Q=Z.getFileName();Y.stat(Q,function(G,A){if(G||!Z.usePgPass(A,Q))return z(void 0);var w=Y.createReadStream(Q);Z.getPassword(J,w,z)})},W.exports.warnTo=Z.warnTo}),rQ=V0(($,W)=>{N0();var X=UW();function Y(Z){this._types=Z||X,this.text={},this.binary={}}F(Y,"TypeOverrides"),Y.prototype.getOverrides=function(Z){switch(Z){case"text":return this.text;case"binary":return this.binary;default:return{}}},Y.prototype.setTypeParser=function(Z,J,z){typeof J=="function"&&(z=J,J="text"),this.getOverrides(J)[Z]=z},Y.prototype.getTypeParser=function(Z,J){return J=J||"text",this.getOverrides(J)[Z]||this._types.getTypeParser(Z,J)},W.exports=Y}),aQ={};A8(aQ,{default:()=>eQ});var eQ,EF=S1(()=>{N0(),eQ={}}),$G={};A8($G,{parse:()=>B7});var WG=S1(()=>{N0(),F(B7,"parse")}),CF=V0(($,W)=>{N0();var X=(WG(),m2($G)),Y=(iQ(),m2(H7));function Z(J){if(J.charAt(0)==="/"){var Q=J.split(" ");return{host:Q[0],database:Q[1]}}var z=X.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(J)?encodeURI(J).replace(/\%25(\d\d)/g,"%$1"):J,!0),Q=z.query;for(var G in Q)Array.isArray(Q[G])&&(Q[G]=Q[G][Q[G].length-1]);var A=(z.auth||":").split(":");if(Q.user=A[0],Q.password=A.splice(1).join(":"),Q.port=z.port,z.protocol=="socket:")return Q.host=decodeURI(z.pathname),Q.database=z.query.db,Q.client_encoding=z.query.encoding,Q;Q.host||(Q.host=z.hostname);var w=z.pathname;if(!Q.host&&w&&/^%2f/i.test(w)){var D=w.split("/");Q.host=decodeURIComponent(D[0]),w=D.splice(1).join("/")}switch(w&&w.charAt(0)==="/"&&(w=w.slice(1)||null),Q.database=w&&decodeURI(w),(Q.ssl==="true"||Q.ssl==="1")&&(Q.ssl=!0),Q.ssl==="0"&&(Q.ssl=!1),(Q.sslcert||Q.sslkey||Q.sslrootcert||Q.sslmode)&&(Q.ssl={}),Q.sslcert&&(Q.ssl.cert=Y.readFileSync(Q.sslcert).toString()),Q.sslkey&&(Q.ssl.key=Y.readFileSync(Q.sslkey).toString()),Q.sslrootcert&&(Q.ssl.ca=Y.readFileSync(Q.sslrootcert).toString()),Q.sslmode){case"disable":{Q.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{Q.ssl.rejectUnauthorized=!1;break}}return Q}F(Z,"parse"),W.exports=Z,Z.parse=Z}),O7=V0(($,W)=>{N0();var X=(EF(),m2(aQ)),Y=MW(),Z=CF().parse,J=F(function(D,O,L){return L===void 0?L=q0.env["PG"+D.toUpperCase()]:L===!1||(L=q0.env[L]),O[D]||L||Y[D]},"val"),z=F(function(){switch(q0.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Y.ssl},"readSSLConfigFromEnvironment"),Q=F(function(D){return"'"+(""+D).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),G=F(function(D,O,L){var B=O[L];B!=null&&D.push(L+"="+Q(B))},"add"),A=class D{constructor(O){O=typeof O=="string"?Z(O):O||{},O.connectionString&&(O=Object.assign({},O,Z(O.connectionString))),this.user=J("user",O),this.database=J("database",O),this.database===void 0&&(this.database=this.user),this.port=parseInt(J("port",O),10),this.host=J("host",O),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:J("password",O)}),this.binary=J("binary",O),this.options=J("options",O),this.ssl=typeof O.ssl>"u"?z():O.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=J("client_encoding",O),this.replication=J("replication",O),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=J("application_name",O,"PGAPPNAME"),this.fallback_application_name=J("fallback_application_name",O,!1),this.statement_timeout=J("statement_timeout",O,!1),this.lock_timeout=J("lock_timeout",O,!1),this.idle_in_transaction_session_timeout=J("idle_in_transaction_session_timeout",O,!1),this.query_timeout=J("query_timeout",O,!1),O.connectionTimeoutMillis===void 0?this.connect_timeout=q0.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(O.connectionTimeoutMillis/1000),O.keepAlive===!1?this.keepalives=0:O.keepAlive===!0&&(this.keepalives=1),typeof O.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(O.keepAliveInitialDelayMillis/1000))}getLibpqConnectionString(O){var L=[];G(L,this,"user"),G(L,this,"password"),G(L,this,"port"),G(L,this,"application_name"),G(L,this,"fallback_application_name"),G(L,this,"connect_timeout"),G(L,this,"options");var B=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(G(L,B,"sslmode"),G(L,B,"sslca"),G(L,B,"sslkey"),G(L,B,"sslcert"),G(L,B,"sslrootcert"),this.database&&L.push("dbname="+Q(this.database)),this.replication&&L.push("replication="+Q(this.replication)),this.host&&L.push("host="+Q(this.host)),this.isDomainSocket)return O(null,L.join(" "));this.client_encoding&&L.push("client_encoding="+Q(this.client_encoding)),X.lookup(this.host,function(M,H){return M?O(M,null):(L.push("hostaddr="+Q(H)),O(null,L.join(" ")))})}};F(A,"ConnectionParameters");var w=A;W.exports=w}),qF=V0(($,W)=>{N0();var X=UW(),Y=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,Z=class z{constructor(Q,G){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=G,this.RowCtor=null,this.rowAsArray=Q==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(Q){var G;Q.text?G=Y.exec(Q.text):G=Y.exec(Q.command),G&&(this.command=G[1],G[3]?(this.oid=parseInt(G[2],10),this.rowCount=parseInt(G[3],10)):G[2]&&(this.rowCount=parseInt(G[2],10)))}_parseRowAsArray(Q){for(var G=new Array(Q.length),A=0,w=Q.length;A<w;A++){var D=Q[A];D!==null?G[A]=this._parsers[A](D):G[A]=null}return G}parseRow(Q){for(var G={},A=0,w=Q.length;A<w;A++){var D=Q[A],O=this.fields[A].name;D!==null?G[O]=this._parsers[A](D):G[O]=null}return G}addRow(Q){this.rows.push(Q)}addFields(Q){this.fields=Q,this.fields.length&&(this._parsers=new Array(Q.length));for(var G=0;G<Q.length;G++){var A=Q[G];this._types?this._parsers[G]=this._types.getTypeParser(A.dataTypeID,A.format||"text"):this._parsers[G]=X.getTypeParser(A.dataTypeID,A.format||"text")}}};F(Z,"Result");var J=Z;W.exports=J}),VF=V0(($,W)=>{N0();var{EventEmitter:X}=h6(),Y=qF(),Z=wW(),J=class Q extends X{constructor(G,A,w){super(),G=Z.normalizeQueryConfig(G,A,w),this.text=G.text,this.values=G.values,this.rows=G.rows,this.types=G.types,this.name=G.name,this.binary=G.binary,this.portal=G.portal||"",this.callback=G.callback,this._rowMode=G.rowMode,q0.domain&&G.callback&&(this.callback=q0.domain.bind(G.callback)),this._result=new Y(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Y(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(G){this._checkForMultirow(),this._result.addFields(G.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(G){let A;if(!this._canceledDueToError){try{A=this._result.parseRow(G.fields)}catch(w){this._canceledDueToError=w;return}this.emit("row",A,this._result),this._accumulateRows&&this._result.addRow(A)}}handleCommandComplete(G,A){this._checkForMultirow(),this._result.addCommandComplete(G),this.rows&&A.sync()}handleEmptyQuery(G){this.rows&&G.sync()}handleError(G,A){if(this._canceledDueToError&&(G=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(G);this.emit("error",G)}handleReadyForQuery(G){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,G);if(this.callback)try{this.callback(null,this._results)}catch(A){q0.nextTick(()=>{throw A})}this.emit("end",this._results)}submit(G){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let A=G.parsedStatements[this.name];return this.text&&A&&this.text!==A?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(G):G.query(this.text),null)}hasBeenParsed(G){return this.name&&G.parsedStatements[this.name]}handlePortalSuspended(G){this._getRows(G,this.rows)}_getRows(G,A){G.execute({portal:this.portal,rows:A}),A?G.flush():G.sync()}prepare(G){this.isPreparedStatement=!0,this.hasBeenParsed(G)||G.parse({text:this.text,name:this.name,types:this.types});try{G.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Z.prepareValue})}catch(A){this.handleError(A,G);return}G.describe({type:"P",name:this.portal||""}),this._getRows(G,this.rows)}handleCopyInResponse(G){G.sendCopyFail("No source stream defined")}handleCopyData(G,A){}};F(J,"Query");var z=J;W.exports=z}),XG={};A8(XG,{Socket:()=>AW,isIP:()=>YG});var bQ,xQ,I5,AW,N7=S1(()=>{N0(),bQ=x5(h6(),1),F(YG,"isIP"),xQ=F(($)=>$.replace(/^[^.]+\./,"api."),"transformHost"),I5=class $ extends bQ.EventEmitter{constructor(){super(...arguments);S0(this,"opts",{}),S0(this,"connecting",!1),S0(this,"pending",!0),S0(this,"writable",!0),S0(this,"encrypted",!1),S0(this,"authorized",!1),S0(this,"destroyed",!1),S0(this,"ws",null),S0(this,"writeBuffer"),S0(this,"tlsState",0),S0(this,"tlsRead"),S0(this,"tlsWrite")}static get poolQueryViaFetch(){return $.opts.poolQueryViaFetch??$.defaults.poolQueryViaFetch}static set poolQueryViaFetch(W){$.opts.poolQueryViaFetch=W}static get fetchEndpoint(){return $.opts.fetchEndpoint??$.defaults.fetchEndpoint}static set fetchEndpoint(W){$.opts.fetchEndpoint=W}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(W){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return $.opts.fetchFunction??$.defaults.fetchFunction}static set fetchFunction(W){$.opts.fetchFunction=W}static get webSocketConstructor(){return $.opts.webSocketConstructor??$.defaults.webSocketConstructor}static set webSocketConstructor(W){$.opts.webSocketConstructor=W}get webSocketConstructor(){return this.opts.webSocketConstructor??$.webSocketConstructor}set webSocketConstructor(W){this.opts.webSocketConstructor=W}static get wsProxy(){return $.opts.wsProxy??$.defaults.wsProxy}static set wsProxy(W){$.opts.wsProxy=W}get wsProxy(){return this.opts.wsProxy??$.wsProxy}set wsProxy(W){this.opts.wsProxy=W}static get coalesceWrites(){return $.opts.coalesceWrites??$.defaults.coalesceWrites}static set coalesceWrites(W){$.opts.coalesceWrites=W}get coalesceWrites(){return this.opts.coalesceWrites??$.coalesceWrites}set coalesceWrites(W){this.opts.coalesceWrites=W}static get useSecureWebSocket(){return $.opts.useSecureWebSocket??$.defaults.useSecureWebSocket}static set useSecureWebSocket(W){$.opts.useSecureWebSocket=W}get useSecureWebSocket(){return this.opts.useSecureWebSocket??$.useSecureWebSocket}set useSecureWebSocket(W){this.opts.useSecureWebSocket=W}static get forceDisablePgSSL(){return $.opts.forceDisablePgSSL??$.defaults.forceDisablePgSSL}static set forceDisablePgSSL(W){$.opts.forceDisablePgSSL=W}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??$.forceDisablePgSSL}set forceDisablePgSSL(W){this.opts.forceDisablePgSSL=W}static get disableSNI(){return $.opts.disableSNI??$.defaults.disableSNI}static set disableSNI(W){$.opts.disableSNI=W}get disableSNI(){return this.opts.disableSNI??$.disableSNI}set disableSNI(W){this.opts.disableSNI=W}static get pipelineConnect(){return $.opts.pipelineConnect??$.defaults.pipelineConnect}static set pipelineConnect(W){$.opts.pipelineConnect=W}get pipelineConnect(){return this.opts.pipelineConnect??$.pipelineConnect}set pipelineConnect(W){this.opts.pipelineConnect=W}static get subtls(){return $.opts.subtls??$.defaults.subtls}static set subtls(W){$.opts.subtls=W}get subtls(){return this.opts.subtls??$.subtls}set subtls(W){this.opts.subtls=W}static get pipelineTLS(){return $.opts.pipelineTLS??$.defaults.pipelineTLS}static set pipelineTLS(W){$.opts.pipelineTLS=W}get pipelineTLS(){return this.opts.pipelineTLS??$.pipelineTLS}set pipelineTLS(W){this.opts.pipelineTLS=W}static get rootCerts(){return $.opts.rootCerts??$.defaults.rootCerts}static set rootCerts(W){$.opts.rootCerts=W}get rootCerts(){return this.opts.rootCerts??$.rootCerts}set rootCerts(W){this.opts.rootCerts=W}wsProxyAddrForHost(W,X){let Y=this.wsProxy;if(Y===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof Y=="function"?Y(W,X):`${Y}?address=${W}:${X}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(W,X,Y){this.connecting=!0,Y&&this.once("connect",Y);let Z=F(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),J=F((Q,G=!1)=>{Q.binaryType="arraybuffer",Q.addEventListener("error",(A)=>{this.emit("error",A),this.emit("close")}),Q.addEventListener("message",(A)=>{if(this.tlsState===0){let w=R0.from(A.data);this.emit("data",w)}}),Q.addEventListener("close",()=>{this.emit("close")}),G?Z():Q.addEventListener("open",Z)},"configureWebSocket"),z;try{z=this.wsProxyAddrForHost(X,typeof W=="string"?parseInt(W,10):W)}catch(Q){this.emit("error",Q),this.emit("close");return}try{let Q=(this.useSecureWebSocket?"wss:":"ws:")+"//"+z;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(Q),J(this.ws);else try{this.ws=new WebSocket(Q),J(this.ws)}catch{this.ws=new __unstable_WebSocket(Q),J(this.ws)}}catch(Q){let G=(this.useSecureWebSocket?"https:":"http:")+"//"+z;fetch(G,{headers:{Upgrade:"websocket"}}).then((A)=>{if(this.ws=A.webSocket,this.ws==null)throw Q;this.ws.accept(),J(this.ws,!0)}).catch((A)=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${A.message}`)),this.emit("close")})}}async startTls(W){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let X=this.subtls.TrustedCert.fromPEM(this.rootCerts),Y=new this.subtls.WebSocketReadQueue(this.ws),Z=Y.read.bind(Y),J=this.rawWrite.bind(this),[z,Q]=await this.subtls.startTls(W,X,Z,J,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=z,this.tlsWrite=Q,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let W=await this.tlsRead();if(W===void 0)break;{let X=R0.from(W);this.emit("data",X)}}}rawWrite(W){if(!this.coalesceWrites){this.ws.send(W);return}if(this.writeBuffer===void 0)this.writeBuffer=W,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let X=new Uint8Array(this.writeBuffer.length+W.length);X.set(this.writeBuffer),X.set(W,this.writeBuffer.length),this.writeBuffer=X}}write(W,X="utf8",Y=(Z)=>{}){return W.length===0?(Y(),!0):(typeof W=="string"&&(W=R0.from(W,X)),this.tlsState===0?(this.rawWrite(W),Y()):this.tlsState===1?this.once("secureConnection",()=>{this.write(W,X,Y)}):(this.tlsWrite(W),Y()),!0)}end(W=R0.alloc(0),X="utf8",Y=()=>{}){return this.write(W,X,()=>{this.ws.close(),Y()}),this}destroy(){return this.destroyed=!0,this.end()}},F(I5,"Socket"),S0(I5,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:F(($)=>"https://"+xQ($)+"/sql","fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:F(($)=>$+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),S0(I5,"opts",{}),AW=I5}),ZG=V0(($)=>{N0(),Object.defineProperty($,"__esModule",{value:!0}),$.NoticeMessage=$.DataRowMessage=$.CommandCompleteMessage=$.ReadyForQueryMessage=$.NotificationResponseMessage=$.BackendKeyDataMessage=$.AuthenticationMD5Password=$.ParameterStatusMessage=$.ParameterDescriptionMessage=$.RowDescriptionMessage=$.Field=$.CopyResponse=$.CopyDataMessage=$.DatabaseError=$.copyDone=$.emptyQuery=$.replicationStart=$.portalSuspended=$.noData=$.closeComplete=$.bindComplete=$.parseComplete=void 0,$.parseComplete={name:"parseComplete",length:5},$.bindComplete={name:"bindComplete",length:5},$.closeComplete={name:"closeComplete",length:5},$.noData={name:"noData",length:5},$.portalSuspended={name:"portalSuspended",length:5},$.replicationStart={name:"replicationStart",length:4},$.emptyQuery={name:"emptyQuery",length:4},$.copyDone={name:"copyDone",length:4};var W=class a extends Error{constructor(v,r,$0){super(v),this.length=r,this.name=$0}};F(W,"DatabaseError");var X=W;$.DatabaseError=X;var Y=class a{constructor(v,r){this.length=v,this.chunk=r,this.name="copyData"}};F(Y,"CopyDataMessage");var Z=Y;$.CopyDataMessage=Z;var J=class a{constructor(v,r,$0,M0){this.length=v,this.name=r,this.binary=$0,this.columnTypes=new Array(M0)}};F(J,"CopyResponse");var z=J;$.CopyResponse=z;var Q=class a{constructor(v,r,$0,M0,c,e,_0){this.name=v,this.tableID=r,this.columnID=$0,this.dataTypeID=M0,this.dataTypeSize=c,this.dataTypeModifier=e,this.format=_0}};F(Q,"Field");var G=Q;$.Field=G;var A=class a{constructor(v,r){this.length=v,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};F(A,"RowDescriptionMessage");var w=A;$.RowDescriptionMessage=w;var D=class a{constructor(v,r){this.length=v,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};F(D,"ParameterDescriptionMessage");var O=D;$.ParameterDescriptionMessage=O;var L=class a{constructor(v,r,$0){this.length=v,this.parameterName=r,this.parameterValue=$0,this.name="parameterStatus"}};F(L,"ParameterStatusMessage");var B=L;$.ParameterStatusMessage=B;var M=class a{constructor(v,r){this.length=v,this.salt=r,this.name="authenticationMD5Password"}};F(M,"AuthenticationMD5Password");var H=M;$.AuthenticationMD5Password=H;var K=class a{constructor(v,r,$0){this.length=v,this.processID=r,this.secretKey=$0,this.name="backendKeyData"}};F(K,"BackendKeyDataMessage");var S=K;$.BackendKeyDataMessage=S;var R=class a{constructor(v,r,$0,M0){this.length=v,this.processId=r,this.channel=$0,this.payload=M0,this.name="notification"}};F(R,"NotificationResponseMessage");var b=R;$.NotificationResponseMessage=b;var f=class a{constructor(v,r){this.length=v,this.status=r,this.name="readyForQuery"}};F(f,"ReadyForQueryMessage");var P=f;$.ReadyForQueryMessage=P;var I=class a{constructor(v,r){this.length=v,this.text=r,this.name="commandComplete"}};F(I,"CommandCompleteMessage");var g=I;$.CommandCompleteMessage=g;var E=class a{constructor(v,r){this.length=v,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};F(E,"DataRowMessage");var V=E;$.DataRowMessage=V;var k=class a{constructor(v,r){this.length=v,this.message=r,this.name="notice"}};F(k,"NoticeMessage");var s=k;$.NoticeMessage=s}),jF=V0(($)=>{N0(),Object.defineProperty($,"__esModule",{value:!0}),$.Writer=void 0;var W=class Y{constructor(Z=256){this.size=Z,this.offset=5,this.headerPosition=0,this.buffer=R0.allocUnsafe(Z)}ensure(Z){var J=this.buffer.length-this.offset;if(J<Z){var z=this.buffer,Q=z.length+(z.length>>1)+Z;this.buffer=R0.allocUnsafe(Q),z.copy(this.buffer)}}addInt32(Z){return this.ensure(4),this.buffer[this.offset++]=Z>>>24&255,this.buffer[this.offset++]=Z>>>16&255,this.buffer[this.offset++]=Z>>>8&255,this.buffer[this.offset++]=Z>>>0&255,this}addInt16(Z){return this.ensure(2),this.buffer[this.offset++]=Z>>>8&255,this.buffer[this.offset++]=Z>>>0&255,this}addCString(Z){if(!Z)this.ensure(1);else{var J=R0.byteLength(Z);this.ensure(J+1),this.buffer.write(Z,this.offset,"utf-8"),this.offset+=J}return this.buffer[this.offset++]=0,this}addString(Z=""){var J=R0.byteLength(Z);return this.ensure(J),this.buffer.write(Z,this.offset),this.offset+=J,this}add(Z){return this.ensure(Z.length),Z.copy(this.buffer,this.offset),this.offset+=Z.length,this}join(Z){if(Z){this.buffer[this.headerPosition]=Z;let J=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(J,this.headerPosition+1)}return this.buffer.slice(Z?0:5,this.offset)}flush(Z){var J=this.join(Z);return this.offset=5,this.headerPosition=0,this.buffer=R0.allocUnsafe(this.size),J}};F(W,"Writer");var X=W;$.Writer=X}),IF=V0(($)=>{N0(),Object.defineProperty($,"__esModule",{value:!0}),$.serialize=void 0;var W=jF(),X=new W.Writer,Y=F((v)=>{X.addInt16(3).addInt16(0);for(let M0 of Object.keys(v))X.addCString(M0).addCString(v[M0]);X.addCString("client_encoding").addCString("UTF8");var r=X.addCString("").flush(),$0=r.length+4;return new W.Writer().addInt32($0).add(r).flush()},"startup"),Z=F(()=>{let v=R0.allocUnsafe(8);return v.writeInt32BE(8,0),v.writeInt32BE(80877103,4),v},"requestSsl"),J=F((v)=>X.addCString(v).flush(112),"password"),z=F(function(v,r){return X.addCString(v).addInt32(R0.byteLength(r)).addString(r),X.flush(112)},"sendSASLInitialResponseMessage"),Q=F(function(v){return X.addString(v).flush(112)},"sendSCRAMClientFinalMessage"),G=F((v)=>X.addCString(v).flush(81),"query"),A=[],w=F((v)=>{let r=v.name||"";r.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",r,r.length),console.error("This can cause conflicts and silent errors executing queries"));let $0=v.types||A;for(var M0=$0.length,c=X.addCString(r).addCString(v.text).addInt16(M0),e=0;e<M0;e++)c.addInt32($0[e]);return X.flush(80)},"parse"),D=new W.Writer,O=F(function(v,r){for(let $0=0;$0<v.length;$0++){let M0=r?r(v[$0],$0):v[$0];M0==null?(X.addInt16(0),D.addInt32(-1)):M0 instanceof R0?(X.addInt16(1),D.addInt32(M0.length),D.add(M0)):(X.addInt16(0),D.addInt32(R0.byteLength(M0)),D.addString(M0))}},"writeValues"),L=F((v={})=>{let r=v.portal||"",$0=v.statement||"",M0=v.binary||!1,c=v.values||A,e=c.length;return X.addCString(r).addCString($0),X.addInt16(e),O(c,v.valueMapper),X.addInt16(e),X.add(D.flush()),X.addInt16(M0?1:0),X.flush(66)},"bind"),B=R0.from([69,0,0,0,9,0,0,0,0,0]),M=F((v)=>{if(!v||!v.portal&&!v.rows)return B;let r=v.portal||"",$0=v.rows||0,M0=R0.byteLength(r),c=4+M0+1+4,e=R0.allocUnsafe(1+c);return e[0]=69,e.writeInt32BE(c,1),e.write(r,5,"utf-8"),e[M0+5]=0,e.writeUInt32BE($0,e.length-4),e},"execute"),H=F((v,r)=>{let $0=R0.allocUnsafe(16);return $0.writeInt32BE(16,0),$0.writeInt16BE(1234,4),$0.writeInt16BE(5678,6),$0.writeInt32BE(v,8),$0.writeInt32BE(r,12),$0},"cancel"),K=F((v,r)=>{let $0=4+R0.byteLength(r)+1,M0=R0.allocUnsafe(1+$0);return M0[0]=v,M0.writeInt32BE($0,1),M0.write(r,5,"utf-8"),M0[$0]=0,M0},"cstringMessage"),S=X.addCString("P").flush(68),R=X.addCString("S").flush(68),b=F((v)=>v.name?K(68,`${v.type}${v.name||""}`):v.type==="P"?S:R,"describe"),f=F((v)=>{let r=`${v.type}${v.name||""}`;return K(67,r)},"close"),P=F((v)=>X.add(v).flush(100),"copyData"),I=F((v)=>K(102,v),"copyFail"),g=F((v)=>R0.from([v,0,0,0,4]),"codeOnlyBuffer"),E=g(72),V=g(83),k=g(88),s=g(99),a={startup:Y,password:J,requestSsl:Z,sendSASLInitialResponseMessage:z,sendSCRAMClientFinalMessage:Q,query:G,parse:w,bind:L,execute:M,describe:b,close:f,flush:F(()=>E,"flush"),sync:F(()=>V,"sync"),end:F(()=>k,"end"),copyData:P,copyDone:F(()=>s,"copyDone"),copyFail:I,cancel:H};$.serialize=a}),bF=V0(($)=>{N0(),Object.defineProperty($,"__esModule",{value:!0}),$.BufferReader=void 0;var W=R0.allocUnsafe(0),X=class Z{constructor(J=0){this.offset=J,this.buffer=W,this.encoding="utf-8"}setBuffer(J,z){this.offset=J,this.buffer=z}int16(){let J=this.buffer.readInt16BE(this.offset);return this.offset+=2,J}byte(){let J=this.buffer[this.offset];return this.offset++,J}int32(){let J=this.buffer.readInt32BE(this.offset);return this.offset+=4,J}string(J){let z=this.buffer.toString(this.encoding,this.offset,this.offset+J);return this.offset+=J,z}cstring(){let J=this.offset,z=J;for(;this.buffer[z++]!==0;);return this.offset=z,this.buffer.toString(this.encoding,J,z-1)}bytes(J){let z=this.buffer.slice(this.offset,this.offset+J);return this.offset+=J,z}};F(X,"BufferReader");var Y=X;$.BufferReader=Y}),xF=V0(($)=>{N0(),Object.defineProperty($,"__esModule",{value:!0}),$.Parser=void 0;var W=ZG(),X=bF(),Y=1,Z=4,J=Y+Z,z=R0.allocUnsafe(0),Q=class A{constructor(w){if(this.buffer=z,this.bufferLength=0,this.bufferOffset=0,this.reader=new X.BufferReader,w?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=w?.mode||"text"}parse(w,D){this.mergeBuffer(w);let O=this.bufferOffset+this.bufferLength,L=this.bufferOffset;for(;L+J<=O;){let B=this.buffer[L],M=this.buffer.readUInt32BE(L+Y),H=Y+M;if(H+L<=O){let K=this.handlePacket(L+J,B,M,this.buffer);D(K),L+=H}else break}L===O?(this.buffer=z,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=O-L,this.bufferOffset=L)}mergeBuffer(w){if(this.bufferLength>0){let D=this.bufferLength+w.byteLength;if(D+this.bufferOffset>this.buffer.byteLength){let O;if(D<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)O=this.buffer;else{let L=this.buffer.byteLength*2;for(;D>=L;)L*=2;O=R0.allocUnsafe(L)}this.buffer.copy(O,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=O,this.bufferOffset=0}w.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=D}else this.buffer=w,this.bufferOffset=0,this.bufferLength=w.byteLength}handlePacket(w,D,O,L){switch(D){case 50:return W.bindComplete;case 49:return W.parseComplete;case 51:return W.closeComplete;case 110:return W.noData;case 115:return W.portalSuspended;case 99:return W.copyDone;case 87:return W.replicationStart;case 73:return W.emptyQuery;case 68:return this.parseDataRowMessage(w,O,L);case 67:return this.parseCommandCompleteMessage(w,O,L);case 90:return this.parseReadyForQueryMessage(w,O,L);case 65:return this.parseNotificationMessage(w,O,L);case 82:return this.parseAuthenticationResponse(w,O,L);case 83:return this.parseParameterStatusMessage(w,O,L);case 75:return this.parseBackendKeyData(w,O,L);case 69:return this.parseErrorMessage(w,O,L,"error");case 78:return this.parseErrorMessage(w,O,L,"notice");case 84:return this.parseRowDescriptionMessage(w,O,L);case 116:return this.parseParameterDescriptionMessage(w,O,L);case 71:return this.parseCopyInMessage(w,O,L);case 72:return this.parseCopyOutMessage(w,O,L);case 100:return this.parseCopyData(w,O,L);default:return new W.DatabaseError("received invalid response: "+D.toString(16),O,"error")}}parseReadyForQueryMessage(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.string(1);return new W.ReadyForQueryMessage(D,L)}parseCommandCompleteMessage(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.cstring();return new W.CommandCompleteMessage(D,L)}parseCopyData(w,D,O){let L=O.slice(w,w+(D-4));return new W.CopyDataMessage(D,L)}parseCopyInMessage(w,D,O){return this.parseCopyMessage(w,D,O,"copyInResponse")}parseCopyOutMessage(w,D,O){return this.parseCopyMessage(w,D,O,"copyOutResponse")}parseCopyMessage(w,D,O,L){this.reader.setBuffer(w,O);let B=this.reader.byte()!==0,M=this.reader.int16(),H=new W.CopyResponse(D,L,B,M);for(let K=0;K<M;K++)H.columnTypes[K]=this.reader.int16();return H}parseNotificationMessage(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.int32(),B=this.reader.cstring(),M=this.reader.cstring();return new W.NotificationResponseMessage(D,L,B,M)}parseRowDescriptionMessage(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.int16(),B=new W.RowDescriptionMessage(D,L);for(let M=0;M<L;M++)B.fields[M]=this.parseField();return B}parseField(){let w=this.reader.cstring(),D=this.reader.int32(),O=this.reader.int16(),L=this.reader.int32(),B=this.reader.int16(),M=this.reader.int32(),H=this.reader.int16()===0?"text":"binary";return new W.Field(w,D,O,L,B,M,H)}parseParameterDescriptionMessage(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.int16(),B=new W.ParameterDescriptionMessage(D,L);for(let M=0;M<L;M++)B.dataTypeIDs[M]=this.reader.int32();return B}parseDataRowMessage(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.int16(),B=new Array(L);for(let M=0;M<L;M++){let H=this.reader.int32();B[M]=H===-1?null:this.reader.string(H)}return new W.DataRowMessage(D,B)}parseParameterStatusMessage(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.cstring(),B=this.reader.cstring();return new W.ParameterStatusMessage(D,L,B)}parseBackendKeyData(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.int32(),B=this.reader.int32();return new W.BackendKeyDataMessage(D,L,B)}parseAuthenticationResponse(w,D,O){this.reader.setBuffer(w,O);let L=this.reader.int32(),B={name:"authenticationOk",length:D};switch(L){case 0:break;case 3:B.length===8&&(B.name="authenticationCleartextPassword");break;case 5:if(B.length===12){B.name="authenticationMD5Password";let H=this.reader.bytes(4);return new W.AuthenticationMD5Password(D,H)}break;case 10:B.name="authenticationSASL",B.mechanisms=[];let M;do M=this.reader.cstring(),M&&B.mechanisms.push(M);while(M);break;case 11:B.name="authenticationSASLContinue",B.data=this.reader.string(D-8);break;case 12:B.name="authenticationSASLFinal",B.data=this.reader.string(D-8);break;default:throw new Error("Unknown authenticationOk message type "+L)}return B}parseErrorMessage(w,D,O,L){this.reader.setBuffer(w,O);let B={},M=this.reader.string(1);for(;M!=="\0";)B[M]=this.reader.cstring(),M=this.reader.string(1);let H=B.M,K=L==="notice"?new W.NoticeMessage(D,H):new W.DatabaseError(H,D,L);return K.severity=B.S,K.code=B.C,K.detail=B.D,K.hint=B.H,K.position=B.P,K.internalPosition=B.p,K.internalQuery=B.q,K.where=B.W,K.schema=B.s,K.table=B.t,K.column=B.c,K.dataType=B.d,K.constraint=B.n,K.file=B.F,K.line=B.L,K.routine=B.R,K}};F(Q,"Parser");var G=Q;$.Parser=G}),JG=V0(($)=>{N0(),Object.defineProperty($,"__esModule",{value:!0}),$.DatabaseError=$.serialize=$.parse=void 0;var W=ZG();Object.defineProperty($,"DatabaseError",{enumerable:!0,get:F(function(){return W.DatabaseError},"get")});var X=IF();Object.defineProperty($,"serialize",{enumerable:!0,get:F(function(){return X.serialize},"get")});var Y=xF();function Z(J,z){let Q=new Y.Parser;return J.on("data",(G)=>Q.parse(G,z)),new Promise((G)=>J.on("end",()=>G()))}F(Z,"parse"),$.parse=Z}),zG={};A8(zG,{connect:()=>QG});var kF=S1(()=>{N0(),F(QG,"connect")}),GG=V0(($,W)=>{N0();var X=(N7(),m2(XG)),Y=h6().EventEmitter,{parse:Z,serialize:J}=JG(),z=J.flush(),Q=J.sync(),G=J.end(),A=class D extends Y{constructor(O){super(),O=O||{},this.stream=O.stream||new X.Socket,this._keepAlive=O.keepAlive,this._keepAliveInitialDelayMillis=O.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=O.ssl||!1,this._ending=!1,this._emitMessage=!1;var L=this;this.on("newListener",function(B){B==="message"&&(L._emitMessage=!0)})}connect(O,L){var B=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(O,L),this.stream.once("connect",function(){B._keepAlive&&B.stream.setKeepAlive(!0,B._keepAliveInitialDelayMillis),B.emit("connect")});let M=F(function(H){B._ending&&(H.code==="ECONNRESET"||H.code==="EPIPE")||B.emit("error",H)},"reportStreamError");if(this.stream.on("error",M),this.stream.on("close",function(){B.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(H){var K=H.toString("utf8");switch(K){case"S":break;case"N":return B.stream.end(),B.emit("error",new Error("The server does not support SSL connections"));default:return B.stream.end(),B.emit("error",new Error("There was an error establishing an SSL connection"))}var S=(kF(),m2(zG));let R={socket:B.stream};B.ssl!==!0&&(Object.assign(R,B.ssl),("key"in B.ssl)&&(R.key=B.ssl.key)),X.isIP(L)===0&&(R.servername=L);try{B.stream=S.connect(R)}catch(b){return B.emit("error",b)}B.attachListeners(B.stream),B.stream.on("error",M),B.emit("sslconnect")})}attachListeners(O){O.on("end",()=>{this.emit("end")}),Z(O,(L)=>{var B=L.name==="error"?"errorMessage":L.name;this._emitMessage&&this.emit("message",L),this.emit(B,L)})}requestSsl(){this.stream.write(J.requestSsl())}startup(O){this.stream.write(J.startup(O))}cancel(O,L){this._send(J.cancel(O,L))}password(O){this._send(J.password(O))}sendSASLInitialResponseMessage(O,L){this._send(J.sendSASLInitialResponseMessage(O,L))}sendSCRAMClientFinalMessage(O){this._send(J.sendSCRAMClientFinalMessage(O))}_send(O){return this.stream.writable?this.stream.write(O):!1}query(O){this._send(J.query(O))}parse(O){this._send(J.parse(O))}bind(O){this._send(J.bind(O))}execute(O){this._send(J.execute(O))}flush(){this.stream.writable&&this.stream.write(z)}sync(){this._ending=!0,this._send(z),this._send(Q)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(G,()=>{this.stream.end()})}close(O){this._send(J.close(O))}describe(O){this._send(J.describe(O))}sendCopyFromChunk(O){this._send(J.copyData(O))}endCopyFrom(){this._send(J.copyDone())}sendCopyFail(O){this._send(J.copyFail(O))}};F(A,"Connection");var w=A;W.exports=w}),TF=V0(($,W)=>{N0();var X=h6().EventEmitter,Y=(GW(),m2(k5)),Z=wW(),J=FF(),z=PF(),Q=rQ(),G=O7(),A=VF(),w=MW(),D=GG(),O=class B extends X{constructor(M){super(),this.connectionParameters=new G(M),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var H=M||{};this._Promise=H.Promise||QW.Promise,this._types=new Q(H.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=H.connection||new D({stream:H.stream,ssl:this.connectionParameters.ssl,keepAlive:H.keepAlive||!1,keepAliveInitialDelayMillis:H.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=H.binary||w.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=H.connectionTimeoutMillis||0}_errorAllQueries(M){let H=F((K)=>{q0.nextTick(()=>{K.handleError(M,this.connection)})},"enqueueError");this.activeQuery&&(H(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(H),this.queryQueue.length=0}_connect(M){var H=this,K=this.connection;if(this._connectionCallback=M,this._connecting||this._connected){let S=new Error("Client has already been connected. You cannot reuse a client.");q0.nextTick(()=>{M(S)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{K._ending=!0,K.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?K.connect(this.host+"/.s.PGSQL."+this.port):K.connect(this.port,this.host),K.on("connect",function(){H.ssl?K.requestSsl():K.startup(H.getStartupConf())}),K.on("sslconnect",function(){K.startup(H.getStartupConf())}),this._attachListeners(K),K.once("end",()=>{let S=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(S),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(S):this._handleErrorEvent(S):this._connectionError||this._handleErrorEvent(S)),q0.nextTick(()=>{this.emit("end")})})}connect(M){if(M){this._connect(M);return}return new this._Promise((H,K)=>{this._connect((S)=>{S?K(S):H()})})}_attachListeners(M){M.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),M.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),M.on("authenticationSASL",this._handleAuthSASL.bind(this)),M.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),M.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),M.on("backendKeyData",this._handleBackendKeyData.bind(this)),M.on("error",this._handleErrorEvent.bind(this)),M.on("errorMessage",this._handleErrorMessage.bind(this)),M.on("readyForQuery",this._handleReadyForQuery.bind(this)),M.on("notice",this._handleNotice.bind(this)),M.on("rowDescription",this._handleRowDescription.bind(this)),M.on("dataRow",this._handleDataRow.bind(this)),M.on("portalSuspended",this._handlePortalSuspended.bind(this)),M.on("emptyQuery",this._handleEmptyQuery.bind(this)),M.on("commandComplete",this._handleCommandComplete.bind(this)),M.on("parseComplete",this._handleParseComplete.bind(this)),M.on("copyInResponse",this._handleCopyInResponse.bind(this)),M.on("copyData",this._handleCopyData.bind(this)),M.on("notification",this._handleNotification.bind(this))}_checkPgPass(M){let H=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then((K)=>{if(K!==void 0){if(typeof K!="string"){H.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=K}else this.connectionParameters.password=this.password=null;M()}).catch((K)=>{H.emit("error",K)}):this.password!==null?M():z(this.connectionParameters,(K)=>{K!==void 0&&(this.connectionParameters.password=this.password=K),M()})}_handleAuthCleartextPassword(M){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(M){this._checkPgPass(()=>{let H=Z.postgresMd5PasswordHash(this.user,this.password,M.salt);this.connection.password(H)})}_handleAuthSASL(M){this._checkPgPass(()=>{this.saslSession=J.startSession(M.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(M){J.continueSession(this.saslSession,this.password,M.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(M){J.finalizeSession(this.saslSession,M.data),this.saslSession=null}_handleBackendKeyData(M){this.processID=M.processID,this.secretKey=M.secretKey}_handleReadyForQuery(M){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:H}=this;this.activeQuery=null,this.readyForQuery=!0,H&&H.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(M){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(M);this.emit("error",M)}}_handleErrorEvent(M){if(this._connecting)return this._handleErrorWhileConnecting(M);this._queryable=!1,this._errorAllQueries(M),this.emit("error",M)}_handleErrorMessage(M){if(this._connecting)return this._handleErrorWhileConnecting(M);let H=this.activeQuery;if(!H){this._handleErrorEvent(M);return}this.activeQuery=null,H.handleError(M,this.connection)}_handleRowDescription(M){this.activeQuery.handleRowDescription(M)}_handleDataRow(M){this.activeQuery.handleDataRow(M)}_handlePortalSuspended(M){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(M){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(M){this.activeQuery.handleCommandComplete(M,this.connection)}_handleParseComplete(M){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(M){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(M){this.activeQuery.handleCopyData(M,this.connection)}_handleNotification(M){this.emit("notification",M)}_handleNotice(M){this.emit("notice",M)}getStartupConf(){var M=this.connectionParameters,H={user:M.user,database:M.database},K=M.application_name||M.fallback_application_name;return K&&(H.application_name=K),M.replication&&(H.replication=""+M.replication),M.statement_timeout&&(H.statement_timeout=String(parseInt(M.statement_timeout,10))),M.lock_timeout&&(H.lock_timeout=String(parseInt(M.lock_timeout,10))),M.idle_in_transaction_session_timeout&&(H.idle_in_transaction_session_timeout=String(parseInt(M.idle_in_transaction_session_timeout,10))),M.options&&(H.options=M.options),H}cancel(M,H){if(M.activeQuery===H){var K=this.connection;this.host&&this.host.indexOf("/")===0?K.connect(this.host+"/.s.PGSQL."+this.port):K.connect(this.port,this.host),K.on("connect",function(){K.cancel(M.processID,M.secretKey)})}else M.queryQueue.indexOf(H)!==-1&&M.queryQueue.splice(M.queryQueue.indexOf(H),1)}setTypeParser(M,H,K){return this._types.setTypeParser(M,H,K)}getTypeParser(M,H){return this._types.getTypeParser(M,H)}escapeIdentifier(M){return'"'+M.replace(/"/g,'""')+'"'}escapeLiteral(M){for(var H=!1,K="'",S=0;S<M.length;S++){var R=M[S];R==="'"?K+=R+R:R==="\\"?(K+=R+R,H=!0):K+=R}return K+="'",H===!0&&(K=" E"+K),K}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let M=this.activeQuery.submit(this.connection);M&&q0.nextTick(()=>{this.activeQuery.handleError(M,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(M,H,K){var S,R,b,f,P;if(M==null)throw new TypeError("Client was passed a null or undefined query");return typeof M.submit=="function"?(b=M.query_timeout||this.connectionParameters.query_timeout,R=S=M,typeof H=="function"&&(S.callback=S.callback||H)):(b=this.connectionParameters.query_timeout,S=new A(M,H,K),S.callback||(R=new this._Promise((I,g)=>{S.callback=(E,V)=>E?g(E):I(V)}))),b&&(P=S.callback,f=setTimeout(()=>{var I=new Error("Query read timeout");q0.nextTick(()=>{S.handleError(I,this.connection)}),P(I),S.callback=()=>{};var g=this.queryQueue.indexOf(S);g>-1&&this.queryQueue.splice(g,1),this._pulseQueryQueue()},b),S.callback=(I,g)=>{clearTimeout(f),P(I,g)}),this.binary&&!S.binary&&(S.binary=!0),S._result&&!S._result._types&&(S._result._types=this._types),this._queryable?this._ending?(q0.nextTick(()=>{S.handleError(new Error("Client was closed and is not queryable"),this.connection)}),R):(this.queryQueue.push(S),this._pulseQueryQueue(),R):(q0.nextTick(()=>{S.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),R)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(M){if(this._ending=!0,!this.connection._connecting)if(M)M();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),M)this.connection.once("end",M);else return new this._Promise((H)=>{this.connection.once("end",H)})}};F(O,"Client");var L=O;L.Query=A,W.exports=L}),gF=V0(($,W)=>{N0();var X=h6().EventEmitter,Y=F(function(){},"NOOP"),Z=F((B,M)=>{let H=B.findIndex(M);return H===-1?void 0:B.splice(H,1)[0]},"removeWhere"),J=class B{constructor(M,H,K){this.client=M,this.idleListener=H,this.timeoutId=K}};F(J,"IdleItem");var z=J,Q=class B{constructor(M){this.callback=M}};F(Q,"PendingItem");var G=Q;function A(){throw new Error("Release called on client which has already been released to the pool.")}F(A,"throwOnDoubleRelease");function w(B,M){if(M)return{callback:M,result:void 0};let H,K,S=F(function(b,f){b?H(b):K(f)},"cb"),R=new B(function(b,f){K=b,H=f}).catch((b)=>{throw Error.captureStackTrace(b),b});return{callback:S,result:R}}F(w,"promisify");function D(B,M){return F(function H(K){K.client=M,M.removeListener("error",H),M.on("error",()=>{B.log("additional client error after disconnection due to error",K)}),B._remove(M),B.emit("error",K,M)},"idleListener")}F(D,"makeIdleListener");var O=class B extends X{constructor(M,H){super(),this.options=Object.assign({},M),M!=null&&"password"in M&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:M.password}),M!=null&&M.ssl&&M.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||H||L7().Client,this.Promise=this.options.Promise||QW.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map((H)=>{this._remove(H.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let M=this._pendingQueue.shift();if(this._idle.length){let H=this._idle.pop();clearTimeout(H.timeoutId);let K=H.client;K.ref&&K.ref();let S=H.idleListener;return this._acquireClient(K,M,S,!1)}if(!this._isFull())return this.newClient(M);throw new Error("unexpected condition")}_remove(M){let H=Z(this._idle,(K)=>K.client===M);H!==void 0&&clearTimeout(H.timeoutId),this._clients=this._clients.filter((K)=>K!==M),M.end(),this.emit("remove",M)}connect(M){if(this.ending){let S=new Error("Cannot use a pool after calling end on the pool");return M?M(S):this.Promise.reject(S)}let H=w(this.Promise,M),K=H.result;if(this._isFull()||this._idle.length){if(this._idle.length&&q0.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new G(H.callback)),K;let S=F((f,P,I)=>{clearTimeout(b),H.callback(f,P,I)},"queueCallback"),R=new G(S),b=setTimeout(()=>{Z(this._pendingQueue,(f)=>f.callback===S),R.timedOut=!0,H.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(R),K}return this.newClient(new G(H.callback)),K}newClient(M){let H=new this.Client(this.options);this._clients.push(H);let K=D(this,H);this.log("checking client timeout");let S,R=!1;this.options.connectionTimeoutMillis&&(S=setTimeout(()=>{this.log("ending client due to timeout"),R=!0,H.connection?H.connection.stream.destroy():H.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),H.connect((b)=>{if(S&&clearTimeout(S),H.on("error",K),b)this.log("client failed to connect",b),this._clients=this._clients.filter((f)=>f!==H),R&&(b.message="Connection terminated due to connection timeout"),this._pulseQueue(),M.timedOut||M.callback(b,void 0,Y);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let f=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(H),this._idle.findIndex((P)=>P.client===H)!==-1&&this._acquireClient(H,new G((P,I,g)=>g()),K,!1)},this.options.maxLifetimeSeconds*1000);f.unref(),H.once("end",()=>clearTimeout(f))}return this._acquireClient(H,M,K,!0)}})}_acquireClient(M,H,K,S){S&&this.emit("connect",M),this.emit("acquire",M),M.release=this._releaseOnce(M,K),M.removeListener("error",K),H.timedOut?S&&this.options.verify?this.options.verify(M,M.release):M.release():S&&this.options.verify?this.options.verify(M,(R)=>{if(R)return M.release(R),H.callback(R,void 0,Y);H.callback(void 0,M,M.release)}):H.callback(void 0,M,M.release)}_releaseOnce(M,H){let K=!1;return(S)=>{K&&A(),K=!0,this._release(M,H,S)}}_release(M,H,K){if(M.on("error",H),M._poolUseCount=(M._poolUseCount||0)+1,this.emit("release",K,M),K||this.ending||!M._queryable||M._ending||M._poolUseCount>=this.options.maxUses){M._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(M),this._pulseQueue();return}if(this._expired.has(M)){this.log("remove expired client"),this._expired.delete(M),this._remove(M),this._pulseQueue();return}let S;this.options.idleTimeoutMillis&&(S=setTimeout(()=>{this.log("remove idle client"),this._remove(M)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&S.unref()),this.options.allowExitOnIdle&&M.unref(),this._idle.push(new z(M,H,S)),this._pulseQueue()}query(M,H,K){if(typeof M=="function"){let R=w(this.Promise,M);return w7(function(){return R.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),R.result}typeof H=="function"&&(K=H,H=void 0);let S=w(this.Promise,K);return K=S.callback,this.connect((R,b)=>{if(R)return K(R);let f=!1,P=F((I)=>{f||(f=!0,b.release(I),K(I))},"onError");b.once("error",P),this.log("dispatching query");try{b.query(M,H,(I,g)=>{if(this.log("query dispatched"),b.removeListener("error",P),!f)return f=!0,b.release(I),I?K(I):K(void 0,g)})}catch(I){return b.release(I),K(I)}}),S.result}end(M){if(this.log("ending"),this.ending){let K=new Error("Called end on pool more than once");return M?M(K):this.Promise.reject(K)}this.ending=!0;let H=w(this.Promise,M);return this._endCallback=H.callback,this._pulseQueue(),H.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((M,H)=>M+(this._expired.has(H)?1:0),0)}get totalCount(){return this._clients.length}};F(O,"Pool");var L=O;W.exports=L}),UG={};A8(UG,{default:()=>MG});var MG,fF=S1(()=>{N0(),MG={}}),yF=V0(($,W)=>{W.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),dF=V0(($,W)=>{N0();var X=h6().EventEmitter,Y=(GW(),m2(k5)),Z=wW(),J=W.exports=function(Q,G,A){X.call(this),Q=Z.normalizeQueryConfig(Q,G,A),this.text=Q.text,this.values=Q.values,this.name=Q.name,this.callback=Q.callback,this.state="new",this._arrayMode=Q.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(w){w==="row"&&(this._emitRowEvents=!0)}.bind(this))};Y.inherits(J,X);var z={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};J.prototype.handleError=function(Q){var G=this.native.pq.resultErrorFields();if(G)for(var A in G){var w=z[A]||A;Q[w]=G[A]}this.callback?this.callback(Q):this.emit("error",Q),this.state="error"},J.prototype.then=function(Q,G){return this._getPromise().then(Q,G)},J.prototype.catch=function(Q){return this._getPromise().catch(Q)},J.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(Q,G){this._once("end",Q),this._once("error",G)}.bind(this)),this._promise)},J.prototype.submit=function(Q){this.state="running";var G=this;this.native=Q.native,Q.native.arrayMode=this._arrayMode;var A=F(function(O,L,B){if(Q.native.arrayMode=!1,w7(function(){G.emit("_done")}),O)return G.handleError(O);G._emitRowEvents&&(B.length>1?L.forEach((M,H)=>{M.forEach((K)=>{G.emit("row",K,B[H])})}):L.forEach(function(M){G.emit("row",M,B)})),G.state="end",G.emit("end",B),G.callback&&G.callback(null,B)},"after");if(q0.domain&&(A=q0.domain.bind(A)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var w=(this.values||[]).map(Z.prepareValue);if(Q.namedQueries[this.name]){if(this.text&&Q.namedQueries[this.name]!==this.text){let O=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return A(O)}return Q.native.execute(this.name,w,A)}return Q.native.prepare(this.name,this.text,w.length,function(O){return O?A(O):(Q.namedQueries[G.name]=G.text,G.native.execute(G.name,w,A))})}else if(this.values){if(!Array.isArray(this.values)){let O=new Error("Query values must be an array");return A(O)}var D=this.values.map(Z.prepareValue);Q.native.query(this.text,D,A)}else Q.native.query(this.text,A)}}),vF=V0(($,W)=>{N0();var X=(fF(),m2(UG)),Y=rQ(),Z=yF(),J=h6().EventEmitter,z=(GW(),m2(k5)),Q=O7(),G=dF(),A=W.exports=function(w){J.call(this),w=w||{},this._Promise=w.Promise||QW.Promise,this._types=new Y(w.types),this.native=new X({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var D=this.connectionParameters=new Q(w);this.user=D.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:D.password}),this.database=D.database,this.host=D.host,this.port=D.port,this.namedQueries={}};A.Query=G,z.inherits(A,J),A.prototype._errorAllQueries=function(w){let D=F((O)=>{q0.nextTick(()=>{O.native=this.native,O.handleError(w)})},"enqueueError");this._hasActiveQuery()&&(D(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(D),this._queryQueue.length=0},A.prototype._connect=function(w){var D=this;if(this._connecting){q0.nextTick(()=>w(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(O,L){if(O)return w(O);D.native.connect(L,function(B){if(B)return D.native.end(),w(B);D._connected=!0,D.native.on("error",function(M){D._queryable=!1,D._errorAllQueries(M),D.emit("error",M)}),D.native.on("notification",function(M){D.emit("notification",{channel:M.relname,payload:M.extra})}),D.emit("connect"),D._pulseQueryQueue(!0),w()})})},A.prototype.connect=function(w){if(w){this._connect(w);return}return new this._Promise((D,O)=>{this._connect((L)=>{L?O(L):D()})})},A.prototype.query=function(w,D,O){var L,B,M,H,K;if(w==null)throw new TypeError("Client was passed a null or undefined query");if(typeof w.submit=="function")M=w.query_timeout||this.connectionParameters.query_timeout,B=L=w,typeof D=="function"&&(w.callback=D);else if(M=this.connectionParameters.query_timeout,L=new G(w,D,O),!L.callback){let S,R;B=new this._Promise((b,f)=>{S=b,R=f}),L.callback=(b,f)=>b?R(b):S(f)}return M&&(K=L.callback,H=setTimeout(()=>{var S=new Error("Query read timeout");q0.nextTick(()=>{L.handleError(S,this.connection)}),K(S),L.callback=()=>{};var R=this._queryQueue.indexOf(L);R>-1&&this._queryQueue.splice(R,1),this._pulseQueryQueue()},M),L.callback=(S,R)=>{clearTimeout(H),K(S,R)}),this._queryable?this._ending?(L.native=this.native,q0.nextTick(()=>{L.handleError(new Error("Client was closed and is not queryable"))}),B):(this._queryQueue.push(L),this._pulseQueryQueue(),B):(L.native=this.native,q0.nextTick(()=>{L.handleError(new Error("Client has encountered a connection error and is not queryable"))}),B)},A.prototype.end=function(w){var D=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,w));var O;return w||(O=new this._Promise(function(L,B){w=F((M)=>M?B(M):L(),"cb")})),this.native.end(function(){D._errorAllQueries(new Error("Connection terminated")),q0.nextTick(()=>{D.emit("end"),w&&w()})}),O},A.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},A.prototype._pulseQueryQueue=function(w){if(this._connected&&!this._hasActiveQuery()){var D=this._queryQueue.shift();if(!D){w||this.emit("drain");return}this._activeQuery=D,D.submit(this);var O=this;D.once("_done",function(){O._pulseQueryQueue()})}},A.prototype.cancel=function(w){this._activeQuery===w?this.native.cancel(function(){}):this._queryQueue.indexOf(w)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(w),1)},A.prototype.ref=function(){},A.prototype.unref=function(){},A.prototype.setTypeParser=function(w,D,O){return this._types.setTypeParser(w,D,O)},A.prototype.getTypeParser=function(w,D){return this._types.getTypeParser(w,D)}}),kQ=V0(($,W)=>{N0(),W.exports=vF()}),L7=V0(($,W)=>{N0();var X=TF(),Y=MW(),Z=GG(),J=gF(),{DatabaseError:z}=JG(),Q=F((A)=>{var w;return w=class extends J{constructor(D){super(D,A)}},F(w,"BoundPool"),w},"poolFactory"),G=F(function(A){this.defaults=Y,this.Client=A,this.Query=this.Client.Query,this.Pool=Q(this.Client),this._pools=[],this.Connection=Z,this.types=UW(),this.DatabaseError=z},"PG");typeof q0.env.NODE_PG_FORCE_NATIVE<"u"?W.exports=new G(kQ()):(W.exports=new G(X),Object.defineProperty(W.exports,"native",{configurable:!0,enumerable:!1,get(){var A=null;try{A=new G(kQ())}catch(w){if(w.code!=="MODULE_NOT_FOUND")throw w}return Object.defineProperty(W.exports,"native",{value:A}),A}}))});N0();var wG=x5(L7());N7();N0();WG();N7();var hF=x5(wW()),AG=class $ extends Error{constructor(){super(...arguments);S0(this,"name","NeonDbError"),S0(this,"severity"),S0(this,"code"),S0(this,"detail"),S0(this,"hint"),S0(this,"position"),S0(this,"internalPosition"),S0(this,"internalQuery"),S0(this,"where"),S0(this,"schema"),S0(this,"table"),S0(this,"column"),S0(this,"dataType"),S0(this,"constraint"),S0(this,"file"),S0(this,"line"),S0(this,"routine"),S0(this,"sourceError")}};F(AG,"NeonDbError");var zW=AG,TQ="transaction() expects an array of queries, or a function returning an array of queries",pF=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];F(_W,"neon");F(_G,"createNeonQueryPromise");F(M7,"processQueryResult");var mF=x5(O7()),p6=x5(L7()),HG=class $ extends wG.Client{constructor(W){super(W);this.config=W}get neonConfig(){return this.connection.stream}connect(W){let{neonConfig:X}=this;X.forceDisablePgSSL&&(this.ssl=this.connection.ssl=!1),this.ssl&&X.useSecureWebSocket&&console.warn("SSL is enabled for both Postgres (e.g. ?sslmode=require in the connection string + forceDisablePgSSL = false) and the WebSocket tunnel (useSecureWebSocket = true). Double encryption will increase latency and CPU usage. It may be appropriate to disable SSL in the Postgres connection parameters or set forceDisablePgSSL = true.");let Y=this.config?.host!==void 0||this.config?.connectionString!==void 0||q0.env.PGHOST!==void 0,Z=q0.env.USER??q0.env.USERNAME;if(!Y&&this.host==="localhost"&&this.user===Z&&this.database===Z&&this.password===null)throw new Error(`No database host or connection string was set, and key parameters have default values (host: localhost, user: ${Z}, db: ${Z}, password: null). Is an environment variable missing? Alternatively, if you intended to connect with these parameters, please set the host to 'localhost' explicitly.`);let J=super.connect(W),z=X.pipelineTLS&&this.ssl,Q=X.pipelineConnect==="password";if(!z&&!X.pipelineConnect)return J;let G=this.connection;if(z&&G.on("connect",()=>G.stream.emit("data","S")),Q){G.removeAllListeners("authenticationCleartextPassword"),G.removeAllListeners("readyForQuery"),G.once("readyForQuery",()=>G.on("readyForQuery",this._handleReadyForQuery.bind(this)));let A=this.ssl?"sslconnect":"connect";G.on(A,()=>{this._handleAuthCleartextPassword(),this._handleReadyForQuery()})}return J}async _handleAuthSASLContinue(W){let X=this.saslSession,Y=this.password,Z=W.data;if(X.message!=="SASLInitialResponse"||typeof Y!="string"||typeof Z!="string")throw new Error("SASL: protocol error");let J=Object.fromEntries(Z.split(",").map((M0)=>{if(!/^.=/.test(M0))throw new Error("SASL: Invalid attribute pair entry");let c=M0[0],e=M0.substring(2);return[c,e]})),z=J.r,Q=J.s,G=J.i;if(!z||!/^[!-+--~]+$/.test(z))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing/unprintable");if(!Q||!/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(Q))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing/not base64");if(!G||!/^[1-9][0-9]*$/.test(G))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: missing/invalid iteration count");if(!z.startsWith(X.clientNonce))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");if(z.length===X.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");let A=parseInt(G,10),w=R0.from(Q,"base64"),D=new TextEncoder,O=D.encode(Y),L=await X1.subtle.importKey("raw",O,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),B=new Uint8Array(await X1.subtle.sign("HMAC",L,R0.concat([w,R0.from([0,0,0,1])]))),M=B;for(var H=0;H<A-1;H++)B=new Uint8Array(await X1.subtle.sign("HMAC",L,B)),M=R0.from(M.map((M0,c)=>M[c]^B[c]));let K=M,S=await X1.subtle.importKey("raw",K,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),R=new Uint8Array(await X1.subtle.sign("HMAC",S,D.encode("Client Key"))),b=await X1.subtle.digest("SHA-256",R),f="n=*,r="+X.clientNonce,P="r="+z+",s="+Q+",i="+A,I="c=biws,r="+z,g=f+","+P+","+I,E=await X1.subtle.importKey("raw",b,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var V=new Uint8Array(await X1.subtle.sign("HMAC",E,D.encode(g))),k=R0.from(R.map((M0,c)=>R[c]^V[c])),s=k.toString("base64");let a=await X1.subtle.importKey("raw",K,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),v=await X1.subtle.sign("HMAC",a,D.encode("Server Key")),r=await X1.subtle.importKey("raw",v,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var $0=R0.from(await X1.subtle.sign("HMAC",r,D.encode(g)));X.message="SASLResponse",X.serverSignature=$0.toString("base64"),X.response=I+",p="+s,this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}};F(HG,"NeonClient");var cF=HG;F(DG,"promisify");var uF=class $ extends wG.Pool{constructor(){super(...arguments);S0(this,"Client",cF),S0(this,"hasFetchUnsupportedListeners",!1)}on(W,X){return W!=="error"&&(this.hasFetchUnsupportedListeners=!0),super.on(W,X)}query(W,X,Y){if(!AW.poolQueryViaFetch||this.hasFetchUnsupportedListeners||typeof W=="function")return super.query(W,X,Y);typeof X=="function"&&(Y=X,X=void 0);let Z=DG(this.Promise,Y);Y=Z.callback;try{let J=new mF.default(this.options),z=encodeURIComponent,Q=encodeURI,G=`postgresql://${z(J.user)}:${z(J.password)}@${z(J.host)}/${Q(J.database)}`,A=typeof W=="string"?W:W.text,w=X??W.values??[];_W(G,{fullResults:!0,arrayMode:W.rowMode==="array"})(A,w).then((D)=>Y(void 0,D)).catch((D)=>Y(D))}catch(J){Y(J)}return Z.result}};F(uF,"NeonPool");var{ClientBase:Pi,Connection:Ei,DatabaseError:Ci,Query:qi,defaults:Vi,types:m6}=p6;/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/class BG{static[o]="ConsoleLogWriter";write($){console.log($)}}class T5{static[o]="DefaultLogger";writer;constructor($){this.writer=$?.writer??new BG}logQuery($,W){const X=W.map((Z)=>{try{return JSON.stringify(Z)}catch{return String(Z)}}),Y=X.length?` -- params: [${X.join(", ")}]`:"";this.writer.write(`Query: ${$}${Y}`)}}class g5{static[o]="NoopLogger";logQuery(){}}class OG extends S5{constructor($,W,X,Y,Z,J){super({sql:W,params:X});this.client=$,this.queryString=W,this.params=X,this.logger=Y,this.fields=Z,this.customResultMapper=J}static[o]="PostgresJsPreparedQuery";async execute($={}){return G2.startActiveSpan("drizzle.execute",async(W)=>{const X=x6(this.params,$);W?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(X)}),this.logger.logQuery(this.queryString,X);const{fields:Y,queryString:Z,client:J,joinsNotNullableMap:z,customResultMapper:Q}=this;if(!Y&&!Q)return G2.startActiveSpan("drizzle.driver.execute",()=>{return J.unsafe(Z,X)});const G=await G2.startActiveSpan("drizzle.driver.execute",()=>{return W?.setAttributes({"drizzle.query.text":Z,"drizzle.query.params":JSON.stringify(X)}),J.unsafe(Z,X).values()});return G2.startActiveSpan("drizzle.mapResponse",()=>{return Q?Q(G):G.map((A)=>v4(Y,A,z))})})}all($={}){return G2.startActiveSpan("drizzle.execute",async(W)=>{const X=x6(this.params,$);return W?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(X)}),this.logger.logQuery(this.queryString,X),G2.startActiveSpan("drizzle.driver.execute",()=>{return W?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(X)}),this.client.unsafe(this.queryString,X)})})}}class f5 extends R5{constructor($,W,X,Y={}){super(W);this.client=$,this.schema=X,this.options=Y,this.logger=Y.logger??new g5}static[o]="PostgresJsSession";logger;prepareQuery($,W,X,Y){return new OG(this.client,$.sql,$.params,this.logger,W,Y)}query($,W){return this.logger.logQuery($,W),this.client.unsafe($,W).values()}queryObjects($,W){return this.client.unsafe($,W)}transaction($,W){return this.client.begin(async(X)=>{const Y=new f5(X,this.dialect,this.schema,this.options),Z=new F7(this.dialect,Y,this.schema);if(W)await Z.setTransaction(W);return $(Z)})}}class F7 extends cX{constructor($,W,X,Y=0){super($,W,X,Y);this.session=W}static[o]="PostgresJsTransaction";transaction($){return this.session.client.savepoint((W)=>{const X=new f5(W,this.dialect,this.schema,this.session.options),Y=new F7(this.dialect,X,this.schema);return $(Y)})}}var NG=function($,W={}){const X=new T6;let Y;if(W.logger===!0)Y=new T5;else if(W.logger!==!1)Y=W.logger;let Z;if(W.schema){const z=o4(W.schema,i4);Z={fullSchema:W.schema,schema:z.tables,tableNamesMap:z.tableNamesMap}}const J=new f5($,X,Z,{logger:Y});return new g6(X,J,Z)};var LG={arrayMode:!1,fullResults:!0},FG={arrayMode:!0,fullResults:!0};class KG extends S5{constructor($,W,X,Y,Z){super(W);this.client=$,this.logger=X,this.fields=Y,this.customResultMapper=Z}static[o]="NeonHttpPreparedQuery";async execute($={}){const W=x6(this.query.params,$);this.logger.logQuery(this.query.sql,W);const{fields:X,client:Y,query:Z,customResultMapper:J}=this;if(!X&&!J)return Y(Z.sql,W,LG);const z=await Y(Z.sql,W,FG);return this.mapResult(z)}mapResult($){if(!this.fields&&!this.customResultMapper)return $;const W=$.rows;if(this.customResultMapper)return this.customResultMapper(W);return W.map((X)=>v4(this.fields,X,this.joinsNotNullableMap))}all($={}){const W=x6(this.query.params,$);return this.logger.logQuery(this.query.sql,W),this.client(this.query.sql,W,LG).then((X)=>X.rows)}values($={}){const W=x6(this.query.params,$);return this.logger.logQuery(this.query.sql,W),this.client(this.query.sql,W).then((X)=>X.rows)}}class K7 extends R5{constructor($,W,X,Y={}){super(W);this.client=$,this.schema=X,this.options=Y,this.logger=Y.logger??new g5}static[o]="NeonHttpSession";logger;prepareQuery($,W,X,Y){return new KG(this.client,$,this.logger,W,Y)}async batch($){const W=[],X=[];for(let Z of $){const J=Z._prepare(),z=J.getQuery();W.push(J),X.push(this.client(z.sql,z.params))}return(await this.client.transaction(X,FG)).map((Z,J)=>W[J].mapResult(Z,!0))}async query($,W){return this.logger.logQuery($,W),await this.client($,W,{arrayMode:!0})}async queryObjects($,W){return this.client($,W)}async transaction($,W={}){throw new Error("No transactions support in neon-http driver")}}var PG=function($,W={}){const X=new T6;let Y;if(W.logger===!0)Y=new T5;else if(W.logger!==!1)Y=W.logger;let Z;if(W.schema){const Q=o4(W.schema,i4);Z={fullSchema:W.schema,schema:Q.tables,tableNamesMap:Q.tableNamesMap}}const z=new SG($,X,{logger:Y}).createSession(Z);return new RG(X,z,Z)};class SG{constructor($,W,X={}){this.client=$,this.dialect=W,this.options=X,this.initMappers()}static[o]="NeonDriver";createSession($){return new K7(this.client,this.dialect,$,{logger:this.options.logger})}initMappers(){m6.setTypeParser(m6.builtins.TIMESTAMPTZ,($)=>$),m6.setTypeParser(m6.builtins.TIMESTAMP,($)=>$),m6.setTypeParser(m6.builtins.DATE,($)=>$)}}class RG extends g6{static[o]="NeonHttpDatabase";async batch($){return this.session.batch($)}}function EG($){return typeof $==="string"&&$.toLowerCase()==="true"}function B$(){const $=process.env.ENV,X=process.env.TESTING_DB_URL,Y=process.env.MIGRATIONS_FOLDER,Z=process.env.NEON_DB_CONNECTION_TEMPLATE,J=process.env.VERBOSE,z={migrationsFolder:Y,processEnvironment:$,localDbURL:"postgresql://postgres:postgres@127.0.0.1:54322/postgres",testingDbURL:X,verbose:EG(J)};if(!$)console.error("\u26D4\uFE0F Missing process environment. Add ENV=dev|test|prod "),process.exit(-1);if($==="test"){const Q={...z,neonApiKey:process.env.NEON_API_KEY,neonDBConnectionTemplate:Z};return console.info("\uD83C\uDF25\uFE0F Test env configs loaded ",J?Q:""),Q}return z}function W8(){if(oF==="test")return c6.get("PreloadKey")||tF();return sF()}function tF($){const W=$?.cacheKey||"testingConnection";console.log("Key used ",W);const X=c6.get(W);if(X)return console.info("\uD83D\uDC4D Read from cache"),X;const Y=$?.overrideURL||iF,Z=PG(_W(Y),{schema:n4,logger:nF||!1});return console.info(`\u2705 New connection to Neon Db established using ${Y}`),c6.set(W,Z),c6.get(W)}function sF(){const W=c6.get("prodConnection");if(W)return W;const X=NG(IQ(lF),{schema:n4});return console.info("\u2705 Connection to Postgres database established"),c6.set("prodConnection",X),c6.get("prodConnection")}var{processEnvironment:oF,testingDbURL:iF,localDbURL:lF,migrationsFolder:Bl,verbose:nF}=B$(),c6=new Map;async function CG($){const W=W8(),X=Array.isArray($)?$:[$];return await W.insert(w8).values(X).returning({id:w8.id,name:w8.name,description:w8.description})}async function qG($){return await W8().insert(o8).values($).returning({id:o8.id,tagId:o8.tagId,transactionId:o8.transactionId})}async function VG($,W){const X=W8();return await Promise.all(W.map(async(Y)=>{return await X.select().from(w8).where(k6(e1(w8.userId,$),e1(w8.id,Y))).leftJoin(o8,e1(w8.id,o8.tagId)).leftJoin(M8,e1(o8.transactionId,M8.id))}))}async function jG($){const W=`inserting ${$.length} transactions`;console.time(W);const X=await Promise.all($.map(async(Q)=>{return await rF(Q)}));console.timeEnd(W);let Y=!0;const Z=[],J=[],z=[];for(let Q of X){const{message:G,value:A,payload:w}=Q;switch(G){case"success":Z.push(A);break;case"duplicate":J.push(w),Y=!1;break;case"unknown":z.push(A),Y=!1;break}}return{message:Y?"success":"partial",oks:Z,duplicates:J,failed:z}}async function rF($){const W=W8();let X;try{X=await W.insert(M8).values($).returning({id:M8.id,messageId:M8.messageId,transactionCode:M8.transactionCode,dateAdded:M8.dateAdded})}catch(Y){if(!(Y instanceof Error))throw Y;if(Y.message.includes("duplicate key value violates unique constraint"))return console.log("Duplicate key value violates unique constraint"),{message:"duplicate",payload:$}}if(!X||X.length===0)return console.log("Unknown error, Check logs."),{message:"unknown"};return{message:"success",value:X[0]}}async function IG($){const W=W8(),X=Bun.password.hashSync($.password),[Y]=await W.insert(J2).values({...$,password:X}).returning({id:J2.id,username:J2.username,email:J2.email,phoneNumber:J2.phoneNumber,dateAdded:J2.dateAdded,lastModified:J2.lastModified});return Y}async function bG($,W){const X=W8(),[Y]=await X.select({id:J2.id,username:J2.username,email:J2.email,phoneNumber:J2.phoneNumber,dateAdded:J2.dateAdded,lastModified:J2.lastModified,password:J2.password}).from(J2).where(e1(J2.username,$));if(!Y)return"user_not_found";else if(!Bun.password.verifySync(W,Y.password))return"incorrect_password";const{password:Z,...J}=Y;return J}async function HW($){const W=W8(),[X]=await W.select({id:J2.id,username:J2.username,email:J2.email,phoneNumber:J2.phoneNumber,dateAdded:J2.dateAdded,lastModified:J2.lastModified}).from(J2).where(e1(J2.id,$));if(!X)return null;return X}async function w6(){return{publicKey:await Bun.file("./temp/public_key.pem").text(),privateKey:await Bun.file("./temp/private_key.pem").text()}}async function xG($,W){const X=await GX($,"RS256");return await new b4().setProtectedHeader({alg:"RS256"}).setIssuedAt().setSubject(W).setExpirationTime("2h").sign(X)}async function y5($,W){const X=await QX($,"RS256");let Y;try{const{payload:J}=await UX(W,X);Y=J}catch(J){return"Invalid"}if(!Y||!Y.exp||!Y.sub)return"Invalid";if(Y.exp*1000<=Date.now())return"Expired";if(await HW(Number(Y.sub))==null)return"User not found";return Y}var kG=Q0.Object({subject:Q0.Optional(Q0.String()),password:Q0.String()}),TG="/sign-in";var gG=new n0().use(X6()).state("keys",w6).post(TG,async({body:$,set:W,store:{keys:X}})=>{const{subject:Y,password:Z}=$;if(!Y)return W.status=400,{message:"Email or Phone Number or Email is required"};const J=await bG(Y,Z);if(typeof J==="string")return W.status=400,{message:J};const{privateKey:z}=await X(),Q=await xG(z,String(J.id));return{user:J,token:Q,message:"OK"}},{body:kG});var fG="/sign-up",yG=Q0.Object({username:Q0.String(),password:Q0.String(),email:Q0.String()});var dG=new n0().use(X6()).state("keys",w6).post(fG,async({body:$,set:W})=>{const{username:X,password:Y,email:Z}=$,z=await IG({username:X,password:Y,email:Z});if(!z)return W.status=400,{message:"User already exists"};return{user:z,message:"OK"}},{body:yG});var vG="/verify";var hG=new n0().use(X6()).state("keys",w6).get(vG,async({bearer:$,set:W,store:{keys:X}})=>{if(!$)return W.status=400,W.headers["WWW-Authenticate"]=`Bearer realm='sign', error="invalid_request"`,"FAIL";const{publicKey:Y}=await X(),Z=await y5(Y,$);if(typeof Z==="string")switch(W.status=400,W.headers["WWW-Authenticate"]=`Bearer realm='sign', error="invalid_token"`,Z){case"Invalid":case"Expired":case"User not found":return"FAIL"}return"OK"});var aF=new n0().group("/users",($)=>$.use(gG).use(dG).use(hG)),pG=aF;var eF=W8(),mG=new n0().onError(({code:$,error:W,set:X})=>{switch(console.error(W),$){case"NOT_FOUND":return X.status=404,"Not Found :(";case"INTERNAL_SERVER_ERROR":return X.status=500,"Internal Server Error :(";default:return X.status=400,"Bad Request :("}}),cG=new n0().state("config",B$()),O$=new n0().state("transactionTypes",await(async()=>{return await eF.query.transactionTypeTable.findMany()})()),A6=new n0().guard({headers:Q0.Object({authorization:Q0.TemplateLiteral("Bearer ${string}")})}).use(X6()).state("keys",w6).onBeforeHandle(async({bearer:$,set:W,store:{keys:X}})=>{if(!$)return W.status=401,W.headers["WWW-Authenticate"]=`Bearer realm='sign', error="invalid_request"`,{message:"not_authenticated"};const{publicKey:Y}=await X(),Z=await y5(Y,$);if(typeof Z==="string")switch(W.status=401,W.headers["WWW-Authenticate"]=`Bearer realm='sign', error="invalid_token"`,Z){case"User not found":case"Invalid":return{message:"invalid_token"};case"Expired":return{message:"expired_token"}}}).derive(async({bearer:$,store:{keys:W}})=>{const{publicKey:X}=await W(),Y=await y5(X,$);if(typeof Y==="string")return{};return{user:await HW(Number(Y.sub))}});var $K=Q0.Object({agentNumber:Q0.Optional(Q0.String()),balance:Q0.String(),dateTime:Q0.String(),interest:Q0.Optional(Q0.String()),location:Q0.Optional(Q0.String()),messageId:Q0.String(),subject:Q0.String(),subjectAccount:Q0.Optional(Q0.String()),subjectPhoneNumber:Q0.Optional(Q0.String()),transactionAmount:Q0.String(),transactionCode:Q0.String(),transactionCost:Q0.String(),type:Q0.String()}),uG=Q0.Object({raw:Q0.Array($K)});var oG=new n0().use(A6).use(O$).post("/transactions",async({body:$,user:W,store:{transactionTypes:X}})=>{const{raw:Y}=$,Z=Y.map((J)=>{const z=X.find((Q)=>Q.name===J.type);if(!z)throw new Error(`Transaction type, ${z}, not found`);return{...J,balance:Number(J.balance),dateTime:new Date(Number(J.dateTime)),interest:J.interest?Number(J.interest):null,messageId:Number(J.messageId),transactionAmount:Number(J.transactionAmount),transactionCost:Number(J.transactionCost),transactionTypeId:z.id,type:X.find((Q)=>Q.name===J.type)?.id??0,userId:W?.id}});return await jG(Z)},{type:"application/json",body:uG});var iG=new n0().onError(({code:$,error:W,set:X})=>{if($==="VALIDATION")return X.status=400,{message:W,suggest:"Check your values for null values"};if($==="INTERNAL_SERVER_ERROR")return X.status=500,{message:"Internal server error",error:W.message}});var WK=new n0().use(iG).group("/upload",($)=>$.use(oG)),lG=WK;var nG=Q0.Object({name:Q0.String(),description:Q0.Optional(Q0.String())}),tG=Q0.Union([nG,Q0.Array(nG)]),sG="/";var rG=new n0().use(A6).use(O$).post(sG,async({body:$,user:W})=>{const X=Array.isArray($)?$.map((Z)=>({...Z,userId:W?.id})):{...$,userId:W?.id};return{tag:await CG(X),message:"OK"}},{body:tG});var aG=Q0.Object({tagId:Q0.Number(),transactionId:Q0.Number()});var eG=new n0().use(A6).post("/link",async({body:$,user:W})=>{const X={...$,userId:W?.id};return await qG(X)},{body:aG});var $U=new n0().use(A6).use(O$).get("/:id",async({user:$,params:{id:W},body:{ids:X}})=>{return await VG($?.id,[W,...X])},{params:Q0.Optional(Q0.Object({id:Q0.Number()})),body:Q0.Optional(Q0.Object({ids:Q0.Array(Q0.Number())}))});var XK=new n0().group("/tag",($)=>$.use(rG).use($U).use(eG)),WU=XK;var YK="Hello Traveller!",ZK=new n0().use(mG).use(cG).get("/",()=>YK).use(pG).use(lG).use(WU),XU=ZK;var JK=function(){const{processEnvironment:$,localDbURL:W}=B$();if($==="dev"&&!W)console.error("\u2757\uFE0F Missing db configs"),process.exit();const X=XU;if(X.listen(process.env.PORT||3000),$==="dev")console.info(`\uD83D\uDCF6 Elysia is running at http://${X.server?.hostname}:${X.server?.port}`)};JK();
